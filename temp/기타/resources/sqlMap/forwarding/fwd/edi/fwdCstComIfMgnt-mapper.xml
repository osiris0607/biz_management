<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="fwd.edi.fwdCstComIfMgnt">

    <!-- LGCHBL조회 -->
    <select id="selectLgCHbl" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgCHbl */
		SELECT
		       IF( ROW_NUMBER() OVER ( PARTITION BY A.BL_NO ORDER BY A.BL_NO) = 1,'F','N') AS CHK
		       , ROW_NUMBER() OVER ( PARTITION BY A.BL_NO ORDER BY A.BL_NO) AS BL_SEQ 
		       , (SELECT COUNT(BL_ID) AS SEND_CNT FROM NFINF.TB_FWD_INT560 WHERE BL_ID = A.BL_ID ) AS SEND_CNT /* BL SEND COUNT 필드 추가 */
		       , COUNT(1) OVER ( PARTITION BY A.BL_NO ORDER BY A.BL_NO) AS BL_CNT
		       , MAX(
			       CASE 
				       WHEN A.EXCT_SPR_CD = 'AR'
				       THEN ''
				       WHEN A.EXCT_SPR_CD = 'OC'
				       THEN IF(A.BL_SPR_CD = 'D', '02', '01')
				       ELSE ''
				    END
		         ) AS GUBUN /* 01:전송화면 HBL, 02:전송화면 DBL, 03:BL화면 HBL, 04:BL화면 DBL*/ 
		       , MAX(A.BL_SPR_CD) AS BL_SPR_CD /* BL 구분*/
		       /* FC_CM_GET_ETC_CD_NM('0055', MAX(A.BL_SPR_CD)) AS BL_SPR_NM BL 구분 */ 
		       , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
			         <property name="clasCd" value="'0055'"/>
			         <property name="dtlCd" value="MAX(A.BL_SPR_CD)"/>
			     </include>) AS BL_SPR_NM
		       , '' AS XML_MSG_ID /* XML MSG ID */
		       , A.RPRS_REF_NO /* 대표참조번호 */
		       , A.MBL_NO /* MBL NO*/
		       , A.BL_NO  /* BL NO */ 
		       , MAX(E.ORD_BIZPTNR_CD) AS BIZPTNR_CD
		       , MAX((SELECT BIZPTNR_ENG_NM
		              FROM   TB_COM_BIZPTNR
		              WHERE  BIZPTNR_CD = E.ORD_BIZPTNR_CD)) AS BIZPTNR_NM /* 거래처명 */
		       , MAX(A.FLT_VSL_NM) AS FLT_VSL_NM  /* 편기선명 */
		       , MAX(D.CARR_CD) AS CARR_CD /* 운송사코드 */
		       , MAX((SELECT BIZPTNR_ENG_NM
	                  FROM   TB_COM_BIZPTNR
	                  WHERE  BIZPTNR_CD = D.CARR_CD)) CARR_NM /* 운송사명 */
		       , MAX(A.POD_CD) AS POD_CD  /* POD 코드 */
		       , MAX(A.POD_NM) AS POD_NM  /* POD 명 */ 
		       , MAX(A.FDEST_CD) AS FDEST_CD  /* FDEST코드 */
		       , MAX(A.FDEST_NM) AS FDEST_NM  /* FDEST명 */
		       , MAX(A.PDEL_CD) AS PDEL_CD /* PDEL코드*/
		       , MAX(A.PDEL_NM) AS PDEL_NM /* PDEL명*/
		       , MAX(A.ONBR_YMD) AS ONBR_YMD /* 선적일자 */
		       , A.BL_ID AS BL_ID /* BL ID*/
		       , A.MBL_ID AS MBL_ID /* MBL ID */
		       , MAX(
				    CASE 
				       WHEN IFNULL(B.BL_CUST_SEND_YN, 'N') = 'N'
				       THEN '최초전송'
				       WHEN IFNULL(B.BL_CUST_SEND_YN, 'N') = 'C'
				       THEN 'BL전송'
				       WHEN IFNULL(B.BL_CUST_SEND_YN, 'N') = 'Y'
				       THEN '재전송'
				    END
		         ) AS SEND_STAT_NM
		       , IFNULL(
		             ( SELECT SUM(CTRT_FRGH_AMT) 
		                FROM   TB_ISM_SELLBUY
		                WHERE  BL_ID = A.BL_ID
		                       AND ADJ_YN = 'Y'
		                       AND ADJ_STN_TYPE_CD = IF(A.BL_SPR_CD = 'D', '02', '01')
		                       AND SELLBUY_SPR_CD = 'SO' /* 공통코드 0051 SO:매출 SI:사내매출 ASIS   A.BUY_SALES_TYPE = 'S' */
		                       AND DOM_ABRD_BIZPTNR_TYPE_CD IN ('1','2') /* 국내거래처 */
		                       AND INV_NO IS NULL
		                       AND DEL_YN = 'N'), 0) AS FRGH_SUM
		       , MAX(A.EXCT_SPR_CD) EXCT_SPR_CD
		       , #{ptnrSprCd} AS PTNR_SPR_CD
		       , MAX(D.INTG_TASK_NO) INTG_TASK_NO                       
		       , ( SELECT BB.INTG_TASK_NO 
		           FROM TB_FWD_BL AA
	               INNER JOIN TB_SMT_INTG_TASK_DEPT BB 
		           WHERE AA.BL_ID = A.MBL_ID
		                 AND AA.EO_NO = BB.EO_NO
		                 AND AA.BL_ID = BB.CST_BL_ID
		                 AND IFNULL(AA.DEL_YN, 'N') = 'N'
		                 AND IFNULL(BB.DEL_YN, 'N') = 'N'
		                 AND BB.TASK_SPR_CD = 'EXP'
		          LIMIT 1) MBL_INTG_TASK_NO
		       , MAX(A.SMT_NO) SMT_NO 
		       , MAX(A.EO_NO) EO_NO
		       , MAX(A.LADG_TYPE_CD) AS LADG_TYPE_CD   
		       , MAX(D.TASK_SPR_CD) AS TASK_SPR_CD                         
		FROM 
		  TB_FWD_BL A
		LEFT OUTER JOIN 
		  TB_FWD_BL_EXPND B ON B.BL_ID = A.BL_ID  /* HBL 확장 */
		INNER JOIN 
		  TB_SMT_INTG_TASK_DEPT D ON D.CST_BL_ID = A.BL_ID /* 통합실행부서*/
		                             AND D.EO_NO = A.EO_NO
		                             AND D.DEL_YN = 'N'
		                             AND D.EXCT_BIZPTNR_CD = #{corpCd}       /* 본사전용 */
		INNER JOIN 
		  TB_SMT_ORD E ON E.SMT_NO = A.SMT_NO
		                  AND E.DEL_YN = 'N'
		                  AND E.ORD_BIZPTNR_CD = #{shppCd}
		WHERE    1=1
		  AND    A.BL_SPR_CD IN ('H','D')
		  AND    A.DEL_YN = 'N'            
		  AND    IFNULL(A.NON_EXCT_BL_YN,'N') = 'N'
		  AND    A.EXCT_SPR_CD = #{exctSprCd}
          AND    E.ORD_BIZPTNR_CD IN (SELECT  BIZPTNR_CD
		                              FROM    TB_COM_BIZPTNR  /* MAIN */
		                              WHERE   BIZPTNR_GRP_CD = (CASE 
												                 WHEN #{ptnrSprCd} = 'LGC'
												                 THEN '1001010'
												                 WHEN #{ptnrSprCd} = 'LGH'
												                 THEN '1001019'
												                 WHEN #{ptnrSprCd} = 'LGM'
												                 THEN '1001021'
												                 WHEN #{ptnrSprCd} = 'LGES'
												                 THEN '1008002'
												                END)
                                       AND     USE_YN = 'Y'
                                       AND     MBIZPTNR_YN = 'Y'
                                       /* 생명과학, 화학 구분 조건*/
                                       AND     'O' = (CASE WHEN #{ptnrSprCd} = 'LGC' THEN
                                                         CASE WHEN 'O' = IFNULL( (SELECT 'O' 
                                                                                  FROM TB_COM_ETC_CD 
                                                                                  WHERE CLAS_CD ='1323'
                                                                                  AND   ETC_CONT1 = 'LGC'
                                                                                  AND   DTL_CD_NM = A.SHPP_CD 
                                                                                  AND   USE_YN = 'Y'
                                                                                  LIMIT 1), 'X')
                                                              THEN 'O' 
                                                              ELSE 'X'
                                                          END
                                                        ELSE 'O'
                                                        END )
                                    UNION ALL
                                       SELECT      A.BIZPTNR_CD
                                       FROM        TB_COM_BIZPTNR A  /* SUB */
                                       INNER JOIN  TB_COM_BIZPTNR B  /* MAIN */
                                       WHERE       A.USE_YN = 'Y'
                                       AND         A.MBIZPTNR_YN = 'N'
                                       AND         A.MBIZPTNR_CD = B.BIZPTNR_CD
                                       AND         B.BIZPTNR_GRP_CD = (CASE 
													                    WHEN #{ptnrSprCd} = 'LGC'
													                    THEN '1001010'
													                    WHEN #{ptnrSprCd} = 'LGH'
													                    THEN '1001019'
													                    WHEN #{ptnrSprCd} = 'LGM'
													                    THEN '1001021'
													                    WHEN #{ptnrSprCd} = 'LGES'
													                    THEN '1008002'
													                 END)
                                       /* 생명과학, 화학 구분 조건*/
                                       AND     'O' = (CASE WHEN #{ptnrSprCd} = 'LGC' THEN
	                                                       CASE WHEN 'O' = IFNULL( (SELECT 'O' 
				                                                                     FROM  TB_COM_ETC_CD 
				                                                                     WHERE CLAS_CD ='1323'
				                                                                     AND   ETC_CONT1 = 'LGC'
				                                                                     AND   DTL_CD_NM =  A.SHPP_CD 
				                                                                     AND   USE_YN = 'Y'
				                                                                     LIMIT 1), 'X')
	                                                            THEN 'O' 
	                                                            ELSE 'X' 
	                                                            END
	                                                   ELSE 'O'
	                                                   END )
                                         ) 
            <![CDATA[  
            AND A.ONBR_YMD >= #{fromDt}
            AND A.ONBR_YMD <= #{toDt}     
            ]]>
            <if test="ofcrEmpno != null and ofcrEmpno != ''">
               AND   D.OFCR_EMPNO = #{ofcrEmpno}
            </if>
            <if test="blNo != null and blNo != '' ">
               AND   A.BL_NO LIKE CONCAT(#{blNo},'%')
            </if>
            <if test="rprsRefNo != null and rprsRefNo != '' ">
               AND   RPRS_REF_NO CONCAT(#{rprsRefNo},'%')
            </if>      
            <if test="blSprCd != null and blSprCd != '' ">
               AND   A.BL_SPR_CD = #{blSprCd}
            </if>      
            <if test="exctSprCd != null and exctSprCd != '' and exctSprCd == 'AR' ">
               AND   D.TASK_SPR_CD IN ('EXP', 'TRD')
            </if>
            <if test="exctSprCd != null and exctSprCd != '' and exctSprCd == 'OC' ">
               AND   D.TASK_SPR_CD = 'EXP'
            </if>  
            <if test="sendType != null and sendType != ''">
               AND   IF(IFNULL(B.BL_CUST_SEND_YN,'N')='C', 'N',IFNULL(B.BL_CUST_SEND_YN,'N')) = #{sendType}
            </if>       
		GROUP BY A.RPRS_REF_NO /* 대표참조번호 */
		         , A.MBL_NO /* MBL NO*/
		         , A.BL_NO  /* BL NO */
		         , A.MBL_ID, A.BL_ID, A.MBL_NO, A.BL_SPR_CD
	   ORDER BY SEND_STAT_NM, A.RPRS_REF_NO
    </select>
    
    <!-- FHN HBL조회 -->
    <select id="selectLgCHblFHN" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgCHblFHN */
        SELECT
		       IF( ROW_NUMBER() OVER ( PARTITION BY A.BL_NO ORDER BY A.BL_NO) = 1,'F','N') AS CHK
		       , ROW_NUMBER() OVER ( PARTITION BY A.BL_NO ORDER BY A.BL_NO) AS BL_SEQ 
		       , (SELECT COUNT(BL_ID) AS SEND_CNT FROM NFINF.TB_FWD_INT560 WHERE BL_ID = A.BL_ID ) AS SEND_CNT /* BL SEND COUNT 필드 추가 */
		       , COUNT(1) OVER ( PARTITION BY A.BL_NO ORDER BY A.BL_NO) AS BL_CNT
		       , MAX(
					    CASE 
					     WHEN A.EXCT_SPR_CD = 'AR'
					     THEN ''
					     WHEN A.EXCT_SPR_CD = 'OC'
					     THEN IF(A.BL_SPR_CD = 'D', '02', '01')
					     ELSE ''
					    END
		            ) AS GUBUNN /* 01:전송화면 HBL, 02:전송화면 DBL, 03:BL화면 HBL, 04:BL화면 DBL*/ 
		       , MAX(A.BL_SPR_CD) AS BL_SPR_CD /* BL 구분*/ 
		       , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                     <property name="clasCd" value="'0055'"/>
                     <property name="dtlCd" value="MAX(A.BL_SPR_CD)"/>
                 </include>) AS BL_SPR_NM
		       /*, FC_CM_GET_ETC_CD_NM('0055', MAX(A.BL_SPR_CD)) AS BL_SPR_NM  BL 구분 */
		       , '' AS XML_MSG_ID /* XML MSG ID */
		       , A.RPRS_REF_NO /* 대표참조번호 */
		       , A.MBL_NO /* MBL NO*/
		       , A.BL_NO  /* BL NO */ 
		       , MAX((SELECT BIZPTNR_ENG_NM
		              FROM   TB_COM_BIZPTNR
		              WHERE  BIZPTNR_CD = E.ORD_BIZPTNR_CD)) AS BIZPTNR_NM /* 거래처명 */
		       , MAX(A.FLT_VSL_NM) AS FLT_VSL_NM  /* 편기선명 */
		       , MAX(D.CARR_CD) AS CARR_CD /* 운송사코드 */
		       , MAX((SELECT BIZPTNR_ENG_NM
		              FROM   TB_COM_BIZPTNR
		              WHERE  BIZPTNR_CD = D.CARR_CD)) AS CARR_NM /* 운송사명 */
		       , MAX(A.POD_CD) AS POD_CD  /* POD 코드 */
		       , MAX(A.POD_NM) AS POD_NM  /* POD 명 */ 
		       , MAX(A.FDEST_CD) AS FDEST_CD  /* FDEST코드 */
		       , MAX(A.FDEST_NM) AS FDEST_NM  /* FDEST명 */
		       , MAX(A.PDEL_CD) AS PDEL_CD /* PDEL코드*/
		       , MAX(A.PDEL_NM) AS PDEL_NM /* PDEL명*/
		       , MAX(A.ONBR_YMD) AS ONBR_YMD /* 선적일자 */
		       , A.BL_ID AS BL_ID /* BL ID*/
		       , A.MBL_ID AS MBL_ID /* MBL ID */
		       , MAX(
					    CASE 
					     WHEN IFNULL(B.BL_CUST_SEND_YN, 'N') = 'N'
					     THEN '최초전송'
					     WHEN IFNULL(B.BL_CUST_SEND_YN, 'N') = 'C'
					     THEN 'BL전송'
					     WHEN IFNULL(B.BL_CUST_SEND_YN, 'N') = 'Y'
					     THEN '재전송'
					    END
			    ) AS SEND_STAT_NM
		       , 0 FRGH_SUM
		       , MAX(A.EXCT_SPR_CD) EXCT_SPR_CD
		       , #{ptnrSprCd} PTNR_SPR_CD
		       , MAX(D.INTG_TASK_NO) INTG_TASK_NO                       
		       , ( SELECT BB.INTG_TASK_NO 
		           FROM TB_FWD_BL AA
		           INNER JOIN TB_SMT_INTG_TASK_DEPT BB 
		           WHERE AA.BL_ID = A.MBL_ID
		                 AND AA.EO_NO = BB.EO_NO
		                 AND AA.BL_ID = BB.CST_BL_ID
		                 AND IFNULL(AA.DEL_YN, 'N') = 'N'
		                 AND IFNULL(BB.DEL_YN, 'N') = 'N'
		                 AND BB.TASK_SPR_CD = #{bound}
		          LIMIT 1) MBL_INTG_TASK_NO
		       , MAX(A.SMT_NO) SMT_NO 
		       , MAX(A.EO_NO) EO_NO
		       , MAX(A.LADG_TYPE_CD) AS LADG_TYPE_CD   
		       , MAX(D.TASK_SPR_CD) AS TASK_SPR_CD                         
		FROM 
		  TB_FWD_BL A
		LEFT OUTER JOIN 
		  TB_FWD_BL_EXPND B ON B.BL_ID = A.BL_ID  /* HBL 확장 */
		INNER JOIN 
		  TB_SMT_INTG_TASK_DEPT D ON D.CST_BL_ID = A.BL_ID /* 통합실행부서*/
		                             AND D.EO_NO = A.EO_NO
		                             AND D.DEL_YN = 'N'
		                             AND D.EXCT_BIZPTNR_CD = #{corpCd}       /* 본사전용 */
		INNER JOIN 
		  TB_SMT_ORD E ON E.SMT_NO = A.SMT_NO
		                  AND E.DEL_YN = 'N'
		                  AND E.ORD_BIZPTNR_CD = #{shppCd}
		WHERE   1=1
        AND     A.BL_SPR_CD IN ('H','D')
        AND     A.DEL_YN = 'N'
        AND     IFNULL(A.NON_EXCT_BL_YN,'N') = CASE WHEN #{shppCd} IN (SELECT  BIZPTNR_CD /* 팜한농 STTLEMENT DBL 처리 가능하도록 쿼리 수정 */
                                           FROM  TB_COM_BIZPTNR  /* MAIN */
                                          WHERE  BIZPTNR_GRP_CD =  '1001076'
                             AND  USE_YN = 'Y'
                             AND  MBIZPTNR_YN = 'Y'
                                      UNION ALL
                                         SELECT  A.BIZPTNR_CD
                                           FROM  TB_COM_BIZPTNR A  /* SUB */
                                               , TB_COM_BIZPTNR B  /* MAIN */
                                          WHERE  A.USE_YN = 'Y'
                                            AND  A.MBIZPTNR_YN = 'N'
                                            AND  A.MBIZPTNR_CD = B.BIZPTNR_CD
                                            AND  B.BIZPTNR_GRP_CD =  '1001076'
                                          ) THEN IFNULL(A.NON_EXCT_BL_YN,'N') ELSE 'N' END 
        AND     A.EXCT_SPR_CD = #{exctSprCd}
        AND     E.ORD_BIZPTNR_CD IN (SELECT  BIZPTNR_CD
                                           FROM  TB_COM_BIZPTNR  /* MAIN */
                                          WHERE  BIZPTNR_GRP_CD = (CASE 
                             WHEN #{ptnrSprCd} = 'LGC'
                             THEN '1001010'
                             WHEN #{ptnrSprCd} = 'LGH'
                             THEN '1001019'
                             WHEN #{ptnrSprCd} = 'LGM'
                             THEN '1001021'
                             WHEN #{ptnrSprCd} = 'FHN'
                             THEN '1001076'
                             WHEN #{ptnrSprCd} = 'LGES'
                             THEN '1008002'
                              END)
                             AND  USE_YN = 'Y'
                             AND  MBIZPTNR_YN = 'Y'
                                      UNION ALL
                                         SELECT  A.BIZPTNR_CD
                                           FROM  TB_COM_BIZPTNR A  /* SUB */
                                               , TB_COM_BIZPTNR B  /* MAIN */
                                          WHERE  A.USE_YN = 'Y'
                                            AND  A.MBIZPTNR_YN = 'N'
                                            AND  A.MBIZPTNR_CD = B.BIZPTNR_CD
                                            AND  B.BIZPTNR_GRP_CD = (CASE 
                                WHEN #{ptnrSprCd} = 'LGC'
                                THEN '1001010'
                                WHEN #{ptnrSprCd} = 'LGH'
                                THEN '1001019'
                                WHEN #{ptnrSprCd} = 'LGM'
                                THEN '1001021'
                                WHEN #{ptnrSprCd} = 'FHN'
                                THEN '1001076'
                                WHEN #{ptnrSprCd} = 'LGES'
                                THEN '1008002'
                               END)
                                          )
            <![CDATA[  
            AND A.ONBR_YMD                >= #{fromDt}
            AND A.ONBR_YMD                <= #{toDt} 
            ]]>           
            <if test="ofcrEmpno != null and ofcrEmpno != ''">
               AND   D.OFCR_EMPNO = #{ofcrEmpno}
            </if>
            <if test="blNo != null and blNo != '' ">
               AND   A.BL_NO LIKE CONCAT(#{blNo},'%')
            </if>
            <if test="rprsRefNo != null and rprsRefNo != '' ">
               AND   RPRS_REF_NO CONCAT(#{rprsRefNo},'%')
            </if>      
            <if test="blSprCd != null and blSprCd != '' ">
               AND   A.BL_SPR_CD = #{blSprCd}
            </if>      
            <if test="exctSprCd != null and exctSprCd != '' and exctSprCd == 'AR' ">
               AND   D.TASK_SPR_CD IN ('EXP', 'TRD')
            </if>
            <if test="exctSprCd != null and exctSprCd != '' and exctSprCd == 'OC' ">
               AND   D.TASK_SPR_CD = 'EXP'
            </if>  
            <if test="sendType != null and sendType != ''">
               AND   IF(IFNULL(B.BL_CUST_SEND_YN,'N')='C', 'N',IFNULL(B.BL_CUST_SEND_YN,'N')) = #{sendType}
            </if>    
          GROUP BY A.RPRS_REF_NO /* 대표참조번호 */
                 , A.MBL_NO /* MBL NO*/
                 , A.BL_NO  /* BL NO */
                 , A.MBL_ID, A.BL_ID, A.MBL_NO
          ORDER BY SEND_STAT_NM, A.RPRS_REF_NO
    </select>
    
    
    <!-- LGCHBL운임조회 -->
    <select id="selectLgCHblFrgh" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgCHblFrgh */
	    SELECT 
	           ROW_NUMBER() OVER ( PARTITION BY (CASE 
								                    WHEN A.EXCT_SPR_CD = 'AR'
								                    THEN C.FRGH_CD
								                    WHEN A.EXCT_SPR_CD = 'OC'
								                    THEN IF(C.CTRT_CUR_CD='USD','OFT',C.FRGH_CD)
								                 END)
								       ORDER BY (CASE 
								                    WHEN A.EXCT_SPR_CD = 'AR'
								                    THEN C.FRGH_CD
								                    WHEN A.EXCT_SPR_CD = 'OC'
								                    THEN IF(C.CTRT_CUR_CD='USD','OFT',C.FRGH_CD)
								                 END) ) AS RN
	           , (CASE 
			          WHEN A.EXCT_SPR_CD = 'AR'
			          THEN C.FRGH_CD
			          WHEN A.EXCT_SPR_CD = 'OC'
			          THEN IF(C.CTRT_CUR_CD='USD','OFT',C.FRGH_CD)
		          END) AS FRGH_CD
		       , MAX((SELECT FRGH_NM
		              FROM   TB_COM_FRGH
				      WHERE  FRGH_CD = (CASE 
				                WHEN A.EXCT_SPR_CD = 'AR'
				                THEN C.FRGH_CD
				                WHEN A.EXCT_SPR_CD = 'OC'
				                THEN IF(C.CTRT_CUR_CD='USD','OFT',C.FRGH_CD)
				              END)
		            )) AS FRGH_NM
		       , SUM(C.CTRT_FRGH_AMT) AS FRGH_AMT
		       , MAX(C.CTRT_CUR_CD) AS CURR_CD
		       , MAX(D.STN_EXCHGRT) AS STN_EXCHGRT
		       , MAX(A.FRGTTERM_CD) AS FRGTTERM_CD
		       , MAX(C.CNTR_SIZE_CD) AS CNTR_SIZE_CD
		       , MAX(C.CNTR_TYPE_CD) AS CNTR_TYPE_CD
		       , SUM(C.FRGH_QTY_WGT) AS FRGH_QTY_WGT
		       , SUM(C.APLY_UNTPRC) AS APLY_UNTPRC
		FROM   TB_FWD_BL A /* HBL */
		       INNER JOIN 
		          TB_ISM_SELLBUY C ON  C.BL_ID = A.BL_ID
		                           AND C.ADJ_YN = 'Y'
		                           AND C.DEL_YN = 'N'
		                           AND C.INV_NO IS NULL
		       INNER JOIN 
		          TB_ISM_SELLBUY_DTL D ON D.SMT_NO = C.SMT_NO
		WHERE   1=1
		AND     A.BL_SPR_CD IN ('H','D')
		AND     C.SELLBUY_SEQ = D.SELLBUY_SEQ
		AND     C.SELLBUY_SPR_CD = 'SO' /* 공통코드 0051 SO:매출 SI:사내매출 ASIS   A.BUY_SALES_TYPE = 'S' */
		AND     C.DOM_ABRD_BIZPTNR_TYPE_CD IN ('1','2')   /* 1:국내거래처,2:해외거래처,3:파트너*/
		AND     C.ADJ_STN_TYPE_CD = IF (A.BL_SPR_CD='D','02','01')
		AND     A.DEL_YN = 'N'
		<if test="exctSprCd != null and exctSprCd != '' and exctSprCd == 'AR' ">
                AND     A.BL_ID = #{blId}
        </if>  
        <if test="exctSprCd != null and exctSprCd != '' and exctSprCd == 'OC' ">
                AND     A.BL_ID=  #{blId}
                AND     IF(C.CTRT_CUR_CD = 'USD', 'OFT',C.FRGH_CD) = C.FRGH_CD           
        </if> 
		GROUP BY (CASE 
		              WHEN A.EXCT_SPR_CD = 'AR'
		              THEN C.FRGH_CD
		              WHEN A.EXCT_SPR_CD = 'OC'
		              THEN IF(C.CTRT_CUR_CD='USD','OFT',C.FRGH_CD)
		         END)
    </select>
    
    
    <!-- 전송가능 거래처 체크 -->
    <select id="selectSendPosbBizptnrYn" parameterType="dataItem" resultType="dataItem">
        /* fwd.common.fwdCstComIfMgnt.selectSendPosbBizptnrYn */
        SELECT  #{cstSprCd} AS CST_SPR_CD
        <if test="cstSprCd != null and cstSprCd != '' and cstSprCd == 'LGC' ">
                /* LGC 해외법인 로직 추가 20180629*/ 
                /* LGC 해외법인 로직 변경 20181217 J.S.E. */
                <![CDATA[  
                , (CASE WHEN( SELECT COUNT(1) 
                              FROM   TB_COM_ETC_CD E
                              WHERE  E.CLAS_CD = '1476'
                              AND    E.ETC_CONT2 != 'A100'
                              AND    E.ETC_CONT2 = B.CORP_CD
                              AND    E.USE_YN = 'Y'
                            ) > 0
                        THEN 'GERP' 
                   END) AS GERP_SPR_CD
                ]]>
        </if> 
        <if test="cstSprCd != null and cstSprCd != '' and cstSprCd == 'LGES' ">
                <![CDATA[  
                , (CASE WHEN( SELECT COUNT(1) 
                              FROM   TB_COM_ETC_CD E
                              WHERE  E.CLAS_CD = FC_FWD_CST_RPRS_BIZPTNR_CD('LGES', 'GERPCLASCD')
                              AND    E.ETC_CONT2 != 'A100'
                              AND    E.ETC_CONT2 = B.CORP_CD
                              AND    E.USE_YN = 'Y'
                            ) > 0
                        THEN 'GERP' 
                   END) AS GERP_SPR_CD
                ]]>
        </if> 
        FROM    TB_FWD_BL A
	            INNER JOIN 
	                       TB_SMT_ORD B ON  B.SMT_NO = A.SMT_NO 
	                                    AND B.DEL_YN = 'N'
                INNER JOIN 
	                       TB_SMT_INTG_TASK_DEPT C ON  C.CST_BL_ID = A.BL_ID
	                                               AND C.EO_NO = A.EO_NO
	                                               AND C.EO_NO = C.TASK_SPR_CD IN ( 'EXP', 'CSM' )
	                                               AND C.EXCT_BIZPTNR_CD = #{corpCd}
	                                               AND C.DEL_YN = 'N'
	        WHERE  1=1
	        AND    A.BL_SPR_CD IN ('H','D')
	        AND    A.BL_ID = #{blId}
	        AND    A.EXCT_SPR_CD = #{exctSprCd}
	        AND    A.DEL_YN = 'N'
	        
            <if test="cstSprCd != null and cstSprCd != '' and cstSprCd == 'LGC' ">
	            AND    B.ORD_BIZPTNR_CD IN( SELECT  BIZPTNR_CD
	                                        FROM    TB_COM_BIZPTNR  /* MAIN */
	                                        WHERE   BIZPTNR_GRP_CD = '1001010'
	                                        AND     USE_YN = 'Y'
	                                        AND     MBIZPTNR_YN = 'Y'
	                                        UNION ALL
	                                        SELECT  A.BIZPTNR_CD
	                                        FROM    TB_COM_BIZPTNR  A /* SUB */
	                                                INNER JOIN 
	                                                            TB_COM_BIZPTNR  B /* MAIN */
	                                        WHERE   A.USE_YN = 'Y'
	                                        AND     B.USE_YN = 'Y'
	                                        AND     A.MBIZPTNR_YN = 'N'
	                                        AND     A.MBIZPTNR_CD = B.BIZPTNR_CD
	                                        AND     B.BIZPTNR_GRP_CD = '1001010'
	                                       )
	           AND    IFNULL(A.NON_EXCT_BL_YN,'N') = 'N'
	           AND    EXISTS (SELECT DTL_CD_NM 
	                          FROM   TB_COM_ETC_CD A
	                          WHERE  CLAS_CD ='1323'
	                          AND    ETC_CONT1 = 'LGC' 
	                          AND    DTL_CD_NM = A.SHPP_CD 
	                          AND USE_YN = 'Y')
           </if>
           <if test="cstSprCd != null and cstSprCd != '' and cstSprCd == 'LGES' ">
	           AND    B.ORD_BIZPTNR_CD IN( SELECT  BIZPTNR_CD
	                                       FROM    TB_COM_BIZPTNR  /* MAIN */
	                                       WHERE   BIZPTNR_GRP_CD = FC_FWD_CST_RPRS_BIZPTNR_CD('LGES', 'GRP')
	                                       AND     USE_YN = 'Y'
	                                       AND     MBIZPTNR_YN = 'Y'
	                                       UNION ALL
	                                       SELECT  A.BIZPTNR_CD
	                                       FROM    TB_COM_BIZPTNR  A /* SUB */
	                                               INNER JOIN
	                                                         TB_COM_BIZPTNR  B /* MAIN */
	                                       WHERE   A.USE_YN = 'Y'
	                                       AND     B.USE_YN = 'Y'
	                                       AND     A.MBIZPTNR_YN = 'N'
	                                       AND     A.MBIZPTNR_CD = B.BIZPTNR_CD
	                                       AND     B.BIZPTNR_GRP_CD = FC_FWD_CST_RPRS_BIZPTNR_CD('LGES', 'GRP')
	                                    )
	           AND    IFNULL(A.NON_EXCT_BL_YN,'N') = 'N' 
           </if> 
           <if test="cstSprCd != null and cstSprCd != '' and cstSprCd == 'LGH' ">
                AND    B.ORD_BIZPTNR_CD IN( SELECT  BIZPTNR_CD
	                                        FROM    TB_COM_BIZPTNR  /* MAIN */
	                                        WHERE   BIZPTNR_GRP_CD = '1001019'
	                                        AND     USE_YN = 'Y'
	                                        AND     MBIZPTNR_YN = 'Y'
	                                        UNION ALL
	                                        SELECT  A.BIZPTNR_CD
	                                        FROM    TB_COM_BIZPTNR  A /* SUB */
	                                        INNER JOIN
	                                                TB_COM_BIZPTNR  B /* MAIN */
	                                        WHERE   A.USE_YN = 'Y'
	                                        AND     B.USE_YN = 'Y'
	                                        AND     A.MBIZPTNR_YN = 'N'
	                                        AND     A.MBIZPTNR_CD = B.BIZPTNR_CD
	                                        AND     B.BIZPTNR_GRP_CD = '1001019')
		        AND    IFNULL(A.NON_EXCT_BL_YN,'N') = 'N'
            </if>
            <if test="cstSprCd != null and cstSprCd != '' and cstSprCd == 'LGHH' ">
		        AND    A.SHPP_CD IN( SELECT   ETC_CONT1
		                             FROM     TB_COM_ETC_CD
		                             WHERE    CLAS_CD = '1450'
		                             AND      SYS_SPR_CD = 'OM'
		                             AND      USE_YN = 'Y' )
		        AND    IFNULL(A.NON_EXCT_BL_YN,'N') = 'N'
            </if>       
            <if test="cstSprCd != null and cstSprCd != '' and cstSprCd == 'LGM' ">
	            AND    B.ORD_BIZPTNR_CD IN( SELECT  BIZPTNR_CD
	                                        FROM    TB_COM_BIZPTNR  /* MAIN */
	                                        WHERE   BIZPTNR_GRP_CD = '1001021'
	                                        AND     USE_YN = 'Y'
	                                        AND     MBIZPTNR_YN = 'Y'
	                                        UNION ALL
	                                        SELECT  A.BIZPTNR_CD
	                                        FROM    TB_COM_BIZPTNR  A /* SUB */
	                                        INNER JOIN
	                                                TB_COM_BIZPTNR  B /* MAIN */
	                                        WHERE   A.USE_YN = 'Y'
	                                        AND     B.USE_YN = 'Y'
	                                        AND     A.MBIZPTNR_YN = 'N'
	                                        AND     A.MBIZPTNR_CD = B.BIZPTNR_CD
	                                        AND     B.BIZPTNR_GRP_CD = '1001021')
	            AND    IFNULL(A.NON_EXCT_BL_YN,'N') = 'N'
            </if>
            /* LG마그나 거래처그룹추가 */
            <if test="cstSprCd != null and cstSprCd != '' and cstSprCd == 'LGE' ">
	            AND    B.ORD_BIZPTNR_CD IN(SELECT  BIZPTNR_CD
	                                       FROM    TB_COM_BIZPTNR  /* MAIN */
	                                       WHERE   BIZPTNR_GRP_CD IN ('1001001','1006001')  /* LG마그나 */
	                                       AND     USE_YN = 'Y'
	                                       AND     MBIZPTNR_YN = 'Y'
	                                       UNION ALL
	                                       SELECT  A.BIZPTNR_CD
	                                       FROM    TB_COM_BIZPTNR  A /* SUB */
	                                               INNER JOIN TB_COM_BIZPTNR  B /* MAIN */
	                                       WHERE   A.USE_YN = 'Y'
	                                       AND     B.USE_YN = 'Y'
	                                       AND     A.MBIZPTNR_YN = 'N'
	                                       AND     A.MBIZPTNR_CD = B.BIZPTNR_CD
	                                       AND     B.BIZPTNR_GRP_CD IN ('1001001','1006001')  /* LG마그나 */
	                                       UNION ALL
	                                       SELECT  C.BIZPTNR_CD
	                                       FROM    TB_COM_BIZPTNR C
	                                       WHERE   C.USE_YN = 'Y'
	                                       AND     C.BIZPTNR_CD IN ( '1029701' , '1008349')/*  HLDS 혜주건 추가 2013-03-01, 말레이시아 법인건 추가 2018-12-11 */)
	            AND    B.ORD_BIZPTNR_CD != '2000061' /* 본사 HLDS 제외 장경화C 요청 */
	            AND    IFNULL(A.NON_EXCT_BL_YN,'N') = 'N' /*자동전송시에는 settlement dbl건 전송못하도록 처리 */
            </if>
            <if test="cstSprCd != null and cstSprCd != '' and cstSprCd == 'LGD' ">
	            AND    B.ORD_BIZPTNR_CD IN (SELECT  INSD_CD
	                                        FROM    TB_COM_CD_MPNG
	                                        WHERE   CD_TYPE_CD = 'C'
	                                        AND     USE_YN = 'Y'
	                                        AND     CD_MPNG_SPR_NM = 'ORDER_CUSTOMER_CODE'
	                                        AND     RLT_BIZPTNR_NM = 'LGD')
		        AND NOT EXISTS (SELECT 1 
		                        FROM  NFINF.TB_FWD_INT434 AA
		                        INNER JOIN 
		                              TB_COM_EMP BB 
		                        WHERE AA.INS_ID = BB.EMPNO 
		                        AND   AA.BL_NO = A.BL_NO
		                        AND   BB.CORP_CD != #{corpCd}
		                        AND   AA.INTERFACE_ID BETWEEN DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -6 MONTH), '%Y%m%d') AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL 6 MONTH), '%Y%m%d'))  /*중복 BL SEND 방지 20140828 홍현룡C*/
            </if>
            <if test="cstSprCd != null and cstSprCd != '' and cstSprCd == 'FHN' ">
	            AND    B.ORD_BIZPTNR_CD IN ('1116833')
	            AND    IFNULL(A.NON_EXCT_BL_YN,'N') = 'N'
            </if>
    </select>
    

	<!-- LGC 인터페이스 테이블 Cnt 조회 -->
    <select id="selectLgCIfTblCnt" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgCIfTblCnt */
	    SELECT COUNT(*) + 1 AS CNT /* interface table count */
	    FROM   NFINF.TB_FWD_INT560
	    WHERE  BL_ID = #{blId}
	</select>
	
	
    <!-- LGC 인터페이스 테이블 등록할 데이터 추출  -->
    <select id="selectLgCIfTblValue" parameterType="dataItem" resultType="dataItem" >
        /* fwd.edi.fwdCstComIfMgnt.selectLgCIfTblValue */
        SELECT 
               #{interfaceId}   AS INTERFACE_ID 
               , #{xmlMsgId}    AS XML_MSG_ID
               , 1              AS XML_DOC_SEQ
               , IF ( #{gubun} = 'AUTO', IF(#{cnt} = 1,'9','4') ,'8' ) AS GUBUN /* SEND_TYPE  9:최초전송  4:재전송  1:취소, 8:운임전송 */
               , (CASE 
			             WHEN #{exctSprCd} = 'OC'
			             THEN '705'
			             WHEN #{exctSprCd} = 'AR'
			             THEN '740'
		          END) AS BL_GUBUN /* 전자문서 고유명칭 해운 705 항공 740*/
               , A.BL_NO  AS BL_NO /* BL NO */
               , IFNULL(#{cnt},0)  AS SENDING_COUNT
               , FC_FWD_TRIM_CHAR( (SELECT SUBSTR(S.BIZPTNR_OFCR_NM,1,17)                          
                                    FROM   TB_FWD_INTG_PIC S                        
                                    WHERE  1=1
                                    AND    S.INTG_KEY_ID = A.BL_ID
                                    AND    S.DEL_YN = 'N'          
                                    AND    S.OFCR_SPR_CD = '05'
                                    LIMIT 1))  AS DAMDANG_NAME
               , ''  AS DAMDANG_DEPT
               , FC_FWD_TRIM_CHAR( (SELECT S.TEL_NO
                                    FROM   TB_FWD_INTG_PIC S
                                    WHERE  1=1
                                    AND    S.INTG_KEY_ID = A.BL_ID
                                    AND    S.DEL_YN = 'N'
                                    AND    S.OFCR_SPR_CD = '05'
                                    LIMIT 1))  AS DAMDANG_CALL
               , A.BL_PRT_YMD  AS BL_ISSUE_DATE /* BL발행일자 */
               , (CASE 
			             WHEN #{exctSprCd} = 'OC'
			             THEN 'USD'
			             WHEN #{exctSprCd} = 'AR'
			             THEN A.CUR_CD
		          END) AS PAYMENT_CODE
               , A.APLY_EXCHGRT  AS EXCHANGE_RATE /* 적용환율 */
               , A.INCOT_CD      AS TRANSFER_COND /* INCOT코드 */
               , A.MBL_NO        AS MASTER_BL_NO  /* MBL번호  */
               , (CASE 
				         WHEN #{exctSprCd} = 'OC'
				         THEN IFNULL( (SELECT S.REF_NO
				                       FROM   TB_FWD_INTG_REF_NO S
			                           WHERE  1=1
				                       AND    S.INTG_KEY_ID = A.BL_ID
				                       AND    S.DEL_YN = 'N'
				                       AND    S.REF_NO_SPR_CD = 'SN'
				                       LIMIT 1),
                                      (SELECT S.REF_NO
                                       FROM   TB_FWD_INTG_REF_NO S
                                       WHERE  1=1
                                       AND    S.INTG_KEY_ID = A.BL_ID
                                       AND    S.DEL_YN = 'N'
                                       AND    S.REF_NO_SPR_CD IN ('SR','IN')
                                       LIMIT 1))
				         WHEN #{exctSprCd} = 'AR'
				         THEN (SELECT S.REF_NO
                               FROM   TB_FWD_INTG_REF_NO S
                               WHERE  1=1
                               AND    S.INTG_KEY_ID = A.BL_ID
                               AND    S.DEL_YN = 'N'
                               AND    S.REF_NO_SPR_CD = 'IN'
                               LIMIT 1)
                         END) AS SR_NO /* 해상 SN->IN->SN으로 변경됨 */
                              /*, (SELECT S.REF_NO
                                 FROM   TB_FW_INTG_SUB_MPNG T
                                       ,TB_FW_INTG_REF_NO S
                                 WHERE  1=1
                                 AND    T.INTG_KEY_ID = A.BL_ID
                                 AND    T.INTG_SUB_ID = S.INTG_SUB_ID
                                 AND    T.DEL_YN = 'N'
                                 AND    S.REF_NO_SPR_CD = 'IN'
                                 LIMIT 1)  SR_NO*/ /* SR_NO 항공/해운모두 INV_NO 로 전송하는 것으로 수정됨 */
               , (CASE 
				         WHEN #{exctSprCd} = 'OC'
				         THEN ( SELECT OUTR_CD
				                FROM   TB_COM_CD_MPNG
				                WHERE  CD_MPNG_SPR_NM = 'EDI_SHIP_MODE'
				                AND    INSD_CD = A.LDNG_COND_CD
				                AND    INSD_CD2 = A.DSCR_COND_CD
				                AND    USE_YN = 'Y'
				                LIMIT 1)   /*FC_CM_GET_EDI_NM2('EDI_SHIP_MODE', A.LDNG_COND_CD, A.DSCR_COND_CD, '') 변환 */
				         WHEN #{exctSprCd} = 'AR'
				         THEN '7'
		          END) AS SERVICE_TYPE /* 서비스타입 */
               , (SELECT S.REF_NO
                  FROM   TB_FWD_INTG_REF_NO S
                  WHERE  1=1
                  AND    S.INTG_KEY_ID = A.BL_ID
                  AND    S.DEL_YN = 'N'
                  AND    S.REF_NO_SPR_CD = 'IN'
                  LIMIT 1)  AS INVOICE_NO
               , (SELECT S.REF_NO
                  FROM   TB_FWD_INTG_REF_NO S
                  WHERE  1=1
                  AND    S.INTG_KEY_ID = A.BL_ID
                  AND    S.DEL_YN = 'N'
                  AND    S.REF_NO_SPR_CD = 'LC'
                  LIMIT 1) AS CREDIT_NO
               , (CASE 
				        WHEN #{exctSprCd} = 'OC'
				        THEN A.VOYAGE
				        WHEN #{exctSprCd} = 'AR'
				        THEN A.FLT_VSL_NM
                  END) AS  VOYAGE_NO /* 항차 */
               , (CASE 
				         WHEN #{exctSprCd} = 'OC'
				         THEN A.FLT_VSL_NM
				         WHEN #{exctSprCd} = 'AR'
				         THEN IFNULL( (SELECT BB.BIZPTNR_GRP_ENG_ACRN_NM
                                       FROM   TB_COM_BIZPTNR AA
                                              INNER JOIN TB_COM_BIZPTNR_GRP_CD BB
                                       WHERE  AA.BIZPTNR_GRP_CD = BB.BIZPTNR_GRP_CD
                                       AND    AA.BIZPTNR_CD = D.CARR_CD), SUBSTR(A.FLT_VSL_NM, 1, 2) )
		          END) AS TRANSPORT_NAME /* 편기선명  */
               /* AR : 항공사약어가 없을 경우를 대비해 NVL처리 */
               , ''                 AS VESSEL_COUNTRY /* 선박국적 */
               , A.ONBR_YMD         AS BOARD_DATE /* 출항일자 */
               , A.ARR_YMD          AS ARRIVAL_DATE /* 예정도착일자 */
               , A.POL_CD           AS LOAD_PORT
               , SUBSTR(A.POL_NM,1,35)  AS LOAD_PORT_NAME /* POL 항구명 */
               , A.POD_CD               AS DISCHARGE_PORT
               , SUBSTR(A.POD_NM,1,35)  AS DSCH_PORT_NAME /* POD 항구명 */
               , A.FDEST_CD         AS DEST_PORT
               , SUBSTR(A.FDEST_NM,1,35) AS DEST_PORT_NAME /* 최종목적지 항구명 */
               , A.POR_CD         AS ACCEPT_PORT
               , (CASE 
				         WHEN #{exctSprCd} = 'OC'
				         THEN SUBSTR(A.POR_NM,1,35)
				         WHEN #{exctSprCd} = 'AR'
				         THEN ''
		          END) AS ACCEPT_PORT_NAME /* 화물인수장소 항구명 */
               , (CASE 
				         WHEN #{exctSprCd} = 'OC'
				         THEN A.PDEL_CD
				         WHEN #{exctSprCd} = 'AR'
				         THEN ''
		          END) AS DELIVERY_PORT
               , (CASE 
				         WHEN #{exctSprCd} = 'OC'
				         THEN SUBSTR(A.PDEL_NM,1,35)
				         WHEN #{exctSprCd} = 'AR'
				         THEN ''
		          END) AS DELIVERY_PORT_NAME  /* 화물인도장소 항구명 */
               , FC_FWD_TRIM_CHAR( IF(A.BL_SPR_CD = 'D', A.CARR_NM, 'LX PANTOS CO.,LTD.') )  AS S_F_NAME
               , FC_FWD_TRIM_CHAR( IF(A.BL_SPR_CD = 'D', '', '03184 3F GWANGHWAMUN B/D. 58,      SAEMUNAN-RO, JONGNO-GU, SEOUL,     REPUBLIC OF KOREA') ) AS S_F_ADDR
               , FC_FWD_TRIM_CHAR(SUBSTR(FC_FWD_STR_RTN((SELECT S.INTG_ADDR
                                                         FROM   TB_FWD_INTG_ADDR S
                                                         WHERE  1=1
                                                         AND    S.INTG_KEY_ID = A.BL_ID
                                                         AND    S.DEL_YN = 'N'
                                                         AND    S.ADDR_SPR_CD = 'BS'),1,1,'X','X'), 1, 70)) AS CONSIGNOR_NAME
               , FC_FWD_TRIM_CHAR(SUBSTR(FC_FWD_STR_RTN((SELECT S.INTG_ADDR
                                                         FROM   TB_FWD_INTG_ADDR S
                                                         WHERE  1=1
                                                         AND    S.INTG_KEY_ID = A.BL_ID
                                                         AND    S.DEL_YN = 'N'
                                                         AND    S.ADDR_SPR_CD = 'BS'),2,0,'X','X'), 1, 175)) AS CONSIGNOR_ADDR
               , FC_FWD_TRIM_CHAR(SUBSTR(FC_FWD_STR_RTN((SELECT S.INTG_ADDR
                                                         FROM   TB_FWD_INTG_ADDR S
                                                         WHERE  1=1
                                                         AND    S.INTG_KEY_ID = A.BL_ID
                                                         AND    S.DEL_YN = 'N'
                                                         AND    S.ADDR_SPR_CD = 'BC'),1,1,'X','X'), 1, 70)) AS CONSIGNEE_NAME
               , FC_FWD_TRIM_CHAR(SUBSTR(FC_FWD_STR_RTN((SELECT S.INTG_ADDR
                                                         FROM   TB_FWD_INTG_ADDR S
                                                         WHERE  1=1
                                                         AND    S.INTG_KEY_ID = A.BL_ID
                                                         AND    S.DEL_YN = 'N'
                                                         AND    S.ADDR_SPR_CD = 'BC'),2,0,'X','X'), 1, 175)) AS CONSIGNEE_ADDR
               , FC_FWD_TRIM_CHAR(SUBSTR(FC_FWD_STR_RTN((SELECT S.INTG_ADDR
                                                         FROM   TB_FWD_INTG_ADDR S
                                                         WHERE  1=1
                                                         AND    S.INTG_KEY_ID = A.BL_ID
                                                         AND    S.DEL_YN = 'N'
                                                         AND    S.ADDR_SPR_CD = 'BN'),1,1,'X','X'), 1, 70)) AS NOTIFY1_NAME
               , FC_FWD_TRIM_CHAR(SUBSTR(FC_FWD_STR_RTN((SELECT S.INTG_ADDR
                                                         FROM   TB_FWD_INTG_ADDR S
                                                         WHERE  1=1
                                                         AND    S.INTG_KEY_ID = A.BL_ID
                                                         AND    S.DEL_YN = 'N'
                                                         AND    S.ADDR_SPR_CD = 'BN'),2,0,'X','X'), 1, 175)) AS NOTIFY1_ADDR
               , ''   AS NOTIFY2_NAME  /* NTFY2 명*/
               , ''   AS NOTIFY2_ADDR  /* NTFY2주소 */
               , ''   AS BL_ISSUE_CODE /* BL ISSUE CODE */
               , ''   AS BL_ISSUE_NAME /* BL ISSUE NAME */
               , IF(A.FRGTTERM_CD = 'PP',A.POL_CD, '')    AS PREPAID_CODE
               , IF(A.FRGTTERM_CD = 'PP','SEOUL, KOREA', '')  AS PREPAID_NAME
               , IF(A.FRGTTERM_CD = 'CC',A.POD_CD, '')          AS COLLECT_CODE
               , IF(A.FRGTTERM_CD = 'PP','', 'DESTINATION')     AS COLLECT_NAME
               , (CASE 
				         WHEN #{exctSprCd} = 'OC'
				         THEN (SELECT BL_PRT_CNT FROM TB_FWD_BL_PRT_EXPND WHERE BL_ID=A.BL_ID AND DEL_YN = 'N')
				         WHEN #{exctSprCd} = 'AR'
				         THEN 1
	               END) AS BL_DOC_COUNT
               , A.PKG_QTY AS PACKAGE_QUANTITY
               , IF(#{exctSprCd} = 'OC', A.PKG_UNIT_CD, '') AS PACKAGE_TYPE /* 항공은 A.PKGS_UNIT 주석처리 되어있음(ASIS) */
               , (CASE 
				         WHEN #{exctSprCd} = 'OC'
				         THEN FC_FWD_TRIM_CHAR( CONCAT('SAY : '
                                                          , RPAD(FC_FWD_STR_RTN((SELECT S.FRM_CONT
                                                                                 FROM   TB_FWD_INTG_RMK S           
                                                                                 WHERE  1=1
                                                                                 AND    S.INTG_KEY_ID = A.BL_ID
                                                                                 AND    S.DEL_YN = 'N'
                                                                                 AND    S.RMK_SPR_CD = 'SAY'),1,1,'X','X'),35,' ')
                                                          , RPAD(FC_FWD_STR_RTN((SELECT S.FRM_CONT
                                                                                 FROM   TB_FWD_INTG_RMK S                        
                                                                                 WHERE  1=1
                                                                                 AND    S.INTG_KEY_ID = A.BL_ID
                                                                                 AND    S.DEL_YN = 'N'
                                                                                 AND    S.RMK_SPR_CD = 'SAY'),2,2,'X','X'),35,' ')) )
				         WHEN #{exctSprCd} = 'AR'
				         THEN ''
                   END) AS GOODS_DIMENSION
                , A.SELL_GWT AS GOODS_WEIGHT
                , A.SELL_CBM AS GOODS_VOLUME /* ASIS SHPR_GRS_VOL 이나 데이터 값은 CBM , A.SELL_VOL_WGT-> A.SELL_CBM으로 변경 , 20121119 by yang */
	            , CONCAT(    
		                  (CASE WHEN 'GERP' = #{gerpSprCd} /* LGC 해외법인 로직 수정 20181219 ..추가 20180629*/
		                            AND  B.ORD_BIZPTNR_CD IN (SELECT  BIZPTNR_CD
		                                                      FROM    TB_COM_BIZPTNR  /* MAIN */
		                                                      WHERE   BIZPTNR_GRP_CD = '1001010'
		                                                      AND     USE_YN = 'Y'
		                                                      AND     MBIZPTNR_YN = 'Y'
		                                                      UNION ALL
		                                                      SELECT  A.BIZPTNR_CD
		                                                      FROM    TB_COM_BIZPTNR  A /* SUB */
		                                                              INNER JOIN TB_COM_BIZPTNR  B /* MAIN */
		                                                      WHERE   A.USE_YN = 'Y'
		                                                      AND     B.USE_YN = 'Y'
		                                                      AND     A.MBIZPTNR_YN = 'N'
		                                                      AND     A.MBIZPTNR_CD = B.BIZPTNR_CD
		                                                      AND     B.BIZPTNR_GRP_CD = '1001010')
		                       THEN (SELECT  V.ETC_CONT1 
		                             FROM  TB_COM_ETC_CD V 
		                             WHERE  V.CLAS_CD = '1476' 
		                                  AND V.ETC_CONT2 = D.EXCT_BIZPTNR_CD 
		                                  AND V.ETC_CONT1 != 'C100'
		                                  AND V.USE_YN = 'Y'
		                             LIMIT 1)
		                       WHEN 'GERP' = #{gerpSprCd} /* LGC 해외법인 로직 수정 20181219 ..추가 20180629*/
		                            AND  B.ORD_BIZPTNR_CD IN (SELECT  BIZPTNR_CD
		                                                      FROM    TB_COM_BIZPTNR  /* MAIN */
		                                                      WHERE   BIZPTNR_GRP_CD =   '1008002' /*FC_CM_CST_RPRS_BIZPTNR_CD('LGES', 'GRP')*/
		                                                      AND     USE_YN = 'Y'
		                                                      AND     MBIZPTNR_YN = 'Y'
		                                                      UNION ALL
		                                                      SELECT  AA.BIZPTNR_CD
		                                                      FROM    TB_COM_BIZPTNR  AA /* SUB */
		                                                            , TB_COM_BIZPTNR  BB /* MAIN */
		                                                      WHERE   AA.USE_YN = 'Y'
		                                                      AND     BB.USE_YN = 'Y'
		                                                      AND     AA.MBIZPTNR_YN = 'N'
		                                                      AND     AA.MBIZPTNR_CD = BB.BIZPTNR_CD
		                                                      AND     BB.BIZPTNR_GRP_CD = '1008002' ) /*FC_CM_CST_RPRS_BIZPTNR_CD('LGES', 'GRP'))*/
		                       THEN (SELECT V.ETC_CONT1 
		                               FROM TB_COM_ETC_CD V 
		                              WHERE V.CLAS_CD = '2561' /*FC_CM_CST_RPRS_BIZPTNR_CD('LGES', 'GERPCLASCD') */
		                                AND V.ETC_CONT2 = D.EXCT_BIZPTNR_CD 
		                                AND V.ETC_CONT1 != 'C100'
		                                AND V.USE_YN = 'Y'
		                              LIMIT 1)                                               
		                 ELSE ''
		                 END), 'IFTMCS', DATE_FORMAT(NOW(), '%Y%m%d%H%i%s'), #{lgcFileSeq}, '.TXT' 
	                    ) AS LGC_FILE_NAME
               , ''                         AS SEND_PART /* ASIS SO_SEND_PART */
               , A.BL_ID                    AS BL_ID       
               , IF(#{exctSprCd} = 'AR', A.BL_NO, '') AS AWB_NO
               , NOW()                                AS TIMESTAMP
               , IF(#{exctSprCd} = 'AR', A.SELL_CWT, '') AS CHARGE_WEIGHT
        FROM   TB_FWD_BL A
               INNER JOIN TB_SMT_ORD B ON B.SMT_NO = A.SMT_NO
               INNER JOIN TB_SMT_INTG_TASK_DEPT D ON  D.CST_BL_ID = A.BL_ID 
                                                  AND D.EO_NO = A.EO_NO
                                                  AND D.DEL_YN = 'N'
                                                  AND D.TASK_SPR_CD IN ('EXP', 'TRD')
                                                  AND D.EXCT_BIZPTNR_CD = #{corpCd}
        WHERE  1=1
        AND    A.DEL_YN = 'N'
        AND    A.BL_SPR_CD IN ('H','D')
        AND    A.EXCT_SPR_CD = #{exctSprCd}
        AND    A.BL_ID = #{blId}   
    </select>
    
    
	<!-- LGC 인터페이스 테이블 등록  -->
	<insert id="insertLgCIfTbl" parameterType="dataItem" >
        /* fwd.edi.fwdCstComIfMgnt.insertLgCIfTbl */
        INSERT INTO NFINF.TB_FWD_INT560(
		                                  INTERFACE_ID 
		                                , XML_MSG_ID
		                                , XML_DOC_SEQ
		                                , GUBUN
		                                , BL_GUBUN
		                                , BL_NO
		                                , SENDING_COUNT
		                                , DAMDANG_NAME
		                                , DAMDANG_DEPT
		                                , DAMDANG_CALL
		                                , BL_ISSUE_DATE
		                                , PAYMENT_CODE
		                                , EXCHANGE_RATE
		                                , TRANSFER_COND
		                                , MASTER_BL_NO
		                                , SR_NO
		                                , SERVICE_TYPE
		                                , INVOICE_NO
		                                , CREDIT_NO
		                                , VOYAGE_NO
		                                , TRANSPORT_NAME
		                                , VESSEL_COUNTRY
		                                , BOARD_DATE
		                                , ARRIVAL_DATE
		                                , LOAD_PORT
		                                , LOAD_PORT_NAME
		                                , DISCHARGE_PORT
		                                , DSCH_PORT_NAME
		                                , DEST_PORT
		                                , DEST_PORT_NAME
		                                , ACCEPT_PORT
		                                , ACCEPT_PORT_NAME
		                                , DELIVERY_PORT
		                                , DELIVERY_PORT_NAME
		                                , S_F_NAME
		                                , S_F_ADDR
		                                , CONSIGNOR_NAME
		                                , CONSIGNOR_ADDR
		                                , CONSIGNEE_NAME
		                                , CONSIGNEE_ADDR
		                                , NOTIFY1_NAME
		                                , NOTIFY1_ADDR
		                                , NOTIFY2_NAME
		                                , NOTIFY2_ADDR
		                                , BL_ISSUE_CODE
		                                , BL_ISSUE_NAME
		                                , PREPAID_CODE
		                                , PREPAID_NAME
		                                , COLLECT_CODE
		                                , COLLECT_NAME
		                                , BL_DOC_COUNT
		                                , PACKAGE_QUANTITY
		                                , PACKAGE_TYPE
		                                , GOODS_DIMENSION
		                                , GOODS_WEIGHT
		                                , GOODS_VOLUME
		                                , LGC_FILE_NAME
		                                , SEND_PART
		                                , BL_ID
		                                , AWB_NO
		                                , TIMESTAMP
		                                , CHARGE_WEIGHT
                        )
          VALUES (
                                        IFNULL(#{interfaceId},'' )
                                        , IFNULL(#{xmlMsgId},'' )
                                        , IFNULL(#{xmlDocSeq},0 )
                                        , IFNULL(#{gubun},'' )
                                        , IFNULL(#{blGubun},'' )
                                        , IFNULL(#{blNo},'' )
                                        , IFNULL(#{sendingCount},0 )
                                        , IFNULL(#{damdangName},'' )
                                        , IFNULL(#{damdangDept},'' )
                                        , IFNULL(#{damdangCall},'' )
                                        , IFNULL(#{blIssueDate},'' )
                                        , IFNULL(#{paymentCode},'' )
                                        , IFNULL(#{exchangeRate},0 )
                                        , IFNULL(#{transferCond},'' )
                                        , IFNULL(#{masterBlNo},'' )
                                        , IFNULL(#{srNo},'' )
                                        , IFNULL(#{serviceType},'' )
                                        , IFNULL(#{invoiceNo},'' )
                                        , IFNULL(#{creditNo},'' )
                                        , IFNULL(#{voyageNo},'' )
                                        , IFNULL(#{transportName},'' )
                                        , IFNULL(#{vesselCountry},'' )
                                        , IFNULL(#{boardDate},'' )
                                        , IFNULL(#{arrivalDate},'' ) 
                                        , IFNULL(#{loadPort},'' )
                                        , IFNULL(#{loadPortName},'' )
                                        , IFNULL(#{dischargePort},'' )
                                        , IFNULL(#{dschPortName},'' )
                                        , IFNULL(#{destPort},'' )
                                        , IFNULL(#{destPortName},'' )
                                        , IFNULL(#{acceptPort},'' )
                                        , IFNULL(#{acceptPortName},'' )
                                        , IFNULL(#{deliveryPort},'' )
                                        , IFNULL(#{deliveryPortName},'' )
                                        , IFNULL(#{sFName},'' )
                                        , IFNULL(#{sFAddr},'' )
                                        , IFNULL(#{consignorName},'' )
                                        , IFNULL(#{consignorAddr},'' )
                                        , IFNULL(#{consigneeName},'' )
                                        , IFNULL(#{consigneeAddr},'' )
                                        , IFNULL(#{notify1Name},'' )
                                        , IFNULL(#{notify1Addr},'' )
                                        , IFNULL(#{notify2Name},'' )
                                        , IFNULL(#{notify2Addr},'' )
                                        , IFNULL(#{blIssueCode},'' )
                                        , IFNULL(#{blIssueName},'' )
                                        , IFNULL(#{prepaidCode},'' )
                                        , IFNULL(#{prepaidName},'' ) 
                                        , IFNULL(#{collectCode},'' )
                                        , IFNULL(#{collectName},'' )
                                        , IFNULL(#{blDocCount},0 )
                                        , IFNULL(#{packageQuantity},0 )
                                        , IFNULL(#{packageType},'' )
                                        , IFNULL(#{goodsDimension},'' )
                                        , IFNULL(#{goodsWeight},0 )
                                        , IFNULL(#{goodsVolume},0 )
                                        , IFNULL(#{lgcFileName},'' )
                                        , IFNULL(#{sendPart},'' )
                                        , IFNULL(#{blId},'' )
                                        , IFNULL(#{awbNo},'' )
                                        , NOW()
                                        , IFNULL(#{chargeWeight},0 )
                 )     
    </insert>


<!-- LGC FHN 인터페이스 테이블 등록할 데이터 추출  -->
    <select id="selectLgCIfTblFHNValue" parameterType="dataItem" resultType="dataItem" >
        /* fwd.edi.fwdCstComIfMgnt.selectLgCIfTblValue */
        SELECT 
               #{interfaceId}   AS INTERFACE_ID 
               , #{xmlMsgId}    AS XML_MSG_ID
               , 1              AS XML_DOC_SEQ
               , IF (#{cnt} = 1, '9', '4')  AS GUBUN
               , (CASE 
                         WHEN #{exctSprCd} = 'OC'
                         THEN '705'
                         WHEN #{exctSprCd} = 'AR'
                         THEN '740'
                  END) AS BL_GUBUN /* 전자문서 고유명칭 해운 705 항공 740*/
               , A.BL_NO  AS BL_NO /* BL NO */
               , IFNULL(#{cnt},0)  AS SENDING_COUNT
               , FC_FWD_TRIM_CHAR( (SELECT SUBSTR(S.BIZPTNR_OFCR_NM,1,17)                          
                                    FROM   TB_FWD_INTG_PIC S                        
                                    WHERE  1=1
                                    AND    S.INTG_KEY_ID = A.BL_ID
                                    AND    S.DEL_YN = 'N'          
                                    AND    S.OFCR_SPR_CD = '05'
                                    LIMIT 1))  AS DAMDANG_NAME
               , ''  AS DAMDANG_DEPT
               , FC_FWD_TRIM_CHAR( (SELECT S.TEL_NO
                                    FROM   TB_FWD_INTG_PIC S
                                    WHERE  1=1
                                    AND    S.INTG_KEY_ID = A.BL_ID
                                    AND    S.DEL_YN = 'N'
                                    AND    S.OFCR_SPR_CD = '05'
                                    LIMIT 1))  AS DAMDANG_CALL
               , A.BL_PRT_YMD  AS BL_ISSUE_DATE /* BL발행일자 */
               , (CASE 
                         WHEN #{exctSprCd} = 'OC'
                         THEN 'USD'
                         WHEN #{exctSprCd} = 'AR'
                         THEN A.CUR_CD
                  END) AS PAYMENT_CODE
               , A.APLY_EXCHGRT  AS EXCHANGE_RATE /* 적용환율 */
               , A.INCOT_CD      AS TRANSFER_COND /* INCOT코드 */
               , A.MBL_NO        AS MASTER_BL_NO  /* MBL번호  */
               , (CASE 
                         WHEN #{exctSprCd} = 'OC'
                         THEN IFNULL( (SELECT S.REF_NO
                                       FROM   TB_FWD_INTG_REF_NO S
                                       WHERE  1=1
                                       AND    S.INTG_KEY_ID = A.BL_ID
                                       AND    S.DEL_YN = 'N'
                                       AND    S.REF_NO_SPR_CD = 'SN'
                                       LIMIT 1),
                                      (SELECT S.REF_NO
                                       FROM   TB_FWD_INTG_REF_NO S
                                       WHERE  1=1
                                       AND    S.INTG_KEY_ID = A.BL_ID
                                       AND    S.DEL_YN = 'N'
                                       AND    S.REF_NO_SPR_CD IN ('SR','IN')
                                       LIMIT 1))
                         WHEN #{exctSprCd} = 'AR'
                         THEN (SELECT S.REF_NO
                               FROM   TB_FWD_INTG_REF_NO S
                               WHERE  1=1
                               AND    S.INTG_KEY_ID = A.BL_ID
                               AND    S.DEL_YN = 'N'
                               AND    S.REF_NO_SPR_CD = 'IN'
                               LIMIT 1)
                         END) AS SR_NO /* 해상 SN->IN->SN으로 변경됨 */
                              /*, (SELECT S.REF_NO
                                 FROM   TB_FW_INTG_SUB_MPNG T
                                       ,TB_FW_INTG_REF_NO S
                                 WHERE  1=1
                                 AND    T.INTG_KEY_ID = A.BL_ID
                                 AND    T.INTG_SUB_ID = S.INTG_SUB_ID
                                 AND    T.DEL_YN = 'N'
                                 AND    S.REF_NO_SPR_CD = 'IN'
                                 LIMIT  1)  SR_NO*/ /* SR_NO 항공/해운모두 INV_NO 로 전송하는 것으로 수정됨 */
               , (CASE 
                         WHEN #{exctSprCd} = 'OC'
                         THEN ( SELECT OUTR_CD
                                FROM   TB_COM_CD_MPNG
                                WHERE  CD_MPNG_SPR_NM = 'EDI_SHIP_MODE'
                                AND    INSD_CD = A.LDNG_COND_CD
                                AND    INSD_CD2 = A.DSCR_COND_CD
                                AND    USE_YN = 'Y'
                                LIMIT 1)   /*FC_CM_GET_EDI_NM2('EDI_SHIP_MODE', A.LDNG_COND_CD, A.DSCR_COND_CD, '') 변환 */
                         WHEN #{exctSprCd} = 'AR'
                         THEN '7'
                  END) AS SERVICE_TYPE /* 서비스타입 */
               , (SELECT S.REF_NO
                  FROM   TB_FWD_INTG_REF_NO S
                  WHERE  1=1
                  AND    S.INTG_KEY_ID = A.BL_ID
                  AND    S.DEL_YN = 'N'
                  AND    S.REF_NO_SPR_CD = 'IN'
                  LIMIT 1)  AS INVOICE_NO
               , (SELECT S.REF_NO
                  FROM   TB_FWD_INTG_REF_NO S
                  WHERE  1=1
                  AND    S.INTG_KEY_ID = A.BL_ID
                  AND    S.DEL_YN = 'N'
                  AND    S.REF_NO_SPR_CD = 'LC'
                  LIMIT 1) AS CREDIT_NO
               , (CASE 
                        WHEN #{exctSprCd} = 'OC'
                        THEN A.VOYAGE
                        WHEN #{exctSprCd} = 'AR'
                        THEN A.FLT_VSL_NM
                  END) AS  VOYAGE_NO /* 항차 */
               , (CASE 
                         WHEN #{exctSprCd} = 'OC'
                         THEN A.FLT_VSL_NM
                         WHEN #{exctSprCd} = 'AR'
                         THEN IFNULL( (SELECT BB.BIZPTNR_GRP_ENG_ACRN_NM
                                       FROM   TB_COM_BIZPTNR AA
                                              INNER JOIN TB_COM_BIZPTNR_GRP_CD BB
                                       WHERE  AA.BIZPTNR_GRP_CD = BB.BIZPTNR_GRP_CD
                                       AND    AA.BIZPTNR_CD = D.CARR_CD), SUBSTR(A.FLT_VSL_NM, 1, 2) )
                  END) AS TRANSPORT_NAME /* 편기선명  */
               /* AR : 항공사약어가 없을 경우를 대비해 NVL처리 */
               , ''                 AS VESSEL_COUNTRY /* 선박국적 */
               , A.ONBR_YMD         AS BOARD_DATE /* 출항일자 */
               , A.ARR_YMD          AS ARRIVAL_DATE /* 예정도착일자 */
               , A.POL_CD           AS LOAD_PORT
               , SUBSTR(A.POL_NM,1,35)  AS LOAD_PORT_NAME /* POL 항구명 */
               , A.POD_CD               AS DISCHARGE_PORT
               , SUBSTR(A.POD_NM,1,35)  AS DSCH_PORT_NAME /* POD 항구명 */
               , A.FDEST_CD         AS DEST_PORT
               , SUBSTR(A.FDEST_NM,1,35) AS DEST_PORT_NAME /* 최종목적지 항구명 */
               , A.POR_CD         AS ACCEPT_PORT
               , (CASE 
                         WHEN #{exctSprCd} = 'OC'
                         THEN SUBSTR(A.POR_NM,1,35)
                         WHEN #{exctSprCd} = 'AR'
                         THEN ''
                  END) AS ACCEPT_PORT_NAME /* 화물인수장소 항구명 */
               , (CASE 
                         WHEN #{exctSprCd} = 'OC'
                         THEN A.PDEL_CD
                         WHEN #{exctSprCd} = 'AR'
                         THEN ''
                  END) AS DELIVERY_PORT
               , (CASE 
                         WHEN #{exctSprCd} = 'OC'
                         THEN SUBSTR(A.PDEL_NM,1,35)
                         WHEN #{exctSprCd} = 'AR'
                         THEN ''
                  END) AS DELIVERY_PORT_NAME  /* 화물인도장소 항구명 */
               , FC_FWD_TRIM_CHAR( IF(A.BL_SPR_CD = 'D', A.CARR_NM, 'LX PANTOS CO.,LTD.') )  AS S_F_NAME
               , FC_FWD_TRIM_CHAR( IF(A.BL_SPR_CD = 'D', '', '03184 3F GWANGHWAMUN B/D. 58,      SAEMUNAN-RO, JONGNO-GU, SEOUL,     REPUBLIC OF KOREA') ) AS S_F_ADDR
               , FC_FWD_TRIM_CHAR(SUBSTR(FC_FWD_STR_RTN((SELECT S.INTG_ADDR
                                                         FROM   TB_FWD_INTG_ADDR S
                                                         WHERE  1=1
                                                         AND    S.INTG_KEY_ID = A.BL_ID
                                                         AND    S.DEL_YN = 'N'
                                                         AND    S.ADDR_SPR_CD = 'BS'),1,1,'X','X'), 1, 70)) AS CONSIGNOR_NAME
               , FC_FWD_TRIM_CHAR(SUBSTR(FC_FWD_STR_RTN((SELECT S.INTG_ADDR
                                                         FROM   TB_FWD_INTG_ADDR S
                                                         WHERE  1=1
                                                         AND    S.INTG_KEY_ID = A.BL_ID
                                                         AND    S.DEL_YN = 'N'
                                                         AND    S.ADDR_SPR_CD = 'BS'),2,0,'X','X'), 1, 175)) AS CONSIGNOR_ADDR
               , FC_FWD_TRIM_CHAR(SUBSTR(FC_FWD_STR_RTN((SELECT S.INTG_ADDR
                                                         FROM   TB_FWD_INTG_ADDR S
                                                         WHERE  1=1
                                                         AND    S.INTG_KEY_ID = A.BL_ID
                                                         AND    S.DEL_YN = 'N'
                                                         AND    S.ADDR_SPR_CD = 'BC'),1,1,'X','X'), 1, 70)) AS CONSIGNEE_NAME
               , FC_FWD_TRIM_CHAR(SUBSTR(FC_FWD_STR_RTN((SELECT S.INTG_ADDR
                                                         FROM   TB_FWD_INTG_ADDR S
                                                         WHERE  1=1
                                                         AND    S.INTG_KEY_ID = A.BL_ID
                                                         AND    S.DEL_YN = 'N'
                                                         AND    S.ADDR_SPR_CD = 'BC'),2,0,'X','X'), 1, 175)) AS CONSIGNEE_ADDR
               , FC_FWD_TRIM_CHAR(SUBSTR(FC_FWD_STR_RTN((SELECT S.INTG_ADDR
                                                         FROM   TB_FWD_INTG_ADDR S
                                                         WHERE  1=1
                                                         AND    S.INTG_KEY_ID = A.BL_ID
                                                         AND    S.DEL_YN = 'N'
                                                         AND    S.ADDR_SPR_CD = 'BN'),1,1,'X','X'), 1, 70)) AS NOTIFY1_NAME
               , FC_FWD_TRIM_CHAR(SUBSTR(FC_FWD_STR_RTN((SELECT S.INTG_ADDR
                                                         FROM   TB_FWD_INTG_ADDR S
                                                         WHERE  1=1
                                                         AND    S.INTG_KEY_ID = A.BL_ID
                                                         AND    S.DEL_YN = 'N'
                                                         AND    S.ADDR_SPR_CD = 'BN'),2,0,'X','X'), 1, 175)) AS NOTIFY1_ADDR
               , ''   AS NOTIFY2_NAME  /* NTFY2 명*/
               , ''   AS NOTIFY2_ADDR  /* NTFY2주소 */
               , ''   AS BL_ISSUE_CODE /* BL ISSUE CODE */
               , ''   AS BL_ISSUE_NAME /* BL ISSUE NAME */
               , IF(A.FRGTTERM_CD = 'PP',A.POL_CD, '')    AS PREPAID_CODE
               , IF(A.FRGTTERM_CD = 'PP','SEOUL, KOREA', '')  AS PREPAID_NAME
               , IF(A.FRGTTERM_CD = 'CC',A.POD_CD, '')          AS COLLECT_CODE
               , IF(A.FRGTTERM_CD = 'PP','', 'DESTINATION')     AS COLLECT_NAME
               , (CASE 
                         WHEN #{exctSprCd} = 'OC'
                         THEN (SELECT BL_PRT_CNT FROM TB_FWD_BL_PRT_EXPND WHERE BL_ID=A.BL_ID AND DEL_YN = 'N')
                         WHEN #{exctSprCd} = 'AR'
                         THEN 1
                   END) AS BL_DOC_COUNT
               , A.PKG_QTY AS PACKAGE_QUANTITY
               , IF(#{exctSprCd} = 'OC', A.PKG_UNIT_CD, '') AS PACKAGE_TYPE /* 항공은 A.PKGS_UNIT 주석처리 되어있음(ASIS) */
               , (CASE 
                         WHEN #{exctSprCd} = 'OC'
                         THEN FC_FWD_TRIM_CHAR( CONCAT('SAY : '
                                                          , RPAD(FC_FWD_STR_RTN((SELECT S.FRM_CONT
                                                                                 FROM   TB_FWD_INTG_RMK S           
                                                                                 WHERE  1=1
                                                                                 AND    S.INTG_KEY_ID = A.BL_ID
                                                                                 AND    S.DEL_YN = 'N'
                                                                                 AND    S.RMK_SPR_CD = 'SAY'),1,1,'X','X'),35,' ')
                                                          , RPAD(FC_FWD_STR_RTN((SELECT S.FRM_CONT
                                                                                 FROM   TB_FWD_INTG_RMK S                        
                                                                                 WHERE  1=1
                                                                                 AND    S.INTG_KEY_ID = A.BL_ID
                                                                                 AND    S.DEL_YN = 'N'
                                                                                 AND    S.RMK_SPR_CD = 'SAY'),2,2,'X','X'),35,' ')) )
                         WHEN #{exctSprCd} = 'AR'
                         THEN ''
                   END) AS GOODS_DIMENSION
               , A.SELL_GWT AS GOODS_WEIGHT
               , A.SELL_CBM AS GOODS_VOLUME /* ASIS SHPR_GRS_VOL 이나 데이터 값은 CBM , A.SELL_VOL_WGT-> A.SELL_CBM으로 변경 , 20121119 by yang */
               , CONCAT('CMBLMRPTS', DATE_FORMAT(NOW(), '%Y%m%d'),  #{lgcFileSeq}, '.txt') AS LGC_FILE_NAME
               , ''                         AS SEND_PART /* ASIS SO_SEND_PART */
               , A.BL_ID                    AS BL_ID       
               , IF(#{exctSprCd} = 'AR', A.BL_NO, '') AS AWB_NO
               , NOW()                                AS TIMESTAMP
               , IF(#{exctSprCd} = 'AR', A.SELL_CWT, '') AS CHARGE_WEIGHT
               , 'CMBLMRPTS' AS BL_SEND_FIX
               , 'PANTOS' AS SENDER_FIX
               , IF(D.TASK_SPR_CD = 'EXP' , 'E' , 'I') AS EXP_IMP
               , A.LADG_TYPE_CD
        FROM   TB_FWD_BL A
               INNER JOIN TB_SMT_INTG_TASK_DEPT D ON  D.CST_BL_ID = A.BL_ID 
                                                  AND D.EO_NO = A.EO_NO
                                                  AND D.DEL_YN = 'N'
                                                  AND D.TASK_SPR_CD IN (#{taskSprCd}, 'TRD')
                                                  AND D.EXCT_BIZPTNR_CD = #{corpCd}
        WHERE  1=1
        AND    A.DEL_YN = 'N'
        AND    A.BL_SPR_CD IN ('H','D')
        AND    A.EXCT_SPR_CD = #{exctSprCd}
        AND    A.BL_ID = #{blId}   
    </select>
    
    
    <!-- LGC - FHN 인터페이스 테이블 등록  -->
    <insert id="insertLgCIfTblFHN" parameterType="dataItem" >
        /* fwd.edi.fwdCstComIfMgnt.insertLgCIfTbl */
        INSERT INTO NFINF.TB_FWD_INT560(
                                          INTERFACE_ID 
                                        , XML_MSG_ID
                                        , XML_DOC_SEQ
                                        , GUBUN
                                        , BL_GUBUN
                                        , BL_NO
                                        , SENDING_COUNT
                                        , DAMDANG_NAME
                                        , DAMDANG_DEPT
                                        , DAMDANG_CALL
                                        , BL_ISSUE_DATE
                                        , PAYMENT_CODE
                                        , EXCHANGE_RATE
                                        , TRANSFER_COND
                                        , MASTER_BL_NO
                                        , SR_NO
                                        , SERVICE_TYPE
                                        , INVOICE_NO
                                        , CREDIT_NO
                                        , VOYAGE_NO
                                        , TRANSPORT_NAME
                                        , VESSEL_COUNTRY
                                        , BOARD_DATE
                                        , ARRIVAL_DATE
                                        , LOAD_PORT
                                        , LOAD_PORT_NAME
                                        , DISCHARGE_PORT
                                        , DSCH_PORT_NAME
                                        , DEST_PORT
                                        , DEST_PORT_NAME
                                        , ACCEPT_PORT
                                        , ACCEPT_PORT_NAME
                                        , DELIVERY_PORT
                                        , DELIVERY_PORT_NAME
                                        , S_F_NAME
                                        , S_F_ADDR
                                        , CONSIGNOR_NAME
                                        , CONSIGNOR_ADDR
                                        , CONSIGNEE_NAME
                                        , CONSIGNEE_ADDR
                                        , NOTIFY1_NAME
                                        , NOTIFY1_ADDR
                                        , NOTIFY2_NAME
                                        , NOTIFY2_ADDR
                                        , BL_ISSUE_CODE
                                        , BL_ISSUE_NAME
                                        , PREPAID_CODE
                                        , PREPAID_NAME
                                        , COLLECT_CODE
                                        , COLLECT_NAME
                                        , BL_DOC_COUNT
                                        , PACKAGE_QUANTITY
                                        , PACKAGE_TYPE
                                        , GOODS_DIMENSION
                                        , GOODS_WEIGHT
                                        , GOODS_VOLUME
                                        , LGC_FILE_NAME
                                        , SEND_PART
                                        , BL_ID
                                        , AWB_NO
                                        , TIMESTAMP
                                        , CHARGE_WEIGHT
                                        , BL_SEND_FIX
                                        , SENDER_FIX
								        , EXP_IMP
								        , LADG_TYPE_CD
                        )
          VALUES (
                                        IFNULL(#{interfaceId},'' )
                                        , IFNULL(#{xmlMsgId},'' )
                                        , IFNULL(#{xmlDocSeq},0 )
                                        , IFNULL(#{gubun},'' )
                                        , IFNULL(#{blGubun},'' )
                                        , IFNULL(#{blNo},'' )
                                        , IFNULL(#{sendingCount},0 )
                                        , IFNULL(#{damdangName},'' )
                                        , IFNULL(#{damdangDept},'' )
                                        , IFNULL(#{damdangCall},'' )
                                        , IFNULL(#{blIssueDate},'' )
                                        , IFNULL(#{paymentCode},'' )
                                        , IFNULL(#{exchangeRate},0 )
                                        , IFNULL(#{transferCond},'' )
                                        , IFNULL(#{masterBlNo},'' )
                                        , IFNULL(#{srNo},'' )
                                        , IFNULL(#{serviceType},'' )
                                        , IFNULL(#{invoiceNo},'' )
                                        , IFNULL(#{creditNo},'' )
                                        , IFNULL(#{voyageNo},'' )
                                        , IFNULL(#{transportName},'' )
                                        , IFNULL(#{vesselCountry},'' )
                                        , IFNULL(#{boardDate},'' )
                                        , IFNULL(#{arrivalDate},'' ) 
                                        , IFNULL(#{loadPort},'' )
                                        , IFNULL(#{loadPortName},'' )
                                        , IFNULL(#{dischargePort},'' )
                                        , IFNULL(#{dschPortName},'' )
                                        , IFNULL(#{destPort},'' )
                                        , IFNULL(#{destPortName},'' )
                                        , IFNULL(#{acceptPort},'' )
                                        , IFNULL(#{acceptPortName},'' )
                                        , IFNULL(#{deliveryPort},'' )
                                        , IFNULL(#{deliveryPortName},'' )
                                        , IFNULL(#{sFName},'' )
                                        , IFNULL(#{sFAddr},'' )
                                        , IFNULL(#{consignorName},'' )
                                        , IFNULL(#{consignorAddr},'' )
                                        , IFNULL(#{consigneeName},'' )
                                        , IFNULL(#{consigneeAddr},'' )
                                        , IFNULL(#{notify1Name},'' )
                                        , IFNULL(#{notify1Addr},'' )
                                        , IFNULL(#{notify2Name},'' )
                                        , IFNULL(#{notify2Addr},'' )
                                        , IFNULL(#{blIssueCode},'' )
                                        , IFNULL(#{blIssueName},'' )
                                        , IFNULL(#{prepaidCode},'' )
                                        , IFNULL(#{prepaidName},'' ) 
                                        , IFNULL(#{collectCode},'' )
                                        , IFNULL(#{collectName},'' )
                                        , IFNULL(#{blDocCount},0 )
                                        , IFNULL(#{packageQuantity},0 )
                                        , IFNULL(#{packageType},'' )
                                        , IFNULL(#{goodsDimension},'' )
                                        , IFNULL(#{goodsWeight},0 )
                                        , IFNULL(#{goodsVolume},0 )
                                        , IFNULL(#{lgcFileName},'' )
                                        , IFNULL(#{sendPart},'' )
                                        , IFNULL(#{blId},'' )
                                        , IFNULL(#{awbNo},'' )
                                        , NOW()
                                        , IFNULL(#{chargeWeight},0 )
                                        , IFNULL(#{lbSendFix},'' )
                                        , IFNULL(#{senderFix},'' )
                                        , IFNULL(#{expImp},'' )
                                        , IFNULL(#{ladgTypeCd},'' )
                 )     
    </insert>
    
    <!-- GOODS 등록  -->
    <insert id="insertHblGoods" parameterType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.insertHblGoods */
        INSERT INTO NFINF.TB_FWD_INT561
               (
	                INTERFACE_ID
	               ,XML_MSG_ID
	               ,XML_DOC_SEQ
	               ,GOODS_SEQ
	               ,GOODS_DESC1
	               ,GOODS_DESC2
	               ,GOODS_DESC3
	               ,GOODS_DESC4
	               ,GOODS_DESC5
	               ,TIMESTAMP 
               )
               SELECT #{interfaceId}
                      ,#{xmlMsgId}
                      ,1
                      ,#{jdx}
                      ,FC_FWD_TRIM_CHAR(SUBSTR(FC_FWD_STR_RTN(SUBSTR(S.FRM_CONT,1,2000),(#{jdx}-1)*5+1,(#{jdx}-1)*5+1,'X','X'), 1, 80))
                      ,FC_FWD_TRIM_CHAR(SUBSTR(FC_FWD_STR_RTN(SUBSTR(S.FRM_CONT,1,2000),(#{jdx}-1)*5+2,(#{jdx}-1)*5+2,'X','X'), 1, 80))
                      ,FC_FWD_TRIM_CHAR(SUBSTR(FC_FWD_STR_RTN(SUBSTR(S.FRM_CONT,1,2000),(#{jdx}-1)*5+3,(#{jdx}-1)*5+3,'X','X'), 1, 80))
                      ,FC_FWD_TRIM_CHAR(SUBSTR(FC_FWD_STR_RTN(SUBSTR(S.FRM_CONT,1,2000),(#{jdx}-1)*5+4,(#{jdx}-1)*5+4,'X','X'), 1, 80))
                      ,FC_FWD_TRIM_CHAR(SUBSTR(FC_FWD_STR_RTN(SUBSTR(S.FRM_CONT,1,2000),(#{jdx}-1)*5+5,(#{jdx}-1)*5+5,'X','X'), 1, 80))                     
                      ,NOW()
              FROM   TB_FWD_INTG_RMK      S /* 통합비고 */
              WHERE  1=1
              AND    S.DEL_YN = 'N' /* 삭제여부 */
              AND    S.INTG_KEY_ID = #{blId}
              AND    S.RMK_SPR_CD = #{rmkSprCd} /* 적요구분코드 */
              LIMIT  1
    </insert>
    
    <!-- Mark 등록  -->
    <insert id="insertHblMark" parameterType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.insertHblMark */
        INSERT INTO NFINF.TB_FWD_INT562
              ( INTERFACE_ID
                , XML_MSG_ID
                , XML_DOC_SEQ
                , MARK_SEQ
                , SHIPPING_MARK1
                , SHIPPING_MARK2
                , SHIPPING_MARK3
                , SHIPPING_MARK4
                , SHIPPING_MARK5
                , SHIPPING_MARK6
                , SHIPPING_MARK7
                , SHIPPING_MARK8
                , SHIPPING_MARK9
                , SHIPPING_MARK10
                , TIMESTAMP 
              )
               SELECT #{interfaceId}
                      , #{xmlMsgId}
                      , 1
                      , #{jdx}
                      , FC_FWD_TRIM_CHAR(SUBSTR(FC_FWD_STR_RTN(S.FRM_CONT,(#{jdx}-1)*5+1,(#{jdx}-1)*5+1,'X','X'), 1, 35))
	                  , FC_FWD_TRIM_CHAR(SUBSTR(FC_FWD_STR_RTN(S.FRM_CONT,(#{jdx}-1)*5+2,(#{jdx}-1)*5+2,'X','X'), 1, 35))
	                  , FC_FWD_TRIM_CHAR(SUBSTR(FC_FWD_STR_RTN(S.FRM_CONT,(#{jdx}-1)*5+3,(#{jdx}-1)*5+3,'X','X'), 1, 35))
	                  , FC_FWD_TRIM_CHAR(SUBSTR(FC_FWD_STR_RTN(S.FRM_CONT,(#{jdx}-1)*5+4,(#{jdx}-1)*5+4,'X','X'), 1, 35))
	                  , FC_FWD_TRIM_CHAR(SUBSTR(FC_FWD_STR_RTN(S.FRM_CONT,(#{jdx}-1)*5+5,(#{jdx}-1)*5+5,'X','X'), 1, 35))
	                  , FC_FWD_TRIM_CHAR(SUBSTR(FC_FWD_STR_RTN(S.FRM_CONT,(#{jdx}-1)*5+6,(#{jdx}-1)*5+6,'X','X'), 1, 35))
	                  , FC_FWD_TRIM_CHAR(SUBSTR(FC_FWD_STR_RTN(S.FRM_CONT,(#{jdx}-1)*5+7,(#{jdx}-1)*5+7,'X','X'), 1, 35))
	                  , FC_FWD_TRIM_CHAR(SUBSTR(FC_FWD_STR_RTN(S.FRM_CONT,(#{jdx}-1)*5+8,(#{jdx}-1)*5+8,'X','X'), 1, 35))
	                  , FC_FWD_TRIM_CHAR(SUBSTR(FC_FWD_STR_RTN(S.FRM_CONT,(#{jdx}-1)*5+9,(#{jdx}-1)*5+9,'X','X'), 1, 35))
	                  , FC_FWD_TRIM_CHAR(SUBSTR(FC_FWD_STR_RTN(S.FRM_CONT,(#{jdx}-1)*5+10,(#{jdx}-1)*5+10,'X','X'), 1, 35))                     
	                  , NOW()
              FROM    TB_FWD_INTG_RMK      S /* 통합비고 */
              WHERE   1=1
              AND     S.DEL_YN = 'N' /* 삭제여부 */
              AND     S.INTG_KEY_ID = #{blId}
              AND     S.RMK_SPR_CD = #{rmkSprCd} /* 적요구분코드 */
              LIMIT  1 
    </insert>
    
    <!-- HBLCont등록  -->
    <insert id="insertHblCont" parameterType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.insertHblCont */
        INSERT INTO NFINF.TB_FWD_INT563
              ( INTERFACE_ID
                , XML_MSG_ID
                , XML_DOC_SEQ
                , CONT_SEQ
                , CONTAINER_NO
                , CONT_TYPE_SIZE
                , CONT_STATUS_CODE
                , CONT_WEIGHT
                , CONT_VOLUME
                , CONT_CARTOON_NO
                , SEAL_NO
                , TIMESTAMP )
              SELECT #{interfaceId}
                     , #{xmlMsgId}
                     , 1
                     , @rownum:=@rownum+1
                     , S.CNTR_NO
                     , S.CNTR_SIZE_CD || S.CNTR_TYPE_CD
                     , 'N'
                     , S.WGT
                     , S.VOL
                     , 0
                     , S.SEAL1
                     , NOW()
              FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
              INNER JOIN TB_SMT_INTG_ITEM S ON  S.INTG_ITEM_NO = T.INTG_ITEM_NO /* 컨테이너  */
                                            AND S.CNTR_YN = 'Y'
                                            AND S.DEL_YN = 'N'
                    ,(SELECT @rownum:=0) TMP
              WHERE  1=1
              AND    T.DEL_YN = 'N' /* 삭제여부 */
              AND    S.DEL_YN = 'N' /* 삭제여부 */
              AND    T.BL_ID = #{blId}
    </insert>
    
    <!-- LGC HBL 운임등록  -->
    <insert id="insertLgCHblFrgh" parameterType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.insertLgCHblFrgh */
        INSERT INTO NFINF.TB_FWD_INT564 
              ( INTERFACE_ID
                , XML_MSG_ID
                , XML_DOC_SEQ
                , CHARGE_SEQ
                , CHARGE_CODE
                , CHARGE_DESC
                , PAY_ARRANGE
                , CHARGE_CLASS
                , CHARGE_CLASS1
                , CHARGE_CLASS2
                , CHARGE_CLASS3
                , CHARGE_CLASS4
                , CHARGE_CLASS5
                , TIMESTAMP)
	            SELECT  #{interfaceId}
	                    , #{xmlMsgId}
	                    , 1 AS XML_DOC_SEQ
	                    , MAX(C.SELLBUY_SEQ) AS CHARGE_SEQ
	                    , (SELECT MAX(X.OUTR_CD) 
	                       FROM   TB_COM_CD_MPNG X
	                       WHERE  X.CD_MPNG_SPR_NM = 'KL-NET_FREIGHT_CODE' 
                           AND    X.INSD_CD = C.FRGH_CD 
                           AND    X.MPNG_DRCT_CD = 'T'
                           AND    X.USE_YN = 'Y') AS CHARGE_CODE                                    /* 2021.04.14 두개행 리턴보완*/
                        , SUBSTR((SELECT MAX(X.OUTR_CD_NM) 
	                              FROM   TB_COM_CD_MPNG X
	                              WHERE  X.CD_MPNG_SPR_NM = 'KL-NET_FREIGHT_CODE' 
	                              AND    X.INSD_CD = C.FRGH_CD 
	                              AND    X.MPNG_DRCT_CD = 'T'
	                              AND    X.USE_YN = 'Y'),1,26) AS CHARGE_DESC           /*2021.01.04 김정숙 LG_MMA 26자초과건 보완   2021.04.14 두개행 리턴보완*/                               
	                    , MAX((CASE 
							         WHEN C.FRGTTERM_CD = 'PP'
							         THEN 'P'
							         WHEN C.FRGTTERM_CD = 'CC'
							         THEN 'C'
					           END)) AS PAY_ARRANGE
                        , MAX(
                           CONCAT(
                                   RPAD(CAST(IFNULL(C.APLY_UNTPRC,0) AS CHAR),10, ' ')
                                   , CONCAT ( CAST(IFNULL((CASE 
												                WHEN C.FRGH_UNIT_CD = '05'
								                                THEN C.CNTR_SIZE_CD
									                            WHEN C.FRGH_UNIT_CD = '04'
												                THEN 'RTON'
												                WHEN C.FRGH_UNIT_CD = '01'
												                THEN 'BL'
									                       END), ' ') AS CHAR)
			                                  , CAST(IFNULL((CASE 
												                WHEN C.FRGH_UNIT_CD = '05'
												                THEN C.CNTR_TYPE_CD
												                WHEN C.FRGH_UNIT_CD = '04'
												                THEN C.FRGH_QTY_WGT
												                WHEN C.FRGH_UNIT_CD = '01'
												                THEN '1'
												           END), ' ') AS CHAR)
		                                      )
                                    , RPAD(CAST(IFNULL(C.FRGH_QTY_WGT,0) AS CHAR),10, ' ')
                                 )
                           ) AS CHARGE_CLASS
                         , NULL AS CHARGE_CLASS1
                         , NULL AS CHARGE_CLASS2
                         , NULL AS CHARGE_CLASS3
                         , NULL AS CHARGE_CLASS4
                         , NULL AS CHARGE_CLASS5
                         , NOW()
                 FROM    TB_FWD_BL A /* HBL */
                         INNER JOIN TB_ISM_SELLBUY C ON  C.BL_ID = A.BL_ID
                                                     AND C.SELLBUY_SPR_CD = 'SO' /* 공통코드 0051 SO:매출 SI:사내매출 ASIS   A.BUY_SALES_TYPE = 'S' */
                                                     AND C.DOM_ABRD_BIZPTNR_TYPE_CD IN ('1','2')   /* 1:국내거래처,2:해외거래처,3:파트너*/
                                                     AND C.ADJ_STN_TYPE_CD = IF(A.BL_SPR_CD = 'D','02','01' )
                                                     AND C.INV_NO IS NULL
                                                     AND C.ADJ_YN = 'Y'
                                                     AND C.DEL_YN = 'N'
                         INNER JOIN TB_ISM_SELLBUY_DTL D ON  D.SMT_NO = C.SMT_NO
                                                         AND D.SELLBUY_SEQ = C.SELLBUY_SEQ
                 WHERE   1=1
                 AND     A.BL_SPR_CD IN ('H','D')
                 AND     C.ADJ_STN_TYPE_CD = IF(A.BL_SPR_CD = 'D','02','01' )
                 AND     A.DEL_YN = 'N'
                 AND     A.BL_ID = #{blId}
                 GROUP BY C.FRGH_CD
    </insert>
    
    <!-- LGC HBL 운임 상세 등록  -->
    <insert id="insertLgCHblFrghDtl" parameterType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.insertLgCHblFrghDtl */
        INSERT INTO NFINF.TB_FWD_INT565 
                (INTERFACE_ID
                 , XML_MSG_ID
                 , XML_DOC_SEQ
                 , CHARGE_SEQ
                 , SUB_CHARGE_SEQ
                 , SUB_CHARGE
                 , SUB_CHARGE_CODE
                 , SUB_CHARGE_KRW
                 , SUB_CHARGE_CODE_KRW
                 , TIMESTAMP)
                 SELECT #{interfaceId}
                        ,#{xmlMsgId}
                        , 1 AS XML_DOC_SEQ
                        , MAX(C.SELLBUY_SEQ) AS CHARGE_SEQ
                        , 1 AS SUB_CHARGE_SEQ
                         ,SUM((CASE 
					                  WHEN C.CTRT_CUR_CD = 'KRW'
					                  THEN C.LOCL_FRGH_AMT
					                  WHEN C.CTRT_CUR_CD = 'USD'
					                  THEN C.DOL_FRGH_AMT
                                      ELSE 
                                            C.CTRT_FRGH_AMT
                                END)) AS SUB_CHARGE
                        , MAX(C.CTRT_CUR_CD) AS SUB_CHARGE_CODE
                        , IF ( SUM(IF(C.CTRT_CUR_CD='USD', C.LOCL_FRGH_AMT,0)) = 0, NULL, SUM(IF(C.CTRT_CUR_CD='USD',C.LOCL_FRGH_AMT,0)) ) AS SUB_CHARGE_KRW                         
                        , MAX( IF(C.CTRT_CUR_CD='USD', 'KRW', NULL) ) AS SUB_CHARGE_CODE_KRW
                        , NOW()
                 FROM    TB_FWD_BL A /* HBL */
                         INNER JOIN TB_ISM_SELLBUY C ON  C.BL_ID = A.BL_ID
                                                     AND C.SELLBUY_SPR_CD = 'SO' /* 공통코드 0051 SO:매출 SI:사내매출 ASIS   A.BUY_SALES_TYPE = 'S' */
                                                     AND C.DOM_ABRD_BIZPTNR_TYPE_CD IN ('1','2')   /* 1:국내거래처,2:해외거래처,3:파트너*/
                                                     AND C.ADJ_STN_TYPE_CD = IF(A.BL_SPR_CD='D','02','01')
                                                     AND C.INV_NO IS NULL
                                                     AND C.ADJ_YN = 'Y'
                                                     AND C.DEL_YN = 'N'
                         INNER JOIN TB_ISM_SELLBUY_DTL D ON  D.SMT_NO = C.SMT_NO
                                                         AND D.SELLBUY_SEQ = C.SELLBUY_SEQ
                 WHERE   1=1
                 AND     A.BL_SPR_CD IN ('H','D')
                 AND     A.DEL_YN = 'N'
                 AND     A.BL_ID = #{blId}
                 GROUP BY C.FRGH_CD
    </insert>
    
    <!-- LGE HBL 정보조회  -->
    <select id="selectLgEHblInfo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgEHblInfo */
        SELECT  
			     'F' CHK 
	             , A.BL_ID 
	             , A.BL_SPR_CD AS BL_SPR_CD /* BL 구분*/
	             , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                        <property name="clasCd" value="'0055'"/>
                        <property name="dtlCd" value="A.BL_SPR_CD"/>
                    </include>) AS BL_SPR_NM
	             /*, FC_CM_GET_ETC_CD_NM('0055', A.BL_SPR_CD) AS BL_SPR_NM /* BL 구분*/
	             , A.EXCT_SPR_CD 
	             , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                        <property name="clasCd" value="'0025'"/>
                        <property name="dtlCd" value="A.EXCT_SPR_CD"/>
                    </include>) AS EXCT_SPR_NM
	             /*, FC_CM_GET_ETC_CD_NM('0025', A.EXCT_SPR_CD) AS EXCT_SPR_NM /* BL 구분*/
	             , A.RPRS_REF_NO /* 대표참조번호 */
	             , (SELECT S.REF_NO
	                FROM   TB_FWD_INTG_REF_NO S
	                WHERE  1=1
	                AND    S.INTG_KEY_ID = A.BL_ID
	                AND    S.REF_NO_SPR_CD = 'IN'
	                AND    S.DEL_YN = 'N'
	                LIMIT  1) AS INV_NO            
	             , A.MBL_NO /* MBL NO*/
	             , A.BL_NO  /* BL NO */
	             , A.ONBR_YMD /* 선적일자 */
	             , A.ARR_YMD /* 선적일자 */
	             , CASE WHEN A.EXCT_SPR_CD = 'OC' 
	               THEN A.ONBR_CLOS_YN
	                    WHEN A.EXCT_SPR_CD = 'AR' OR A.EXCT_SPR_CD = 'EX' 
	                    THEN A.WGT_CLOS_YN
	                    /* [TODO] PJS : 차후에 RAIL 에서 만들면 사용한다.
	                    WHEN A.EXCT_SPR_CD = 'RL' 
	                    THEN FC_RL_DPT_CLOS_YN(A.BL_ID, 'EXP')*/
	               END AS CLOS_YN /* BL전송가능시점  해상:선적마감, 항공,특송:중량마감, 철송:발차마감 */
	                              /* 전송화면에서 CLOS_YN 관계없이 전송가능하도록 다시 수정 20130112 */
	             , A.EXPS_BIZ_TYPE_CD
	             , A.ONBR_CLOS_YN /* 선적마감여부 */ 
	             , A.PKG_QTY      /* 패키지수량 */        
	             , A.PKG_UNIT_CD  /* 패키지단위코 */
	             , A.SELL_CWT     /* 매출CWT */
	             , A.POL_CD     /* POL */
	             , A.POL_NM     /* POL명 */
	             , A.FLT_VSL_NM /* 편기선명 */
	             , B.PRE_FLT_VSL_NM
	             , A.POD_CD     /* POD */
	             , A.POD_NM     /* POD명 */
	             , C.OFCR_EMPNO /* 담당자사번 */
	             , (SELECT ENG_EMP_NM
			        FROM   TB_COM_EMP
			        WHERE  EMPNO = C.OFCR_EMPNO) AS OFCR_EMPNM /* 담당자명 */
	             , A.SHPP_CD /* 송화주코드 */
	             , A.SHPP_NM /* 송화주명 */
	             , A.CNEE_CD /* 수화주코드 */
	             , A.CNEE_NM /* 수화주명 */
	             , A.RPRS_ITEM_CD /* 대표품목코드 */
	             , A.RPRS_ITEM_NM /* 대표품목명 */    
	             , (SELECT COUNT(1)       
	                FROM TB_FWD_BL_PRT_EXPND
	                WHERE PRT_KIND_CD = 'O'
	                AND BL_ID = A.BL_ID 
	                AND DEL_YN = 'N') AS OBL_CNT 
	             , D.CST_OBU_CD   /* 고객OBU코드 */  
	             , C.INTG_TASK_NO 
	             , A.MBL_ID 
	             , (SELECT BB.INTG_TASK_NO 
	                FROM  TB_FWD_BL AA
	                      , TB_SMT_INTG_TASK_DEPT BB 
	                WHERE AA.BL_ID = A.MBL_ID
	                AND   AA.EO_NO = BB.EO_NO
	                AND   AA.BL_ID = BB.CST_BL_ID
	                AND   IFNULL(AA.DEL_YN, 'N') = 'N'
	                AND   IFNULL(BB.DEL_YN, 'N') = 'N'
	                AND   BB.TASK_SPR_CD = 'EXP'
	                LIMIT 1  
	                ) AS MBL_INTG_TASK_NO
	             , A.SMT_NO 
	             , A.EO_NO   
                 , (SELECT IF (COUNT(1)=0, 'N', 'Y')
	                FROM   NFINF.TB_FWD_INT183 AA
	                       , NFINF.TB_EDI_MASTER_S BB
	                WHERE  1=1
	                AND    AA.INTERFACE_ID = BB.INTERFACE_ID
	                AND    AA.BL_NO = A.BL_NO) AS SEND_YN
	               , ( SELECT IF (COUNT(1)=0, 'N', 'Y')
	                 FROM NFINF.TB_ISM_INT181 AA 
	                 LEFT OUTER JOIN NFINF.TB_ISM_INT182 BB ON BB.INTERFACE_ID = AA.INTERFACE_ID     
	                 WHERE  1=1 
	                 AND AA.DOC_NO = A.BL_NO) AS RECEIVE_YN
	               , (SELECT CO_ONBR_YMD 
	                  FROM   TB_SMT_CO 
	                  WHERE  1=1 
	                  AND    CO_NO = ( IFNULL( A.RPRS_REF_NO , ( SELECT S.REF_NO 
	                                                             FROM   TB_FWD_INTG_REF_NO S 
	                                                             WHERE  1=1 
	                                                             AND    S.INTG_KEY_ID = A.BL_ID 
	                                                             AND    S.DEL_YN = 'N' 
	                                                             AND    S.REF_NO_SPR_CD = 'IN' 
	                                                             LIMIT  1 )
	                                           )
	                                   )
	                 LIMIT 1) AS SR_ETD
	             , (SELECT DATE_FORMAT(CO_RECV_DT, '%Y%m%d') 
	                FROM   TB_SMT_CO 
	                WHERE  1=1 
	                AND    CO_NO = ( IFNULL( A.RPRS_REF_NO , ( SELECT S.REF_NO 
	                                                           FROM   TB_FWD_INTG_REF_NO S 
	                                                           WHERE  1=1 
	                                                           AND    S.INTG_KEY_ID = A.BL_ID 
	                                                           AND    S.DEL_YN = 'N' 
	                                                           AND    S.REF_NO_SPR_CD = 'IN' 
	                                                           LIMIT  1)
	                                         )
	                                )
	                LIMIT 1)  AS SR_RECV_DT 
	            , '' AS SEND_TYPE                            
        FROM   TB_FWD_BL A
        INNER JOIN TB_FWD_BL_EXPND B ON B.BL_ID = A.BL_ID
        INNER JOIN TB_SMT_INTG_TASK_DEPT C ON  C.EO_NO = A.EO_NO
	                                       AND C.CST_BL_ID = A.BL_ID
	                                       AND C.EXCT_BIZPTNR_CD = #{corpCd} 
	                                       AND IFNULL(C.DEL_YN, 'N') = 'N'
	                                       AND C.TASK_SPR_CD IN ( 'EXP', 'CSM' )
	    INNER JOIN TB_FWD_BL_CST_EXPND D ON D.BL_ID = A.BL_ID
	    INNER JOIN TB_SMT_ORD E ON E.SMT_NO = A.SMT_NO
        WHERE  1=1 
        AND    A.BL_SPR_CD IN ('H','D')
        <![CDATA[  
        AND    A.ONBR_YMD >= #{fromDt}   
        AND    A.ONBR_YMD <= #{toDt}   
        ]]>    
        AND    A.DEL_YN = 'N'
        AND    A.BL_NO IS NOT NULL
        AND    C.TASK_SPR_CD = CASE WHEN ( SELECT  COUNT(1)
                                           FROM    TB_FWD_BL AA
                                                 , TB_SMT_INTG_TASK_DEPT BB
                                           WHERE   1=1
                                           AND     AA.EO_NO = BB.EO_NO
                                           AND     AA.BL_ID = BB.CST_BL_ID
                                           AND     BB.EXCT_BIZPTNR_CD = C.EXCT_BIZPTNR_CD
                                           AND     AA.SMT_NO = A.SMT_NO
                                           /*AND     AA.BL_NO = A.BL_NO*/
                                           AND     AA.DEL_YN = 'N'
                                           AND     BB.DEL_YN = 'N'
                                           AND     BB.TASK_SPR_CD = 'CSM' ) > 0 
                                    THEN 'CSM'
                                    ELSE 'EXP' 
                                END /* CSM건이 존재할 경우 같은 SO의 EXP건은 검색되지 않도록 */
        AND    A.SPLIT_BL_YN = 'N' /* LG전자는 SPLIT건은 전송못하도록 (윤찬수K 요청)*/
        /*--AND    NVL(A.NON_EXCT_BL_YN,'N') = 'N'  화면에서는 settlement dbl건 전송 가능토록 주석처리 */
        AND    IF (IFNULL(B.BL_CUST_SEND_YN,'N')='C','N', IFNULL(B.BL_CUST_SEND_YN,'N')) = #{sendType}
        /* [TODO] PJS : CONNECT BY PRIOR 부분을 일단 막는다.. */
         <!-- AND    E.ORD_BIZPTNR_CD IN (SELECT BIZPTNR_CD
                                    FROM TB_COM_BIZPTNR
                                    CONNECT BY PRIOR BIZPTNR_CD = UPPR_BIZPTNR_CD
                                    START WITH BIZPTNR_CD = #{shppCd}) /*하위거래처 조회되도록 추가요청으로 주석처리 (박정진D 요청) */ -->
        AND    E.ORD_BIZPTNR_CD IN (SELECT  BIZPTNR_CD
                                    FROM    TB_COM_BIZPTNR  /* MAIN */
                                    WHERE   BIZPTNR_GRP_CD IN ('1001001','1006001')  /* LG마그나 */
                                    AND     USE_YN = 'Y'
                                    AND     MBIZPTNR_YN = 'Y'
                                    UNION ALL
                                    SELECT  A.BIZPTNR_CD
                                    FROM    TB_COM_BIZPTNR A  /* SUB */
                                          , TB_COM_BIZPTNR B  /* MAIN */
                                    WHERE   A.USE_YN = 'Y'
                                    AND     A.MBIZPTNR_YN = 'N'
                                    AND     A.MBIZPTNR_CD = B.BIZPTNR_CD
                                    AND     B.BIZPTNR_GRP_CD IN ('1001001','1006001')  /* LG마그나 */
                                    UNION ALL
                                    SELECT  C.BIZPTNR_CD
                                    FROM    TB_COM_BIZPTNR C
                                    WHERE   C.USE_YN = 'Y'
                                    AND     C.BIZPTNR_CD IN ( '1029701' , '1008349')/*  HLDS 혜주건 추가 2013-03-01, 말레이시아 법인건 추가 2018-12-11 */
                                    )
        AND     E.ORD_BIZPTNR_CD != '2000061' /* 본사 HLDS 제외 장경화C 요청 */
        
        <if test="ofcrEmpno != null and ofcrEmpno != ''">
            AND     C.OFCR_EMPNO = #{ofcrEmpno}
        </if>
        <if test="blNo != null and blNo != ''">
            AND     A.BL_NO =  #{blNo}
        </if>
        <if test="polCd != null and polCd != ''">
            AND     A.POL_CD LIKE CONCAT(#{polCd},'%')
        </if>
        <if test="podCd != null and podCd != ''">
            AND     A.POD_CD LIKE CONCAT(#{podCd},'%')
        </if>
        <if test="blSprCd != null and blSprCd != ''">
            AND     A.BL_SPR_CD =  #{blSprCd}
        </if>
        <if test="exctSprCd != null and exctSprCd != ''">
            AND     A.EXCT_SPR_CD =  #{exctSprCd}
        </if>
        <if test='coYn != null and coYn != "" and coYn == "Y"'>
            AND    EXISTS ( SELECT  1
		                    FROM    TB_SMT_ORD_CO_RELT X
		                          , TB_SMT_CO Y
		                    WHERE   E.SMT_NO = X.SMT_NO
		                    AND     X.CO_RECV_NO = Y.CO_RECV_NO
		                    AND     X.DEL_YN = 'N'
		                    AND     Y.DEL_YN = 'N'
		                  ) /* Co 및 RELT존재 */
        </if>
        <if test='coYn != null and coYn != "" and coYn == "N"'>
            AND    NOT EXISTS( SELECT  1
			                   FROM    TB_SMT_ORD_CO_RELT X
			                           , TB_SMT_CO Y
			                   WHERE   E.SMT_NO = X.SMT_NO
			                   AND     X.CO_RECV_NO = Y.CO_RECV_NO
			                   AND     X.DEL_YN = 'N'
			                   AND     Y.DEL_YN = 'N'
                            ) /* Co 및 RELT존재 */
        </if>
        <if test="cstSprCd != null and cstSprCd != '' and cstSprCd == 'LGE'">
            AND    NOT EXISTS (
	                               SELECT 1
	                               FROM TB_COM_BIZPTNR SA
	                                   ,TB_COM_BIZPTNR SB
	                               WHERE 1 = 1
	                               AND  SA.BIZPTNR_CD     = E.ORD_BIZPTNR_CD
	                               AND  SB.BIZPTNR_CD     = IF(IFNULL(SA.MBIZPTNR_YN,'N')='Y', SA.BIZPTNR_CD, SA.MBIZPTNR_CD)
	                               AND  SB.BIZPTNR_GRP_CD = '1006001' /* LG마그나 거래처그룹코드 */
                               )
        </if>
        <if test="cstSprCd != null and cstSprCd != '' and cstSprCd == 'LGMG'">
            AND    EXISTS (
                               SELECT 1
                               FROM TB_COM_BIZPTNR SA
                                   ,TB_COM_BIZPTNR SB
                               WHERE 1 = 1
                               AND  SA.BIZPTNR_CD     = E.ORD_BIZPTNR_CD
                               AND  SB.BIZPTNR_CD     = IF(IFNULL(SA.MBIZPTNR_YN,'N')='Y', SA.BIZPTNR_CD, SA.MBIZPTNR_CD)
                               AND  SB.BIZPTNR_GRP_CD = '1006001' /* LG마그나 거래처그룹코드 */
                          )
        </if>
    </select>
    
    
    <!-- LGEHBL전송정보조회 조회 -->
    <select id="selectLgEHblSendInfo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgEHblSendInfo */
        SELECT @rownum:=@rownum+1 AS RN
             , AA.BL_NO
             , AA.INVOICE_NO
             , AA.VESSEL_FLIGHT_NAME
             , AA.SEND_EMP_NO  
             , AA.IF_STATUS_CODE
             , AA.IF_STATUS_NAME
             , AA.SEND_DATE
             , AA.XML_MSG_ID
             , AA.XML_DOC_SEQ
        FROM     
         (      SELECT A.BL_NO  /* bl_no */
                     , A.INVOICE_NO /* invoice_no */
                     , A.VESSEL_FLIGHT_NAME /* vessel_flight_name */
                     /*, FC_CM_GET_EMP_NM(A.INS_ID) SEND_EMP_NO - Sub Query로 대체 */
                     , (SELECT ENG_EMP_NM
         FROM   TB_COM_EMP
         WHERE  EMPNO = A.INS_ID) AS SEND_EMP_NO /* send_emp_no */
                     , B.IF_STATUS_CODE /* if_status_code */
                     /*, FC_CM_GET_ETC_CD_NM('0032', B.IF_STATUS_CODE) IF_STATUS_NAME - Sub Query로 대체 */
                     , (SELECT DTL_CD_NM
         FROM   TB_COM_ETC_CD
         WHERE  CLAS_CD = '0032'
         AND    DTL_CD = B.IF_STATUS_CODE
         AND    USE_YN ='Y') AS IF_STATUS_NAME /* send_emp_no */
                     , DATE_FORMAT(A.TIMESTAMP,'%Y-%m-%d %H:%i:%s') AS SEND_DATE  /* send_date */
                     , A.XML_DOCUMENT_NO AS XML_MSG_ID
                     , A.DOCUMENT_SEQ_NO AS XML_DOC_SEQ
              FROM NFINF.TB_FWD_INT183 A
              INNER JOIN NFINF.TB_EDI_MASTER_S B ON B.INTERFACE_ID = A.INTERFACE_ID
              INNER JOIN (SELECT @rownum:=0) TMP
              WHERE 1=1
              AND A.BL_NO = #{blNo}
              ORDER BY TIMESTAMP DESC
        ) AA
    </select>
    
    <!-- LGEHBL전송정보조회 조회 -->
    <select id="selectLgEHblSendAns" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgEHblSendAns */
        SELECT @rownum:=@rownum+1 AS RN
		       , INTERFACE_ID
	           , AFFILIATE_CODE
	           , RECEIVE_STATUS
	           , RECEIVE_STATUS_NAME
	           , RECEIVE_DATE
	           , XML_DOCUMENT_NO
	           , SEND_COUNT
	           , ORIGINAL_EDI_NO 
	    FROM  ( SELECT  A.INTERFACE_ID
		                , A.AFFILIATE_CODE
		                , A.DOC_TYPE_CODE AS RECEIVE_STATUS
		                , B.RESPONSE1_DESC AS RECEIVE_STATUS_NAME
		                , A.CREATION_DATE  AS RECEIVE_DATE
		                , A.XML_DOCUMENT_NO
		                , A.SEND_COUNT AS SEND_COUNT
		                , A.ORIGINAL_EDI_NO 
		        FROM    NFINF.TB_ISM_INT181 A 
		        LEFT OUTER JOIN NFINF.TB_ISM_INT182 B ON B.INTERFACE_ID = A.INTERFACE_ID
		        WHERE   1=1 
		        AND     A.DOC_NO = #{blNo}
		        ORDER BY A.INTERFACE_ID ) AA
    </select>
    
    
    <!-- LGE HBL India 정보조회 -->
    <select id="selectLgEHblInfoIndia" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgEHblInfoIndia */
        SELECT  'F' CHK
                , RANK() OVER (PARTITION BY A.BL_ID ORDER BY A.RPRS_REF_NO) CHK_RNK 
                , A.BL_ID 
                , A.BL_SPR_CD BL_SPR_CD /* BL 구분*/ 
                /*, FC_CM_GET_ETC_CD_NM('0055', A.BL_SPR_CD) BL_SPR_NM - Include로 대체 */
                , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                        <property name="clasCd" value="'0055'"/>
                        <property name="dtlCd" value="BL_SPR_CD"/>
                    </include>) AS BL_SPR_NM /* BL 구분*/
                , A.EXCT_SPR_CD 
               /*, FC_CM_GET_ETC_CD_NM('0025', A.EXCT_SPR_CD) EXCT_SPR_NM - Include로 대체 */
                , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                        <property name="clasCd" value="'0025'"/>
                        <property name="dtlCd" value="A.EXCT_SPR_CD"/>
                   </include>) AS EXCT_SPR_NM /* BL 구분*/
                , F.CO_NO AS RPRS_REF_NO /* 대표참조번호 */
                , F.CO_NO AS INV_NO            
                , A.MBL_NO /* MBL NO*/
                , A.BL_NO  /* BL NO */
                , A.ONBR_YMD /* 선적일자 */
                , A.ARR_YMD /* 선적일자 */
                , CASE WHEN A.EXCT_SPR_CD = 'OC' 
                       THEN A.ONBR_CLOS_YN
                       WHEN A.EXCT_SPR_CD = 'AR' OR A.EXCT_SPR_CD = 'EX' 
                       THEN A.WGT_CLOS_YN
                    /* [TODO] PJS : 차후에 RAIL 에서 만들면 사용한다.
                    WHEN A.EXCT_SPR_CD = 'RL' 
                    THEN FC_RL_DPT_CLOS_YN(A.BL_ID, 'EXP')*/
               END AS CLOS_YN /* BL전송가능시점  해상:선적마감, 항공,특송:중량마감, 철송:발차마감 */
                              /* 전송화면에서 CLOS_YN 관계없이 전송가능하도록 다시 수정 20130112 */
                , A.EXPS_BIZ_TYPE_CD
                , A.ONBR_CLOS_YN /* 선적마감여부 */ 
                , A.PKG_QTY      /* 패키지수량 */        
                , A.PKG_UNIT_CD  /* 패키지단위코 */
                , A.SELL_CWT     /* 매출CWT */
                , A.POL_CD     /* POL */
                , A.POL_NM     /* POL명 */
                , A.FLT_VSL_NM /* 편기선명 */
                , B.PRE_FLT_VSL_NM
                , A.POD_CD     /* POD */
                , A.POD_NM     /* POD명 */
                , C.OFCR_EMPNO /* 담당자사번 */
                /*,FC_CM_GET_EMP_NM(C.OFCR_EMPNO) OFCR_EMPNM - Subquery로 처리 */
                , (SELECT ENG_EMP_NM
                   FROM   TB_COM_EMP
                   WHERE  EMPNO = C.OFCR_EMPNO) AS OFCR_EMPNM /* 담당자명 */
                , A.SHPP_CD /* 송화주코드 */
                , A.SHPP_NM /* 송화주명 */
                , A.CNEE_CD /* 수화주코드 */
                , A.CNEE_NM /* 수화주명 */
                , A.RPRS_ITEM_CD /* 대표품목코드 */
                , A.RPRS_ITEM_NM /* 대표품목명 */    
                , (SELECT COUNT(1)       
                   FROM TB_FWD_BL_PRT_EXPND
                   WHERE PRT_KIND_CD = 'O'
                   AND BL_ID = A.BL_ID 
                   AND DEL_YN = 'N') AS OBL_CNT 
                , D.CST_OBU_CD   /* 고객OBU코드 */  
                , C.INTG_TASK_NO 
                , A.MBL_ID 
                , (SELECT BB.INTG_TASK_NO 
                   FROM   TB_FWD_BL AA
                          , TB_SMT_INTG_TASK_DEPT BB 
                   WHERE  AA.BL_ID = A.MBL_ID
                   AND    AA.EO_NO = BB.EO_NO
                   AND    AA.BL_ID = BB.CST_BL_ID
                   AND    IFNULL(AA.DEL_YN, 'N') = 'N'
                   AND    IFNULL(BB.DEL_YN, 'N') = 'N'
                   AND    BB.TASK_SPR_CD = 'EXP'
                   LIMIT  1  
                ) AS MBL_INTG_TASK_NO
                , A.SMT_NO 
                , A.EO_NO   
                , (SELECT IF(COUNT(1)=0, 'N', 'Y') 
                   FROM   NFINF.TB_FWD_INT183 AA
                          , NFINF.TB_EDI_MASTER_S BB
                   WHERE  1=1
                   AND    AA.INTERFACE_ID = BB.INTERFACE_ID
                   AND    AA.BL_NO = A.BL_NO) AS SEND_YN
                , (SELECT IF(COUNT(1)=0, 'N', 'Y') 
                   FROM   NFINF.TB_ISM_INT181 AA 
                   LEFT OUTER JOIN NFINF.TB_ISM_INT182 BB ON BB.INTERFACE_ID = AA.INTERFACE_ID         
                   WHERE  1=1 
                   AND    AA.DOC_NO = A.BL_NO) AS RECEIVE_YN
                , G.CO_ONBR_YMD  AS SR_ETD
                , DATE_FORMAT(G.CO_RECV_DT, '%Y%m%d')  AS SR_RECV_DT  
                , F.CO_NO AS SR_NO /* SR NO */           
        FROM   TB_FWD_BL A
        INNER JOIN TB_FWD_BL_EXPND B ON B.BL_ID = A.BL_ID
        INNER JOIN TB_SMT_INTG_TASK_DEPT C ON  C.EO_NO = A.EO_NO
                   AND C.CST_BL_ID = A.BL_ID
                   AND C.EXCT_BIZPTNR_CD = #{corpCd}   
                   AND IFNULL(C.DEL_YN, 'N') = 'N' 
                   AND C.TASK_SPR_CD IN ( 'EXP', 'CSM' )
        INNER JOIN TB_FWD_BL_CST_EXPND D ON D.BL_ID = A.BL_ID
        INNER JOIN TB_SMT_ORD E ON E.SMT_NO = A.SMT_NO     
        INNER JOIN TB_SMT_ORD_CO_RELT F ON  F.SMT_NO = E.SMT_NO
                AND F.DEL_YN = 'N'
        INNER JOIN TB_SMT_CO G ON  G.CO_RECV_NO = F.CO_RECV_NO
                AND G.DEL_YN = 'N'
        WHERE  1=1 
        AND    A.BL_SPR_CD IN ('H','D')
        <![CDATA[  
        AND    A.ONBR_YMD >= #{fromDt}   
        AND    A.ONBR_YMD <= #{toDt}      
        ]]> 
        AND    A.DEL_YN = 'N'
        AND    A.BL_NO IS NOT NULL
        AND    C.TASK_SPR_CD = CASE WHEN ( SELECT  COUNT(1)
                                           FROM    TB_FWD_BL AA
                                                 , TB_SMT_INTG_TASK_DEPT BB
                                           WHERE   1=1
                                           AND     AA.EO_NO = BB.EO_NO
                                           AND     AA.BL_ID = BB.CST_BL_ID
                                           AND     BB.EXCT_BIZPTNR_CD = C.EXCT_BIZPTNR_CD
                                           AND     AA.SMT_NO = A.SMT_NO
                                           /*--AND     AA.BL_NO = A.BL_NO*/
                                           AND     AA.DEL_YN = 'N'
                                           AND     BB.DEL_YN = 'N'
                                           AND     BB.TASK_SPR_CD = 'CSM' ) > 0 THEN 'CSM'
                                    ELSE 'EXP' END /* CSM건이 존재할 경우 같은 SO의 EXP건은 검색되지 않도록 */
        AND    A.SPLIT_BL_YN = 'N' /* LG전자는 SPLIT건은 전송못하도록 (윤찬수K 요청)*/
        /*--AND    NVL(A.NON_EXCT_BL_YN,'N') = 'N' /* 화면에서는 settlement dbl건 전송 가능토록 주석처리 */
        AND    IF ( IFNULL(B.BL_CUST_SEND_YN,'N')='C', 'N',IFNULL(B.BL_CUST_SEND_YN,'N')) = #{sendType}
        /* [TODO] PJS : CONNECT BY PRIOR 부분을 일단 막는다.. */
         <!-- AND    E.ORD_BIZPTNR_CD IN (SELECT BIZPTNR_CD
                                    FROM TB_COM_BIZPTNR
                                    CONNECT BY PRIOR BIZPTNR_CD = UPPR_BIZPTNR_CD
                                    START WITH BIZPTNR_CD = #{shppCd}) /*하위거래처 조회되도록 추가요청으로 주석처리 (박정진D 요청) -->
        AND    E.ORD_BIZPTNR_CD IN (SELECT  BIZPTNR_CD
                                    FROM    TB_COM_BIZPTNR  /* MAIN */
                                    WHERE   BIZPTNR_GRP_CD IN ('1001001','1006001')  /* LG마그나 */
                                    AND     USE_YN = 'Y'
                                    AND     MBIZPTNR_YN = 'Y'
                                    UNION ALL
                                    SELECT  A.BIZPTNR_CD
                                    FROM    TB_COM_BIZPTNR A  /* SUB */
                                          , TB_COM_BIZPTNR B  /* MAIN */
                                    WHERE   A.USE_YN = 'Y'
                                    AND     A.MBIZPTNR_YN = 'N'
                                    AND     A.MBIZPTNR_CD = B.BIZPTNR_CD
                                    AND     B.BIZPTNR_GRP_CD IN ('1001001','1006001')  /* LG마그나 */
                                    UNION ALL
                                    SELECT  C.BIZPTNR_CD
                                    FROM    TB_COM_BIZPTNR C
                                    WHERE   C.USE_YN = 'Y'
                                    AND     C.BIZPTNR_CD IN ( '1029701' , '1008349')/*  HLDS 혜주건 추가 2013-03-01, 말레이시아 법인건 추가 2018-12-11 */
                                    )
        AND     E.ORD_BIZPTNR_CD != '2000061' /* 본사 HLDS 제외 장경화C 요청 */
        
        <if test="ofcrEmpno != null and ofcrEmpno != ''">
            AND     C.OFCR_EMPNO = #{ofcrEmpno}
        </if>
        <if test="blNo != null and blNo != ''">
            AND     A.BL_NO =  #{blNo}
        </if>
        <if test="polCd != null and polCd != ''">
            AND     A.POL_CD LIKE CONCAT(#{polCd},'%')
        </if>
        <if test="podCd != null and podCd != ''">
            AND     A.POD_CD LIKE CONCAT(#{podCd},'%')
        </if>
        <if test="blSprCd != null and blSprCd != ''">
            AND     A.BL_SPR_CD =  #{blSprCd}
        </if>
        <if test="exctSprCd != null and exctSprCd != ''">
            AND     A.EXCT_SPR_CD =  #{exctSprCd}
        </if>
        <if test='coYn != null and coYn != "" and coYn == "Y"'>
            AND    EXISTS ( SELECT  1
                            FROM    TB_SMT_ORD_CO_RELT X
                                  , TB_SMT_CO Y
                            WHERE   E.SMT_NO = X.SMT_NO
                            AND     X.CO_RECV_NO = Y.CO_RECV_NO
                            AND     X.DEL_YN = 'N'
                            AND     Y.DEL_YN = 'N'
                          ) /* Co 및 RELT존재 */
        </if>
        <if test='coYn != null and coYn != "" and coYn == "N"'>
            AND    NOT EXISTS( SELECT  1
                               FROM    TB_SMT_ORD_CO_RELT X
                                       , TB_SMT_CO Y
                               WHERE   E.SMT_NO = X.SMT_NO
                               AND     X.CO_RECV_NO = Y.CO_RECV_NO
                               AND     X.DEL_YN = 'N'
                               AND     Y.DEL_YN = 'N'
                            ) /* Co 및 RELT존재 */
        </if>
        <if test="cstSprCd != null and cstSprCd != '' and cstSprCd == 'LGE'">
            AND    NOT EXISTS (
                                   SELECT 1
                                   FROM TB_COM_BIZPTNR SA
                                       ,TB_COM_BIZPTNR SB
                                   WHERE 1 = 1
                                   AND  SA.BIZPTNR_CD     = E.ORD_BIZPTNR_CD
                                   AND  SB.BIZPTNR_CD     = IF(IFNULL(SA.MBIZPTNR_YN,'N')='Y', SA.BIZPTNR_CD, SA.MBIZPTNR_CD)
                                   AND  SB.BIZPTNR_GRP_CD = '1006001' /* LG마그나 거래처그룹코드 */
                               )
        </if>
        <!-- LG마그나 추가 START -->
        <if test="cstSprCd != null and cstSprCd != '' and cstSprCd == 'LGMG'">
            AND    EXISTS (
                               SELECT 1
                               FROM TB_COM_BIZPTNR SA
                                   ,TB_COM_BIZPTNR SB
                               WHERE 1 = 1
                               AND  SA.BIZPTNR_CD     = E.ORD_BIZPTNR_CD
                               AND  SB.BIZPTNR_CD     = IF(IFNULL(SA.MBIZPTNR_YN,'N')='Y', SA.BIZPTNR_CD, SA.MBIZPTNR_CD)
                               AND  SB.BIZPTNR_GRP_CD = '1006001' /* LG마그나 거래처그룹코드 */
                          )
        </if>   
    </select>
    
    
    <!-- LGE 트럭 정보 조회 -->
    <!-- 2021.05.27 : LG마그나 법인추가로 인한 수정  -->
    <select id="selectLgECarInfo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgECarInfo */
        SELECT 
	           'F' AS CHK
		       , D.SMT_NO  AS BL_ID
		       , ''       AS BL_SPR_CD 
		       , ''       AS BL_SPR_NM
		       , ''       AS EXCT_SPR_CD 
		       , 'Truck'  AS EXCT_SPR_NM /* BL 구분*/
		       , ''       AS RPRS_REF_NO /* 대표참조번호 */
		       , A.CO_NO  AS INV_NO
		       , ''       AS MBL_NO
		       , D.RPRS_HBL_NO      AS BL_NO  /* BL NO */
		       , D.ONBR_RQST_YMD    AS ONBR_YMD /* 선적일자 */
		       , ''       AS CLOS_YN
		       , ''       AS EXPS_BIZ_TYPE_CD
		       , ''       AS ONBR_CLOS_YN /* 선적마감여부 */
		       , D.ORD_QTY   AS PKG_QTY      /* 패키지수량 */
		       , D.PACKG_UNIT_CD    AS PKG_UNIT_CD  /* 패키지단위코드 */
		       , D.ORD_WGT AS SELL_CWT     /* 매출CWT */
		       , D.POL_CD     /* POL */
		      /*, FC_CM_GET_LOC_NM(D.POL_CD,'ENG_LOC_NM') POL_NM - Sub Query로 대체 */
		       , (SELECT ENG_LOC_NM
		         FROM TB_COM_LOC
		         WHERE LOC_CD = TRIM(D.POL_CD)
		        ) AS POL_NM     /* POL명 */
		       , A.CO_FLT_VSL_NM AS FLT_VSL_NM /* 편기선명 */
		       , D.POD_CD     /* POD */
		    /* , FC_CM_GET_LOC_NM(D.POD_CD,'ENG_LOC_NM') POD_NM - Sub Query로 대체 */
		       , (SELECT ENG_LOC_NM
		         FROM TB_COM_LOC
		         WHERE LOC_CD = TRIM(D.POD_CD)
		        ) AS POD_NM     /* POD명 */
		       , ''         AS OFCR_EMPNO /* 담당자사번 */
		       , ''         AS OFCR_EMPNM /* 담당자명 */
		       , D.SHPP_CD /* 송화주코드 */
		       , D.SHPP_NM /* 송화주명 */
		       , D.CNEE_CD /* 수화주코드 */
		       , D.CNEE_NM /* 수화주명 */
		       , ''         AS RPRS_ITEM_CD /* 대표품목코드 */
		       , ''         AS RPRS_ITEM_NM /* 대표품목명 */
		       , ''         AS OBL_CNT
		       , ''         AS CST_OBU_CD   /* 고객OBU코드 */
		       , F.INTG_TASK_NO AS INTG_TASK_NO 
		       , ''         AS MBL_ID 
		       , ''         AS MBL_INTG_TASK_NO
		       , D.SMT_NO    AS SMT_NO
		       , E.EO_NO    AS EO_NO
        FROM   TB_SMT_CO A
        INNER  JOIN TB_SMT_CO_EXPND B ON B.CO_RECV_NO = A.CO_RECV_NO
        INNER  JOIN TB_SMT_ORD_CO_RELT C ON  C.CO_RECV_NO = A.CO_RECV_NO
                                         AND C.DEL_YN = 'N'
        INNER  JOIN TB_SMT_ORD D ON  D.SMT_NO = C.SMT_NO
                                 AND D.ORD_TYPE_CD IN ('ITRK','DTRK') /* 국제트럭, 국내트럭 */
                                 AND D.RPRS_HBL_NO IS NOT NULL
                                 AND D.DEL_YN = 'N'
        INNER JOIN (SELECT SMT_NO, MAX(EO_NO) EO_NO
                    FROM   TB_SMT_ORD_SVC_TYPE
	                WHERE  STG_SPR_CD = 1
	                AND    SVC_TYPE_CD = '0040' /* 트럭 */
	                AND   DEL_YN = 'N'
	                GROUP BY SMT_NO ) E ON E.SMT_NO = D.SMT_NO
        INNER JOIN TB_SMT_INTG_TASK_DEPT F ON  F.SMT_NO = E.SMT_NO
                                           AND F.EO_NO = E.EO_NO
                                           AND F.TASK_SPR_CD = 'EXP'
                                           AND F.EXCT_BIZPTNR_CD = #{corpCd}
                                           AND F.DEL_YN = 'N'
		 WHERE  1=1 
		 <![CDATA[  
		 AND    D.ONBR_RQST_YMD >= #{fromDt}   
		 AND    D.ONBR_RQST_YMD <= #{toDt}
		 ]]>
		AND A.DEL_YN = 'N'
		/* [TODO] PJS : CONNECT BY PRIOR 부분을 일단 막는다.. */
		<!-- AND D.ORD_BIZPTNR_CD IN (SELECT BIZPTNR_CD
			FROM TB_COM_BIZPTNR
			CONNECT BY PRIOR BIZPTNR_CD = UPPR_BIZPTNR_CD
			START WITH BIZPTNR_CD = #{shppCd}) /*하위거래처 조회되도록 추가요청으로 주석처리 (박정진D 요청) -->
		AND D.ORD_BIZPTNR_CD IN (SELECT BIZPTNR_CD
		FROM TB_COM_BIZPTNR /* MAIN */
		WHERE BIZPTNR_GRP_CD IN ('1001001','1006001') /* LG마그나 */
		AND USE_YN = 'Y'
		AND MBIZPTNR_YN = 'Y'
		UNION ALL
		SELECT A.BIZPTNR_CD
		FROM TB_COM_BIZPTNR A /* SUB */
		, TB_COM_BIZPTNR B /* MAIN */
		WHERE A.USE_YN = 'Y'
		AND A.MBIZPTNR_YN = 'N'
		AND A.MBIZPTNR_CD = B.BIZPTNR_CD
		AND B.BIZPTNR_GRP_CD IN ('1001001','1006001') /* LG마그나 */
		UNION ALL
		SELECT C.BIZPTNR_CD
		FROM TB_COM_BIZPTNR C
		WHERE C.USE_YN = 'Y'
		AND C.BIZPTNR_CD IN ( '1029701' , '1008349')/* HLDS 혜주건 추가 2013-03-01, 말레이시아 법인건 추가 2018-12-11 */
		)
		AND D.ORD_BIZPTNR_CD != '2000061' /* 본사 HLDS 제외 장경화C 요청 */
		<if test="ofcrEmpno != null and ofcrEmpno != ''">
			AND F.OFCR_EMPNO = #{ofcrEmpno}
		</if>
		<if test="blNo != null and blNo != ''">
			AND D.BL_NO = #{blNo}
		</if>
		<if test="polCd != null and polCd != ''">
			AND D.POL_CD LIKE CONCAT(#{polCd},'%')
		</if>
		<if test="podCd != null and podCd != ''">
			AND D.POD_CD LIKE CONCAT(#{podCd},'%')
		</if>
		<if test='coYn != null and coYn != "" and coYn == "Y"'>
			AND 1=1
		</if>
		<if test='coYn != null and coYn != "" and coYn == "N"'>
			AND 1=2
		</if>
		<if test="cstSprCd != null and cstSprCd != '' and cstSprCd == 'LGE'">
			AND NOT EXISTS (
			SELECT 1
			FROM TB_COM_BIZPTNR SA
			,TB_COM_BIZPTNR SB
			WHERE 1 = 1
			AND SA.BIZPTNR_CD = D.ORD_BIZPTNR_CD
			AND SB.BIZPTNR_CD = IF(IFNULL(SA.MBIZPTNR_YN,'N')='Y', SA.BIZPTNR_CD, SA.MBIZPTNR_CD)
			AND SB.BIZPTNR_GRP_CD = '1006001' /* LG마그나 거래처그룹코드 */
			)
		</if>
		<!-- LG마그나 추가 START -->
		<if test="cstSprCd != null and cstSprCd != '' and cstSprCd == 'LGMG'">
			AND EXISTS (
			SELECT 1
			FROM TB_COM_BIZPTNR SA
			,TB_COM_BIZPTNR SB
			WHERE 1 = 1
			AND SA.BIZPTNR_CD = D.ORD_BIZPTNR_CD
			AND SB.BIZPTNR_CD = IF(IFNULL(SA.MBIZPTNR_YN,'N')='Y', SA.BIZPTNR_CD, SA.MBIZPTNR_CD)
			AND SB.BIZPTNR_GRP_CD = '1006001' /* LG마그나 거래처그룹코드 */
			)
		</if>
	</select>

	<!-- 전송가능여부조회 -->
	<select id="selectSendPosbYn" parameterType="dataItem" resultType="dataItem">
		/* fwd.edi.fwdCstComIfMgnt.selectSendPosbYn */
		SELECT
				A.EXCT_SPR_CD
				, (CASE
				WHEN A.BL_SPR_CD = 'D'
				THEN 'Y'
				WHEN A.BL_SPR_CD != 'D' AND EXISTS (SELECT 'T'
				FROM TB_SMT_INTG_TASK_DEPT
				WHERE DEL_YN = 'N'
				AND CST_BL_ID = A.BL_ID
				AND CARR_CD IN ('1005771','2003719','2014373','2009388'))
				THEN IF(IFNULL(IFNULL(A.MBL_NO,A.BL_NO), 'N')='N', 'N', 'Y' )
				WHEN A.BL_SPR_CD != 'D'
				THEN IF(IFNULL(A.MBL_NO, 'N')='N', 'N', 'Y')
				ELSE 'Y'
				END) AS SEND_YN /* 전송여부 */
				/* , FC_CM_GET_EDI_NM2('SEA_BL_SEND_CUST', 'LGE', B.ORD_BIZPTNR_CD, '') SHPR_SEND_YN - Subquery로 구현 */
				, IF( (SELECT BIZPTNR_CD
				FROM TB_COM_BIZPTNR
				LIMIT 1
				/* [TODO] CONNECT BY PRIOR START WITH 처리 방식 필요 */
				<!-- CONNECT BY PRIOR UPPR_BIZPTNR_CD = BIZPTNR_CD
					START WITH BIZPTNR_CD = B.ORD_BIZPTNR_CD -->
				)='1500122', 'LGE', '0') AS SHPR_SEND_YN /* 전송가능 거래처 여부 */
				, A.HLDS_BL_YN /* HLDS BL여부*/
				, IFNULL((SELECT S.REF_NO
				FROM TB_FWD_INTG_REF_NO S
				WHERE 1=1
				AND S.INTG_KEY_ID = A.BL_ID
				AND S.DEL_YN = 'N'
				AND S.REF_NO_SPR_CD = 'SR'
				LIMIT 1),
				(SELECT S.REF_NO
				FROM TB_FWD_INTG_REF_NO S
				WHERE 1=1
				AND S.INTG_KEY_ID = A.BL_ID
				AND S.DEL_YN = 'N'
				AND S.REF_NO_SPR_CD = 'IN'
				LIMIT 1)) AS SR_NO
				, (SELECT X.EO_NO
				FROM TB_SMT_INTG_TASK_DEPT X
				WHERE X.SMT_NO = A.SMT_NO
				AND X.TASK_SPR_CD = 'CSM'
				AND X.DEL_YN = 'N'
				LIMIT 1) AS CSM_EO_NO
				, A.EO_NO
				, A.LADG_TYPE_CD
		FROM    TB_FWD_BL A
		INNER JOIN TB_SMT_ORD B ON B.SMT_NO = A.SMT_NO
		AND     B.DEL_YN = 'N'
		WHERE   1=1
		AND     A.BL_SPR_CD IN ('H','D')
		AND     A.BL_ID = #{blId}
		AND     A.DEL_YN = 'N'
	</select>

	<!-- LGE관계사코드조회 -->
	<select id="selectLgEAfltCd" parameterType="dataItem" resultType="dataItem">
		/* fwd.edi.fwdCstComIfMgnt.selectLgEAfltCd */
		SELECT 
				CASE 
						WHEN C.CO_AFLT_CD IN ('ECHZ','ECKS','ECNT','ECQD','ECSY','ECTA','ECPN','ECCH','ECHN','ECCT','ECYT','ECQH','ECSH') THEN 'CN'
						WHEN C.CO_AFLT_CD IN ('HCHZ') THEN 'HLDS'
						ELSE 'KIC'
				END CO_AFLT_YN
		FROM    TB_FWD_BL A
		INNER JOIN TB_SMT_ORD_CO_RELT B ON  B.SMT_NO = A.SMT_NO
		                                AND B.DEL_YN = 'N'
		INNER JOIN TB_SMT_CO C ON  C.CO_RECV_NO = B.CO_RECV_NO
							   AND C.DEL_YN = 'N'
							   AND C.CO_AFLT_CD IS NOT NULL
		WHERE   1=1
		AND     A.DEL_YN = 'N'
		AND     A.BL_ID = #{blId}
		<if test='indiaYn != null and indiaYn != "" and indiaYn == "Y"'>
			AND C.CO_NO = #{srNo}
		</if>
	</select>

	<!-- 포워딩인터페이스상태등록 -->
	<insert id="insertFwdIfStatus" parameterType="dataItem">
		/* fwd.edi.fwdCstComIfMgnt.insertFwdIfStatus */
		INSERT INTO TB_FWD_BL_IF_STAT(
		BL_ID
		, TASK_SPR_CD
		, IF_ID
		, IF_SNGL_ID
		, BL_NO
		, CORP_CD
		, CST_KIND_CD
		, ATTR_NM1
		, ATTR_NM2
		, ATTR_NM3
		, REG_DT
		, RSTR_ID
		, UPD_DT
		, UPDR_ID
		) VALUES (
		#{blId}
		, #{taskSprCd}
		, #{ifId}
		, #{ifSnglId}
		, #{blNo}
		, #{corpCd}
		, #{cstKindCd}
		, #{attrNm1}
		, #{attrNm2}
		, #{attrNm3}
		, NOW()
		, #{rstrId}
		, NOW()
		, #{rstrId}
		)
		ON DUPLICATE KEY UPDATE
		IF_ID = #{ifId}
		, IF_SNGL_ID = #{ifSnglId}
		, BL_NO = #{blNo}
		, CORP_CD = #{corpCd}
		, ATTR_NM1 = #{attrNm1}
		, ATTR_NM2 = #{attrNm2}
		, ATTR_NM3 = #{attrNm3}
		, UPDR_ID = #{rstrId}
		, UPD_DT = NOW()
	</insert>

	<!-- 포워딩인터페이스상태등록 -->
	<insert id="insertFwdIfLog" parameterType="dataItem">
		/* fwd.edi.fwdCstComIfMgnt.insertFwdIfLog */
		INSERT INTO TB_FWD_BL_IF_LOG(
		LOG_NO
		, BL_ID
		, TASK_SPR_CD
		, IF_ID
		, IF_SNGL_ID
		, BL_NO
		, CORP_CD
		, CST_KIND_CD
		, ANS_TYPE_CD
		, ANS_YMD_HMS
		, ATTR_NM1
		, ATTR_NM2
		, ATTR_NM3
		, REG_DT
		, RSTR_ID
		)
		VALUES
		(
		/*JAVA에서 Seq No를 채번한다.*/
		/* FC_FW_GET_NO('BL_IF_LOG') */
		#{logNo}
		,#{blId}
		,#{taskSprCd}
		,#{ifId}
		,#{ifSnglId}
		,#{blNo}
		,#{corpCd}
		,#{cstKindCd}
		,#{ansTypeCd}
		,#{ansYmdHms}
		,#{attrNm1}
		,#{attrNm2}
		,#{attrNm3}
		,NOW()
		,#{rstrId}
		)
	</insert>

	<!-- LGE인터페이스테이블Cnt조회 -->
	<select id="selectLgEIfTblCnt" parameterType="dataItem" resultType="dataItem">
		/* fwd.edi.fwdCstComIfMgnt.selectLgEIfTblCnt */
		SELECT COUNT(*)+1 CNT /* interface table count */
		FROM NFINF.TB_FWD_INT183
		WHERE BL_NO = (SELECT BL_NO
		FROM TB_FWD_BL
		WHERE 1=1
		AND BL_ID = #{blId})
		<if test='indiaYn != null and indiaYn != "" and indiaYn == "Y"'>
			AND SR_NO = #{srNo}
		</if>
	</select>

	<!-- LGE인터페이스테이블 INSERT Data 조회  -->
	<select id="selectLgEIfTblData" parameterType="dataItem" resultType="dataItem">
		/* fwd.edi.fwdCstComIfMgnt.selectLgEIfTblData */
		SELECT
                #{interfaceId} AS INTERFACE_ID
                ,#{xmlDocumentNo} AS XML_DOCUMENT_NO
                ,1 AS DOCUMENT_SEQ_NO
                ,CASE 
                        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'A'
                        THEN (CASE
                                    WHEN A.EXCT_SPR_CD = 'AR'
                                    THEN '740'
                                    WHEN A.EXCT_SPR_CD = 'OC'
                                    THEN '705'
                                    WHEN A.EXCT_SPR_CD = 'RL'
                                    THEN '705'
                                    WHEN A.EXCT_SPR_CD = 'EX'
                                    THEN '740'
                                    END)
                        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'C'
                        THEN (CASE
                                    WHEN A.EXCT_SPR_CD = 'AR'
                                    THEN '740'
                                    WHEN A.EXCT_SPR_CD = 'OC'
                                    THEN '705'
                                    WHEN A.EXCT_SPR_CD = 'RL'
                                    THEN '705'
                                    WHEN A.EXCT_SPR_CD = 'EX'
                                    THEN '740'
                                    END)
                        ELSE '740'
                 END AS TYPE_CODE
                ,CASE 
                        WHEN #{sendType} = 'C'
                        THEN '7'
                        ELSE IF(#{cnt}=1, '9', '4')
                 END AS BL_TYPE_CODE
                ,A.BL_NO AS BL_NO
                ,#{cnt} AS SEND_COUNT
                /* FC_CM_GET_EMP_NM() CONTACT_NAME - SubQuery*/
                ,(SELECT   ENG_EMP_NM
                  FROM     TB_COM_EMP
                  WHERE    EMPNO = #{rstrId}) AS CONTACT_NAME
                /* FC_CM_GET_ACCTG_DEPT_NM(FC_CM_GET_EMP_ACCTG_DEPT()) CONTACT_DEPARTMENT_NAME - SubQuery */
                ,(SELECT    ACCTG_DEPT_ENG_NM
                  FROM      TB_COM_ACCTG_DEPT
                  WHERE     ACCTG_DEPT_CD = (SELECT    ACCTG_DEPT_CD
                                             FROM      TB_COM_EMP
                                             WHERE     EMPNO = #{rstrId})
                  ) AS CONTACT_DEPARTMENT_NAME
                /* FC_CM_GET_EMP_TEL_NO() CONTACT_PHONE_NO - SubQuery */
                ,(SELECT  TEL_NO
                  FROM    TB_COM_EMP
                  WHERE   EMPNO = #{rstrId}) AS CONTACT_PHONE_NO
                ,A.ONBR_YMD AS BL_ISSUE_DATE /* 특송의 경우 ISSUE_DATE가 없기에, ONBR_YMD로 수정 윤찬수K 요청 2013-03-07 */
                /* NVL(A.BL_PRT_YMD, A.ONBR_YMD) -> ONBR_YMD로 수정 조만규B 요청 2013-03-18 */
                ,A.INCOT_CD AS PAYMENT_TERMS_CODE
                ,A.APLY_EXCHGRT AS EXCHANGE_RATE
                ,A.INCOT_CD AS TRANSFER_CONDITION_DESC
                ,CASE
                        WHEN C.CARR_CD IN ('1005771','2003719','2014373','2009388') AND A.BL_SPR_CD = 'H' AND A.MBL_NO IS NULL
                        THEN A.BL_NO
                        ELSE A.MBL_NO
                 END AS MASTER_BL_NO
                ,IFNULL(IFNULL((SELECT    S.REF_NO
                                FROM      TB_FWD_INTG_REF_NO S
                                WHERE     1=1
                                AND       S.INTG_KEY_ID = A.BL_ID
                                AND       S.DEL_YN = 'N'
                                AND       S.RPRS_YN = 'Y'
                                AND       S.REF_NO_SPR_CD = 'SR'
                                LIMIT     1),
                                (SELECT   S.REF_NO
                                FROM      TB_FWD_INTG_REF_NO S
                                WHERE     1=1
                                AND       S.INTG_KEY_ID = A.BL_ID
                                AND       S.DEL_YN = 'N'
                                AND       S.REF_NO_SPR_CD = 'SR'
                                LIMIT     1)),
                        IFNULL((SELECT    S.REF_NO
                                FROM      TB_FWD_INTG_REF_NO S
                                WHERE     1=1
                                AND       S.INTG_KEY_ID = A.BL_ID
                                AND       S.DEL_YN = 'N'
                                AND       S.RPRS_YN = 'Y'
                                AND       S.REF_NO_SPR_CD = 'IN'
                                LIMIT 1),
                               (SELECT    S.REF_NO
                                FROM      TB_FWD_INTG_REF_NO S
                                WHERE     1=1
                                AND       S.INTG_KEY_ID = A.BL_ID
                                AND       S.DEL_YN = 'N'
                                AND       S.REF_NO_SPR_CD = 'IN'
                                LIMIT 1))
                ) AS SR_NO
                ,(CASE 
                        WHEN A.LDNG_COND_CD || A.DSCR_COND_CD = 'CYCY' THEN '1'
                        WHEN A.LDNG_COND_CD || A.DSCR_COND_CD = 'CYCFS' THEN '2'
                        WHEN A.LDNG_COND_CD || A.DSCR_COND_CD = 'CFSCY' THEN '3'
                        WHEN A.LDNG_COND_CD || A.DSCR_COND_CD = 'CFSCFS' THEN '4'
                        WHEN A.LDNG_COND_CD || A.DSCR_COND_CD = 'DOORDOOR' THEN '5'
                        WHEN A.LDNG_COND_CD || A.DSCR_COND_CD = 'CYDOOR' THEN '7'
                        WHEN A.LDNG_COND_CD || A.DSCR_COND_CD = 'CFSDOOR' THEN '8'
                        WHEN A.LDNG_COND_CD || A.DSCR_COND_CD = 'DOORCFS' THEN '10'
                        WHEN A.LDNG_COND_CD || A.DSCR_COND_CD = 'DOORCY' THEN '11'
                        WHEN A.LDNG_COND_CD || A.DSCR_COND_CD = 'CYFOR' THEN '13'
                        WHEN A.LDNG_COND_CD || A.DSCR_COND_CD = 'CYCYCFS' THEN '14'
                        ELSE '6' END) AS SERVICE_TYPE_CODE /* FC_CM_GET_EDI_NM2('EDI_SHIP_MODE', A.LDNG_COND_CD, A.DSCR_COND_CD, '') SERVICE_TYPE_CODE */
                ,IFNULL((SELECT S.REF_NO
                         FROM   TB_FWD_INTG_REF_NO S
                         WHERE  1=1
                         AND    S.INTG_KEY_ID = A.BL_ID
                         AND    S.DEL_YN = 'N'
                         AND    S.REF_NO_SPR_CD = 'IN'
                         AND    S.RPRS_YN = 'Y'
                         LIMIT  1),
                        (SELECT S.REF_NO
                         FROM   TB_FWD_INTG_REF_NO S
                         WHERE  1=1
                         AND    S.INTG_KEY_ID = A.BL_ID
                         AND    S.DEL_YN = 'N'
                         AND    S.REF_NO_SPR_CD = 'IN'
                         LIMIT  1)
                ) AS INVOICE_NO
                ,(SELECT  S.REF_NO
                  FROM    TB_FWD_INTG_REF_NO S
                  WHERE   1=1
                  AND     S.INTG_KEY_ID = A.BL_ID
                  AND     S.DEL_YN = 'N'
                  AND     S.REF_NO_SPR_CD = 'LC'
                  LIMIT   1) AS LC_NO
                ,FC_FWD_CHN_REPLACE(
                                    CASE
                                        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'A'
                                        THEN SUBSTR(IF(A.EXCT_SPR_CD='AR', SUBSTR(A.FLT_VSL_NM,3), A.VOYAGE),1, 20 )
                                        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'B'
                                        THEN SUBSTR(IF(A.EXCT_SPR_CD='AR', NULL, A.VOYAGE), 1, 20 )
                                        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'C'
                                        THEN SUBSTR(
                                                    (CASE
                                                        WHEN A.EXCT_SPR_CD = 'AR'
                                                        THEN NULL
                                                        WHEN A.EXCT_SPR_CD = 'EX'
                                                        THEN NULL
                                                        ELSE IF(B.PRE_FLT_VSL_NM=NULL,A.VOYAGE,B.PRE_VOYAGE)
                                                    END),1,20)
                                        ELSE SUBSTR(IF(A.EXCT_SPR_CD='AR', SUBSTR(A.FLT_VSL_NM,3), A.VOYAGE),1, 20 )
                                    END) AS VOYAGE_SEQS
                ,FC_FWD_CHN_REPLACE(
                                    CASE
                                        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'A'
                                        THEN SUBSTR(
                                                    (CASE
                                                        WHEN A.EXCT_SPR_CD = 'OC'
                                                        THEN A.FLT_VSL_NM
                                                        WHEN A.EXCT_SPR_CD = 'RL'
                                                        THEN A.FLT_VSL_NM
                                                        WHEN A.EXCT_SPR_CD = 'EX'
                                                        THEN IFNULL(A.FLT_VSL_NM, 'COURIER')
                                                        ELSE (SELECT    BB.BIZPTNR_GRP_ENG_ACRN_NM
                                                              FROM      TB_COM_BIZPTNR AA
                                                                        ,TB_COM_BIZPTNR_GRP_CD BB
                                                              WHERE     AA.BIZPTNR_GRP_CD = BB.BIZPTNR_GRP_CD
                                                              AND       AA.BIZPTNR_CD = C.CARR_CD)
                                                     END),1, 30 )
                                        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'B'
                                        THEN SUBSTR( IF(A.EXCT_SPR_CD='EX', IFNULL(A.FLT_VSL_NM, 'COURIER'), A.FLT_VSL_NM),1, 30 )
                                        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'C'
                                        THEN SUBSTR( IF(A.EXCT_SPR_CD='EX', IFNULL(A.FLT_VSL_NM, 'COURIER'), IF (B.PRE_FLT_VSL_NM=NULL, A.FLT_VSL_NM,B.PRE_FLT_VSL_NM )
                                                    ) ,1, 30)
                                        ELSE SUBSTR(A.FLT_VSL_NM,1, 30 )
                                    END) AS VESSEL_FLIGHT_NAME
                ,'' AS VESSEL_FLIGHT_NATIONALITY_CODE
                ,A.ONBR_YMD AS EXPECTED_DEPARTURE_DATE
                ,(CASE 
                        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'A' AND A.EXCT_SPR_CD = 'AR'
                        THEN IFNULL((SELECT     ETA_YMD
                                     FROM      (SELECT ETA_YMD
                                                FROM TB_FWD_BL_SCHD
                                                WHERE BL_ID = #{blId}
                                                AND DEL_YN = 'N'
                                                ORDER BY SCHD_SEQ DESC) AA
                                                LIMIT 1) ,A.ONBR_YMD)
                        ELSE A.ARR_YMD
                END) AS ARRIVAL_DATE /* 본사 항공의 경우만 스케쥴의 ETA 전송 */
                ,IF( #{hldsYn}='Y'
                    , ( SELECT  OUTR_CD
                        FROM    TB_COM_CD_MPNG
                        WHERE   CD_MPNG_SPR_NM = 'PORT_CODE'
                        AND     RLT_BIZPTNR_CD LIKE '12'
                        AND     INSD_CD = A.POL_CD
                        AND     USE_YN = 'Y'
                        LIMIT 1)
                    , ( SELECT OUTR_CD
                        FROM    (SELECT   OUTR_CD, RANK() OVER (PARTITION BY INSD_CD ORDER BY MPNG_DRCT_CD) AS RK
                                 FROM     TB_COM_CD_MPNG
                                 WHERE    CD_MPNG_SPR_NM = 'PORT_CODE'
                                 AND      RLT_BIZPTNR_CD LIKE '01'
                                 AND      INSD_CD = A.POL_CD
                                 AND      USE_YN = 'Y' ) AA
                                 WHERE    RK = 1)
                ) AS LOAD_PORT_CODE /* 확인 필요 매핑데이터 모두 없음 */
                ,A.POL_NM AS LOAD_PORT_NAME
                ,IF( #{hldsYn}='Y'
                    , ( SELECT OUTR_CD
                        FROM TB_COM_CD_MPNG
                        WHERE CD_MPNG_SPR_NM = 'PORT_CODE'
                        AND RLT_BIZPTNR_CD LIKE '12'
                        AND INSD_CD = A.POD_CD
                        AND USE_YN = 'Y'
                        LIMIT 1)
                    , ( SELECT OUTR_CD
                        FROM (SELECT OUTR_CD, RANK() OVER (PARTITION BY INSD_CD ORDER BY MPNG_DRCT_CD) AS RK
                              FROM TB_COM_CD_MPNG
                              WHERE CD_MPNG_SPR_NM = 'PORT_CODE'
                              AND RLT_BIZPTNR_CD LIKE '01'
                              AND INSD_CD = A.POD_CD
                              AND USE_YN = 'Y' ) AA
                        WHERE RK = 1)
                ) AS DISCHARGE_PORT_CODE /* 확인 필요 매핑데이터 모두 없음 */
                ,A.POD_NM AS DISCHARGE_PORT_NAME
                ,IF( #{hldsYn}='Y'
                    , ( SELECT OUTR_CD
                        FROM TB_COM_CD_MPNG
                        WHERE CD_MPNG_SPR_NM = 'PORT_CODE'
                        AND RLT_BIZPTNR_CD LIKE '12'
                        AND INSD_CD = A.FDEST_CD
                        AND USE_YN = 'Y'
                        LIMIT 1)
                    , ( SELECT OUTR_CD
                    FROM (SELECT OUTR_CD, RANK() OVER (PARTITION BY INSD_CD ORDER BY MPNG_DRCT_CD) AS RK
                          FROM TB_COM_CD_MPNG
                          WHERE CD_MPNG_SPR_NM = 'PORT_CODE'
                          AND RLT_BIZPTNR_CD LIKE '01'
                          AND INSD_CD = A.FDEST_CD
                          AND USE_YN = 'Y' ) AA
                          WHERE RK = 1)
                ) AS FINAL_DESTINATION_CODE /* 확인 필요 매핑데이터 모두 없음 */
                ,A.FDEST_NM AS FINAL_DESTINATION_NAME
                ,IF( #{hldsYn}='Y'
                    , ( SELECT OUTR_CD
                        FROM TB_COM_CD_MPNG
                        WHERE CD_MPNG_SPR_NM = 'PORT_CODE'
                        AND RLT_BIZPTNR_CD LIKE '12'
                        AND INSD_CD = A.POR_CD
                        AND USE_YN = 'Y'
                        LIMIT 1)
                    , ( SELECT OUTR_CD
                        FROM (SELECT OUTR_CD, RANK() OVER (PARTITION BY INSD_CD ORDER BY MPNG_DRCT_CD) AS RK
                        FROM TB_COM_CD_MPNG
                        WHERE CD_MPNG_SPR_NM = 'PORT_CODE'
                        AND RLT_BIZPTNR_CD LIKE '01'
                        AND INSD_CD = A.POR_CD
                        AND USE_YN = 'Y' ) AA
                        WHERE RK = 1)
                ) AS ACCEPTANCE_PORT_CODE /* 확인 필요 매핑데이터 모두 없음 */
                ,A.POR_NM AS ACCEPTANCE_PORT_NAME
                ,IF( #{hldsYn}='Y'
                    , ( SELECT OUTR_CD
                        FROM TB_COM_CD_MPNG
                        WHERE CD_MPNG_SPR_NM = 'PORT_CODE'
                        AND RLT_BIZPTNR_CD LIKE '12'
                        AND INSD_CD = A.PDEL_CD
                        AND USE_YN = 'Y'
                        LIMIT 1)
                    , ( SELECT OUTR_CD
                        FROM (SELECT OUTR_CD, RANK() OVER (PARTITION BY INSD_CD ORDER BY MPNG_DRCT_CD) AS RK
                        FROM TB_COM_CD_MPNG
                        WHERE CD_MPNG_SPR_NM = 'PORT_CODE'
                        AND RLT_BIZPTNR_CD LIKE '01'
                        AND INSD_CD = A.PDEL_CD
                        AND USE_YN = 'Y' ) AA
                        WHERE RK = 1)
                ) AS DELIVERY_PORT_CODE /* 확인 필요 매핑데이터 모두 없음 */
                ,A.PDEL_NM AS DELIVERY_PORT_NAME
                ,(CASE
                        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'A'
                        THEN 'KR018484'
                /*FC_FW_B2BI_GET_CODE는 mybatis inlucde 로 구현한다. */
                        ELSE (
                        <include refid="fwd.common.fwdFuncInclude.fwdFcFwB2biGetCode_LgeShippingLine1Code">
                            <property name="refNo"
                                value="(SELECT REF_NO FROM TB_FWD_INTG_REF_NO S WHERE 1=1 AND S.INTG_KEY_ID = A.BL_ID AND S.DEL_YN = 'N' AND S.REF_NO_SPR_CD IN ('SR','IN') LIMIT 1)"></property>
                        </include>
                        )
                END) AS SHIPPING_LINE_CODE
                ,IFNULL((SELECT BIZPTNR_ENG_NM
                         FROM TB_COM_BIZPTNR
                         WHERE BIZPTNR_CD = C.EXCT_BIZPTNR_CD)
                        , 
                        (SELECT ETC_CONT1
                         FROM TB_COM_ETC_CD
                         WHERE CLAS_CD ='1118'
                         AND DTL_CD_NM = C.EXCT_BIZPTNR_CD)
                ) AS SHIPPING_LINE1_NAME
                ,'' AS SHIPPING_LINE2_NAME
                ,'' AS SHIPPING_LINE1_ADDR
                ,'' AS SHIPPING_LINE2_ADDR
                ,'' AS SHIPPING_LINE3_ADDR
                ,'' AS SHIPPING_LINE4_ADDR
                ,'' AS SHIPPING_LINE5_ADDR
                /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BS', '1'),1,50) SHIPPER1_NAME - Subquery로 처리*/
                ,SUBSTR(
                        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '1', '1', 'X', 'H')
                         FROM   TB_FWD_BL AA
                                ,TB_FWD_INTG_ADDR CC
                         WHERE  AA.BL_ID = CC.INTG_KEY_ID
                         AND    AA.BL_ID = A.BL_ID
                         AND    CC.ADDR_SPR_CD = 'BS'
                        LIMIT 1), 1, 50) AS SHIPPER1_NAME
                ,' ' AS SHIPPER2_NAME
                /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BS', '2'),1,50) SHIPPER_ADDR1_INFO - Subquery로 처리*/
                ,SUBSTR(
                        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '2', '2', 'X', 'H')
                         FROM   TB_FWD_BL AA
                                ,TB_FWD_INTG_ADDR CC
                         WHERE  AA.BL_ID = CC.INTG_KEY_ID
                         AND    AA.BL_ID = A.BL_ID
                         AND    CC.ADDR_SPR_CD = 'BS'
                         LIMIT 1), 1, 50) AS SHIPPER_ADDR1_INFO
                /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BS', '3'),1,50) SHIPPER_ADDR2_INFO - Subquery로 처리*/
                ,SUBSTR(
                        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '3', '3', 'X', 'H')
                         FROM   TB_FWD_BL AA
                                ,TB_FWD_INTG_ADDR CC
                         WHERE  AA.BL_ID = CC.INTG_KEY_ID
                         AND    AA.BL_ID = A.BL_ID
                         AND    CC.ADDR_SPR_CD = 'BS'
                         LIMIT  1), 1, 50) AS SHIPPER_ADDR2_INFO
                /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BS', '4'),1,50) SHIPPER_ADDR3_INFO - Subquery로 처리*/
                ,SUBSTR(
                        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '4', '4', 'X', 'H')
                         FROM   TB_FWD_BL AA
                                ,TB_FWD_INTG_ADDR CC
                         WHERE  AA.BL_ID = CC.INTG_KEY_ID
                         AND    AA.BL_ID = A.BL_ID
                         AND    CC.ADDR_SPR_CD = 'BS'
                         LIMIT  1), 1, 50) AS SHIPPER_ADDR3_INFO
                /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BS', '5'),1,50) SHIPPER_ADDR4_INFO - Subquery로 처리*/
                ,SUBSTR(
                        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '5', '5', 'X', 'H')
                         FROM   TB_FWD_BL AA
                                ,TB_FWD_INTG_ADDR CC
                         WHERE  AA.BL_ID = CC.INTG_KEY_ID
                         AND    AA.BL_ID = A.BL_ID
                         AND    CC.ADDR_SPR_CD = 'BS'
                         LIMIT  1), 1, 50) AS SHIPPER_ADDR4_INFO
                /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BS', '6'),1,50) SHIPPER_ADDR5_INFO - Subquery로 처리*/
                ,SUBSTR(
                        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '6', '6', 'X', 'H')
                         FROM   TB_FWD_BL AA
                                ,TB_FWD_INTG_ADDR CC
                         WHERE  AA.BL_ID = CC.INTG_KEY_ID
                         AND    AA.BL_ID = A.BL_ID
                         AND    CC.ADDR_SPR_CD = 'BS'
                         LIMIT  1), 1, 50) AS SHIPPER_ADDR5_INFO
                /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BC', '1'),1,50) CONSIGNEE1_NAME - Subquery로 처리*/
                ,SUBSTR(
                        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '1', '1', 'X', 'H')
                         FROM   TB_FWD_BL AA
                                ,TB_FWD_INTG_ADDR CC
                         WHERE  AA.BL_ID = CC.INTG_KEY_ID
                         AND    AA.BL_ID = A.BL_ID
                         AND    CC.ADDR_SPR_CD = 'BC'
                         LIMIT  1), 1, 50) AS CONSIGNEE1_NAME
                ,' ' CONSIGNEE2_NAME
                /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BC', '2'),1,50) CONSIGNEE_ADDR1_INFO - Subquery로 처리*/
                ,SUBSTR(
                        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '2', '2', 'X', 'H')
                         FROM   TB_FWD_BL AA
                                ,TB_FWD_INTG_ADDR CC
                         WHERE  AA.BL_ID = CC.INTG_KEY_ID
                         AND    AA.BL_ID = A.BL_ID
                         AND    CC.ADDR_SPR_CD = 'BC'
                         LIMIT  1), 1, 50) AS CONSIGNEE_ADDR1_INFO
                /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BC', '3'),1,50) CONSIGNEE_ADDR2_INFO - Subquery로 처리*/
                ,SUBSTR(
                        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '3', '3', 'X', 'H')
                         FROM   TB_FWD_BL AA
                                ,TB_FWD_INTG_ADDR CC
                         WHERE  AA.BL_ID = CC.INTG_KEY_ID
                         AND    AA.BL_ID = A.BL_ID
                         AND    CC.ADDR_SPR_CD = 'BC'
                         LIMIT  1), 1, 50) AS CONSIGNEE_ADDR2_INFO
                /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BC', '4'),1,50) CONSIGNEE_ADDR3_INFO - Subquery로 처리*/
                ,SUBSTR(
                        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '4', '4', 'X', 'H')
                         FROM   TB_FWD_BL AA
                                ,TB_FWD_INTG_ADDR CC
                         WHERE  AA.BL_ID = CC.INTG_KEY_ID
                         AND    AA.BL_ID = A.BL_ID
                         AND    CC.ADDR_SPR_CD = 'BC'
                         LIMIT  1), 1, 50) AS CONSIGNEE_ADDR3_INFO
                /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BC', '5'),1,50) CONSIGNEE_ADDR4_INFO - Subquery로 처리*/
                ,SUBSTR(
                        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '5', '5', 'X', 'H')
                         FROM   TB_FWD_BL AA
                                ,TB_FWD_INTG_ADDR CC
                         WHERE  AA.BL_ID = CC.INTG_KEY_ID
                         AND    AA.BL_ID = A.BL_ID
                         AND    CC.ADDR_SPR_CD = 'BC'
                         LIMIT  1), 1, 50) AS CONSIGNEE_ADDR4_INFO
                /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BC', '6'),1,50) CONSIGNEE_ADDR5_INFO - Subquery로 처리*/
                ,SUBSTR(
                        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '6', '6', 'X', 'H')
                         FROM   TB_FWD_BL AA
                                ,TB_FWD_INTG_ADDR CC
                         WHERE  AA.BL_ID = CC.INTG_KEY_ID
                         AND    AA.BL_ID = A.BL_ID
                         AND    CC.ADDR_SPR_CD = 'BC'
                         LIMIT  1), 1, 50) AS CONSIGNEE_ADDR5_INFO
                /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BN', '1'),1,50) NOTIFY_PARTY1_NAME1_INFO - Subquery로 처리*/
                        ,SUBSTR(
                        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '1', '1', 'X', 'H')
                         FROM   TB_FWD_BL AA
                                ,TB_FWD_INTG_ADDR CC
                         WHERE  AA.BL_ID = CC.INTG_KEY_ID
                         AND    AA.BL_ID = A.BL_ID
                         AND    CC.ADDR_SPR_CD = 'BN'
                         LIMIT  1), 1, 50) AS NOTIFY_PARTY1_NAME1_INFO
                ,' ' NOTIFY_PARTY1_NAME2_INFO
                /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BN', '2'),1,50) NOTIFY_PARTY1_ADDR1_INFO - Subquery로 처리*/
                        ,SUBSTR(
                        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '2', '2', 'X', 'H')
                         FROM   TB_FWD_BL AA
                                ,TB_FWD_INTG_ADDR CC
                         WHERE  AA.BL_ID = CC.INTG_KEY_ID
                         AND    AA.BL_ID = A.BL_ID
                         AND    CC.ADDR_SPR_CD = 'BN'
                         LIMIT  1), 1, 50) AS NOTIFY_PARTY1_ADDR1_INFO
                /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BN', '3'),1,50) NOTIFY_PARTY1_ADDR2_INFO - Subquery로 처리*/
                ,SUBSTR(
                        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '3', '3', 'X', 'H')
                         FROM   TB_FWD_BL AA
                                ,TB_FWD_INTG_ADDR CC
                         WHERE  AA.BL_ID = CC.INTG_KEY_ID
                         AND    AA.BL_ID = A.BL_ID
                         AND    CC.ADDR_SPR_CD = 'BN'
                         LIMIT  1), 1, 50) AS NOTIFY_PARTY1_ADDR2_INFO
                /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BN', '4'),1,50) NOTIFY_PARTY1_ADDR3_INFO - Subquery로 처리*/
                ,SUBSTR(
                        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '4', '4', 'X', 'H')
                         FROM   TB_FWD_BL AA
                                ,TB_FWD_INTG_ADDR CC
                         WHERE  AA.BL_ID = CC.INTG_KEY_ID
                         AND    AA.BL_ID = A.BL_ID
                         AND    CC.ADDR_SPR_CD = 'BN'
                         LIMIT  1), 1, 50) AS NOTIFY_PARTY1_ADDR3_INFO
                /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BN', '5'),1,50) NOTIFY_PARTY1_ADDR4_INFO - Subquery로 처리*/
                ,SUBSTR(
                        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '5', '5', 'X', 'H')
                         FROM   TB_FWD_BL AA
                                ,TB_FWD_INTG_ADDR CC
                         WHERE  AA.BL_ID = CC.INTG_KEY_ID
                         AND    AA.BL_ID = A.BL_ID
                         AND    CC.ADDR_SPR_CD = 'BN'
                         LIMIT  1), 1, 50) AS NOTIFY_PARTY1_ADDR4_INFO
                /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BN', '6'),1,50) NOTIFY_PARTY1_ADDR5_INFO - Subquery로 처리*/
                ,SUBSTR(
                        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '6', '6', 'X', 'H')
                         FROM   TB_FWD_BL AA
                                ,TB_FWD_INTG_ADDR CC
                         WHERE  AA.BL_ID = CC.INTG_KEY_ID
                         AND    AA.BL_ID = A.BL_ID
                         AND    CC.ADDR_SPR_CD = 'BN'
                         LIMIT  1), 1, 50) AS NOTIFY_PARTY1_ADDR5_INFO
                /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BP', '1'),1,50) NOTIFY_PARTY2_NAME1_INFO - Subquery로 처리*/
                ,SUBSTR(
                        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '1', '1', 'X', 'H')
                         FROM   TB_FWD_BL AA
                                ,TB_FWD_INTG_ADDR CC
                         WHERE  AA.BL_ID = CC.INTG_KEY_ID
                         AND    AA.BL_ID = A.BL_ID
                         AND    CC.ADDR_SPR_CD = 'BP'
                         LIMIT  1), 1, 50) AS NOTIFY_PARTY2_NAME1_INFO
                ,' ' NOTIFY_PARTY2_NAME2_INFO
                /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BP', '2'),1,50) NOTIFY_PARTY2_ADDR1_INFO - Subquery로 처리*/
                ,SUBSTR(
                        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '2', '2', 'X', 'H')
                         FROM   TB_FWD_BL AA
                                ,TB_FWD_INTG_ADDR CC
                         WHERE  AA.BL_ID = CC.INTG_KEY_ID
                         AND    AA.BL_ID = A.BL_ID
                         AND    CC.ADDR_SPR_CD = 'BP'
                         LIMIT  1), 1, 50) AS NOTIFY_PARTY2_ADDR1_INFO
                /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BP', '3'),1,50) NOTIFY_PARTY2_ADDR2_INFO - Subquery로 처리*/
                ,SUBSTR(
                        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '3', '3', 'X', 'H')
                         FROM   TB_FWD_BL AA
                                ,TB_FWD_INTG_ADDR CC
                         WHERE  AA.BL_ID = CC.INTG_KEY_ID
                         AND    AA.BL_ID = A.BL_ID
                         AND    CC.ADDR_SPR_CD = 'BP'
                         LIMIT  1), 1, 50) AS NOTIFY_PARTY2_ADDR2_INFO
                /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BP', '4'),1,50) NOTIFY_PARTY2_ADDR3_INFO - Subquery로 처리*/
                ,SUBSTR(
                        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '4', '4', 'X', 'H')
                         FROM   TB_FWD_BL AA
                                ,TB_FWD_INTG_ADDR CC
                         WHERE  AA.BL_ID = CC.INTG_KEY_ID
                         AND    AA.BL_ID = A.BL_ID
                         AND    CC.ADDR_SPR_CD = 'BP'
                         LIMIT  1), 1, 50) AS NOTIFY_PARTY2_ADDR3_INFO
                /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BP', '5'),1,50) NOTIFY_PARTY2_ADDR4_INFO - Subquery로 처리*/
                ,SUBSTR(
                        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '5', '5', 'X', 'H')
                         FROM   TB_FWD_BL AA
                                ,TB_FWD_INTG_ADDR CC
                         WHERE  AA.BL_ID = CC.INTG_KEY_ID
                         AND    AA.BL_ID = A.BL_ID
                         AND    CC.ADDR_SPR_CD = 'BP'
                         LIMIT  1), 1, 50) AS NOTIFY_PARTY2_ADDR4_INFO
                /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BP', '6'),1,50) NOTIFY_PARTY2_ADDR5_INFO - Subquery로 처리*/
                ,SUBSTR(
                        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '6', '6', 'X', 'H')
                         FROM   TB_FWD_BL AA
                                ,TB_FWD_INTG_ADDR CC
                         WHERE  AA.BL_ID = CC.INTG_KEY_ID
                         AND    AA.BL_ID = A.BL_ID
                         AND    CC.ADDR_SPR_CD = 'BP'
                         LIMIT  1), 1, 50) AS NOTIFY_PARTY2_ADDR5_INFO
                ,'' BL_ISSUE_CODE
                ,CASE 
                    WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'A'
                    THEN (CASE
                                WHEN A.FRGTTERM_CD = 'CC'
                                THEN 'DESTINATION'
                                WHEN A.FRGTTERM_CD = 'PP'
                                THEN 'SEOUL, KOREA'
                         END) /* 본사 */
                    WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'B'
                    THEN (CASE
                                WHEN A.FRGTTERM_CD = 'CC'
                                THEN 'DESTINATION'
                                WHEN A.FRGTTERM_CD = 'PP'
                                THEN 'MONTERRY,MEXICO'
                         END) /* 중국 */
                    WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'C'
                    THEN NULL /* 아주 */
                    ELSE (CASE
                                WHEN A.FRGTTERM_CD = 'CC'
                                THEN 'DESTINATION'
                                WHEN A.FRGTTERM_CD = 'PP'
                                THEN 'WAW,PL'
                         END) /* 구주 */
                END AS BL_ISSUE_ADDR
                ,IF(SUBSTR(A.FRGTTERM_CD,1,1)='P','P','') AS PREPAY_CODE
                ,CASE 
                    WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'A'
                    THEN IF(A.FRGTTERM_CD = 'PP', 'SEOUL, KOREA','')
                    WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'B'
                    THEN NULL
                    WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'C'
                    THEN NULL
                    /* 원본 소스가 맞는지 확인 필요. 일단 원본대로 작업함. A.FRGTTERM_CD의 비교값이 DESTINATION 인 것이 이상함.
                    * [수정처리] 2021-11-02. CC 코드를 추가하기로 함.
                    ELSE DECODE(A.FRGTTERM_CD,'DESTINATION','PP','WAW,PL','')*/
                    ELSE (CASE
                                WHEN A.FRGTTERM_CD = 'CC'
                                THEN 'DESTINATION'
                                WHEN A.FRGTTERM_CD = 'PP'
                                THEN 'WAW,PL'
                                ELSE ''
                         END)
                END AS PREPAY_PLACE_NAME
                ,IF(SUBSTR(A.FRGTTERM_CD,1,1) = 'C', 'C', '') AS COLLECTION_CODE
                ,IF(A.FRGTTERM_CD = 'PP', '', 'DESTINATION') AS COLLECTION_NAME
                ,(CASE
                    WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'A'
                    THEN IFNULL((SELECT INSD_CD FROM TB_COM_CD_MPNG WHERE CD_MPNG_SPR_NM='LGE_ACCT_SALES_SEND_PART_SETTING' AND OUTR_CD = A.SHPP_CD), '1')
                    WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'B'
                    THEN IF(SUBSTR((SELECT REF_NO
                                    FROM TB_FWD_INTG_REF_NO S
                                    WHERE 1=1
                                    AND S.INTG_KEY_ID = A.BL_ID
                                    AND S.DEL_YN = 'N'
                                    AND S.REF_NO_SPR_CD IN ('SR','IN')
                                    LIMIT 1 ),'1','3') = 'SVC','2','')
                    /* FC_FW_B2BI_GET_CODE는 mybatis inlucde 로 구현한다. */
                    WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'C'
                    THEN IFNULL((
                    <include refid="fwd.common.fwdFuncInclude.fwdFcFwB2biGetCode_SendDepartmentTypeCode">
                        <property name="refNo"
                            value="(SELECT REF_NO FROM TB_FWD_INTG_REF_NO S WHERE 1=1 AND S.INTG_KEY_ID = A.BL_ID AND S.DEL_YN = 'N' AND S.REF_NO_SPR_CD IN ('SR','IN') LIMIT 1)"></property>
                    </include>
                    ), 1)
                    ELSE IFNULL((SELECT INSD_CD FROM TB_COM_CD_MPNG WHERE CD_MPNG_SPR_NM='LGE_ACCT_SALES_SEND_PART_SETTING' AND OUTR_CD = A.SHPP_CD), '1')
                END) AS SEND_DEPARTMENT_TYPE_CODE
                ,1 AS BL_ISSUE_COUNT
                ,CASE 
                    WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'A'
                    THEN ( CASE
                                WHEN SUBSTR( IFNULL(( SELECT S.REF_NO
                                                      FROM TB_FWD_INTG_REF_NO S
                                                      WHERE 1=1
                                                      AND S.INTG_KEY_ID = A.BL_ID
                                                      AND S.DEL_YN = 'N'
                                                      AND S.REF_NO_SPR_CD = 'SR'
                                                      LIMIT 1) ,
                                                    ( SELECT S.REF_NO
                                                      FROM TB_FWD_INTG_REF_NO S
                                                      WHERE 1=1
                                                      AND S.INTG_KEY_ID = A.BL_ID
                                                      AND S.DEL_YN = 'N'
                                                      AND S.REF_NO_SPR_CD = 'IN'
                                                      LIMIT 1 ))
                                             ,1,1) = 'F'
                                THEN IFNULL(
                                            (SELECT   SUM(Z.CO_CTN_QTY)
                                             FROM     TB_SMT_ORD_CO_RELT X
                                                      , TB_SMT_CO Y
                                                      , TB_SMT_CO_PACKG Z
                                             WHERE    A.SMT_NO = X.SMT_NO
                                             AND      X.CO_RECV_NO = Y.CO_RECV_NO
                                             AND      Y.CO_RECV_NO = Z.CO_RECV_NO
                                             AND      X.DEL_YN = 'N'
                                             AND      Y.DEL_YN = 'N'
                                             GROUP BY X.SMT_NO, X.CO_RECV_NO, X.CO_NO
                                            ), A.PKG_QTY
                                           )
                                ELSE A.PKG_QTY
                            END ) -- 본사는 기본 로직 처리
                    ELSE
                        IFNULL(
                                (SELECT SUM(IFNULL( Z.CO_PACKG_QTY, Z.CO_CTN_QTY))
                                 FROM     TB_SMT_ORD_CO_RELT X
                                          , TB_SMT_CO Y
                                          , TB_SMT_CO_PACKG Z
                                 WHERE    A.SMT_NO = X.SMT_NO
                                 AND      X.CO_RECV_NO = Y.CO_RECV_NO
                                 AND      Y.CO_RECV_NO = Z.CO_RECV_NO
                                 AND      X.DEL_YN = 'N'
                                 AND      Y.DEL_YN = 'N'
                                 GROUP    BY X.SMT_NO
                                          , X.CO_RECV_NO
                                          , X.CO_NO
                                ), A.PKG_QTY
                              )
                END AS PACKING_QTY
                /* 기존쿼리 -- CSR ID:2329549 요청으로 현재 쿼리로 변경 -요청자 : 최성호 부장/(ID)IT Dept
                CASE WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'C' THEN (SELECT Z.CO_PACKG_QTY
                FROM TB_OM_SO_CO_RELT X
                , TB_OM_CO Y
                , TB_OM_CO_PACKG Z
                WHERE A.SMT_NO = X.SMT_NO
                AND X.CO_RECV_NO = Y.CO_RECV_NO
                AND Y.CO_RECV_NO = Z.CO_RECV_NO
                AND X.DEL_YN = 'N'
                AND Y.DEL_YN = 'N')
                ELSE A.PKG_QTY
                END
                */
                ,CASE 
                    WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'A'
                    THEN 'K'
                    WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'B'
                    THEN (CASE
                            WHEN A.PKG_UNIT_CD = 'CT'
                            THEN 'CT'
                            WHEN A.PKG_UNIT_CD = 'PL'
                            THEN 'PT'
                            WHEN A.PKG_UNIT_CD = 'PA'
                            THEN 'PKG'
                            ELSE A.PKG_UNIT_CD
                          END)
                    WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'C'
                    THEN IF(A.PKG_UNIT_CD = NULL, 'CT', A.PKG_UNIT_CD)
                    ELSE 'K'
                 END AS PACKING_TYPE_CODE
                ,'' AS CONTAINER_COUNT_DESC
                ,A.SELL_GWT AS TOTAL_WEIGHT
                ,CASE 
                    WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'A'
                    THEN IFNULL(A.SELL_CBM,0)
                    WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'B'
                    THEN
                        CASE 
                            WHEN A.EXCT_SPR_CD = 'OC'
                            THEN IFNULL(A.SELL_CBM,0)
                            ELSE IFNULL(A.SELL_VOL_WGT,0) /* NVL(A.SHPR_CHG_VOL,0) */
                        END
                    WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'C'
                    THEN IFNULL(A.BUY_CBM,0)
                    ELSE IFNULL(A.SELL_CBM,0)
                 END AS TOTAL_CBM
                ,'' AS SUPPLIER_BRN
                ,CASE 
                        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'A'
                        THEN (CASE
                        WHEN A.SHPP_CD = '1031390'
                        THEN '2'
                        WHEN A.SHPP_CD = '2000124'
                        THEN '3'
                        WHEN A.SHPP_CD = '2020496'
                        THEN '1'
                        ELSE A.PKG_UNIT_CD
                        END)
                        ELSE NULL
                END AS SHIPPER_CODE /* 거래처코드 TOBE로 변경 013851->1031390 013773->2000124 013760->2020496 */
                ,(CASE
                        WHEN A.EXCT_SPR_CD = 'OC'
                        THEN 0
                        WHEN A.PKG_UNIT_CD = 'RL'
                        THEN 0
                        ELSE A.SELL_CWT
                 END) AS CHARGEABLE_WEIGHT
                ,IFNULL((SELECT ET.ETC_CONT1
                         FROM TB_COM_ETC_CD ET
                         WHERE ET.CLAS_CD ='0079'
                         AND ET.DTL_CD = A.CTRT_TYPE_CD
                         AND ET.USE_YN = 'Y' ),'N') AS AIR_TYPE_CODE /*[CSR ID:3640537] LGE I/F BL정보 Mapping 요청(청구방식 단일유형-->3가지 유형) */
                ,CASE
                        WHEN SUBSTR(IFNULL((SELECT   S.REF_NO
                                            FROM     TB_FWD_INTG_REF_NO S
                                            WHERE    1=1
                                            AND      S.INTG_KEY_ID = A.BL_ID
                                            AND      S.DEL_YN = 'N'
                                            AND      S.REF_NO_SPR_CD = 'SR'
                                            LIMIT 1),
                                            (SELECT  S.REF_NO
                                            FROM     TB_FWD_INTG_REF_NO S
                                            WHERE    1=1
                                            AND      S.INTG_KEY_ID = A.BL_ID
                                            AND      S.DEL_YN = 'N'
                                            AND      S.REF_NO_SPR_CD = 'IN'
                                            LIMIT 1)
                                            )
                                            ,1,1) = 'F'
                        THEN IFNULL((SELECT    SUM(Z.CO_CTN_QTY)
                                     FROM      TB_SMT_ORD_CO_RELT X
                                               , TB_SMT_CO Y
                                               , TB_SMT_CO_PACKG Z
                                    WHERE      A.SMT_NO = X.SMT_NO
                                    AND        X.CO_RECV_NO = Y.CO_RECV_NO
                                    AND        Y.CO_RECV_NO = Z.CO_RECV_NO
                                    AND        X.DEL_YN = 'N'
                                    AND        Y.DEL_YN = 'N'
                                    GROUP BY X.SMT_NO, X.CO_RECV_NO, X.CO_NO), A.PKG_QTY)
                        ELSE A.PKG_QTY
                END AS ORIGINAL_PACKING_QTY
                /* 기존쿼리 -- CSR ID:2329549 요청으로 현재 쿼리로 변경 -요청자 : 최성호 부장/(ID)IT Dept
                    CASE WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'C' THEN (SELECT Z.CO_PACKG_QTY
                    FROM TB_OM_SO_CO_RELT X
                    , TB_OM_CO Y
                    , TB_OM_CO_PACKG Z
                    WHERE A.SMT_NO = X.SMT_NO
                    AND X.CO_RECV_NO = Y.CO_RECV_NO
                    AND Y.CO_RECV_NO = Z.CO_RECV_NO
                    AND X.DEL_YN = 'N'
                    AND Y.DEL_YN = 'N')
                    ELSE A.PKG_QTY
                    END
                */
                ,CASE 
                        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'A'
                        THEN (CASE
                                    WHEN A.PKG_UNIT_CD = 'CTN'
                                    THEN 'CT'
                                    WHEN A.PKG_UNIT_CD = 'PLT'
                                    THEN 'PG'
                                    WHEN A.PKG_UNIT_CD = 'CT'
                                    THEN 'CT'
                                    ELSE 'K'
                              END)
                        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'B'
                        THEN (CASE
                                    WHEN A.PKG_UNIT_CD = 'CT'
                                    THEN 'CT'
                                    WHEN A.PKG_UNIT_CD = 'PL'
                                    THEN 'PT'
                                    WHEN A.PKG_UNIT_CD = 'PA'
                                    THEN 'PKG'
                                    ELSE A.PKG_UNIT_CD
                              END)
                        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'C'
                        THEN IF(A.PKG_UNIT_CD=NULL,'CT',A.PKG_UNIT_CD)
                        ELSE (CASE
                                    WHEN A.PKG_UNIT_CD = 'CTN'
                                    THEN 'CT'
                                    WHEN A.PKG_UNIT_CD = 'PLT'
                                    THEN 'PG'
                                    WHEN A.PKG_UNIT_CD = 'CT'
                                    THEN 'CT'
                                    ELSE 'K'
                              END)
                END AS ORIGINAL_PACKING_UNIT_CODE /* TOBE 포장단위코드*/
                ,'' AS FREIGHT_ROUTE_TYPE_CODE
                ,'' AS STATUS_CODE
                ,CASE 
                        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'C'
                        THEN NULL /* 아주 NULL */
                        ELSE A.INVC_AMT
                END AS BL_AMOUNT /* 항공수출 LGE IFT_MCS 전송시 CI 총금액 구하기 */
                ,A.CUR_CD AS CURRENCY_CODE
                ,CASE 
                        WHEN C.EXCT_BIZPTNR_CD = 'A100'
                        THEN NULL
                /* FC_FW_B2BI_GET_CODE('LGE_SHIPPING_LINE2_CODE') 는 mybatis inlucde 로 구현한다. */
                        ELSE (
                        <include refid="fwd.common.fwdFuncInclude.fwdFcFwB2biGetCode_LgeShippingLine2Code">
                            <property name="refNo"
                                value="(SELECT REF_NO FROM TB_FWD_INTG_REF_NO S WHERE 1=1 AND S.INTG_KEY_ID = A.BL_ID AND S.DEL_YN = 'N' AND S.REF_NO_SPR_CD IN ('SR','IN') LIMIT 1)"></property>
                        </include>
                        )
                END AS SHIPPING_LINE2_CODE
                ,'' AS SHIPPING_LINE2_NAME1_INFO
                ,'' AS SHIPPING_LINE2_NAME2_INFO
                ,'' AS SHIPPING_LINE2_ADDR1_INFO
                ,'' AS SHIPPING_LINE2_ADDR2_INFO
                ,'' AS SHIPPING_LINE2_ADDR3_INFO
                ,'' AS SHIPPING_LINE2_ADDR4_INFO
                ,'' AS SHIPPING_LINE2_ADDR5_INFO
                ,'' AS SENDER_EMAIL_ADDR
                ,'' AS RECEIVER_NAME
                ,'' AS RECEIVER_EMAIL_ADDR
                ,'' AS RECEIVER_PHONE_NO
                ,'' AS RECEIVER_DEPARTMENT_NAME
                ,'' AS GENERAL_RESPONSE_FLAG
                ,'' AS APPLY_FLAG
                ,'' AS ATTRIBUTE1
                ,'' AS ATTRIBUTE2
                ,'' AS ATTRIBUTE3
                ,'' AS ATTRIBUTE4
                ,'' AS ATTRIBUTE5
                ,'' AS ATTRIBUTE6
                ,'' AS ATTRIBUTE7
                ,'' AS ATTRIBUTE8
                ,'' AS ATTRIBUTE9
                ,'' AS ATTRIBUTE10
                ,'' AS ATTRIBUTE11
                ,'' AS ATTRIBUTE12
                ,'' AS ATTRIBUTE13
                ,'' AS ATTRIBUTE14
                ,'' AS ATTRIBUTE15
                ,DATE_FORMAT(NOW(), '%Y%m%d%H%i%s') AS CREATION_DATE
                ,NULL AS CREATED_BY
                ,NULL AS LAST_UPDATE_DATE
                ,NULL AS LAST_UPDATED_BY
                ,NULL AS LAST_UPDATE_LOGIN
                ,NULL AS GLOBAL_UNIQUE_ID
                ,NULL AS BAM_SEQUENCE_ID
                ,NULL AS OLD_GLOBAL_UNIQUE_ID
                ,NULL AS ORG_ID
                ,CASE 
                        WHEN C.EXCT_BIZPTNR_CD = 'A100'
                        THEN 'KLPKEXM011'
                /* FC_FW_B2BI_GET_CODE('LGE_EDI_RECEIVER_ID')는 mybatis inlucde 로 구현한다. */
                        ELSE (
                        <include refid="fwd.common.fwdFuncInclude.fwdFcFwB2biGetCode_LgeEdiReceiverId">
                            <property name="refNo"
                                value="(SELECT REF_NO FROM TB_FWD_INTG_REF_NO S WHERE 1=1 AND S.INTG_KEY_ID = A.BL_ID AND S.DEL_YN = 'N' AND S.REF_NO_SPR_CD IN ('SR','IN') LIMIT 1)"></property>
                        </include>
                        )
                END AS EDI_SENDER_ID
                /* LG마그나 법인추가로 수정 */
                ,CASE 
                        WHEN C.EXCT_BIZPTNR_CD = 'A100'
                        THEN (
                                SELECT IFNULL(MAX(Y.CO_AFLT_CD),'EKHQ')
                                FROM TB_SMT_ORD_CO_RELT X
                                , TB_SMT_CO Y
                                WHERE A.SMT_NO = X.SMT_NO
                                AND X.CO_RECV_NO = Y.CO_RECV_NO
                                AND X.DEL_YN = 'N'
                                AND Y.DEL_YN = 'N'
                        )
                        ELSE (SELECT   Y.CO_AFLT_CD
                              FROM     TB_SMT_ORD_CO_RELT X
                                       , TB_SMT_CO Y
                              WHERE    A.SMT_NO = X.SMT_NO
                              AND      X.CO_RECV_NO = Y.CO_RECV_NO
                              AND      X.DEL_YN = 'N'
                              AND      Y.DEL_YN = 'N')
                END     AS AFFILIATE_CODE /* 본사 이외에는 CO 직접참조로 하는 방식으로 수정 */
                ,#{rstrId} AS INS_ID
                ,NOW() AS TIMESTAMP
        FROM    TB_FWD_BL A
        INNER   JOIN TB_FWD_BL_EXPND B ON B.BL_ID = A.BL_ID
        INNER   JOIN TB_SMT_INTG_TASK_DEPT C ON  C.EO_NO = A.EO_NO
                                             AND C.CST_BL_ID = A.BL_ID
                                             AND C.DEL_YN = 'N'
                                             AND C.TASK_SPR_CD IN ( 'EXP', 'CSM' )
        WHERE 1=1
        AND     A.DEL_YN = 'N'
        AND     A.BL_SPR_CD IN ('H','D')
        AND     A.EXCT_SPR_CD = #{exctSprCd}
        AND     A.BL_ID = #{blId}
	</select>



	<!-- 포워딩인터페이스상태등록 -->
	<insert id="insertLgEIfTbl" parameterType="dataItem">
		/* fwd.edi.fwdCstComIfMgnt.insertLgEIfTbl */
		INSERT INTO NFINF.TB_FWD_INT183
		(
		INTERFACE_ID
		,XML_DOCUMENT_NO
		,DOCUMENT_SEQ_NO
		,TYPE_CODE
		,BL_TYPE_CODE
		,BL_NO
		,SEND_COUNT
		,CONTACT_NAME
		,CONTACT_DEPARTMENT_NAME
		,CONTACT_PHONE_NO
		,BL_ISSUE_DATE
		,PAYMENT_TERMS_CODE
		,EXCHANGE_RATE
		,TRANSFER_CONDITION_DESC
		,MASTER_BL_NO
		,SR_NO
		,SERVICE_TYPE_CODE
		,INVOICE_NO
		,LC_NO
		,VOYAGE_SEQS
		,VESSEL_FLIGHT_NAME
		,VESSEL_FLIGHT_NATIONALITY_CODE
		,EXPECTED_DEPARTURE_DATE
		,ARRIVAL_DATE
		,LOAD_PORT_CODE
		,LOAD_PORT_NAME
		,DISCHARGE_PORT_CODE
		,DISCHARGE_PORT_NAME
		,FINAL_DESTINATION_CODE
		,FINAL_DESTINATION_NAME
		,ACCEPTANCE_PORT_CODE
		,ACCEPTANCE_PORT_NAME
		,DELIVERY_PORT_CODE
		,DELIVERY_PORT_NAME
		,SHIPPING_LINE_CODE
		,SHIPPING_LINE1_NAME
		,SHIPPING_LINE2_NAME
		,SHIPPING_LINE1_ADDR
		,SHIPPING_LINE2_ADDR
		,SHIPPING_LINE3_ADDR
		,SHIPPING_LINE4_ADDR
		,SHIPPING_LINE5_ADDR
		,SHIPPER1_NAME
		,SHIPPER2_NAME
		,SHIPPER_ADDR1_INFO
		,SHIPPER_ADDR2_INFO
		,SHIPPER_ADDR3_INFO
		,SHIPPER_ADDR4_INFO
		,SHIPPER_ADDR5_INFO
		,CONSIGNEE1_NAME
		,CONSIGNEE2_NAME
		,CONSIGNEE_ADDR1_INFO
		,CONSIGNEE_ADDR2_INFO
		,CONSIGNEE_ADDR3_INFO
		,CONSIGNEE_ADDR4_INFO
		,CONSIGNEE_ADDR5_INFO
		,NOTIFY_PARTY1_NAME1_INFO
		,NOTIFY_PARTY1_NAME2_INFO
		,NOTIFY_PARTY1_ADDR1_INFO
		,NOTIFY_PARTY1_ADDR2_INFO
		,NOTIFY_PARTY1_ADDR3_INFO
		,NOTIFY_PARTY1_ADDR4_INFO
		,NOTIFY_PARTY1_ADDR5_INFO
		,NOTIFY_PARTY2_NAME1_INFO
		,NOTIFY_PARTY2_NAME2_INFO
		,NOTIFY_PARTY2_ADDR1_INFO
		,NOTIFY_PARTY2_ADDR2_INFO
		,NOTIFY_PARTY2_ADDR3_INFO
		,NOTIFY_PARTY2_ADDR4_INFO
		,NOTIFY_PARTY2_ADDR5_INFO
		,BL_ISSUE_CODE
		,BL_ISSUE_ADDR
		,PREPAY_CODE
		,PREPAY_PLACE_NAME
		,COLLECTION_CODE
		,COLLECTION_NAME
		,SEND_DEPARTMENT_TYPE_CODE
		,BL_ISSUE_COUNT
		,PACKING_QTY
		,PACKING_TYPE_CODE
		,CONTAINER_COUNT_DESC
		,TOTAL_WEIGHT
		,TOTAL_CBM
		,SUPPLIER_BRN
		,SHIPPER_CODE
		,CHARGEABLE_WEIGHT
		,AIR_TYPE_CODE
		,ORIGINAL_PACKING_QTY
		,ORIGINAL_PACKING_UNIT_CODE
		,FREIGHT_ROUTE_TYPE_CODE
		,STATUS_CODE
		,BL_AMOUNT
		,CURRENCY_CODE
		,SHIPPING_LINE2_CODE
		,SHIPPING_LINE2_NAME1_INFO
		,SHIPPING_LINE2_NAME2_INFO
		,SHIPPING_LINE2_ADDR1_INFO
		,SHIPPING_LINE2_ADDR2_INFO
		,SHIPPING_LINE2_ADDR3_INFO
		,SHIPPING_LINE2_ADDR4_INFO
		,SHIPPING_LINE2_ADDR5_INFO
		,SENDER_EMAIL_ADDR
		,RECEIVER_NAME
		,RECEIVER_EMAIL_ADDR
		,RECEIVER_PHONE_NO
		,RECEIVER_DEPARTMENT_NAME
		,GENERAL_RESPONSE_FLAG
		,APPLY_FLAG
		,ATTRIBUTE1
		,ATTRIBUTE2
		,ATTRIBUTE3
		,ATTRIBUTE4
		,ATTRIBUTE5
		,ATTRIBUTE6
		,ATTRIBUTE7
		,ATTRIBUTE8
		,ATTRIBUTE9
		,ATTRIBUTE10
		,ATTRIBUTE11
		,ATTRIBUTE12
		,ATTRIBUTE13
		,ATTRIBUTE14
		,ATTRIBUTE15
		,CREATION_DATE
		,CREATED_BY
		,LAST_UPDATE_DATE
		,LAST_UPDATED_BY
		,LAST_UPDATE_LOGIN
		,GLOBAL_UNIQUE_ID
		,BAM_SEQUENCE_ID
		,OLD_GLOBAL_UNIQUE_ID
		,ORG_ID
		,EDI_SENDER_ID
		,AFFILIATE_CODE
		,INS_ID
		,TIMESTAMP
		)
		VALUES (
		IFNULL(#{interfaceId},'' )
		, IFNULL(#{xmlDocumentNo},'' )
		, IFNULL(#{documentSeqNo},0 )
		, IFNULL(#{typeCode},'' )
		, IFNULL(#{blTypeCode},'' )
		, IFNULL(#{blNo},'' )
		, IFNULL(#{sendCount},0 )
		, IFNULL(#{contactName},'' )
		, IFNULL(#{contactDepartmentName},'' )
		, IFNULL(#{contactPhoneNo},'' )
		, IFNULL(#{blIssueDate},'' )
		, IFNULL(#{paymentTermsCode},'' )
		, IFNULL(#{exchangeRate},0 )
		, IFNULL(#{transferConditionDesc},'' )
		, IFNULL(#{masterBlNo},'' )
		, IFNULL(#{srNo},'' )
		, IFNULL(#{serviceTypeCode},'' )
		, IFNULL(#{invoiceNo},'' )
		, IFNULL(#{lcNo},'' )
		, IFNULL(#{voyageSeqs},'' )
		, IFNULL(#{vesselFlightName},'' )
		, IFNULL(#{vesselFlightNationalityCode},'' )
		, IFNULL(#{expectedDepartureDate},'' )
		, IFNULL(#{arrivalDate},'' )
		, IFNULL(#{loadPortCode},'' )
		, IFNULL(#{loadPortName},'' )
		, IFNULL(#{dischargePortCode},'' )
		, IFNULL(#{dischargePortName},'' )
		, IFNULL(#{finalDestinationCode},'' )
		, IFNULL(#{finalDestinationName},'' )
		, IFNULL(#{acceptancePortCode},'' )
		, IFNULL(#{acceptancePortName},'' )
		, IFNULL(#{deliveryPortCode},'' )
		, IFNULL(#{deliveryPortName},'' )
		, IFNULL(#{shippingLineCode},'' )
		, IFNULL(#{shippingLine1Name},'' )
		, IFNULL(#{shippingLine2Name},'' )
		, IFNULL(#{shippingLine1Addr},'' )
		, IFNULL(#{shippingLine2Addr},'' )
		, IFNULL(#{shippingLine3Addr},'' )
		, IFNULL(#{shippingLine4Addr},'' )
		, IFNULL(#{shippingLine5Addr},'' )
		, IFNULL(#{shipper1Name},'' )
		, IFNULL(#{shipper2Name},'' )
		, IFNULL(#{shipperAddr1Info},'' )
		, IFNULL(#{shipperAddr2Info},'' )
		, IFNULL(#{shipperAddr3Info},'' )
		, IFNULL(#{shipperAddr4Info},'' )
		, IFNULL(#{shipperAddr5Info},'' )
		, IFNULL(#{consignee1Name},'' )
		, IFNULL(#{consignee2Name},'' )
		, IFNULL(#{consigneeAddr1Info},'' )
		, IFNULL(#{consigneeAddr2Info},'' )
		, IFNULL(#{consigneeAddr3Info},'' )
		, IFNULL(#{consigneeAddr4Info},'' )
		, IFNULL(#{consigneeAddr5Info},'' )
		, IFNULL(#{notifyParty1Name1Info},'' )
		, IFNULL(#{notifyParty1Name2Info},'' )
		, IFNULL(#{notifyParty1Addr1Info},'' )
		, IFNULL(#{notifyParty1Addr2Info},'' )
		, IFNULL(#{notifyParty1Addr3Info},'' )
		, IFNULL(#{notifyParty1Addr4Info},'' )
		, IFNULL(#{notifyParty1Addr5Info},'' )
		, IFNULL(#{notifyParty2Name1Info},'' )
		, IFNULL(#{notifyParty2Name2Info},'' )
		, IFNULL(#{notifyParty2Addr1Info},'' )
        , IFNULL(#{notifyParty2Addr2Info},'' )
        , IFNULL(#{notifyParty2Addr3Info},'' )
        , IFNULL(#{notifyParty2Addr4Info},'' )
        , IFNULL(#{notifyParty2Addr5Info},'' )
		, IFNULL(#{blIssueCode},'' )
		, IFNULL(#{blIssueAddr},'' )
		, IFNULL(#{prepayCode},'' )
		, IFNULL(#{prepayPlaceName},'' )
		, IFNULL(#{collectionCode},'' )
		, IFNULL(#{collectionName},'' )
		, IFNULL(#{sendDepartmentTypeCode},'' )
		, IFNULL(#{blIssueCount},0 )
		, IFNULL(#{packingQty},0 )
		, IFNULL(#{packingTypeCode},'' )
		, IFNULL(#{containerCountDesc},'' )
		, IFNULL(#{totalWeight},0 )
		, IFNULL(#{totalCbm},0 )
		, IFNULL(#{supplierBrn},'' )
		, IFNULL(#{shipperCode},'' )
		, IFNULL(#{chargeableWeight},0 )
		, IFNULL(#{airTypeCode},'' )
		, IFNULL(#{originalPackingQty},0 )
		, IFNULL(#{originalPackingUnitCode},'' )
		, IFNULL(#{freightRouteTypeCode},'' )
		, IFNULL(#{statusCode},'' )
		, IFNULL(#{blAmount},0 )
		, IFNULL(#{currencyCode},'' )
		, IFNULL(#{shippingLine2Code},'' )
		, IFNULL(#{shippingLine2Name1Info},'' )
		, IFNULL(#{shippingLine2Name2Info},'' )
		, IFNULL(#{shippingLine2Addr1Info},'' )
		, IFNULL(#{shippingLine2Addr2Info},'' )
		, IFNULL(#{shippingLine2Addr3Info},'' )
		, IFNULL(#{shippingLine2Addr4Info},'' )
		, IFNULL(#{shippingLine2Addr5Info},'' )
		, IFNULL(#{senderEmailAddr},'' )
		, IFNULL(#{receiverName},'' )
		, IFNULL(#{receiverEmailAddr},'' )
		, IFNULL(#{receiverPhoneNo},'' )
		, IFNULL(#{receiverDepartmentName},'' )
		, IFNULL(#{generalResponseFlag},'' )
		, IFNULL(#{applyFlag},'' )
		, IFNULL(#{attribute1},'' )
		, IFNULL(#{attribute2},'' )
		, IFNULL(#{attribute3},'' )
		, IFNULL(#{attribute4},'' )
		, IFNULL(#{attribute5},'' )
		, IFNULL(#{attribute6},'' )
		, IFNULL(#{attribute7},'' )
		, IFNULL(#{attribute8},'' )
		, IFNULL(#{attribute9},'' )
		, IFNULL(#{attribute10},'' )
		, IFNULL(#{attribute11},'' )
		, IFNULL(#{attribute12},'' )
		, IFNULL(#{attribute13},'' )
		, IFNULL(#{attribute14},'' )
		, IFNULL(#{attribute15},'' )
		, IFNULL(#{creationDate},'' )
		, IFNULL(#{createdBy},0 )
		, IFNULL(#{lastUpdateDate},'' )
		, IFNULL(#{lastUpdatedBy},0 )
		, IFNULL(#{lastUpdateLogin},0 )
		, IFNULL(#{globalUniqueId},'' )
		, IFNULL(#{bamSequenceId},0 )
		, IFNULL(#{oldGlobalUniqueId},'' )
		, IFNULL(#{orgId},0 )
		, IFNULL(#{ediSenderId},'' )
		, IFNULL(#{affiliateCode},'' )
		, IFNULL(#{insId},'' )
		, IFNULL(#{timestamp},NOW() )
		)
	</insert>

    <insert id="insertLgEHblDesc" parameterType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.insertLgEHblDesc */
	    INSERT INTO NFINF.TB_FWD_INT187
	              (  INTERFACE_ID
	               , LINE_SEQ_NO
	               , GOODS1_DESC
	               , GOODS2_DESC
	               , GOODS3_DESC
	               , GOODS4_DESC
	               , GOODS5_DESC
	               , TYPE_CODE
	               , ATTRIBUTE1
	               , INS_ID
	               , TIMESTAMP )
	          VALUES(  #{interfaceId}
	                 , #{idx}
	                 , FC_FWD_STR_RTN(#{vDesc},#{jdx}+1,#{jdx}+1,'X','X')
	                 , FC_FWD_STR_RTN(#{vDesc},#{jdx}+2,#{jdx}+2,'X','X')
	                 , FC_FWD_STR_RTN(#{vDesc},#{jdx}+3,#{jdx}+3,'X','X')
	                 , FC_FWD_STR_RTN(#{vDesc},#{jdx}+4,#{jdx}+4,'X','X')
	                 , FC_FWD_STR_RTN(#{vDesc},#{jdx}+5,#{jdx}+5,'X','X')
	                 , NULL
	                 , NULL
	                 , #{rstrId}
	                 , NOW()
	                )
    </insert>
    
    <insert id="insertLgEHblMark" parameterType="dataItem">
         /* fwd.edi.fwdCstComIfMgnt.insertLgEHblMark */
         INSERT INTO NFINF.TB_FWD_INT188
              ( INTERFACE_ID
               ,LINE_SEQ_NO
               ,SHIPPING_MARK1_INFO
               ,SHIPPING_MARK2_INFO
               ,SHIPPING_MARK3_INFO
               ,SHIPPING_MARK4_INFO
               ,SHIPPING_MARK5_INFO
               ,SHIPPING_MARK6_INFO
               ,SHIPPING_MARK7_INFO
               ,SHIPPING_MARK8_INFO
               ,SHIPPING_MARK9_INFO
               ,SHIPPING_MARK10_INFO
               ,ATTRIBUTE1
               ,INS_ID
               ,TIMESTAMP )
              VALUES( #{interfaceId}
                     ,#{idx}
                     ,FC_FWD_STR_RTN(#{vDesc},#{jdx}+1,#{jdx}+1,'X','X')
                     ,FC_FWD_STR_RTN(#{vDesc},#{jdx}+2,#{jdx}+2,'X','X')
                     ,FC_FWD_STR_RTN(#{vDesc},#{jdx}+3,#{jdx}+3,'X','X')
                     ,FC_FWD_STR_RTN(#{vDesc},#{jdx}+4,#{jdx}+4,'X','X')
                     ,FC_FWD_STR_RTN(#{vDesc},#{jdx}+5,#{jdx}+5,'X','X')
                     ,FC_FWD_STR_RTN(#{vDesc},#{jdx}+6,#{jdx}+6,'X','X')
                     ,FC_FWD_STR_RTN(#{vDesc},#{jdx}+7,#{jdx}+7,'X','X')
                     ,FC_FWD_STR_RTN(#{vDesc},#{jdx}+8,#{jdx}+8,'X','X')
                     ,FC_FWD_STR_RTN(#{vDesc},#{jdx}+9,#{jdx}+9,'X','X')
                     ,FC_FWD_STR_RTN(#{vDesc},#{jdx}+10,#{jdx}+10,'X','X')
                     ,NULL
                     ,#{rstrId}
                     ,NOW()
                    )
    </insert>
    
    
    <select id="selectLgEHblCntrCnt" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgEHblCntrCnt */
        SELECT COUNT(*) AS CNTR_QTY
		FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
		INNER JOIN TB_SMT_INTG_ITEM S ON  S.INTG_ITEM_NO = T.INTG_ITEM_NO /* 컨테이너  */
		         AND S.DEL_YN = 'N' /* 삭제여부 */
		         AND S.CNTR_YN = 'Y'
		         AND S.CNTR_NO IS NOT NULL
		WHERE  1=1
		AND    T.DEL_YN = 'N' /* 삭제여부 */
		AND    T.BL_ID = #{blId}
		AND    LENGTH( S.CNTR_NO ) = 11
    </select>


    <insert id="insertLgEHblCntr" parameterType="dataItem">
         /* fwd.edi.fwdCstComIfMgnt.insertLgEHblCntr */
         INSERT INTO NFINF.TB_FWD_INT186
              ( INTERFACE_ID
               ,CONTAINER_SEQ_NO
               ,CONTAINER_NO
               ,CONTAINER_SIZE
               ,CONTAINER_WEIGHT
               ,CONTAINER_CBM
               ,SEAL_NO  
               ,CONTAINER_CARTON_QTY
               ,LCL_FLAG
               ,LOAD_CONFIRM_FLAG
               ,CARTON_QTY
               ,CARTON_UNIT_CODE
               ,ATTRIBUTE1
               ,INS_ID   
               ,TIMESTAMP )
               SELECT #{interfaceId}
                     ,@rownum:=@rownum+1
                     ,S.CNTR_NO
                     ,S.CNTR_SIZE_CD || S.CNTR_TYPE_CD
                     ,S.WGT
                     ,S.VOL
                     ,S.SEAL1
                     ,S.PKG_QTY
                     ,IF(IFNULL(S.LADG_TYPE_CD,'F')='L','Y','N' )
                     ,NULL
                     ,S.PKG_QTY
                     ,S.PACKG_UNIT_CD
                     ,NULL
                     ,#{rstrId}
                     ,NOW()
              FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
              INNER JOIN TB_SMT_INTG_ITEM S ON  S.INTG_ITEM_NO = T.INTG_ITEM_NO/* 컨테이너  */
                        AND S.DEL_YN = 'N' /* 삭제여부 */
                        AND S.CNTR_YN = 'Y'
              INNER JOIN (SELECT @rownum:=0) TMP
              WHERE  1=1
              AND    T.DEL_YN = 'N' /* 삭제여부 */
              AND    T.BL_ID = #{blId}
    </insert>
    
    
    <!-- LGE 인터페이스테이블 INSERT Data 조회  -->
    <select id="selectLgEIfTblDataIndia" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgEIfTblDataIndia */
        SELECT
		        #{interfaceId} AS INTERFACE_ID
		        ,#{xmlDocumentNo} AS XML_DOCUMENT_NO
		        ,1 AS DOCUMENT_SEQ_NO
		        ,CASE 
				        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'A'
				        THEN (CASE
							        WHEN A.EXCT_SPR_CD = 'AR'
							        THEN '740'
							        WHEN A.EXCT_SPR_CD = 'OC'
							        THEN '705'
							        WHEN A.EXCT_SPR_CD = 'RL'
							        THEN '705'
							        WHEN A.EXCT_SPR_CD = 'EX'
							        THEN '740'
							        END)
				        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'C'
				        THEN (CASE
							        WHEN A.EXCT_SPR_CD = 'AR'
							        THEN '740'
							        WHEN A.EXCT_SPR_CD = 'OC'
							        THEN '705'
							        WHEN A.EXCT_SPR_CD = 'RL'
							        THEN '705'
							        WHEN A.EXCT_SPR_CD = 'EX'
							        THEN '740'
							        END)
				        ELSE '740'
		         END AS TYPE_CODE
		        ,CASE 
				        WHEN #{sendType} = 'C'
				        THEN '7'
				        ELSE IF(#{cnt}=1, '9', '4')
		         END AS BL_TYPE_CODE
		        ,A.BL_NO AS BL_NO
		        ,#{cnt} AS SEND_COUNT
		        /* FC_CM_GET_EMP_NM() CONTACT_NAME - SubQuery*/
		        ,(SELECT   ENG_EMP_NM
			      FROM     TB_COM_EMP
			      WHERE    EMPNO = #{rstrId}) AS CONTACT_NAME
		        /* FC_CM_GET_ACCTG_DEPT_NM(FC_CM_GET_EMP_ACCTG_DEPT()) CONTACT_DEPARTMENT_NAME - SubQuery */
		        ,(SELECT    ACCTG_DEPT_ENG_NM
			      FROM      TB_COM_ACCTG_DEPT
			      WHERE     ACCTG_DEPT_CD = (SELECT    ACCTG_DEPT_CD
	       	                   			     FROM      TB_COM_EMP
										     WHERE     EMPNO = #{rstrId})
			      ) AS CONTACT_DEPARTMENT_NAME
		        /* FC_CM_GET_EMP_TEL_NO() CONTACT_PHONE_NO - SubQuery */
		        ,(SELECT  TEL_NO
		          FROM    TB_COM_EMP
		          WHERE   EMPNO = #{rstrId}) AS CONTACT_PHONE_NO
		        ,A.ONBR_YMD AS BL_ISSUE_DATE /* 특송의 경우 ISSUE_DATE가 없기에, ONBR_YMD로 수정 윤찬수K 요청 2013-03-07 */
		        /* NVL(A.BL_PRT_YMD, A.ONBR_YMD) -> ONBR_YMD로 수정 조만규B 요청 2013-03-18 */
		        ,A.INCOT_CD AS PAYMENT_TERMS_CODE
		        ,A.APLY_EXCHGRT AS EXCHANGE_RATE
		        ,A.INCOT_CD AS TRANSFER_CONDITION_DESC
		        ,A.MBL_NO   AS MASTER_BL_NO
		        ,E.CO_NO AS SR_NO

		        ,(CASE 
				        WHEN A.LDNG_COND_CD || A.DSCR_COND_CD = 'CYCY' THEN '1'
				        WHEN A.LDNG_COND_CD || A.DSCR_COND_CD = 'CYCFS' THEN '2'
				        WHEN A.LDNG_COND_CD || A.DSCR_COND_CD = 'CFSCY' THEN '3'
				        WHEN A.LDNG_COND_CD || A.DSCR_COND_CD = 'CFSCFS' THEN '4'
				        WHEN A.LDNG_COND_CD || A.DSCR_COND_CD = 'DOORDOOR' THEN '5'
				        WHEN A.LDNG_COND_CD || A.DSCR_COND_CD = 'CYDOOR' THEN '7'
				        WHEN A.LDNG_COND_CD || A.DSCR_COND_CD = 'CFSDOOR' THEN '8'
				        WHEN A.LDNG_COND_CD || A.DSCR_COND_CD = 'DOORCFS' THEN '10'
				        WHEN A.LDNG_COND_CD || A.DSCR_COND_CD = 'DOORCY' THEN '11'
				        WHEN A.LDNG_COND_CD || A.DSCR_COND_CD = 'CYFOR' THEN '13'
				        WHEN A.LDNG_COND_CD || A.DSCR_COND_CD = 'CYCYCFS' THEN '14'
				        ELSE '6' END) AS SERVICE_TYPE_CODE /* FC_CM_GET_EDI_NM2('EDI_SHIP_MODE', A.LDNG_COND_CD, A.DSCR_COND_CD, '') SERVICE_TYPE_CODE */
		        ,E.CO_NO AS  INVOICE_NO
		        ,(SELECT  S.REF_NO
		          FROM    TB_FWD_INTG_REF_NO S
		          WHERE   1=1
		          AND     S.INTG_KEY_ID = A.BL_ID
		          AND     S.DEL_YN = 'N'
		          AND     S.REF_NO_SPR_CD = 'LC'
		          LIMIT   1) AS LC_NO
		          
		        ,FC_FWD_CHN_REPLACE(
							        CASE
								        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'A'
								        THEN SUBSTR(IF(A.EXCT_SPR_CD='AR', SUBSTR(A.FLT_VSL_NM,3), A.VOYAGE),1, 20 )
								        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'B'
								        THEN SUBSTR(IF(A.EXCT_SPR_CD='AR', NULL, A.VOYAGE), 1, 20 )
								        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'C'
								        THEN SUBSTR(
											        (CASE
												        WHEN A.EXCT_SPR_CD = 'AR'
												        THEN NULL
												        WHEN A.EXCT_SPR_CD = 'EX'
												        THEN NULL
												        ELSE IF(B.PRE_FLT_VSL_NM=NULL,A.VOYAGE,B.PRE_VOYAGE)
											        END),1,20)
								        ELSE SUBSTR(IF(A.EXCT_SPR_CD='AR', SUBSTR(A.FLT_VSL_NM,3), A.VOYAGE),1, 20 )
							        END) AS VOYAGE_SEQS
		        ,FC_FWD_CHN_REPLACE(
							        CASE
								        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'A'
								        THEN SUBSTR(
											        (CASE
												        WHEN A.EXCT_SPR_CD = 'OC'
												        THEN A.FLT_VSL_NM
												        WHEN A.EXCT_SPR_CD = 'RL'
												        THEN A.FLT_VSL_NM
												        WHEN A.EXCT_SPR_CD = 'EX'
												        THEN IFNULL(A.FLT_VSL_NM, 'COURIER')
												        ELSE (SELECT    BB.BIZPTNR_GRP_ENG_ACRN_NM
													          FROM      TB_COM_BIZPTNR AA
													                    ,TB_COM_BIZPTNR_GRP_CD BB
													          WHERE     AA.BIZPTNR_GRP_CD = BB.BIZPTNR_GRP_CD
													          AND       AA.BIZPTNR_CD = C.CARR_CD)
											         END),1, 30 )
								        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'B'
								        THEN SUBSTR( IF(A.EXCT_SPR_CD='EX', IFNULL(A.FLT_VSL_NM, 'COURIER'), A.FLT_VSL_NM),1, 30 )
								        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'C'
								        THEN SUBSTR( IF(A.EXCT_SPR_CD='EX', IFNULL(A.FLT_VSL_NM, 'COURIER'), IF (B.PRE_FLT_VSL_NM=NULL, A.FLT_VSL_NM,B.PRE_FLT_VSL_NM )
											        ) ,1, 30)
								        ELSE SUBSTR(A.FLT_VSL_NM,1, 30 )
	                                END) AS VESSEL_FLIGHT_NAME
		        ,'' AS VESSEL_FLIGHT_NATIONALITY_CODE
		        ,A.ONBR_YMD AS EXPECTED_DEPARTURE_DATE
		        ,A.ARR_YMD AS  ARRIVAL_DATE /* 본사 항공의 경우만 스케쥴의 ETA 전송 */
		        ,IF( #{hldsYn}='Y'
			        , ( SELECT  OUTR_CD
				        FROM    TB_COM_CD_MPNG
				        WHERE   CD_MPNG_SPR_NM = 'PORT_CODE'
				        AND     RLT_BIZPTNR_CD LIKE '12'
				        AND     INSD_CD = A.POL_CD
				        AND     USE_YN = 'Y'
				        LIMIT 1)
			        , ( SELECT OUTR_CD
				        FROM    (SELECT   OUTR_CD, RANK() OVER (PARTITION BY INSD_CD ORDER BY MPNG_DRCT_CD) AS RK
						         FROM     TB_COM_CD_MPNG
						         WHERE    CD_MPNG_SPR_NM = 'PORT_CODE'
						         AND      RLT_BIZPTNR_CD LIKE '01'
						         AND      INSD_CD = A.POL_CD
						         AND      USE_YN = 'Y' ) AA
						         WHERE    RK = 1)
		        ) AS LOAD_PORT_CODE /* 확인 필요 매핑데이터 모두 없음 */
		        ,A.POL_NM AS LOAD_PORT_NAME
		        ,IF( #{hldsYn}='Y'
			        , ( SELECT OUTR_CD
				        FROM TB_COM_CD_MPNG
				        WHERE CD_MPNG_SPR_NM = 'PORT_CODE'
				        AND RLT_BIZPTNR_CD LIKE '12'
				        AND INSD_CD = A.POD_CD
				        AND USE_YN = 'Y'
				        LIMIT 1)
			        , ( SELECT OUTR_CD
				        FROM (SELECT OUTR_CD, RANK() OVER (PARTITION BY INSD_CD ORDER BY MPNG_DRCT_CD) AS RK
						      FROM TB_COM_CD_MPNG
						      WHERE CD_MPNG_SPR_NM = 'PORT_CODE'
						      AND RLT_BIZPTNR_CD LIKE '01'
						      AND INSD_CD = A.POD_CD
						      AND USE_YN = 'Y' ) AA
				        WHERE RK = 1)
		        ) AS DISCHARGE_PORT_CODE /* 확인 필요 매핑데이터 모두 없음 */
		        ,A.POD_NM AS DISCHARGE_PORT_NAME
		        ,IF( #{hldsYn}='Y'
			        , ( SELECT OUTR_CD
				        FROM TB_COM_CD_MPNG
				        WHERE CD_MPNG_SPR_NM = 'PORT_CODE'
				        AND RLT_BIZPTNR_CD LIKE '12'
				        AND INSD_CD = A.FDEST_CD
				        AND USE_YN = 'Y'
				        LIMIT 1)
			        , ( SELECT OUTR_CD
			        FROM (SELECT OUTR_CD, RANK() OVER (PARTITION BY INSD_CD ORDER BY MPNG_DRCT_CD) AS RK
				          FROM TB_COM_CD_MPNG
				          WHERE CD_MPNG_SPR_NM = 'PORT_CODE'
				          AND RLT_BIZPTNR_CD LIKE '01'
				          AND INSD_CD = A.FDEST_CD
				          AND USE_YN = 'Y' ) AA
				          WHERE RK = 1)
		        ) AS FINAL_DESTINATION_CODE /* 확인 필요 매핑데이터 모두 없음 */
		        ,A.FDEST_NM AS FINAL_DESTINATION_NAME
		        ,IF( #{hldsYn}='Y'
			        , ( SELECT OUTR_CD
				        FROM TB_COM_CD_MPNG
				        WHERE CD_MPNG_SPR_NM = 'PORT_CODE'
				        AND RLT_BIZPTNR_CD LIKE '12'
				        AND INSD_CD = A.POR_CD
				        AND USE_YN = 'Y'
				        LIMIT 1)
			        , ( SELECT OUTR_CD
				        FROM (SELECT OUTR_CD, RANK() OVER (PARTITION BY INSD_CD ORDER BY MPNG_DRCT_CD) AS RK
				        FROM TB_COM_CD_MPNG
				        WHERE CD_MPNG_SPR_NM = 'PORT_CODE'
				        AND RLT_BIZPTNR_CD LIKE '01'
				        AND INSD_CD = A.POR_CD
				        AND USE_YN = 'Y' ) AA
				        WHERE RK = 1)
		        ) AS ACCEPTANCE_PORT_CODE /* 확인 필요 매핑데이터 모두 없음 */
		        ,A.POR_NM AS ACCEPTANCE_PORT_NAME
		        ,IF( #{hldsYn}='Y'
			        , ( SELECT OUTR_CD
				        FROM TB_COM_CD_MPNG
				        WHERE CD_MPNG_SPR_NM = 'PORT_CODE'
				        AND RLT_BIZPTNR_CD LIKE '12'
				        AND INSD_CD = A.PDEL_CD
				        AND USE_YN = 'Y'
				        LIMIT 1)
			        , ( SELECT OUTR_CD
				        FROM (SELECT OUTR_CD, RANK() OVER (PARTITION BY INSD_CD ORDER BY MPNG_DRCT_CD) AS RK
				        FROM TB_COM_CD_MPNG
				        WHERE CD_MPNG_SPR_NM = 'PORT_CODE'
				        AND RLT_BIZPTNR_CD LIKE '01'
				        AND INSD_CD = A.PDEL_CD
				        AND USE_YN = 'Y' ) AA
				        WHERE RK = 1)
		        ) AS DELIVERY_PORT_CODE /* 확인 필요 매핑데이터 모두 없음 */
		        ,A.PDEL_NM AS DELIVERY_PORT_NAME
		        ,(CASE
				        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'A'
				        THEN 'KR018484'
		        /*FC_FW_B2BI_GET_CODE는 mybatis inlucde 로 구현한다. */
				        ELSE (
				        <include refid="fwd.common.fwdFuncInclude.fwdFcFwB2biGetCode_LgeShippingLine1Code">
				            <property name="refNo"
				                value="E.CO_NO"></property>
				        </include>
				        )
		        END) AS SHIPPING_LINE_CODE
		        ,IFNULL((SELECT BIZPTNR_ENG_NM
				         FROM TB_COM_BIZPTNR
				         WHERE BIZPTNR_CD = C.EXCT_BIZPTNR_CD)
				        , 
				        (SELECT ETC_CONT1
				         FROM TB_COM_ETC_CD
				         WHERE CLAS_CD ='1118'
				         AND DTL_CD_NM = C.EXCT_BIZPTNR_CD)
		        ) AS SHIPPING_LINE1_NAME
		        ,'' AS SHIPPING_LINE2_NAME
		        ,'' AS SHIPPING_LINE1_ADDR
		        ,'' AS SHIPPING_LINE2_ADDR
		        ,'' AS SHIPPING_LINE3_ADDR
		        ,'' AS SHIPPING_LINE4_ADDR
		        ,'' AS SHIPPING_LINE5_ADDR
		        /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BS', '1'),1,50) SHIPPER1_NAME - Subquery로 처리*/
		        ,SUBSTR(
				        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '1', '1', 'X', 'H')
				         FROM   TB_FWD_BL AA
				                ,TB_FWD_INTG_ADDR CC
				         WHERE  AA.BL_ID = CC.INTG_KEY_ID
				         AND    AA.BL_ID = A.BL_ID
				         AND    CC.ADDR_SPR_CD = 'BS'
				        LIMIT 1), 1, 50) AS SHIPPER1_NAME
		        ,' ' AS SHIPPER2_NAME
		        /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BS', '2'),1,50) SHIPPER_ADDR1_INFO - Subquery로 처리*/
		        ,SUBSTR(
				        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '2', '2', 'X', 'H')
				         FROM   TB_FWD_BL AA
				                ,TB_FWD_INTG_ADDR CC
				         WHERE  AA.BL_ID = CC.INTG_KEY_ID
				         AND    AA.BL_ID = A.BL_ID
				         AND    CC.ADDR_SPR_CD = 'BS'
				         LIMIT 1), 1, 50) AS SHIPPER_ADDR1_INFO
		        /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BS', '3'),1,50) SHIPPER_ADDR2_INFO - Subquery로 처리*/
		        ,SUBSTR(
				        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '3', '3', 'X', 'H')
				         FROM   TB_FWD_BL AA
				                ,TB_FWD_INTG_ADDR CC
				         WHERE  AA.BL_ID = CC.INTG_KEY_ID
				         AND    AA.BL_ID = A.BL_ID
				         AND    CC.ADDR_SPR_CD = 'BS'
				         LIMIT  1), 1, 50) AS SHIPPER_ADDR2_INFO
		        /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BS', '4'),1,50) SHIPPER_ADDR3_INFO - Subquery로 처리*/
		        ,SUBSTR(
				        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '4', '4', 'X', 'H')
				         FROM   TB_FWD_BL AA
				                ,TB_FWD_INTG_ADDR CC
				         WHERE  AA.BL_ID = CC.INTG_KEY_ID
				         AND    AA.BL_ID = A.BL_ID
				         AND    CC.ADDR_SPR_CD = 'BS'
				         LIMIT  1), 1, 50) AS SHIPPER_ADDR3_INFO
		        /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BS', '5'),1,50) SHIPPER_ADDR4_INFO - Subquery로 처리*/
		        ,SUBSTR(
				        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '5', '5', 'X', 'H')
				         FROM   TB_FWD_BL AA
				                ,TB_FWD_INTG_ADDR CC
				         WHERE  AA.BL_ID = CC.INTG_KEY_ID
				         AND    AA.BL_ID = A.BL_ID
				         AND    CC.ADDR_SPR_CD = 'BS'
				         LIMIT  1), 1, 50) AS SHIPPER_ADDR4_INFO
		        /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BS', '6'),1,50) SHIPPER_ADDR5_INFO - Subquery로 처리*/
		        ,SUBSTR(
				        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '6', '6', 'X', 'H')
				         FROM   TB_FWD_BL AA
				                ,TB_FWD_INTG_ADDR CC
				         WHERE  AA.BL_ID = CC.INTG_KEY_ID
				         AND    AA.BL_ID = A.BL_ID
				         AND    CC.ADDR_SPR_CD = 'BS'
				         LIMIT  1), 1, 50) AS SHIPPER_ADDR5_INFO
		        /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BC', '1'),1,50) CONSIGNEE1_NAME - Subquery로 처리*/
		        ,SUBSTR(
				        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '1', '1', 'X', 'H')
				         FROM   TB_FWD_BL AA
				                ,TB_FWD_INTG_ADDR CC
				         WHERE  AA.BL_ID = CC.INTG_KEY_ID
				         AND    AA.BL_ID = A.BL_ID
				         AND    CC.ADDR_SPR_CD = 'BC'
				         LIMIT  1), 1, 50) AS CONSIGNEE1_NAME
				,' ' CONSIGNEE2_NAME
		        /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BC', '2'),1,50) CONSIGNEE_ADDR1_INFO - Subquery로 처리*/
		        ,SUBSTR(
				        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '2', '2', 'X', 'H')
				         FROM   TB_FWD_BL AA
				                ,TB_FWD_INTG_ADDR CC
				         WHERE  AA.BL_ID = CC.INTG_KEY_ID
				         AND    AA.BL_ID = A.BL_ID
				         AND    CC.ADDR_SPR_CD = 'BC'
				         LIMIT  1), 1, 50) AS CONSIGNEE_ADDR1_INFO
		        /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BC', '3'),1,50) CONSIGNEE_ADDR2_INFO - Subquery로 처리*/
		        ,SUBSTR(
				        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '3', '3', 'X', 'H')
				         FROM   TB_FWD_BL AA
				                ,TB_FWD_INTG_ADDR CC
				         WHERE  AA.BL_ID = CC.INTG_KEY_ID
				         AND    AA.BL_ID = A.BL_ID
				         AND    CC.ADDR_SPR_CD = 'BC'
				         LIMIT  1), 1, 50) AS CONSIGNEE_ADDR2_INFO
		        /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BC', '4'),1,50) CONSIGNEE_ADDR3_INFO - Subquery로 처리*/
		        ,SUBSTR(
				        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '4', '4', 'X', 'H')
				         FROM   TB_FWD_BL AA
				                ,TB_FWD_INTG_ADDR CC
				         WHERE  AA.BL_ID = CC.INTG_KEY_ID
				         AND    AA.BL_ID = A.BL_ID
				         AND    CC.ADDR_SPR_CD = 'BC'
				         LIMIT  1), 1, 50) AS CONSIGNEE_ADDR3_INFO
		        /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BC', '5'),1,50) CONSIGNEE_ADDR4_INFO - Subquery로 처리*/
		        ,SUBSTR(
				        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '5', '5', 'X', 'H')
				         FROM   TB_FWD_BL AA
				                ,TB_FWD_INTG_ADDR CC
				         WHERE  AA.BL_ID = CC.INTG_KEY_ID
				         AND    AA.BL_ID = A.BL_ID
				         AND    CC.ADDR_SPR_CD = 'BC'
				         LIMIT  1), 1, 50) AS CONSIGNEE_ADDR4_INFO
		        /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BC', '6'),1,50) CONSIGNEE_ADDR5_INFO - Subquery로 처리*/
		        ,SUBSTR(
				        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '6', '6', 'X', 'H')
				         FROM   TB_FWD_BL AA
				                ,TB_FWD_INTG_ADDR CC
				         WHERE  AA.BL_ID = CC.INTG_KEY_ID
				         AND    AA.BL_ID = A.BL_ID
				         AND    CC.ADDR_SPR_CD = 'BC'
				         LIMIT  1), 1, 50) AS CONSIGNEE_ADDR5_INFO
		        /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BN', '1'),1,50) NOTIFY_PARTY1_NAME1_INFO - Subquery로 처리*/
				        ,SUBSTR(
				        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '1', '1', 'X', 'H')
				         FROM   TB_FWD_BL AA
				                ,TB_FWD_INTG_ADDR CC
				         WHERE  AA.BL_ID = CC.INTG_KEY_ID
				         AND    AA.BL_ID = A.BL_ID
				         AND    CC.ADDR_SPR_CD = 'BN'
				         LIMIT  1), 1, 50) AS NOTIFY_PARTY1_NAME1_INFO
		        ,' ' NOTIFY_PARTY1_NAME2_INFO
		        /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BN', '2'),1,50) NOTIFY_PARTY1_ADDR1_INFO - Subquery로 처리*/
				        ,SUBSTR(
				        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '2', '2', 'X', 'H')
				         FROM   TB_FWD_BL AA
				                ,TB_FWD_INTG_ADDR CC
				         WHERE  AA.BL_ID = CC.INTG_KEY_ID
				         AND    AA.BL_ID = A.BL_ID
				         AND    CC.ADDR_SPR_CD = 'BN'
				         LIMIT  1), 1, 50) AS NOTIFY_PARTY1_ADDR1_INFO
		        /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BN', '3'),1,50) NOTIFY_PARTY1_ADDR2_INFO - Subquery로 처리*/
		        ,SUBSTR(
				        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '3', '3', 'X', 'H')
				         FROM   TB_FWD_BL AA
				                ,TB_FWD_INTG_ADDR CC
				         WHERE  AA.BL_ID = CC.INTG_KEY_ID
				         AND    AA.BL_ID = A.BL_ID
				         AND    CC.ADDR_SPR_CD = 'BN'
				         LIMIT  1), 1, 50) AS NOTIFY_PARTY1_ADDR2_INFO
		        /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BN', '4'),1,50) NOTIFY_PARTY1_ADDR3_INFO - Subquery로 처리*/
		        ,SUBSTR(
				        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '4', '4', 'X', 'H')
				         FROM   TB_FWD_BL AA
				                ,TB_FWD_INTG_ADDR CC
				         WHERE  AA.BL_ID = CC.INTG_KEY_ID
				         AND    AA.BL_ID = A.BL_ID
				         AND    CC.ADDR_SPR_CD = 'BN'
				         LIMIT  1), 1, 50) AS NOTIFY_PARTY1_ADDR3_INFO
		        /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BN', '5'),1,50) NOTIFY_PARTY1_ADDR4_INFO - Subquery로 처리*/
		        ,SUBSTR(
				        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '5', '5', 'X', 'H')
				         FROM   TB_FWD_BL AA
				                ,TB_FWD_INTG_ADDR CC
				         WHERE  AA.BL_ID = CC.INTG_KEY_ID
				         AND    AA.BL_ID = A.BL_ID
				         AND    CC.ADDR_SPR_CD = 'BN'
				         LIMIT  1), 1, 50) AS NOTIFY_PARTY1_ADDR4_INFO
		        /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BN', '6'),1,50) NOTIFY_PARTY1_ADDR5_INFO - Subquery로 처리*/
		        ,SUBSTR(
				        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '6', '6', 'X', 'H')
				         FROM   TB_FWD_BL AA
				                ,TB_FWD_INTG_ADDR CC
				         WHERE  AA.BL_ID = CC.INTG_KEY_ID
				         AND    AA.BL_ID = A.BL_ID
				         AND    CC.ADDR_SPR_CD = 'BN'
				         LIMIT  1), 1, 50) AS NOTIFY_PARTY1_ADDR5_INFO
		        /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BP', '1'),1,50) NOTIFY_PARTY2_NAME1_INFO - Subquery로 처리*/
		        ,SUBSTR(
				        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '1', '1', 'X', 'H')
				         FROM   TB_FWD_BL AA
				                ,TB_FWD_INTG_ADDR CC
				         WHERE  AA.BL_ID = CC.INTG_KEY_ID
				         AND    AA.BL_ID = A.BL_ID
				         AND    CC.ADDR_SPR_CD = 'BP'
				         LIMIT  1), 1, 50) AS NOTIFY_PARTY2_NAME1_INFO
		        ,' ' AS NOTIFY_PARTY2_NAME2_INFO
		        /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BP', '2'),1,50) NOTIFY_PARTY2_ADDR1_INFO - Subquery로 처리*/
		        ,SUBSTR(
				        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '2', '2', 'X', 'H')
				         FROM   TB_FWD_BL AA
				                ,TB_FWD_INTG_ADDR CC
				         WHERE  AA.BL_ID = CC.INTG_KEY_ID
				         AND    AA.BL_ID = A.BL_ID
				         AND    CC.ADDR_SPR_CD = 'BP'
				         LIMIT  1), 1, 50) AS NOTIFY_PARTY2_ADDR1_INFO
		        /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BP', '3'),1,50) NOTIFY_PARTY2_ADDR2_INFO - Subquery로 처리*/
		        ,SUBSTR(
				        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '3', '3', 'X', 'H')
				         FROM   TB_FWD_BL AA
				                ,TB_FWD_INTG_ADDR CC
				         WHERE  AA.BL_ID = CC.INTG_KEY_ID
				         AND    AA.BL_ID = A.BL_ID
				         AND    CC.ADDR_SPR_CD = 'BP'
				         LIMIT  1), 1, 50) AS NOTIFY_PARTY2_ADDR2_INFO
		        /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BP', '4'),1,50) NOTIFY_PARTY2_ADDR3_INFO - Subquery로 처리*/
		        ,SUBSTR(
				        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '4', '4', 'X', 'H')
				         FROM   TB_FWD_BL AA
				                ,TB_FWD_INTG_ADDR CC
				         WHERE  AA.BL_ID = CC.INTG_KEY_ID
				         AND    AA.BL_ID = A.BL_ID
				         AND    CC.ADDR_SPR_CD = 'BP'
				         LIMIT  1), 1, 50) AS NOTIFY_PARTY2_ADDR3_INFO
		        /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BP', '5'),1,50) NOTIFY_PARTY2_ADDR4_INFO - Subquery로 처리*/
		        ,SUBSTR(
				        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '5', '5', 'X', 'H')
				         FROM   TB_FWD_BL AA
				                ,TB_FWD_INTG_ADDR CC
				         WHERE  AA.BL_ID = CC.INTG_KEY_ID
				         AND    AA.BL_ID = A.BL_ID
				         AND    CC.ADDR_SPR_CD = 'BP'
				         LIMIT  1), 1, 50) AS NOTIFY_PARTY2_ADDR4_INFO
		        /* SUBSTRB(FC_CM_GET_EDI_NM2('BL_ADDR_INFO', A.BL_ID, 'BP', '6'),1,50) NOTIFY_PARTY2_ADDR5_INFO - Subquery로 처리*/
		        ,SUBSTR(
				        (SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '6', '6', 'X', 'H')
				         FROM   TB_FWD_BL AA
				                ,TB_FWD_INTG_ADDR CC
				         WHERE  AA.BL_ID = CC.INTG_KEY_ID
				         AND    AA.BL_ID = A.BL_ID
				         AND    CC.ADDR_SPR_CD = 'BP'
				         LIMIT  1), 1, 50) AS NOTIFY_PARTY2_ADDR5_INFO
		        ,'' BL_ISSUE_CODE
		        ,CASE 
			        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'A'
			        THEN (CASE
						        WHEN A.FRGTTERM_CD = 'CC'
						        THEN 'DESTINATION'
						        WHEN A.FRGTTERM_CD = 'PP'
						        THEN 'SEOUL, KOREA'
						 END) /* 본사 */
			        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'B'
			        THEN (CASE
						        WHEN A.FRGTTERM_CD = 'CC'
						        THEN 'DESTINATION'
						        WHEN A.FRGTTERM_CD = 'PP'
						        THEN 'MONTERRY,MEXICO'
				         END) /* 중국 */
			        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'C'
			        THEN NULL /* 아주 */
			        ELSE (CASE
						        WHEN A.FRGTTERM_CD = 'CC'
						        THEN 'DESTINATION'
						        WHEN A.FRGTTERM_CD = 'PP'
						        THEN 'WAW,PL'
			             END) /* 구주 */
		        END AS BL_ISSUE_ADDR
		        ,IF(SUBSTR(A.FRGTTERM_CD,1,1)='P','P','') AS PREPAY_CODE
		        ,CASE 
			        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'A'
			        THEN IF(A.FRGTTERM_CD = 'PP', 'SEOUL, KOREA','')
			        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'B'
			        THEN NULL
			        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'C'
			        THEN NULL
			        /* 원본 소스가 맞는지 확인 필요. 일단 원본대로 작업함. A.FRGTTERM_CD의 비교값이 DESTINATION 인 것이 이상함.
			        * [수정처리] 2021-11-02. CC 코드를 추가하기로 함.
			        ELSE DECODE(A.FRGTTERM_CD,'DESTINATION','PP','WAW,PL','')*/
			        ELSE (CASE
						        WHEN A.FRGTTERM_CD = 'CC'
						        THEN 'DESTINATION'
						        WHEN A.FRGTTERM_CD = 'PP'
						        THEN 'WAW,PL'
						        ELSE ''
				         END)
		        END AS PREPAY_PLACE_NAME
		        ,IF(SUBSTR(A.FRGTTERM_CD,1,1) = 'C', 'C', '') AS COLLECTION_CODE
		        ,IF(A.FRGTTERM_CD = 'PP', '', 'DESTINATION') AS COLLECTION_NAME
		        ,(CASE
			        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'A'
			        THEN IFNULL((SELECT INSD_CD FROM TB_COM_CD_MPNG WHERE CD_MPNG_SPR_NM='LGE_ACCT_SALES_SEND_PART_SETTING' AND OUTR_CD = A.SHPP_CD), '1')
			        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'B'
			        THEN IF(SUBSTR((SELECT REF_NO
							        FROM TB_FWD_INTG_REF_NO S
							        WHERE 1=1
							        AND S.INTG_KEY_ID = A.BL_ID
							        AND S.DEL_YN = 'N'
							        AND S.REF_NO_SPR_CD IN ('SR','IN')
							        LIMIT 1 ),'1','3') = 'SVC','2','')
			        /* FC_FW_B2BI_GET_CODE는 mybatis inlucde 로 구현한다. */
			        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'C'
			        THEN IFNULL((
			        <include refid="fwd.common.fwdFuncInclude.fwdFcFwB2biGetCode_SendDepartmentTypeCode">
			            <property name="refNo"
			                value="E.CO_NO"></property>
			        </include>
			        ), 1)
			        ELSE IFNULL((SELECT INSD_CD FROM TB_COM_CD_MPNG WHERE CD_MPNG_SPR_NM='LGE_ACCT_SALES_SEND_PART_SETTING' AND OUTR_CD = A.SHPP_CD), '1')
		        END) AS SEND_DEPARTMENT_TYPE_CODE
		        ,1 AS BL_ISSUE_COUNT
		        ,IFNULL((SELECT SUM(IFNULL( Z.CO_PACKG_QTY, Z.CO_CTN_QTY)) 
                                      FROM TB_SMT_CO_PACKG Z 
                                      WHERE Z.CO_RECV_NO = E.CO_RECV_NO), A.PKG_QTY) AS  PACKING_QTY 
		        /* 기존쿼리 -- CSR ID:2329549 요청으로 현재 쿼리로 변경 -요청자 : 최성호 부장/(ID)IT Dept
			        CASE WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'C' THEN (SELECT Z.CO_PACKG_QTY
			        FROM TB_OM_SO_CO_RELT X
			        , TB_OM_CO Y
			        , TB_OM_CO_PACKG Z
			        WHERE A.SMT_NO = X.SMT_NO
			        AND X.CO_RECV_NO = Y.CO_RECV_NO
			        AND Y.CO_RECV_NO = Z.CO_RECV_NO
			        AND X.DEL_YN = 'N'
			        AND Y.DEL_YN = 'N')
			        ELSE A.PKG_QTY
			        END
		        */
		        ,CASE 
			        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'A'
			        THEN 'K'
			        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'B'
			        THEN (CASE
					        WHEN A.PKG_UNIT_CD = 'CT'
					        THEN 'CT'
					        WHEN A.PKG_UNIT_CD = 'PL'
					        THEN 'PT'
					        WHEN A.PKG_UNIT_CD = 'PA'
					        THEN 'PKG'
					        ELSE A.PKG_UNIT_CD
				          END)
			        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'C'
			        THEN IF(A.PKG_UNIT_CD = NULL, 'CT', A.PKG_UNIT_CD)
			        ELSE 'K'
		         END AS PACKING_TYPE_CODE
		        ,'' AS CONTAINER_COUNT_DESC
		        ,IFNULL((SELECT SUM(CO_WGT) FROM TB_SMT_CO_PACKG WHERE CO_RECV_NO = D.CO_RECV_NO), A.SELL_GWT) AS TOTAL_WEIGHT
		        ,IFNULL((SELECT SUM(CO_VOL) FROM TB_SMT_CO_PACKG WHERE CO_RECV_NO = D.CO_RECV_NO), A.SELL_CBM) AS TOTAL_CBM
		        ,'' AS SUPPLIER_BRN
		        ,CASE 
		                WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'A'
				        THEN (CASE
							        WHEN A.SHPP_CD = '1031390'
							        THEN '2'
							        WHEN A.SHPP_CD = '2000124'
							        THEN '3'
							        WHEN A.SHPP_CD = '2020496'
							        THEN '1'
					          END)
				        ELSE NULL
		        END AS SHIPPER_CODE /* 거래처코드 TOBE로 변경 013851->1031390 013773->2000124 013760->2020496 */
		        ,IFNULL(E.CO_CWT, A.SELL_CWT)  CHARGEABLE_WEIGHT
		        ,IFNULL((SELECT ET.ETC_CONT1
				         FROM TB_COM_ETC_CD ET
				         WHERE ET.CLAS_CD ='0079'
				         AND ET.DTL_CD = A.CTRT_TYPE_CD
				         AND ET.USE_YN = 'Y' ),'N') AS AIR_TYPE_CODE /*[CSR ID:3640537] LGE I/F BL정보 Mapping 요청(청구방식 단일유형-->3가지 유형) */
		        ,IFNULL((SELECT SUM(IFNULL( Z.CO_PACKG_QTY, Z.CO_CTN_QTY)) 
                                      FROM TB_SMT_CO_PACKG Z 
                                      WHERE Z.CO_RECV_NO = E.CO_RECV_NO), A.PKG_QTY) AS ORIGINAL_PACKING_QTY
		        /* 기존쿼리 -- CSR ID:2329549 요청으로 현재 쿼리로 변경 -요청자 : 최성호 부장/(ID)IT Dept
			        CASE WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'C' THEN (SELECT Z.CO_PACKG_QTY
			        FROM TB_OM_SO_CO_RELT X
			        , TB_OM_CO Y
			        , TB_OM_CO_PACKG Z
			        WHERE A.SMT_NO = X.SMT_NO
			        AND X.CO_RECV_NO = Y.CO_RECV_NO
			        AND Y.CO_RECV_NO = Z.CO_RECV_NO
			        AND X.DEL_YN = 'N'
			        AND Y.DEL_YN = 'N')
			        ELSE A.PKG_QTY
			        END
		        */
		        ,CASE 
		                WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'A'
				        THEN (CASE
							        WHEN A.PKG_UNIT_CD = 'CTN'
							        THEN 'CT'
							        WHEN A.PKG_UNIT_CD = 'PLT'
							        THEN 'PG'
							        WHEN A.PKG_UNIT_CD = 'CT'
							        THEN 'CT'
							        ELSE 'K'
				              END)
				        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'B'
				        THEN (CASE
							        WHEN A.PKG_UNIT_CD = 'CT'
							        THEN 'CT'
							        WHEN A.PKG_UNIT_CD = 'PL'
							        THEN 'PT'
							        WHEN A.PKG_UNIT_CD = 'PA'
							        THEN 'PKG'
							        ELSE A.PKG_UNIT_CD
				              END)
				        WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'C'
				        THEN IF(A.PKG_UNIT_CD=NULL,'CT',A.PKG_UNIT_CD)
				        ELSE (CASE
							        WHEN A.PKG_UNIT_CD = 'CTN'
							        THEN 'CT'
							        WHEN A.PKG_UNIT_CD = 'PLT'
							        THEN 'PG'
							        WHEN A.PKG_UNIT_CD = 'CT'
							        THEN 'CT'
							        ELSE 'K'
				              END)
		        END AS ORIGINAL_PACKING_UNIT_CODE /* TOBE 포장단위코드*/
		        ,'' AS FREIGHT_ROUTE_TYPE_CODE
		        ,'' AS STATUS_CODE
		        ,CASE 
		                WHEN SUBSTR(C.EXCT_BIZPTNR_CD,1,1) = 'C'
		                THEN NULL /* 아주 NULL */
		                ELSE A.INVC_AMT
		        END AS BL_AMOUNT /* 항공수출 LGE IFT_MCS 전송시 CI 총금액 구하기 */
		        ,A.CUR_CD AS CURRENCY_CODE
		        ,CASE 
		                WHEN C.EXCT_BIZPTNR_CD = 'A100'
		                THEN NULL
		        /* FC_FW_B2BI_GET_CODE('LGE_SHIPPING_LINE2_CODE') 는 mybatis inlucde 로 구현한다. */
				        ELSE (
				        <include refid="fwd.common.fwdFuncInclude.fwdFcFwB2biGetCode_LgeShippingLine2Code">
				            <property name="refNo"
				                value="E.CO_NO"></property>
				        </include>
				        )
		        END AS SHIPPING_LINE2_CODE
		        ,'' AS SHIPPING_LINE2_NAME1_INFO
		        ,'' AS SHIPPING_LINE2_NAME2_INFO
		        ,'' AS SHIPPING_LINE2_ADDR1_INFO
		        ,'' AS SHIPPING_LINE2_ADDR2_INFO
		        ,'' AS SHIPPING_LINE2_ADDR3_INFO
		        ,'' AS SHIPPING_LINE2_ADDR4_INFO
		        ,'' AS SHIPPING_LINE2_ADDR5_INFO
		        ,'' AS SENDER_EMAIL_ADDR
		        ,'' AS RECEIVER_NAME
		        ,'' AS RECEIVER_EMAIL_ADDR
		        ,'' AS RECEIVER_PHONE_NO
		        ,'' AS RECEIVER_DEPARTMENT_NAME
		        ,'' AS GENERAL_RESPONSE_FLAG
		        ,'' AS APPLY_FLAG
		        ,'' AS ATTRIBUTE1
		        ,'' AS ATTRIBUTE2
		        ,'' AS ATTRIBUTE3
		        ,'' AS ATTRIBUTE4
		        ,'' AS ATTRIBUTE5
		        ,'' AS ATTRIBUTE6
		        ,'' AS ATTRIBUTE7
		        ,'' AS ATTRIBUTE8
		        ,'' AS ATTRIBUTE9
		        ,'' AS ATTRIBUTE10
		        ,'' AS ATTRIBUTE11
		        ,'' AS ATTRIBUTE12
		        ,'' AS ATTRIBUTE13
		        ,'' AS ATTRIBUTE14
		        ,'' AS ATTRIBUTE15
		        ,DATE_FORMAT(NOW(), '%Y%m%d%H%i%s') AS CREATION_DATE
		        ,NULL AS CREATED_BY
		        ,NULL AS LAST_UPDATE_DATE
		        ,NULL AS LAST_UPDATED_BY
		        ,NULL AS LAST_UPDATE_LOGIN
		        ,NULL AS GLOBAL_UNIQUE_ID
		        ,NULL AS BAM_SEQUENCE_ID
		        ,NULL AS OLD_GLOBAL_UNIQUE_ID
		        ,NULL AS ORG_ID
		        ,CASE 
		                WHEN C.EXCT_BIZPTNR_CD = 'A100'
		                THEN 'KLPKEXM011'
		        /* FC_FW_B2BI_GET_CODE('LGE_EDI_RECEIVER_ID')는 mybatis inlucde 로 구현한다. */
				        ELSE (
				        <include refid="fwd.common.fwdFuncInclude.fwdFcFwB2biGetCode_LgeEdiReceiverId">
				            <property name="refNo"
				                value="E.CO_NO"></property>
				        </include>
				        )
		        END AS EDI_SENDER_ID
		        ,CASE 
			        WHEN C.EXCT_BIZPTNR_CD = 'A100' 
			        THEN 'EKHQ'
	                ELSE E.CO_AFLT_CD 
                END AFFILIATE_CODE /* 본사 이외에는 CO 직접참조로 하는 방식으로 수정 */
		        ,#{rstrId} AS INS_ID
		        ,NOW() AS TIMESTAMP
        FROM    TB_FWD_BL A
        INNER   JOIN TB_FWD_BL_EXPND B ON B.BL_ID = A.BL_ID
        INNER   JOIN TB_SMT_INTG_TASK_DEPT C ON  C.EO_NO = A.EO_NO
                                             AND C.CST_BL_ID = A.BL_ID
                                             AND C.DEL_YN = 'N'
                                             AND C.TASK_SPR_CD IN ( 'EXP', 'CSM' )
        INNER   JOIN TB_SMT_ORD_CO_RELT D ON  D.SMT_NO = A.SMT_NO
                                        AND D.DEL_YN = 'N'
        INNER   JOIN TB_SMT_CO E ON  E.CO_RECV_NO =  D.CO_RECV_NO
                                AND E.DEL_YN = 'N'
                                AND E.CO_NO = #{srNo}
        WHERE 1=1
        AND     A.DEL_YN = 'N'
        AND     A.BL_SPR_CD IN ('H','D')
        AND     A.EXCT_SPR_CD = #{exctSprCd}
        AND     A.BL_ID = #{blId}
    </select>
    
    <!-- 포워딩인터페이스상태등록 -->
    <insert id="insertLgEIfTblIndia" parameterType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.insertLgEIfTbl */
        INSERT INTO NFINF.TB_FWD_INT183
        (
	        INTERFACE_ID
	        ,XML_DOCUMENT_NO
	        ,DOCUMENT_SEQ_NO
	        ,TYPE_CODE
	        ,BL_TYPE_CODE
	        ,BL_NO
	        ,SEND_COUNT
	        ,CONTACT_NAME
	        ,CONTACT_DEPARTMENT_NAME
	        ,CONTACT_PHONE_NO
	        ,BL_ISSUE_DATE
	        ,PAYMENT_TERMS_CODE
	        ,EXCHANGE_RATE
	        ,TRANSFER_CONDITION_DESC
	        ,MASTER_BL_NO
	        ,SR_NO
	        ,SERVICE_TYPE_CODE
	        ,INVOICE_NO
	        ,LC_NO
	        ,VOYAGE_SEQS
	        ,VESSEL_FLIGHT_NAME
	        ,VESSEL_FLIGHT_NATIONALITY_CODE
	        ,EXPECTED_DEPARTURE_DATE
	        ,ARRIVAL_DATE
	        ,LOAD_PORT_CODE
	        ,LOAD_PORT_NAME
	        ,DISCHARGE_PORT_CODE
	        ,DISCHARGE_PORT_NAME
	        ,FINAL_DESTINATION_CODE
	        ,FINAL_DESTINATION_NAME
	        ,ACCEPTANCE_PORT_CODE
	        ,ACCEPTANCE_PORT_NAME
	        ,DELIVERY_PORT_CODE
	        ,DELIVERY_PORT_NAME
	        ,SHIPPING_LINE_CODE
	        ,SHIPPING_LINE1_NAME
	        ,SHIPPING_LINE2_NAME
	        ,SHIPPING_LINE1_ADDR
	        ,SHIPPING_LINE2_ADDR
	        ,SHIPPING_LINE3_ADDR
	        ,SHIPPING_LINE4_ADDR
	        ,SHIPPING_LINE5_ADDR
	        ,SHIPPER1_NAME
	        ,SHIPPER2_NAME
	        ,SHIPPER_ADDR1_INFO
	        ,SHIPPER_ADDR2_INFO
	        ,SHIPPER_ADDR3_INFO
	        ,SHIPPER_ADDR4_INFO
	        ,SHIPPER_ADDR5_INFO
	        ,CONSIGNEE1_NAME
	        ,CONSIGNEE2_NAME
	        ,CONSIGNEE_ADDR1_INFO
	        ,CONSIGNEE_ADDR2_INFO
	        ,CONSIGNEE_ADDR3_INFO
	        ,CONSIGNEE_ADDR4_INFO
	        ,CONSIGNEE_ADDR5_INFO
	        ,NOTIFY_PARTY1_NAME1_INFO
	        ,NOTIFY_PARTY1_NAME2_INFO
	        ,NOTIFY_PARTY1_ADDR1_INFO
	        ,NOTIFY_PARTY1_ADDR2_INFO
	        ,NOTIFY_PARTY1_ADDR3_INFO
	        ,NOTIFY_PARTY1_ADDR4_INFO
	        ,NOTIFY_PARTY1_ADDR5_INFO
	        ,NOTIFY_PARTY2_NAME1_INFO
	        ,NOTIFY_PARTY2_NAME2_INFO
	        ,NOTIFY_PARTY2_ADDR1_INFO
	        ,NOTIFY_PARTY2_ADDR2_INFO
	        ,NOTIFY_PARTY2_ADDR3_INFO
	        ,NOTIFY_PARTY2_ADDR4_INFO
	        ,NOTIFY_PARTY2_ADDR5_INFO
	        ,BL_ISSUE_CODE
	        ,BL_ISSUE_ADDR
	        ,PREPAY_CODE
	        ,PREPAY_PLACE_NAME
	        ,COLLECTION_CODE
	        ,COLLECTION_NAME
	        ,SEND_DEPARTMENT_TYPE_CODE
	        ,BL_ISSUE_COUNT
	        ,PACKING_QTY
	        ,PACKING_TYPE_CODE
	        ,CONTAINER_COUNT_DESC
	        ,TOTAL_WEIGHT
	        ,TOTAL_CBM
	        ,SUPPLIER_BRN
	        ,SHIPPER_CODE
	        ,CHARGEABLE_WEIGHT
	        ,AIR_TYPE_CODE
	        ,ORIGINAL_PACKING_QTY
	        ,ORIGINAL_PACKING_UNIT_CODE
	        ,FREIGHT_ROUTE_TYPE_CODE
	        ,STATUS_CODE
	        ,BL_AMOUNT
	        ,CURRENCY_CODE
	        ,SHIPPING_LINE2_CODE
	        ,SHIPPING_LINE2_NAME1_INFO
	        ,SHIPPING_LINE2_NAME2_INFO
	        ,SHIPPING_LINE2_ADDR1_INFO
	        ,SHIPPING_LINE2_ADDR2_INFO
	        ,SHIPPING_LINE2_ADDR3_INFO
	        ,SHIPPING_LINE2_ADDR4_INFO
	        ,SHIPPING_LINE2_ADDR5_INFO
	        ,SENDER_EMAIL_ADDR
	        ,RECEIVER_NAME
	        ,RECEIVER_EMAIL_ADDR
	        ,RECEIVER_PHONE_NO
	        ,RECEIVER_DEPARTMENT_NAME
	        ,GENERAL_RESPONSE_FLAG
	        ,APPLY_FLAG
	        ,ATTRIBUTE1
	        ,ATTRIBUTE2
	        ,ATTRIBUTE3
	        ,ATTRIBUTE4
	        ,ATTRIBUTE5
	        ,ATTRIBUTE6
	        ,ATTRIBUTE7
	        ,ATTRIBUTE8
	        ,ATTRIBUTE9
	        ,ATTRIBUTE10
	        ,ATTRIBUTE11
	        ,ATTRIBUTE12
	        ,ATTRIBUTE13
	        ,ATTRIBUTE14
	        ,ATTRIBUTE15
	        ,CREATION_DATE
	        ,CREATED_BY
	        ,LAST_UPDATE_DATE
	        ,LAST_UPDATED_BY
	        ,LAST_UPDATE_LOGIN
	        ,GLOBAL_UNIQUE_ID
	        ,BAM_SEQUENCE_ID
	        ,OLD_GLOBAL_UNIQUE_ID
	        ,ORG_ID
	        ,EDI_SENDER_ID
	        ,AFFILIATE_CODE
	        ,INS_ID
	        ,TIMESTAMP
        )
        VALUES (
	        IFNULL(#{interfaceId},'' )
	        , IFNULL(#{xmlDocumentNo},'' )
	        , IFNULL(#{documentSeqNo},0 )
	        , IFNULL(#{typeCode},'' )
	        , IFNULL(#{blTypeCode},'' )
	        , IFNULL(#{blNo},'' )
	        , IFNULL(#{sendCount},0 )
	        , IFNULL(#{contactName},'' )
	        , IFNULL(#{contactDepartmentName},'' )
	        , IFNULL(#{contactPhoneNo},'' )
	        , IFNULL(#{blIssueDate},'' )
	        , IFNULL(#{paymentTermsCode},'' )
	        , IFNULL(#{exchangeRate},0 )
	        , IFNULL(#{transferConditionDesc},'' )
	        , IFNULL(#{masterBlNo},'' )
	        , IFNULL(#{srNo},'' )
	        , IFNULL(#{serviceTypeCode},'' )
	        , IFNULL(#{invoiceNo},'' )
	        , IFNULL(#{lcNo},'' )
	        , IFNULL(#{voyageSeqs},'' )
	        , IFNULL(#{vesselFlightName},'' )
	        , IFNULL(#{vesselFlightNationalityCode},'' )
	        , IFNULL(#{expectedDepartureDate},'' )
	        , IFNULL(#{arrivalDate},'' )
	        , IFNULL(#{loadPortCode},'' )
	        , IFNULL(#{loadPortName},'' )
	        , IFNULL(#{dischargePortCode},'' )
	        , IFNULL(#{dischargePortName},'' )
	        , IFNULL(#{finalDestinationCode},'' )
	        , IFNULL(#{finalDestinationName},'' )
	        , IFNULL(#{acceptancePortCode},'' )
	        , IFNULL(#{acceptancePortName},'' )
	        , IFNULL(#{deliveryPortCode},'' )
	        , IFNULL(#{deliveryPortName},'' )
	        , IFNULL(#{shippingLineCode},'' )
	        , IFNULL(#{shippingLine1Name},'' )
	        , IFNULL(#{shippingLine2Name},'' )
	        , IFNULL(#{shippingLine1Addr},'' )
	        , IFNULL(#{shippingLine2Addr},'' )
	        , IFNULL(#{shippingLine3Addr},'' )
	        , IFNULL(#{shippingLine4Addr},'' )
	        , IFNULL(#{shippingLine5Addr},'' )
	        , IFNULL(#{shipper1Name},'' )
	        , IFNULL(#{shipper2Name},'' )
	        , IFNULL(#{shipperAddr1Info},'' )
	        , IFNULL(#{shipperAddr2Info},'' )
	        , IFNULL(#{shipperAddr3Info},'' )
	        , IFNULL(#{shipperAddr4Info},'' )
	        , IFNULL(#{shipperAddr5Info},'' )
	        , IFNULL(#{consignee1Name},'' )
	        , IFNULL(#{consignee2Name},'' )
	        , IFNULL(#{consigneeAddr1Info},'' )
	        , IFNULL(#{consigneeAddr2Info},'' )
	        , IFNULL(#{consigneeAddr3Info},'' )
	        , IFNULL(#{consigneeAddr4Info},'' )
	        , IFNULL(#{consigneeAddr5Info},'' )
	        , IFNULL(#{notifyParty1Name1Info},'' )
	        , IFNULL(#{notifyParty1Name2Info},'' )
	        , IFNULL(#{notifyParty1Addr1Info},'' )
	        , IFNULL(#{notifyParty1Addr2Info},'' )
	        , IFNULL(#{notifyParty1Addr3Info},'' )
	        , IFNULL(#{notifyParty1Addr4Info},'' )
	        , IFNULL(#{notifyParty1Addr5Info},'' )
	        , IFNULL(#{notifyParty2Name1Info},'' )
	        , IFNULL(#{notifyParty2Name2Info},'' )
	        , IFNULL(#{notifyParty2Addr1Info},'' )
	        , IFNULL(#{notifyParty2Addr2Info},'' )
	        , IFNULL(#{notifyParty2Addr3Info},'' )
	        , IFNULL(#{notifyParty2Addr4Info},'' )
	        , IFNULL(#{notifyParty2Addr5Info},'' )
	        , IFNULL(#{blIssueCode},'' )
	        , IFNULL(#{blIssueAddr},'' )
	        , IFNULL(#{prepayCode},'' )
	        , IFNULL(#{prepayPlaceName},'' )
	        , IFNULL(#{collectionCode},'' )
	        , IFNULL(#{collectionName},'' )
	        , IFNULL(#{sendDepartmentTypeCode},'' )
	        , IFNULL(#{blIssueCount},0 )
	        , IFNULL(#{packingQty},0 )
	        , IFNULL(#{packingTypeCode},'' )
	        , IFNULL(#{containerCountDesc},'' )
	        , IFNULL(#{totalWeight},0 )
	        , IFNULL(#{totalCbm},0 )
	        , IFNULL(#{supplierBrn},'' )
	        , IFNULL(#{shipperCode},'' )
	        , IFNULL(#{chargeableWeight},0 )
	        , IFNULL(#{airTypeCode},'' )
	        , IFNULL(#{originalPackingQty},0 )
	        , IFNULL(#{originalPackingUnitCode},'' )
	        , IFNULL(#{freightRouteTypeCode},'' )
	        , IFNULL(#{statusCode},'' )
	        , IFNULL(#{blAmount},0 )
	        , IFNULL(#{currencyCode},'' )
	        , IFNULL(#{shippingLine2Code},'' )
	        , IFNULL(#{shippingLine2Name1Info},'' )
	        , IFNULL(#{shippingLine2Name2Info},'' )
	        , IFNULL(#{shippingLine2Addr1Info},'' )
	        , IFNULL(#{shippingLine2Addr2Info},'' )
	        , IFNULL(#{shippingLine2Addr3Info},'' )
	        , IFNULL(#{shippingLine2Addr4Info},'' )
	        , IFNULL(#{shippingLine2Addr5Info},'' )
	        , IFNULL(#{senderEmailAddr},'' )
	        , IFNULL(#{receiverName},'' )
	        , IFNULL(#{receiverEmailAddr},'' )
	        , IFNULL(#{receiverPhoneNo},'' )
	        , IFNULL(#{receiverDepartmentName},'' )
	        , IFNULL(#{generalResponseFlag},'' )
	        , IFNULL(#{applyFlag},'' )
	        , IFNULL(#{attribute1},'' )
	        , IFNULL(#{attribute2},'' )
	        , IFNULL(#{attribute3},'' )
	        , IFNULL(#{attribute4},'' )
	        , IFNULL(#{attribute5},'' )
	        , IFNULL(#{attribute6},'' )
	        , IFNULL(#{attribute7},'' )
	        , IFNULL(#{attribute8},'' )
	        , IFNULL(#{attribute9},'' )
	        , IFNULL(#{attribute10},'' )
	        , IFNULL(#{attribute11},'' )
	        , IFNULL(#{attribute12},'' )
	        , IFNULL(#{attribute13},'' )
	        , IFNULL(#{attribute14},'' )
	        , IFNULL(#{attribute15},'' )
	        , IFNULL(#{creationDate},'' )
	        , IFNULL(#{createdBy},0 )
	        , IFNULL(#{lastUpdateDate},'' )
	        , IFNULL(#{lastUpdatedBy},0 )
	        , IFNULL(#{lastUpdateLogin},0 )
	        , IFNULL(#{globalUniqueId},'' )
	        , IFNULL(#{bamSequenceId},0 )
	        , IFNULL(#{oldGlobalUniqueId},'' )
	        , IFNULL(#{orgId},0 )
	        , IFNULL(#{ediSenderId},'' )
	        , IFNULL(#{affiliateCode},'' )
	        , IFNULL(#{insId},'' )
	        , IFNULL(#{timestamp},NOW() )
        )
    </insert>
    
    <select id="selectLgEHblCntrCntIndia" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgEHblCntrCntIndia */
        SELECT     COUNT(*) AS CNTR_QTY 
		FROM       TB_SMT_CO_ITEM A
		INNER JOIN TB_SMT_ORD_CO_RELT B ON  B.CO_RECV_NO = A.CO_RECV_NO
		                                AND B.CO_NO = #{srNo}
		INNER JOIN TB_FWD_BL C ON  C.SMT_NO = B.SMT_NO   
		                       AND C.BL_ID = #{blId}
		AND        A.CO_CNTR_NO != 'LCL'
		AND        LENGTH( A.CO_CNTR_NO ) = 11
    </select>
    
    
    
    <insert id="insertLgEHblCntrIndia" parameterType="dataItem">
         /* fwd.edi.fwdCstComIfMgnt."insertLgEHblCntrIndia" */
         INSERT INTO NFINF.TB_FWD_INT186
              ( INTERFACE_ID
               ,CONTAINER_SEQ_NO
               ,CONTAINER_NO
               ,CONTAINER_SIZE
               ,CONTAINER_WEIGHT
               ,CONTAINER_CBM
               ,SEAL_NO  
               ,CONTAINER_CARTON_QTY
               ,LCL_FLAG
               ,LOAD_CONFIRM_FLAG
               ,CARTON_QTY
               ,CARTON_UNIT_CODE
               ,ATTRIBUTE1
               ,INS_ID   
               ,TIMESTAMP )
               SELECT #{interfaceId}
                     ,@rownum:=@rownum+1
                     ,S.CNTR_NO
                     ,S.CNTR_SIZE_CD || S.CNTR_TYPE_CD
                     ,S.WGT
                     ,S.VOL
                     ,S.SEAL1
                     ,S.PKG_QTY
                     ,IF(IFNULL(S.LADG_TYPE_CD,'F') = 'L', 'Y', 'N')
                     ,NULL
                     ,S.PKG_QTY
                     ,S.PACKG_UNIT_CD
                     ,NULL
                     ,#{rstrId}
                     ,NOW()
              FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
              INNER JOIN TB_SMT_INTG_ITEM S ON  S.INTG_ITEM_NO = T.INTG_ITEM_NO/* 컨테이너  */
                      AND S.DEL_YN = 'N' /* 삭제여부 */
                      AND S.CNTR_YN = 'Y'
              INNER JOIN (SELECT @rownum:=0) TMP
              WHERE  1=1
              AND    T.DEL_YN = 'N' /* 삭제여부 */
              AND    T.BL_ID = #{blId}
              AND    S.CNTR_YN = 'Y'
              AND    S.CNTR_NO IN (
                 SELECT A.CO_CNTR_NO
               FROM TB_SMT_CO_ITEM A
                  , TB_SMT_ORD_CO_RELT B 
                  , TB_FWD_BL C             
               WHERE C.SMT_NO = B.SMT_NO
               AND   B.CO_RECV_NO = A.CO_RECV_NO
               AND   C.BL_ID = #{blId}
               AND   A.CO_CNTR_NO != 'LCL'
               AND   LENGTH( A.CO_CNTR_NO ) = 11
               AND   B.CO_NO = #{srNo})
    </insert>
    
    <!-- LGE인터페이스테이블Cnt조회  -->
    <select id="selectLgECarIfTblCnt" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgECarIfTblCnt */
        SELECT COUNT(*)+1 AS CNT  /* interface table count */
		FROM   NFINF.TB_FWD_INT183
		WHERE  BL_NO = #{blNo}
    </select>
    
    
    <!-- LGE Car 인터페이스 Interface를 위한 데이터 조회  -->
    <select id="selectLgECarIfTblData" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgECarIfTblData */
        SELECT 
                #{interfaceId}                       AS INTERFACE_ID
               ,#{xmlDocumentNo}                     AS XML_DOCUMENT_NO
               ,1                                    AS DOCUMENT_SEQ_NO
               ,'740'                                AS TYPE_CODE
               ,IF(#{cnt}=1,'9','4')              AS BL_TYPE_CODE /* 확인 필요 */
               ,D.RPRS_HBL_NO                        AS BL_NO /* 확인 필요 EO NO*/
               ,#{cnt}                               AS SEND_COUNT /* 확인 필요 */
               /* FC_CM_GET_EMP_NM()          CONTACT_NAME - Sub Query로 처리 */
               ,(SELECT ENG_EMP_NM
		         FROM   TB_COM_EMP
		         WHERE  EMPNO = #{rstrId}) AS CONTACT_NAME /* 확인 필요 테스트테이터  모두 없음 */
               /* FC_CM_GET_ACCTG_DEPT_NM(FC_CM_GET_EMP_ACCTG_DEPT()    CONTACT_DEPARTMENT_NAME - Sub Query로 처리*/
               ,(SELECT ACCTG_DEPT_ENG_NM
	             FROM   TB_COM_ACCTG_DEPT
	             WHERE  ACCTG_DEPT_CD = (SELECT ACCTG_DEPT_CD
							              FROM   TB_COM_EMP
							              WHERE  EMPNO = #{rstrId} ) 
	            ) AS CONTACT_DEPARTMENT_NAME
               /* FC_CM_GET_EMP_TEL_NO(})      CONTACT_PHONE_NO - Sub Query로 처리 */
               ,(SELECT TEL_NO
                 FROM   TB_COM_EMP
                 WHERE  EMPNO = #{rstrId}) AS CONTACT_PHONE_NO /* 확인 필요 테스트테이터  모두 없음 */
               ,D.ONBR_RQST_YMD                     AS BL_ISSUE_DATE
               ,D.CST_INCOT_CD                      AS PAYMENT_TERMS_CODE
               ,''                                  AS EXCHANGE_RATE /* 확인 필요 테스트테이터 모두 없음 */
               ,D.CST_INCOT_CD                      AS TRANSFER_CONDITION_DESC
               ,''                                  AS MASTER_BL_NO
               ,A.CO_NO                             AS SR_NO
               ,IFNULL(B.CO_SVC_TYPE_CD,6)          AS SERVICE_TYPE_CODE /* 확인 필요 실데이터 모두 6으로 들어옴*/
               ,A.CO_NO                             AS INVOICE_NO
               ,(SELECT S.REF_NO
                 FROM   TB_FWD_INTG_REF_NO S
                 WHERE  1=1
                 AND    S.INTG_KEY_ID = D.SMT_NO
                 AND    S.DEL_YN = 'N'
                 AND    S.REF_NO_SPR_CD = 'LC'
                 LIMIT 1)                          AS LC_NO
               ,A.CO_VOYAGE                         AS VOYAGE_SEQS /* 확인 필요 실데이터 모두 1로 들어옴*/
               ,A.CO_FLT_VSL_NM                     AS VESSEL_FLIGHT_NAME /* 확인 필요 실데이터 'turck' or 'by truck'로 들어옴*/
               ,''                                  AS VESSEL_FLIGHT_NATIONALITY_CODE
               ,D.ONBR_RQST_YMD                     AS EXPECTED_DEPARTURE_DATE
               ,D.ONBR_RQST_YMD                     AS ARRIVAL_DATE /* 확인 필요 일단 ONBR_RQST_YMD와 동일하게 */
               /* DECODE(hldsYn,'Y',FC_CM_GET_EDI_NM1('HLDS_PORT_MAP_OUT',D.POL_CD),FC_CM_GET_EDI_NM1('GERP_PORT_MAP_OUT',D.POL_CD)) - subquery 처리*/ 
               ,IF( #{hldsYn}='Y'
                   , (SELECT OUTR_CD
		              FROM   TB_COM_CD_MPNG
		              WHERE  CD_MPNG_SPR_NM = 'PORT_CODE'
		              AND    RLT_BIZPTNR_CD LIKE '12'
		              AND    INSD_CD = D.POL_CD
		              AND    USE_YN = 'Y'
		              LIMIT 1)
                   , (SELECT OUTR_CD
		              FROM (SELECT OUTR_CD, RANK() OVER (PARTITION BY INSD_CD ORDER BY MPNG_DRCT_CD) AS RK
		                    FROM   TB_COM_CD_MPNG
		                    WHERE  CD_MPNG_SPR_NM = 'PORT_CODE'
		                    AND    RLT_BIZPTNR_CD LIKE '01'
		                    AND    INSD_CD = D.POL_CD
		                    AND    USE_YN = 'Y' ) AA
		               WHERE RK = 1)) AS  LOAD_PORT_CODE /* 확인 필요 매핑데이터 모두 없음 */
                /* FC_CM_GET_LOC_NM(D.POL_CD,'ENG_LOC_NM')                LOAD_PORT_NAME - SubQuery 처리*/
                ,(SELECT ENG_LOC_NM
		          FROM   TB_COM_LOC
		          WHERE  LOC_CD = TRIM(D.POL_CD)) AS LOAD_PORT_NAME
          /* DECODE(hldsYn,'Y',FC_CM_GET_EDI_NM1('HLDS_PORT_MAP_OUT',D.POD_CD),FC_CM_GET_EDI_NM1('GERP_PORT_MAP_OUT',D.POD_CD)) DISCHARGE_PORT_CODE - Subquery */
          ,IF( #{hldsYn}='Y'
              ,(SELECT OUTR_CD
                FROM   TB_COM_CD_MPNG
                WHERE  CD_MPNG_SPR_NM = 'PORT_CODE'
                AND    RLT_BIZPTNR_CD LIKE '12'
                AND    INSD_CD = D.POD_CD
                AND    USE_YN = 'Y'
                LIMIT  1)
               ,(SELECT OUTR_CD
                 FROM (SELECT OUTR_CD, RANK() OVER (PARTITION BY INSD_CD ORDER BY MPNG_DRCT_CD) AS RK
                       FROM   TB_COM_CD_MPNG
                       WHERE  CD_MPNG_SPR_NM = 'PORT_CODE'
                       AND    RLT_BIZPTNR_CD LIKE '01'
                       AND    INSD_CD = D.POD_CD
                       AND    USE_YN = 'Y' ) AA
                 WHERE RK = 1)) AS  DISCHARGE_PORT_CODE /* 확인 필요 매핑데이터 모두 없음 */  
               /* FC_CM_GET_LOC_NM(D.POD_NM,'ENG_LOC_NM')                DISCHARGE_PORT_NAME - SubQuery */
               ,(SELECT ENG_LOC_NM
		         FROM   TB_COM_LOC
		         WHERE  LOC_CD = TRIM(D.POD_NM)) AS DISCHARGE_PORT_NAME
               ,''      AS FINAL_DESTINATION_CODE /* SO FDEST 없음, 데이터 없음(asis 트럭bl에도 없는듯) */
               ,''      AS FINAL_DESTINATION_NAME
               /* DECODE(hldsYn,'Y',FC_CM_GET_EDI_NM1('HLDS_PORT_MAP_OUT',D.POR_CD),FC_CM_GET_EDI_NM1('GERP_PORT_MAP_OUT',D.POR_CD))        ACCEPTANCE_PORT_CODE /* 확인 필요 매핑데이터 모두 없음 */
               ,IF( #{hldsYn}='Y'
                   ,(SELECT OUTR_CD
	                 FROM   TB_COM_CD_MPNG
	                 WHERE  CD_MPNG_SPR_NM = 'PORT_CODE'
	                 AND    RLT_BIZPTNR_CD LIKE '12'
	                 AND    INSD_CD = D.POR_CD
	                 AND    USE_YN = 'Y'
	                 LIMIT  1)
                   ,(SELECT OUTR_CD
                     FROM (SELECT OUTR_CD, RANK() OVER (PARTITION BY INSD_CD ORDER BY MPNG_DRCT_CD) AS RK
	                      FROM   TB_COM_CD_MPNG
	                      WHERE  CD_MPNG_SPR_NM = 'PORT_CODE'
	                      AND    RLT_BIZPTNR_CD LIKE '01'
	                      AND    INSD_CD = D.POR_CD
	                      AND    USE_YN = 'Y' ) AA
                     WHERE RK = 1) 
                   ) AS  ACCEPTANCE_PORT_CODE /* 확인 필요 매핑데이터 모두 없음 */ 
                /* FC_CM_GET_LOC_NM(D.POR_CD,'ENG_LOC_NM')                ACCEPTANCE_PORT_NAME - SubQuery */
                , (SELECT ENG_LOC_NM
		           FROM   TB_COM_LOC
		           WHERE  LOC_CD = TRIM(D.POR_CD)) AS ACCEPTANCE_PORT_NAME /* 확인 필요 데이터 모두 없음 */
                /* DECODE(hldsYn,'Y',FC_CM_GET_EDI_NM1('HLDS_PORT_MAP_OUT',D.PDEL_CD),FC_CM_GET_EDI_NM1('GERP_PORT_MAP_OUT',D.PDEL_CD))       DELIVERY_PORT_CODE - SubQuery */
                ,IF( #{hldsYn}='Y'
                    ,(SELECT OUTR_CD
	                  FROM   TB_COM_CD_MPNG
	                  WHERE  CD_MPNG_SPR_NM = 'PORT_CODE'
	                  AND    RLT_BIZPTNR_CD LIKE '12'
	                  AND    INSD_CD = D.PDEL_CD
	                  AND    USE_YN = 'Y'
	                  LIMIT  1)
                    ,(SELECT OUTR_CD
	                  FROM (SELECT OUTR_CD, RANK() OVER (PARTITION BY INSD_CD ORDER BY MPNG_DRCT_CD) AS RK
	                        FROM   TB_COM_CD_MPNG
	                        WHERE  CD_MPNG_SPR_NM = 'PORT_CODE'
	                        AND    RLT_BIZPTNR_CD LIKE '01'
	                        AND    INSD_CD = D.PDEL_CD
	                        AND    USE_YN = 'Y' ) AA
	                  WHERE RK = 1)) AS  DELIVERY_PORT_CODE /* 확인 필요 매핑데이터 모두 없음 */ 
                 /* FC_CM_GET_LOC_NM(D.PDEL_CD,'ENG_LOC_NM')               DELIVERY_PORT_NAME - SubQuery */
                 ,(SELECT ENG_LOC_NM
			       FROM   TB_COM_LOC
			       WHERE  LOC_CD = TRIM(D.PDEL_CD)) AS DELIVERY_PORT_NAME /* 확인 필요 데이터 모두 없음 */
                 ,A.CO_EXCT_COM_CD                                       AS SHIPPING_LINE_CODE /* A.CO_SHIPLN1_CD ? */
                 /* FC_CM_GET_BIZPTNR_NM(F.EXCT_BIZPTNR_CD)                SHIPPING_LINE1_NAME - SubQuery */  
                 ,IFNULL( (SELECT BIZPTNR_ENG_NM
			               FROM   TB_COM_BIZPTNR
			               WHERE  BIZPTNR_CD = F.EXCT_BIZPTNR_CD)
				         ,(SELECT ETC_CONT1
				           FROM   TB_COM_ETC_CD
				           WHERE  CLAS_CD ='1118'
				           AND    DTL_CD_NM = F.EXCT_BIZPTNR_CD) 
                   ) AS SHIPPING_LINE1_NAME /* 확인 필요 .TASK_SPR_CD ='EXP' 인 EXCT_BIZ_PTNR_CD   PANTOS LOGISTICS (HK) CO. LTD. */
                  ,''                                                     AS SHIPPING_LINE2_NAME
                  ,''                                                     AS SHIPPING_LINE1_ADDR
                  ,''                                                     AS SHIPPING_LINE2_ADDR
                  ,''                                                     AS SHIPPING_LINE3_ADDR
                  ,''                                                     AS SHIPPING_LINE4_ADDR
                  ,''                                                     AS SHIPPING_LINE5_ADDR
                  /* FC_CM_GET_EDI_NM2('SO_ADDR_INFO', D.SO_NO, 'BS', '1')         SHIPPER1_NAME - SubQuery*/
                  ,( SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '1', '1', 'X', 'H')
		             FROM   TB_SMT_ORD AA
		                   ,TB_FWD_INTG_ADDR CC
		             WHERE  AA.SMT_NO = CC.INTG_KEY_ID
		             AND    AA.SMT_NO = D.SMT_NO
		             AND    CC.ADDR_SPR_CD = 'BS'
		             LIMIT  1) AS SHIPPER1_NAME
                   ,' '                                                           AS SHIPPER2_NAME
                   /* FC_CM_GET_EDI_NM2('SO_ADDR_INFO', D.SO_NO, 'BS', '2')         SHIPPER_ADDR1_INFO - SubQuery */
                   ,(SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '2', '2', 'X', 'H')
		             FROM   TB_SMT_ORD AA
		                   ,TB_FWD_INTG_ADDR CC
		             WHERE  AA.SMT_NO=CC.INTG_KEY_ID
		             AND    AA.SMT_NO = D.SMT_NO
		             AND    CC.ADDR_SPR_CD = 'BS'
		             LIMIT  1 ) AS SHIPPER_ADDR1_INFO
                  /* FC_CM_GET_EDI_NM2('SO_ADDR_INFO', D.SO_NO, 'BS', '3')         SHIPPER_ADDR2_INFO - SubQuery */
                   ,(SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '3', '3', 'X', 'H')
		             FROM   TB_SMT_ORD AA
		                   ,TB_FWD_INTG_ADDR CC
		             WHERE  AA.SMT_NO=CC.INTG_KEY_ID
		             AND    AA.SMT_NO = D.SMT_NO
		             AND    CC.ADDR_SPR_CD = 'BS'
		             LIMIT  1 ) AS SHIPPER_ADDR2_INFO
                   /* FC_CM_GET_EDI_NM2('SO_ADDR_INFO', D.SO_NO, 'BS', '4')         SHIPPER_ADDR3_INFO - SubQuery */
                   ,(SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '4', '4', 'X', 'H')
		             FROM   TB_SMT_ORD AA
		                   ,TB_FWD_INTG_ADDR CC
		             WHERE  AA.SMT_NO=CC.INTG_KEY_ID
		             AND    AA.SMT_NO = D.SMT_NO
		             AND    CC.ADDR_SPR_CD = 'BS'
		             LIMIT  1 ) AS SHIPPER_ADDR3_INFO
                   /* FC_CM_GET_EDI_NM2('SO_ADDR_INFO', D.SO_NO, 'BS', '5')         SHIPPER_ADDR4_INFO - SubQuery */
                   ,(SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '5', '5', 'X', 'H')
		             FROM   TB_SMT_ORD AA
		                   ,TB_FWD_INTG_ADDR CC
		             WHERE  AA.SMT_NO=CC.INTG_KEY_ID
		             AND    AA.SMT_NO = D.SMT_NO
		             AND    CC.ADDR_SPR_CD = 'BS'
		             LIMIT  1 ) AS SHIPPER_ADDR4_INFO
                   /* FC_CM_GET_EDI_NM2('SO_ADDR_INFO', D.SO_NO, 'BS', '6')         SHIPPER_ADDR5_INFO - SubQuery */
                   ,(SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '6', '6', 'X', 'H')
		             FROM   TB_SMT_ORD AA
		                   ,TB_FWD_INTG_ADDR CC
		             WHERE  AA.SMT_NO=CC.INTG_KEY_ID
		             AND    AA.SMT_NO = D.SMT_NO
		             AND    CC.ADDR_SPR_CD = 'BS'
		             LIMIT  1 ) AS SHIPPER_ADDR5_INFO
                   /* FC_CM_GET_EDI_NM2('SO_ADDR_INFO', D.SO_NO, 'BC', '1')         CONSIGNEE1_NAME - SubQuery */
                   ,(SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '1', '1', 'X', 'H')
		             FROM   TB_SMT_ORD AA
		                   ,TB_FWD_INTG_ADDR CC
		             WHERE  AA.SMT_NO=CC.INTG_KEY_ID
		             AND    AA.SMT_NO = D.SMT_NO
		             AND    CC.ADDR_SPR_CD = 'BC'
		             LIMIT  1 ) AS CONSIGNEE1_NAME
                   ,' '                                                           AS CONSIGNEE2_NAME
                   /* FC_CM_GET_EDI_NM2('SO_ADDR_INFO', D.SO_NO, 'BC', '2')         CONSIGNEE_ADDR1_INFO - SubQuery */
                   ,(SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '2', '2', 'X', 'H')
		             FROM   TB_SMT_ORD AA
		                   ,TB_FWD_INTG_ADDR CC
		             WHERE  AA.SMT_NO=CC.INTG_KEY_ID
		             AND    AA.SMT_NO = D.SMT_NO
		             AND    CC.ADDR_SPR_CD = 'BC'
		             LIMIT  1 ) AS CONSIGNEE_ADDR1_INFO
                   /* FC_CM_GET_EDI_NM2('SO_ADDR_INFO', D.SO_NO, 'BC', '3')         CONSIGNEE_ADDR2_INFO - SubQuery */
                   ,(SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '3', '3', 'X', 'H')
		             FROM   TB_SMT_ORD AA
		                   ,TB_FWD_INTG_ADDR CC
		             WHERE  AA.SMT_NO=CC.INTG_KEY_ID
		             AND    AA.SMT_NO = D.SMT_NO
		             AND    CC.ADDR_SPR_CD = 'BC'
		             LIMIT  1 ) AS CONSIGNEE_ADDR2_INFO
                    /* FC_CM_GET_EDI_NM2('SO_ADDR_INFO', D.SO_NO, 'BC', '4')         CONSIGNEE_ADDR3_INFO - SubQuery */
                   ,(SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '4', '4', 'X', 'H')
		             FROM   TB_SMT_ORD AA
		                   ,TB_FWD_INTG_ADDR CC
		             WHERE  AA.SMT_NO=CC.INTG_KEY_ID
		             AND    AA.SMT_NO = D.SMT_NO
		             AND    CC.ADDR_SPR_CD = 'BC'
		             LIMIT  1 ) AS CONSIGNEE_ADDR3_INFO
                  /* FC_CM_GET_EDI_NM2('SO_ADDR_INFO', D.SO_NO, 'BC', '5')         CONSIGNEE_ADDR4_INFO - SubQuery */
                   ,(SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '5', '5', 'X', 'H')
		             FROM   TB_SMT_ORD AA
		                   ,TB_FWD_INTG_ADDR CC
		             WHERE  AA.SMT_NO=CC.INTG_KEY_ID
		             AND    AA.SMT_NO = D.SMT_NO
		             AND    CC.ADDR_SPR_CD = 'BC'
		             LIMIT  1 ) AS CONSIGNEE_ADDR4_INFO
                  /* FC_CM_GET_EDI_NM2('SO_ADDR_INFO', D.SO_NO, 'BC', '6')         CONSIGNEE_ADDR5_INFO - SubQuery */
                   ,(SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '6', '6', 'X', 'H')
		             FROM   TB_SMT_ORD AA
		                   ,TB_FWD_INTG_ADDR CC
		             WHERE  AA.SMT_NO=CC.INTG_KEY_ID
		             AND    AA.SMT_NO = D.SMT_NO
		             AND    CC.ADDR_SPR_CD = 'BC'
		             LIMIT  1 ) AS CONSIGNEE_ADDR5_INFO
                   /* FC_CM_GET_EDI_NM2('SO_ADDR_INFO', D.SO_NO, 'BN', '1')         NOTIFY_PARTY1_NAME1_INFO - SubQuery */
                   ,(SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '1', '1', 'X', 'H')
		             FROM   TB_SMT_ORD AA
		                   ,TB_FWD_INTG_ADDR CC
		             WHERE  AA.SMT_NO=CC.INTG_KEY_ID
		             AND    AA.SMT_NO = D.SMT_NO
		             AND    CC.ADDR_SPR_CD = 'BN'
		             LIMIT  1 ) AS NOTIFY_PARTY1_NAME1_INFO
                    ,' '                                                           AS NOTIFY_PARTY1_NAME2_INFO
                   /* FC_CM_GET_EDI_NM2('SO_ADDR_INFO', D.SO_NO, 'BN', '2')         NOTIFY_PARTY1_ADDR1_INFO - SubQuery */
                   ,(SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '2', '2', 'X', 'H')
		             FROM   TB_SMT_ORD AA
		                   ,TB_FWD_INTG_ADDR CC
		             WHERE  AA.SMT_NO=CC.INTG_KEY_ID
		             AND    AA.SMT_NO = D.SMT_NO
		             AND    CC.ADDR_SPR_CD = 'BN'
		             LIMIT  1 ) AS NOTIFY_PARTY1_ADDR1_INFO
                   /* FC_CM_GET_EDI_NM2('SO_ADDR_INFO', D.SO_NO, 'BN', '3')         NOTIFY_PARTY1_ADDR2_INFO - SubQuery */
                   ,(SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '3', '3', 'X', 'H')
		             FROM   TB_SMT_ORD AA
		                   ,TB_FWD_INTG_ADDR CC
		             WHERE  AA.SMT_NO=CC.INTG_KEY_ID
		             AND    AA.SMT_NO = D.SMT_NO
		             AND    CC.ADDR_SPR_CD = 'BN'
		             LIMIT  1 ) AS NOTIFY_PARTY1_ADDR2_INFO
                   /* FC_CM_GET_EDI_NM2('SO_ADDR_INFO', D.SO_NO, 'BN', '4')         NOTIFY_PARTY1_ADDR3_INFO - SubQuery */
                   ,(SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '4', '4', 'X', 'H')
		             FROM   TB_SMT_ORD AA
		                   ,TB_FWD_INTG_ADDR CC
		             WHERE  AA.SMT_NO=CC.INTG_KEY_ID
		             AND    AA.SMT_NO = D.SMT_NO
		             AND    CC.ADDR_SPR_CD = 'BN'
		             LIMIT  1 ) AS NOTIFY_PARTY1_ADDR3_INFO
                   /* FC_CM_GET_EDI_NM2('SO_ADDR_INFO', D.SO_NO, 'BN', '5')         NOTIFY_PARTY1_ADDR4_INFO - SubQuery */
                   ,(SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '5', '5', 'X', 'H')
		             FROM   TB_SMT_ORD AA
		                   ,TB_FWD_INTG_ADDR CC
		             WHERE  AA.SMT_NO=CC.INTG_KEY_ID
		             AND    AA.SMT_NO = D.SMT_NO
		             AND    CC.ADDR_SPR_CD = 'BN'
		             LIMIT  1 ) AS NOTIFY_PARTY1_ADDR4_INFO
                   /* FC_CM_GET_EDI_NM2('SO_ADDR_INFO', D.SO_NO, 'BN', '6')         NOTIFY_PARTY1_ADDR5_INFO - SubQuery */
                   ,(SELECT FC_FWD_STR_RTN(CC.INTG_ADDR, '6', '6', 'X', 'H')
		             FROM   TB_SMT_ORD AA
		                   ,TB_FWD_INTG_ADDR CC
		             WHERE  AA.SMT_NO=CC.INTG_KEY_ID
		             AND    AA.SMT_NO = D.SMT_NO
		             AND    CC.ADDR_SPR_CD = 'BN'
		             LIMIT  1 ) AS NOTIFY_PARTY1_ADDR5_INFO   
                    ,' '                                                    AS NOTIFY_PARTY2_NAME1_INFO
                    ,' '                                                    AS NOTIFY_PARTY2_NAME2_INFO
                    ,' '                                                    AS NOTIFY_PARTY2_ADDR1_INFO
                    ,' '                                                    AS NOTIFY_PARTY2_ADDR2_INFO
                    ,' '                                                    AS NOTIFY_PARTY2_ADDR3_INFO
                    ,' '                                                    AS NOTIFY_PARTY2_ADDR4_INFO
                    ,' '                                                    AS NOTIFY_PARTY2_ADDR5_INFO
                    ,' '                                                    AS BL_ISSUE_CODE
                    ,(CASE 
                      WHEN D.FRGTTERM_CD = 'CC'
                      THEN 'DESTINATION'
                      WHEN D.FRGTTERM_CD = 'PP'
                      THEN 'MONTERRY,MEXICO'
                      END) AS BL_ISSUE_ADDR
                               ,IF(SUBSTR(D.FRGTTERM_CD,1,1)='P', 'P', '')             AS PREPAY_CODE
                               ,''                                                     AS PREPAY_PLACE_NAME
                               ,IF(SUBSTR(D.FRGTTERM_CD,1,1)='C', 'C', '')             AS COLLECTION_CODE
                               ,IF(SUBSTR(D.FRGTTERM_CD,1,1)='PP', '', 'DESTINATION')  AS COLLECTION_NAME
                               ,IF(SUBSTR(A.CO_NO,1,3)='SVC', 2, '')                   AS SEND_DEPARTMENT_TYPE_CODE
                               ,1                                        AS BL_ISSUE_COUNT
                               ,D.ORD_QTY                                AS PACKING_QTY
                               ,(CASE 
                      WHEN D.PACKG_UNIT_CD = 'CT'
                      THEN 'CT'
                      WHEN D.PACKG_UNIT_CD = 'PL'
                      THEN 'PT'
                      WHEN D.PACKG_UNIT_CD = 'PA'
                      THEN 'PKG'
                      ELSE D.PACKG_UNIT_CD
                      END) AS PACKING_TYPE_CODE
                               ,''                                       AS CONTAINER_COUNT_DESC
                               ,D.ORD_WGT                                AS TOTAL_WEIGHT
                               ,IFNULL(D.ORD_VOL,0)                      AS TOTAL_CBM
                               ,''                                       AS SUPPLIER_BRN
                               ,''                                       AS SHIPPER_CODE
                               ,D.CWT                                    AS CHARGEABLE_WEIGHT
                               ,''                                       AS AIR_TYPE_CODE
                               ,D.ORD_QTY                                AS ORIGINAL_PACKING_QTY
                               ,(CASE 
                      WHEN D.PACKG_UNIT_CD = 'CT'
                      THEN 'CT'
                      WHEN D.PACKG_UNIT_CD = 'PL'
                      THEN 'PT'
                      WHEN D.PACKG_UNIT_CD = 'PA'
                      THEN 'PKG'
                      ELSE D.PACKG_UNIT_CD
                      END) AS ORIGINAL_PACKING_UNIT_CODE
		      ,''                                       AS FREIGHT_ROUTE_TYPE_CODE
		      ,''                                       AS STATUS_CODE
		      ,D.INVC_AMT                               AS  BL_AMOUNT /* 확인 필요 데이터 모두 없음 */
		      ,D.INVC_CUR_CD                            AS CURRENCY_CODE
		      ,A.CO_SHIPLN2_CD                          AS SHIPPING_LINE2_CODE
		      ,''                                       AS SHIPPING_LINE2_NAME1_INFO
		      ,''                                       AS SHIPPING_LINE2_NAME2_INFO
		      ,''                                       AS SHIPPING_LINE2_ADDR1_INFO
		      ,''                                       AS SHIPPING_LINE2_ADDR2_INFO
		      ,''                                       AS SHIPPING_LINE2_ADDR3_INFO
		      ,''                                       AS SHIPPING_LINE2_ADDR4_INFO
		      ,''                                       AS SHIPPING_LINE2_ADDR5_INFO
		      ,''                                       AS SENDER_EMAIL_ADDR
		      ,'' AS RECEIVER_NAME
		      ,'' AS RECEIVER_EMAIL_ADDR
		      ,'' AS RECEIVER_PHONE_NO
		      ,'' AS RECEIVER_DEPARTMENT_NAME
		      ,'' AS GENERAL_RESPONSE_FLAG
		      ,'' AS APPLY_FLAG
		      ,'' AS ATTRIBUTE1
		      ,'' AS ATTRIBUTE2
		      ,'' AS ATTRIBUTE3
		      ,'' AS ATTRIBUTE4
		      ,'' AS ATTRIBUTE5
		      ,'' AS ATTRIBUTE6
		      ,'' AS ATTRIBUTE7
		      ,'' AS ATTRIBUTE8
		      ,'' AS ATTRIBUTE9
		      ,'' AS ATTRIBUTE10
		      ,'' AS ATTRIBUTE11
		      ,'' AS ATTRIBUTE12
		      ,'' AS ATTRIBUTE13
		      ,'' AS ATTRIBUTE14
		      ,'' AS ATTRIBUTE15
		      ,DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')  AS CREATION_DATE
		      ,NULL                                AS CREATED_BY
		      ,NULL AS LAST_UPDATE_DATE
		      ,NULL AS LAST_UPDATED_BY
		      ,NULL AS LAST_UPDATE_LOGIN
		      ,NULL AS GLOBAL_UNIQUE_ID
		      ,NULL AS BAM_SEQUENCE_ID
		      ,NULL AS OLD_GLOBAL_UNIQUE_ID
		      ,NULL AS ORG_ID
		      ,'687822338'    AS EDI_SENDER_ID /* 방식 확인필요 */
		      ,A.CO_AFLT_CD   AS AFFILIATE_CODE  /* 방식 확인필요 */
		      ,#{rstrId}      AS INS_ID
		      ,NOW()          AS TIMESTAMP
		FROM  TB_SMT_CO A
		INNER JOIN TB_SMT_CO_EXPND B ON B.CO_RECV_NO = A.CO_RECV_NO
		INNER JOIN TB_SMT_ORD_CO_RELT C ON  C.CO_RECV_NO = A.CO_RECV_NO
		         AND C.DEL_YN = 'N'
		INNER JOIN TB_SMT_ORD D ON  D.SMT_NO = C.SMT_NO
		       AND D.SMT_NO = #{blId}
		       AND D.ORD_TYPE_CD IN ('ITRK','DTRK') /* 국제트럭, 국내트럭 */
		       AND D.DEL_YN = 'N'
		INNER JOIN (SELECT SMT_NO, MAX(EO_NO) EO_NO
		         FROM   TB_SMT_ORD_SVC_TYPE
		      WHERE  STG_SPR_CD = 1
		         AND    SVC_TYPE_CD = '0040' /* 트럭 */
		         AND   DEL_YN = 'N'
		         GROUP BY SMT_NO ) E ON E.SMT_NO = D.SMT_NO
		INNER JOIN TB_SMT_INTG_TASK_DEPT F ON  F.SMT_NO = E.SMT_NO
		         AND F.EO_NO = E.EO_NO
		         AND F.TASK_SPR_CD = 'EXP'
		         AND F.EXCT_BIZPTNR_CD = #{corpCd}
		         AND F.DEL_YN = 'N'
		WHERE  1=1 
		AND    A.DEL_YN = 'N'
    </select>
    
    <!-- LGE트럭인터페이스테이블등록  -->
    <insert id="insertLgECarIfTbl" parameterType="dataItem">
         /* fwd.edi.fwdCstComIfMgnt.insertLgECarIfTbl */
        INSERT INTO NFINF.TB_FWD_INT183
        (
	        INTERFACE_ID
	        ,XML_DOCUMENT_NO
	        ,DOCUMENT_SEQ_NO
	        ,TYPE_CODE
	        ,BL_TYPE_CODE
	        ,BL_NO
	        ,SEND_COUNT
	        ,CONTACT_NAME
	        ,CONTACT_DEPARTMENT_NAME
	        ,CONTACT_PHONE_NO
	        ,BL_ISSUE_DATE
	        ,PAYMENT_TERMS_CODE
	        ,EXCHANGE_RATE
	        ,TRANSFER_CONDITION_DESC
	        ,MASTER_BL_NO
	        ,SR_NO
	        ,SERVICE_TYPE_CODE
	        ,INVOICE_NO
	        ,LC_NO
	        ,VOYAGE_SEQS
	        ,VESSEL_FLIGHT_NAME
	        ,VESSEL_FLIGHT_NATIONALITY_CODE
	        ,EXPECTED_DEPARTURE_DATE
	        ,ARRIVAL_DATE
	        ,LOAD_PORT_CODE
	        ,LOAD_PORT_NAME
	        ,DISCHARGE_PORT_CODE
	        ,DISCHARGE_PORT_NAME
	        ,FINAL_DESTINATION_CODE
	        ,FINAL_DESTINATION_NAME
	        ,ACCEPTANCE_PORT_CODE
	        ,ACCEPTANCE_PORT_NAME
	        ,DELIVERY_PORT_CODE
	        ,DELIVERY_PORT_NAME
	        ,SHIPPING_LINE_CODE
	        ,SHIPPING_LINE1_NAME
	        ,SHIPPING_LINE2_NAME
	        ,SHIPPING_LINE1_ADDR
	        ,SHIPPING_LINE2_ADDR
	        ,SHIPPING_LINE3_ADDR
	        ,SHIPPING_LINE4_ADDR
	        ,SHIPPING_LINE5_ADDR
	        ,SHIPPER1_NAME
	        ,SHIPPER2_NAME
	        ,SHIPPER_ADDR1_INFO
	        ,SHIPPER_ADDR2_INFO
	        ,SHIPPER_ADDR3_INFO
	        ,SHIPPER_ADDR4_INFO
	        ,SHIPPER_ADDR5_INFO
	        ,CONSIGNEE1_NAME
	        ,CONSIGNEE2_NAME
	        ,CONSIGNEE_ADDR1_INFO
	        ,CONSIGNEE_ADDR2_INFO
	        ,CONSIGNEE_ADDR3_INFO
	        ,CONSIGNEE_ADDR4_INFO
	        ,CONSIGNEE_ADDR5_INFO
	        ,NOTIFY_PARTY1_NAME1_INFO
	        ,NOTIFY_PARTY1_NAME2_INFO
	        ,NOTIFY_PARTY1_ADDR1_INFO
	        ,NOTIFY_PARTY1_ADDR2_INFO
	        ,NOTIFY_PARTY1_ADDR3_INFO
	        ,NOTIFY_PARTY1_ADDR4_INFO
	        ,NOTIFY_PARTY1_ADDR5_INFO
	        ,NOTIFY_PARTY2_NAME1_INFO
	        ,NOTIFY_PARTY2_NAME2_INFO
	        ,NOTIFY_PARTY2_ADDR1_INFO
	        ,NOTIFY_PARTY2_ADDR2_INFO
	        ,NOTIFY_PARTY2_ADDR3_INFO
	        ,NOTIFY_PARTY2_ADDR4_INFO
	        ,NOTIFY_PARTY2_ADDR5_INFO
	        ,BL_ISSUE_CODE
	        ,BL_ISSUE_ADDR
	        ,PREPAY_CODE
	        ,PREPAY_PLACE_NAME
	        ,COLLECTION_CODE
	        ,COLLECTION_NAME
	        ,SEND_DEPARTMENT_TYPE_CODE
	        ,BL_ISSUE_COUNT
	        ,PACKING_QTY
	        ,PACKING_TYPE_CODE
	        ,CONTAINER_COUNT_DESC
	        ,TOTAL_WEIGHT
	        ,TOTAL_CBM
	        ,SUPPLIER_BRN
	        ,SHIPPER_CODE
	        ,CHARGEABLE_WEIGHT
	        ,AIR_TYPE_CODE
	        ,ORIGINAL_PACKING_QTY
	        ,ORIGINAL_PACKING_UNIT_CODE
	        ,FREIGHT_ROUTE_TYPE_CODE
	        ,STATUS_CODE
	        ,BL_AMOUNT
	        ,CURRENCY_CODE
	        ,SHIPPING_LINE2_CODE
	        ,SHIPPING_LINE2_NAME1_INFO
	        ,SHIPPING_LINE2_NAME2_INFO
	        ,SHIPPING_LINE2_ADDR1_INFO
	        ,SHIPPING_LINE2_ADDR2_INFO
	        ,SHIPPING_LINE2_ADDR3_INFO
	        ,SHIPPING_LINE2_ADDR4_INFO
	        ,SHIPPING_LINE2_ADDR5_INFO
	        ,SENDER_EMAIL_ADDR
	        ,RECEIVER_NAME
	        ,RECEIVER_EMAIL_ADDR
	        ,RECEIVER_PHONE_NO
	        ,RECEIVER_DEPARTMENT_NAME
	        ,GENERAL_RESPONSE_FLAG
	        ,APPLY_FLAG
	        ,ATTRIBUTE1
	        ,ATTRIBUTE2
	        ,ATTRIBUTE3
	        ,ATTRIBUTE4
	        ,ATTRIBUTE5
	        ,ATTRIBUTE6
	        ,ATTRIBUTE7
	        ,ATTRIBUTE8
	        ,ATTRIBUTE9
	        ,ATTRIBUTE10
	        ,ATTRIBUTE11
	        ,ATTRIBUTE12
	        ,ATTRIBUTE13
	        ,ATTRIBUTE14
	        ,ATTRIBUTE15
	        ,CREATION_DATE
	        ,CREATED_BY
	        ,LAST_UPDATE_DATE
	        ,LAST_UPDATED_BY
	        ,LAST_UPDATE_LOGIN
	        ,GLOBAL_UNIQUE_ID
	        ,BAM_SEQUENCE_ID
	        ,OLD_GLOBAL_UNIQUE_ID
	        ,ORG_ID
	        ,EDI_SENDER_ID
	        ,AFFILIATE_CODE
	        ,INS_ID
	        ,TIMESTAMP
        )
        VALUES (
	        IFNULL(#{interfaceId},'' )
	        , IFNULL(#{xmlDocumentNo},'' )
	        , IFNULL(#{documentSeqNo},0 )
	        , IFNULL(#{typeCode},'' )
	        , IFNULL(#{blTypeCode},'' )
	        , IFNULL(#{blNo},'' )
	        , IFNULL(#{sendCount},0 )
	        , IFNULL(#{contactName},'' )
	        , IFNULL(#{contactDepartmentName},'' )
	        , IFNULL(#{contactPhoneNo},'' )
	        , IFNULL(#{blIssueDate},'' )
	        , IFNULL(#{paymentTermsCode},'' )
	        , IFNULL(#{exchangeRate},0 )
	        , IFNULL(#{transferConditionDesc},'' )
	        , IFNULL(#{masterBlNo},'' )
	        , IFNULL(#{srNo},'' )
	        , IFNULL(#{serviceTypeCode},'' )
	        , IFNULL(#{invoiceNo},'' )
	        , IFNULL(#{lcNo},'' )
	        , IFNULL(#{voyageSeqs},'' )
	        , IFNULL(#{vesselFlightName},'' )
	        , IFNULL(#{vesselFlightNationalityCode},'' )
	        , IFNULL(#{expectedDepartureDate},'' )
	        , IFNULL(#{arrivalDate},'' )
	        , IFNULL(#{loadPortCode},'' )
	        , IFNULL(#{loadPortName},'' )
	        , IFNULL(#{dischargePortCode},'' )
	        , IFNULL(#{dischargePortName},'' )
	        , IFNULL(#{finalDestinationCode},'' )
	        , IFNULL(#{finalDestinationName},'' )
	        , IFNULL(#{acceptancePortCode},'' )
	        , IFNULL(#{acceptancePortName},'' )
	        , IFNULL(#{deliveryPortCode},'' )
	        , IFNULL(#{deliveryPortName},'' )
	        , IFNULL(#{shippingLineCode},'' )
	        , IFNULL(#{shippingLine1Name},'' )
	        , IFNULL(#{shippingLine2Name},'' )
	        , IFNULL(#{shippingLine1Addr},'' )
	        , IFNULL(#{shippingLine2Addr},'' )
	        , IFNULL(#{shippingLine3Addr},'' )
	        , IFNULL(#{shippingLine4Addr},'' )
	        , IFNULL(#{shippingLine5Addr},'' )
	        , IFNULL(#{shipper1Name},'' )
	        , IFNULL(#{shipper2Name},'' )
	        , IFNULL(#{shipperAddr1Info},'' )
	        , IFNULL(#{shipperAddr2Info},'' )
	        , IFNULL(#{shipperAddr3Info},'' )
	        , IFNULL(#{shipperAddr4Info},'' )
	        , IFNULL(#{shipperAddr5Info},'' )
	        , IFNULL(#{consignee1Name},'' )
	        , IFNULL(#{consignee2Name},'' )
	        , IFNULL(#{consigneeAddr1Info},'' )
	        , IFNULL(#{consigneeAddr2Info},'' )
	        , IFNULL(#{consigneeAddr3Info},'' )
	        , IFNULL(#{consigneeAddr4Info},'' )
	        , IFNULL(#{consigneeAddr5Info},'' )
	        , IFNULL(#{notifyParty1Name1Info},'' )
	        , IFNULL(#{notifyParty1Name2Info},'' )
	        , IFNULL(#{notifyParty1Addr1Info},'' )
	        , IFNULL(#{notifyParty1Addr2Info},'' )
	        , IFNULL(#{notifyParty1Addr3Info},'' )
	        , IFNULL(#{notifyParty1Addr4Info},'' )
	        , IFNULL(#{notifyParty1Addr5Info},'' )
	        , IFNULL(#{notifyParty2Name1Info},'' )
	        , IFNULL(#{notifyParty2Name2Info},'' )
	        , IFNULL(#{notifyParty2Addr1Info},'' )
	        , IFNULL(#{notifyParty2Addr2Info},'' )
	        , IFNULL(#{notifyParty2Addr3Info},'' )
	        , IFNULL(#{notifyParty2Addr4Info},'' )
	        , IFNULL(#{notifyParty2Addr5Info},'' )
	        , IFNULL(#{blIssueCode},'' )
	        , IFNULL(#{blIssueAddr},'' )
	        , IFNULL(#{prepayCode},'' )
	        , IFNULL(#{prepayPlaceName},'' )
	        , IFNULL(#{collectionCode},'' )
	        , IFNULL(#{collectionName},'' )
	        , IFNULL(#{sendDepartmentTypeCode},'' )
	        , IFNULL(#{blIssueCount},0 )
	        , IFNULL(#{packingQty},0 )
	        , IFNULL(#{packingTypeCode},'' )
	        , IFNULL(#{containerCountDesc},'' )
	        , IFNULL(#{totalWeight},0 )
	        , IFNULL(#{totalCbm},0 )
	        , IFNULL(#{supplierBrn},'' )
	        , IFNULL(#{shipperCode},'' )
	        , IFNULL(#{chargeableWeight},0 )
	        , IFNULL(#{airTypeCode},'' )
	        , IFNULL(#{originalPackingQty},0 )
	        , IFNULL(#{originalPackingUnitCode},'' )
	        , IFNULL(#{freightRouteTypeCode},'' )
	        , IFNULL(#{statusCode},'' )
	        , IFNULL(#{blAmount},0 )
	        , IFNULL(#{currencyCode},'' )
	        , IFNULL(#{shippingLine2Code},'' )
	        , IFNULL(#{shippingLine2Name1Info},'' )
	        , IFNULL(#{shippingLine2Name2Info},'' )
	        , IFNULL(#{shippingLine2Addr1Info},'' )
	        , IFNULL(#{shippingLine2Addr2Info},'' )
	        , IFNULL(#{shippingLine2Addr3Info},'' )
	        , IFNULL(#{shippingLine2Addr4Info},'' )
	        , IFNULL(#{shippingLine2Addr5Info},'' )
	        , IFNULL(#{senderEmailAddr},'' )
	        , IFNULL(#{receiverName},'' )
	        , IFNULL(#{receiverEmailAddr},'' )
	        , IFNULL(#{receiverPhoneNo},'' )
	        , IFNULL(#{receiverDepartmentName},'' )
	        , IFNULL(#{generalResponseFlag},'' )
	        , IFNULL(#{applyFlag},'' )
	        , IFNULL(#{attribute1},'' )
	        , IFNULL(#{attribute2},'' )
	        , IFNULL(#{attribute3},'' )
	        , IFNULL(#{attribute4},'' )
	        , IFNULL(#{attribute5},'' )
	        , IFNULL(#{attribute6},'' )
	        , IFNULL(#{attribute7},'' )
	        , IFNULL(#{attribute8},'' )
	        , IFNULL(#{attribute9},'' )
	        , IFNULL(#{attribute10},'' )
	        , IFNULL(#{attribute11},'' )
	        , IFNULL(#{attribute12},'' )
	        , IFNULL(#{attribute13},'' )
	        , IFNULL(#{attribute14},'' )
	        , IFNULL(#{attribute15},'' )
	        , IFNULL(#{creationDate},'' )
	        , IFNULL(#{createdBy},0 )
	        , IFNULL(#{lastUpdateDate},'' )
	        , IFNULL(#{lastUpdatedBy},0 )
	        , IFNULL(#{lastUpdateLogin},0 )
	        , IFNULL(#{globalUniqueId},'' )
	        , IFNULL(#{bamSequenceId},0 )
	        , IFNULL(#{oldGlobalUniqueId},'' )
	        , IFNULL(#{orgId},0 )
	        , IFNULL(#{ediSenderId},'' )
	        , IFNULL(#{affiliateCode},'' )
	        , IFNULL(#{insId},'' )
	        , IFNULL(#{timestamp},NOW() )
        )
    </insert>
    
    <select id="selectLgEPreBl" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgEPreBl */
         SELECT                                                                                                                 
			    'F' AS CHK                                                                                                          
			    ,AA.REVN_RCGN_CD                                                                                                                
			    ,AA.REVN_RCGN_IMG                                                                                                               
			    ,AA.ORD_TYPE_CD                                                                                                             
			    , CASE WHEN AA.EXCT_BIZPTNR_CD = 'F100' OR AA.EXCT_BIZPTNR_CD = 'E700'                                                                                                              
			           THEN                                                                                                         
			                 CASE    WHEN AA.ONBR_YMD IS NULL                                                                                                               
			                         THEN 
			                         (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
					                     <property name="clasCd" value="'0499'"/>
					                     <property name="dtlCd" value="'2'"/>
					                 </include>) /* FC_CM_GET_ETC_CD_NM('0499', '2') - MySql Include로 구현*/                                                                                                                          
			                         WHEN AA.BL_NO IS NULL                                                                                                              
			                         THEN 
			                         (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                                         <property name="clasCd" value="'0499'"/>
                                         <property name="dtlCd" value="'1'"/>
                                     </include>)  /* FC_CM_GET_ETC_CD_NM('0499', '1') - MySql Include로 구현*/                                                                                                              
			                         WHEN IFNULL(AA.BL_IMG_YN, 'N') = 'N' AND AA.ATTACH_FILE IS NULL                                                                                                                
			                         THEN 
			                         (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                                         <property name="clasCd" value="'0499'"/>
                                         <property name="dtlCd" value="'18'"/>
                                     </include>) /* FC_CM_GET_ETC_CD_NM('0499', '18') - MySql Include로 구현*/                                                                                                             
			                         ELSE 
			                         (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                                         <property name="clasCd" value="'0499'"/>
                                         <property name="dtlCd" value="'0'"/>
                                     </include>) /* FC_CM_GET_ETC_CD_NM('0499', '0') - MySql Include로 구현*/                                                                                                          
			                 END                                                                                                                    
			        ELSE  
			        <![CDATA[                                                                                                              
			        CASE WHEN AA.SELL_GWT <= 0 
                    ]]>
			             THEN 
				             (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
	                              <property name="clasCd" value="'0499'"/>
	                              <property name="dtlCd" value="'9'"/>
	                         </include>) /* FC_CM_GET_ETC_CD_NM('0499', '9') - MySql Include로 구현*/                                                                                                                
			             WHEN AA.ARR_YMD IS NULL 
			             THEN 
				             (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
	                              <property name="clasCd" value="'0499'"/>
	                              <property name="dtlCd" value="'7'"/>
	                          </include>) /* FC_CM_GET_ETC_CD_NM('0499', '7') - MySql Include로 구현*/                                                                                                                  
			             WHEN AA.FRGTTERM_CD IS NULL 
			             THEN 
			                 (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                                  <property name="clasCd" value="'0499'"/>
                                  <property name="dtlCd" value="'6'"/>
                              </include>) /* FC_CM_GET_ETC_CD_NM('0499', '6') - MySql Include로 구현*/                                                                                                              
			             WHEN AA.EXCT_SPR_CD IN('OC','RL') AND AA.INVC_CUR_CD IS NULL 
			             THEN 
			                  (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                                  <property name="clasCd" value="'0499'"/>
                                  <property name="dtlCd" value="'5'"/>
                              </include>) /* FC_CM_GET_ETC_CD_NM('0499', '5') - MySql Include로 구현*/                                                                                                             
			             WHEN AA.EXCT_SPR_CD IN('AR','EX') AND AA.CUR_CD IS NULL 
			             THEN 
			                 (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                                  <property name="clasCd" value="'0499'"/>
                                  <property name="dtlCd" value="'5'"/>
                              </include>) /* FC_CM_GET_ETC_CD_NM('0499', '5') - MySql Include로 구현*/                                                                                                              
			             WHEN AA.POD_CD IS NULL 
			             THEN 
			                 (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                                  <property name="clasCd" value="'0499'"/>
                                  <property name="dtlCd" value="'4'"/>
                              </include>) /* FC_CM_GET_ETC_CD_NM('0499', '4') - MySql Include로 구현*/                                                                                                                                   
			             WHEN AA.POL_CD IS NULL 
			             THEN 
			                 (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                                  <property name="clasCd" value="'0499'"/>
                                  <property name="dtlCd" value="'3'"/>
                              </include>) /* FC_CM_GET_ETC_CD_NM('0499', '3') - MySql Include로 구현*/                                                                                                                                   
			             WHEN AA.ONBR_YMD IS NULL 
			             THEN 
			                 (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                                  <property name="clasCd" value="'0499'"/>
                                  <property name="dtlCd" value="'2'"/>
                              </include>) /* FC_CM_GET_ETC_CD_NM('0499', '2') - MySql Include로 구현*/                                                                                                             
			             WHEN AA.BL_NO IS NULL THEN 
			                 (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                                  <property name="clasCd" value="'0499'"/>
                                  <property name="dtlCd" value="'1'"/>
                              </include>) /* FC_CM_GET_ETC_CD_NM('0499', '1') - MySql Include로 구현*/    
                         <![CDATA[                                                                                                               
			             WHEN AA.EXCT_SPR_CD = 'AR' THEN CASE WHEN INSTR(AA.PO_NO, '&') > 0 
	                     ]]>
			                                                  THEN 
		                                                          (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
									                                   <property name="clasCd" value="'0499'"/>
									                                   <property name="dtlCd" value="'21'"/>
									                               </include>) /* FC_CM_GET_ETC_CD_NM('0499', '21') - MySql Include로 구현*/                                                                                                              
			                                                   <![CDATA[     
			                                                  WHEN INSTR(AA.INVOICE_NO, '&') > 0 
			                                                  ]]>
			                                                  THEN 
		                                                           (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
									                                   <property name="clasCd" value="'0499'"/>
									                                   <property name="dtlCd" value="'20'"/>
									                               </include>) /* FC_CM_GET_ETC_CD_NM('0499', '20') - MySql Include로 구현*/                                                                                         
			                                                  WHEN IFNULL(AA.BL_IMG_YN, 'N') = 'N' AND AA.ATTACH_FILE IS NULL 
			                                                  THEN 
			                                                       (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
									                                   <property name="clasCd" value="'0499'"/>
									                                   <property name="dtlCd" value="'18'"/>
								                                   </include>) /* FC_CM_GET_ETC_CD_NM('0499', '18') - MySql Include로 구현*/                                                                                                            
			                                                  WHEN AA.BILLING_REGION_CODE IS NULL 
			                                                  THEN 
	                                                               (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
							                                             <property name="clasCd" value="'0499'"/>
							                                             <property name="dtlCd" value="'17'"/>
					                                               </include>) /* FC_CM_GET_ETC_CD_NM('0499', '17') - MySql Include로 구현*/                                                                                        
			                                                  WHEN AA.AIRLINE_CODE IS NULL 
			                                                  THEN 
			                                                     (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
									                                 <property name="clasCd" value="'0499'"/>
									                                 <property name="dtlCd" value="'15'"/>
									                             </include>) /* FC_CM_GET_ETC_CD_NM('0499', '15') - MySql Include로 구현*/
							                                  <![CDATA[                                                                                                              
			                                                  WHEN AA.SELL_CWT <= 0
			                                                  ]]> 
			                                                  THEN 
			                                                     (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
									                                  <property name="clasCd" value="'0499'"/>
									                                  <property name="dtlCd" value="'10'"/>
									                              </include>) /* FC_CM_GET_ETC_CD_NM('0499', '10') - MySql Include로 구현*/                                                                                      
			                                                  <![CDATA[
			                                                  WHEN AA.PKG_QTY <= 0 
			                                                  ]]>
			                                                  THEN 
			                                                     (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
									                                  <property name="clasCd" value="'0499'"/>
									                                  <property name="dtlCd" value="'8'"/>
									                              </include>) /* FC_CM_GET_ETC_CD_NM('0499', '8') - MySql Include로 구현*/                                                                                        
			                                                  WHEN AA.HUB_BILG_YN != 'Y' AND AA.CST_OBU_CD IS NULL 
			                                                  THEN 
			                                                     (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
									                                  <property name="clasCd" value="'0499'"/>
									                                  <property name="dtlCd" value="'16'"/>
									                              </include>) /* FC_CM_GET_ETC_CD_NM('0499', '16') - MySql Include로 구현*/                                                                                     
			                                                  /*2020.10.21 김정숙 [CSR ID:4273084] [인니/태국] LG전자 수입 PreBL 기능 보완 요청 | [요청번호]C20200722_73084   */                                                                                     
			                                                  /*2021.02.17 이아름 [CSR ID:4349890] [LG전자] 중계건에 대한 PreBL 전송 기능 개선*/                                                                                     
			                                                  WHEN AA.EXCT_BIZPTNR_CD = 'C100' AND NOT EXISTS (SELECT 1                                                                                         
			                                                                                                     FROM TB_SMT_INTG_TASK_DEPT T1,                                                             
			                                                                                                          TB_FWD_BL T2                                                              
			                                                                                                    WHERE T1.CST_BL_ID = T2.BL_ID                                                                                           
			                                                                                                      AND T2.BL_ID IN (SELECT T.BL_ID                                                                                           
			                                                                                                                         FROM TB_FWD_BL T                                                                                                               
			                                                                                                                        WHERE T.BL_NO = AA.BL_NO)                                                                                                                                                                                               
			                                                                                                      AND T1.EXCT_BIZPTNR_CD = 'A100'                                                                                           
			                                                                                                      AND ((T1.TASK_SPR_CD = 'TRD' AND T2.BL_SWITCH_YN = 'Y')                                                                                           
			                                                                                                           OR                                                                                           
			                                                                                                           (T1.TASK_SPR_CD = 'ADJ'))) AND (SELECT OUTR_CD2                                                                                          
			                                                                                                                                             FROM TB_COM_CD_MPNG                                                
			                                                                                                                                            WHERE CD_MPNG_SPR_NM = 'GERP_DIVISION_PREBL_CODE'                                                   
			                                                                                                                                              AND SYS_TYPE_CD ='FW'                                                                                                                 
			                                                                                                                                              AND INSD_CD2 ='C100'                                                                                                                  
			                                                                                                                                              AND INSD_CD = AA.CNEE_CD                                                                                                                  
			                                                                                                                                              AND INSD_CD3= AA.CST_OBU_CD                                                                                                               
			                                                                                                                                              AND USE_YN = 'Y') IS NULL 
                                                              THEN 
                                                                    (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
										                                 <property name="clasCd" value="'0499'"/>
										                                 <property name="dtlCd" value="'24'"/>
										                             </include>) /* FC_CM_GET_ETC_CD_NM('0499', '24') - MySql Include로 구현*/                                                                                                              
			                                                  WHEN AA.PO_NO IS NULL AND AA.HUB_BILG_YN != 'Y' AND AA.NCV_YN != 'Y' 
			                                                  THEN 
			                                                         (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
										                                  <property name="clasCd" value="'0499'"/>
										                                  <property name="dtlCd" value="'12'"/>
										                              </include>) /* FC_CM_GET_ETC_CD_NM('0499', '12') - MySql Include로 구현*/                                                                                       
			                                                  WHEN AA.PO_NO IS NULL AND AA.HUB_BILG_YN != 'Y' AND AA.NCV_YN = 'Y' AND (AA.CST_OBU_CD IS NULL OR AA.INVC_CUR_CD IS NULL)                                                                                      
                                                              THEN 
                                                                    (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
										                                  <property name="clasCd" value="'0499'"/>
										                                  <property name="dtlCd" value="'11'"/>
										                              </include>) /* FC_CM_GET_ETC_CD_NM('0499', '11') - MySql Include로 구현*/           
			                                                  ELSE 
                                                                    (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
										                                  <property name="clasCd" value="'0499'"/>
										                                  <property name="dtlCd" value="'0'"/>
										                              </include>) /* FC_CM_GET_ETC_CD_NM('0499', '0') - MySql Include로 구현*/                                                                                             
			                                                  END                                                                                       
			             WHEN AA.EXCT_SPR_CD = 'OC' 
			             THEN   
			                    <![CDATA[                                                                                                             
			                    CASE WHEN INSTR(AA.PO_NO, '&') > 0 
			                    ]]> 
			                         THEN                                                                                                                 
                                          (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
			                                  <property name="clasCd" value="'0499'"/>
			                                  <property name="dtlCd" value="'21'"/>
			                              </include>) /* FC_CM_GET_ETC_CD_NM('0499', '21') - MySql Include로 구현*/  
                                     <![CDATA[                                                                                                                  
			                         WHEN INSTR(AA.INVOICE_NO, '&') > 0 
			                         ]]> 
			                         THEN                                                                                                                
		                                  (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                                              <property name="clasCd" value="'0499'"/>
                                              <property name="dtlCd" value="'20'"/>
                                          </include>) /* FC_CM_GET_ETC_CD_NM('0499', '20') - MySql Include로 구현*/                                                                                                                                              
			                          WHEN IFNULL(AA.BL_IMG_YN, 'N') = 'N' AND AA.ATTACH_FILE IS NULL 
			                          THEN                                                                                                                 
		                                   (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                                              <property name="clasCd" value="'0499'"/>
                                              <property name="dtlCd" value="'18'"/>
                                          </include>) /* FC_CM_GET_ETC_CD_NM('0499', '18') - MySql Include로 구현*/                                                                                                      
			                          WHEN AA.CST_OBU_CD IS NULL AND AA.HUB_BILG_YN != 'Y'  
			                          THEN                                                                                                                
			                               (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                                              <property name="clasCd" value="'0499'"/>
                                              <property name="dtlCd" value="'16'"/>
                                          </include>) /* FC_CM_GET_ETC_CD_NM('0499', '16') - MySql Include로 구현*/                                                                                                                
			                          /*2020.10.21 김정숙 [CSR ID:4273084] [인니/태국] LG전자 수입 PreBL 기능 보완 요청 | [요청번호]C20200722_73084  */                                                                                                              
			                          /*2021.02.17 이아름 [CSR ID:4349890] [LG전자] 중계건에 대한 PreBL 전송 기능 개선*/                                                                                                             
			                          WHEN  AA.EXCT_BIZPTNR_CD = 'C100' AND NOT EXISTS (SELECT 1                                                                                                                
			                                                                              FROM TB_SMT_INTG_TASK_DEPT T1,                                                                
			                                                                                   TB_FWD_BL T2                                                             
			                                                                             WHERE T1.CST_BL_ID = T2.BL_ID                                                                                          
			                                                                               AND T2.BL_ID IN (SELECT T.BL_ID                                                                                          
			                                                                                                  FROM TB_FWD_BL T                                                                                                              
			                                                                                                 WHERE T.BL_NO = AA.BL_NO)                                                                                                              
			                                                                               AND T1.EXCT_BIZPTNR_CD = 'A100'                                                                                          
			                                                                               AND ((T1.TASK_SPR_CD = 'TRD' AND T2.BL_SWITCH_YN = 'Y')                                                                                          
			                                                                                    OR                                                                                          
			                                                                                    (T1.TASK_SPR_CD = 'ADJ'))) AND (SELECT OUTR_CD2                                                                                         
			                                                                                                                      FROM TB_COM_CD_MPNG                                                                                           
			                                                                                                                     WHERE CD_MPNG_SPR_NM  = 'GERP_DIVISION_PREBL_CODE'                                                                                             
			                                                                                                                       AND SYS_TYPE_CD ='FW'                                                                                                                
			                                                                                                                       AND INSD_CD2 ='C100'                                                                                                                 
			                                                                                                                       AND INSD_CD = AA.CNEE_CD                                                                                                                 
			                                                                                                                       AND INSD_CD3= AA.CST_OBU_CD                                                                                                              
			                                                                                                                       AND USE_YN = 'Y') IS NULL 
                                      THEN 
                                           (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                                              <property name="clasCd" value="'0499'"/>
                                              <property name="dtlCd" value="'24'"/>
                                          </include>) /* FC_CM_GET_ETC_CD_NM('0499', '24') - MySql Include로 구현*/ 
                                      <![CDATA[                                                                                                                                                                     
			                          WHEN AA.HUB_BILG_YN != 'Y' AND AA.PKG_QTY <= 0 AND AA.LADG_TYPE_CD = 'B'  
			                          ]]> 
			                          THEN                                                                                                                
			                               (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                                              <property name="clasCd" value="'0499'"/>
                                              <property name="dtlCd" value="'8'"/>
                                          </include>) /* FC_CM_GET_ETC_CD_NM('0499', '8') - MySql Include로 구현*/  
                                      <![CDATA[                                                                                                                 
			                          WHEN AA.SELL_CBM <= 0  AND AA.HUB_BILG_YN != 'Y' 
			                          ]]> 
			                          THEN                                                                                                                 
			                               (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                                              <property name="clasCd" value="'0499'"/>
                                              <property name="dtlCd" value="'22'"/>
                                          </include>) /* FC_CM_GET_ETC_CD_NM('0499', '22') - MySql Include로 구현*/                                                                                                                
			                          WHEN AA.HUB_BILG_YN != 'Y' AND AA.NCV_YN != 'Y' AND AA.PO_NO IS NULL AND AA.LC_NO IS NULL 
			                          THEN /* po is null (or->and로 수정) lc is null */                                                                                                                  
			                               (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                                              <property name="clasCd" value="'0499'"/>
                                              <property name="dtlCd" value="'14'"/>
                                          </include>) /* FC_CM_GET_ETC_CD_NM('0499', '14') - MySql Include로 구현*/                                                                                                                                        
			                          WHEN AA.HUB_BILG_YN != 'Y' AND AA.PO_NO IS NULL AND AA.LC_NO IS NULL AND AA.NCV_YN = 'Y' 
			                          THEN                                                                                                             
			                               CASE WHEN AA.CST_SHPP_CD IS NULL OR AA.CST_OBU_CD IS NULL OR AA.INVC_CUR_CD IS NULL 
				                                THEN                                                                                                             
	                                                (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
			                                             <property name="clasCd" value="'0499'"/>
			                                             <property name="dtlCd" value="'23'"/>
			                                         </include>) /* FC_CM_GET_ETC_CD_NM('0499', '23') - MySql Include로 구현*/                                                                                                                
                                                ELSE                                                                                                                
	                                                (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
			                                              <property name="clasCd" value="'0499'"/>
			                                              <property name="dtlCd" value="'0'"/>
			                                          </include>) /* FC_CM_GET_ETC_CD_NM('0499', '0') - MySql Include로 구현*/                                                                                                                 
			                               END                                                                                                              
			                          ELSE                                                                                                              
			                               (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                                              <property name="clasCd" value="'0499'"/>
                                              <property name="dtlCd" value="'0'"/>
                                          </include>) /* PJS:: FC_CM_GET_ETC_CD_NM('0499', '0') - MySql Include로 구현*/                                                                                                                 
			                          END                                                                                                               
			                WHEN AA.EXCT_SPR_CD = 'EX' THEN                                                                                                                 
			                    CASE WHEN AA.PIC_MAIL IS NULL 
			                         THEN                                                                                                              
                                          (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                                              <property name="clasCd" value="'0499'"/>
                                              <property name="dtlCd" value="'19'"/>
                                          </include>) /* FC_CM_GET_ETC_CD_NM('0499', '19') - MySql Include로 구현*/                                                                                                              
				                     WHEN IFNULL(AA.BL_IMG_YN, 'N') = 'N'  AND AA.ATTACH_FILE IS NULL 
				                     THEN                                                                                                                 
		                                  (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                                              <property name="clasCd" value="'0499'"/>
                                              <property name="dtlCd" value="'18'"/>
                                          </include>) /* FC_CM_GET_ETC_CD_NM('0499', '18') - MySql Include로 구현*/                                                                                                                
				                     WHEN AA.CST_OBU_CD IS NULL 
				                     THEN                                                                                                                
		                                  (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                                              <property name="clasCd" value="'0499'"/>
                                              <property name="dtlCd" value="'16'"/>
                                          </include>) /* FC_CM_GET_ETC_CD_NM('0499', '16') - MySql Include로 구현*/                                                                                                                                                                
				                     WHEN AA.AIRLINE_CODE IS NULL 
				                     THEN                                                                                                              
		                                  (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                                              <property name="clasCd" value="'0499'"/>
                                              <property name="dtlCd" value="'15'"/>
                                          </include>) /* FC_CM_GET_ETC_CD_NM('0499', '15') - MySql Include로 구현*/  
                                     <![CDATA[                                                                                                                
				                     WHEN AA.SELL_CWT <= 0 
				                     ]]> 
				                     THEN                                                                                                                 
		                                  (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                                              <property name="clasCd" value="'0499'"/>
                                              <property name="dtlCd" value="'10'"/>
                                          </include>) /* FC_CM_GET_ETC_CD_NM('0499', '10') - MySql Include로 구현*/      
                                     <![CDATA[                                                                                                              
				                     WHEN AA.PKG_QTY <= 0 
				                     ]]> 
				                     THEN                                                                                                              
		                                  (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                                              <property name="clasCd" value="'0499'"/>
                                              <property name="dtlCd" value="'8'"/>
                                          </include>) /* FC_CM_GET_ETC_CD_NM('0499', '8') - MySql Include로 구현*/                                                                                                                 
				                     ELSE                                                                                                               
		                                  (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                                              <property name="clasCd" value="'0499'"/>
                                              <property name="dtlCd" value="'0'"/>
                                          </include>) /* FC_CM_GET_ETC_CD_NM('0499', '0') - MySql Include로 구현*/                                                                                                                 
			                     END                                                                                                                    
			         END     
			      END AS STAT_NM                                                                                                                           
			     , AA.BL_ID                                                                                                             
			     , AA.BL_NO                                                                                                             
			     , AA.RESULT_CD                                                                                                             
			     , AA.RESULT_NM                                                                                                             
			     , AA.RESULT_MSG                                                                                                                
			     , AA.IMG_YN                                                                                                                
			     , AA.IMG_DT                                                                                                                
			     , AA.ARR_YMD /* 입항일자 */                                                                                                                
			     , AA.ONBR_YMD /* 출항일자 */                                                                                                               
			     , AA.BILLING_REGION_CODE                                                                                                                   
			     , AA.CST_OBU_CD                                                                                                                
			     , AA.PO_NO                                                                                                             
			     , AA.NCV_YN                                                                                                                
			     , AA.INVOICE_NO                                                                                                                
			     , AA.INVC_DT                                                                                                               
			     , AA.INVC_CUR_CD                                                                                                               
			     , AA.INVC_AMT                                                                                                              
			     , AA.CUR_CD                                                                                                                
			     , AA.HUB_BILG_YN                                                                                                               
			     , AA.FRT_CURR_CD                                                                                                               
			     , AA.FRT_AMT                                                                                                               
			     , AA.BL_IMG_YN                                                                                                             
			     , AA.CI_IMG_YN                                                                                                             
			     , AA.PL_IMG_YN                                                                                                             
			     , AA.CIPL_IMG_YN                                                                                                               
			     , AA.NTPR_CD                                                                                                               
			     , AA.NTPR_NM                                                                                                               
			     , AA.CNEE_CD                                                                                                               
			     , AA.CNEE_NM                                                                                                               
			     , AA.LC_NO                                                                                                             
			     , AA.TT_LC_TYPE_CD                                                                                                                 
			     , AA.LG_USER                                                                                                               
			     , AA.PIC_MAIL                                                                                                              
			     , AA.CST_SHPP_CD                                                                                                               
			     , AA.CST_SHPP_NM                                                                                                               
			     , AA.LGE_POL                                                                                                               
			     , AA.POL_CD                                                                                                                
			     , AA.POD_CD                                                                                                                
			     , AA.MBL_NO                                                                                                                
			     , AA.PKG_QTY                                                                                                               
			     , AA.SELL_CBM                                                                                                              
			     , AA.SELL_GWT                                                                                                              
			     , AA.SELL_CWT                                                                                                              
			     , AA.FLT_VSL_NM                                                                                                                
			     , AA.INCOT_CD                                                                                                              
			     , AA.CARGO_TYPE                                                                                                                
			     , AA.EXCT_SPR_CD                                                                                                               
			     , AA.ASGN_PLC_CD                                                                                                               
			     , AA.ASGN_PLC_NM                                                                                                               
			     , AA.SEND_PROCESS                                                                                                              
			     , AA.SEND_MSG                                                                                                              
			     , AA.FRGTTERM_CD                                                                                                               
			     , AA.INTG_TASK_NO                                                                                                              
			     , AA.MBL_ID                                                                                                                
			     , AA.MBL_INTG_TASK_NO                                                                                                              
			     , AA.EO_NO                                                                                                                 
			     , AA.SMT_NO                                                                                                                 
			     , AA.AIRLINE_CODE                                                                                                              
			     , '' AS IMG                                                                                                               
			     , AA.ATTACH_FILE                                                                                                               
			     , AA.LADG_TYPE_CD                                                                                                              
			     , AA.LADG_TYPE_NM                                                                                                              
			     , AA.SEND_YN                                                                                                               
			     , AA.LAST_SEND_YMD                                                                                                             
			     , AA.EXCT_BIZPTNR_CD AS CORP_CD                                                                                                                
			     , AA.AUTO_SEND_YN                                                                                                                  
			     /* start [CSR ID:4349890] [LG전자] 중계건에 대한 PreBL 전송 기능 개선 */                                                                                                             
			     , AA.TASK_SPR_CD                                                                                                               
			     , AA.AFFILIATE_CODE                                                                                                                
			     , AA.FREIGHT_CURRENCY_CODE                                                                                                             
			     , AA.C_GUBUN                                                                                                               
			     /* end [CSR ID:4349890] [LG전자] 중계건에 대한 PreBL 전송 기능 개선 */    
			     /*{#PREBL_AUTO}*/
			     <if test='autoSendYn == "Y" and autoSendYnNa == "US"'>
	               , 'PREBLAT' AS RSTR_ID 
                 </if>
			FROM (SELECT                                                                                                                
			          A.BL_ID /* Bl Id */                                                                                                               
			          , '' AS REVN_RCGN_CD /*[TODO] PJS:: ISM으로부터 제공 받아야 하는 Fuction이다. FC_IS_GET_SALES_RCGN(A.SO_NO, '', 'FLAG') AS REVN_RCGN_CD*/                                                                                                                
			          , '' AS REVN_RCGN_IMG /*[TODO] PJS:: ISM으로부터 제공 받아야 하는 Fuction이다.FC_IS_GET_SALES_RCGN(A.SO_NO, '', '') AS  REVN_RCGN_IMG */                                                                                                             
			          , E.ORD_TYPE_CD                                                                                                               
			          , A.BL_NO /* BL NO */                                                                                                             
			          , (<include refid="fwd.common.fwdFuncInclude.fwdFcFwB2biGetCode">
                             <property name="tag" value="'GERP_IN_PRE_RESULT'"/>
                             <property name="param1" value="'RESULT_CD'"/>
                             <property name="param2" value="A.BL_NO"/>
                             <property name="param3" value="NULL"/>
                             <property name="param4" value="NULL"/>
                         </include>) AS RESULT_CD /* Mybatis Include로 구현. FC_FW_B2BI_GET_CODE('GERP_IN_PRE_RESULT', 'RESULT_CD',  A.BL_NO, '', '')    AS RESULT_CD */
			          ,  CASE
			                 WHEN (<include refid="fwd.common.fwdFuncInclude.fwdFcFwB2biGetCode">
		                             <property name="tag" value="'GERP_IN_PRE_RESULT'"/>
		                             <property name="param1" value="'RESULT_CD'"/>
		                             <property name="param2" value="A.BL_NO"/>
		                             <property name="param3" value="NULL"/>
		                             <property name="param4" value="NULL"/>
                                   </include>) = 'Y'    /* PJS:: Mybatis Include로 구현. FC_FW_B2BI_GET_CODE('GERP_IN_PRE_RESULT', 'RESULT_CD', A.BL_NO, '', '')*/
			                 THEN 'SEND COMPLETE'
			                 WHEN (<include refid="fwd.common.fwdFuncInclude.fwdFcFwB2biGetCode">
                                     <property name="tag" value="'GERP_IN_PRE_RESULT'"/>
                                     <property name="param1" value="'RESULT_CD'"/>
                                     <property name="param2" value="A.BL_NO"/>
                                     <property name="param3" value="NULL"/>
                                     <property name="param4" value="NULL"/>
                                   </include>) = 'E'    /* PJS:: Mybatis Include로 구현. FC_FW_B2BI_GET_CODE('GERP_IN_PRE_RESULT', 'RESULT_CD', A.BL_NO, '', '')*/
			                 THEN 'SEND ERROR'
			             END AS RESULT_NM      
			          , SUBSTR(
			                     (<include refid="fwd.common.fwdFuncInclude.fwdFcFwB2biGetCode">
                                     <property name="tag" value="'GERP_IN_PRE_RESULT'"/>
                                     <property name="param1" value="'RESULT_MSG'"/>
                                     <property name="param2" value="A.BL_NO"/>
                                     <property name="param3" value="NULL"/>
                                     <property name="param4" value="NULL"/>
                                   </include>)  /* PJS:: Mybatis Include로 구현. FC_FW_B2BI_GET_CODE('GERP_IN_PRE_RESULT', 'RESULT_MSG', A.BL_NO, '', '')*/
                               ,1,255) AS RESULT_MSG                                                                                                             
			          , (<include refid="fwd.common.fwdFuncInclude.fwdFcFwB2biGetCode">
                           <property name="tag" value="'EDMS_IMG'"/>
                           <property name="param1" value="'PREBL_ATT_YN'"/>
                           <property name="param2" value="A.BL_NO"/>
                           <property name="param3" value="NULL"/>
                           <property name="param4" value="NULL"/>
                         </include>) AS IMG_YN /* PJS:: Mybatis Include로 구현. FC_FW_B2BI_GET_CODE('EDMS_IMG', 'PREBL_ATT_YN', A.BL_NO, '', '') AS IMG_YN*/                                                                                                             
			          , (<include refid="fwd.common.fwdFuncInclude.fwdFcFwB2biGetCode">
                           <property name="tag" value="'EDMS_IMG'"/>
                           <property name="param1" value="'PREBL_ATT_DT'"/>
                           <property name="param2" value="A.BL_NO"/>
                           <property name="param3" value="NULL"/>
                           <property name="param4" value="NULL"/>
                         </include>) AS IMG_DT /*PJS:: FC_FW_B2BI_GET_CODE('EDMS_IMG', 'PREBL_ATT_DT', A.BL_NO, '', '') AS IMG_DT*/                                                                                                              
			          , A.ARR_YMD  /* 입항일자 */                                                                                                               
			          , A.ONBR_YMD /* 출항일자 */                                                                                                               
			          , CASE  WHEN D.EXCT_BIZPTNR_CD ='F100' OR D.EXCT_BIZPTNR_CD ='E700' THEN ' ' /*2021.09.08 : LGE PRE BL 법인 확장 러시아 브라질  RITM0140802 안영수*/                                                                                                               
			                  WHEN D.EXCT_BIZPTNR_CD='C100' AND NOT EXISTS (SELECT 1                                                                                                                
			                                                                 FROM TB_SMT_INTG_TASK_DEPT T1,                                                                     
			                                                                      TB_FWD_BL T2                                                              
			                                                                WHERE T1.CST_BL_ID = T2.BL_ID                                                                                           
			                                                                  AND T2.BL_ID IN (SELECT T.BL_ID                                                                                           
			                                                                                     FROM TB_FWD_BL T                                                                                                               
			                                                                                    WHERE T.BL_NO = A.BL_NO)                                                                                                                
			                                                                  AND T1.EXCT_BIZPTNR_CD = 'A100'                                                                                           
			                                                                  AND ((T1.TASK_SPR_CD = 'TRD' AND T2.BL_SWITCH_YN = 'Y')                                                                                           
			                                                                       OR                                                                                           
			                                                                       (T1.TASK_SPR_CD = 'ADJ'))) THEN (SELECT OUTR_CD2                                                                                             
			                                                                                                          FROM TB_COM_CD_MPNG                                                                                                               
			                                                                                                         WHERE CD_MPNG_SPR_NM = 'GERP_DIVISION_PREBL_CODE'                                                                                                                  
			                                                                                                           AND SYS_TYPE_CD = 'FW'                                                                                                               
			                                                                                                           AND INSD_CD2 = 'C100'                                                                                                                
			                                                                                                           AND INSD_CD = A.CNEE_CD                                                                                                                  
			                                                                                                           AND INSD_CD3 = B.CST_OBU_CD                                                                                                              
			                                                                                                           AND USE_YN = 'Y'                                                                                                             
			                                                                                                           LIMIT 1) /*인니향 직선적*/                                                                                                                     
			                 /* LG마그나 법인일 경우 법인코드 세팅 */                                                                                                 
			                 WHEN IFNULL(I.BIZPTNR_GRP_CD,'XXXX') = '1006001' THEN (SELECT INSD_CD                                                                                                             
			                                                        FROM TB_COM_CD_MPNG                                                                                                             
			                                                        WHERE CD_MPNG_SPR_NM = 'GERP_MAPP_CODE'                                                                                                             
			                                                        AND OUTR_CD ='08'                                                                                                               
			                                                        LIMIT 1)                                                                                                                                    
			                 ELSE CASE WHEN A.EXCT_SPR_CD IN ('OC','AR') AND IFNULL(A.HUB_BILG_YN,'N')='Y'                                                                                                              
			                           THEN /*FC_CM_GET_EDI_NM2('PKE_EDI코드', '75', A.NTPR_CD ,'') - SubQuery로 처리*/                                                                                                      
			                               (SELECT OUTR_CD                                                                                                  
			                                  FROM   TB_COM_CD_MPNG                                                                                         
			                                  WHERE  UPPR_CD_MPNG_NO = '75'                                                                                         
			                                  AND    INSD_CD = A.NTPR_CD                                                                                            
			                                  AND    USE_YN = 'Y'                                                                                           
			                                  LIMIT 1)                                                                                          
			                           ELSE ( SELECT INSD_CD                                                                                                                
			                                    FROM TB_COM_CD_MPNG                                                                                                                 
			                                   WHERE CD_MPNG_SPR_NM='GERP_DIVISION_CODE'                                                                                                                
			                                    AND OUTR_CD = B.CST_OBU_CD                                                                                                              
			                                    AND SYS_TYPE_CD = 'FW'                                                                                                              
			                                    AND USE_YN = 'Y'                                                                                                                
			                                    LIMIT 1)                                                                                                                
			                       END                                                                                                              
			            END AS BILLING_REGION_CODE /*2020.10.21 김정숙 [CSR ID:4273084] [인니/태국] LG전자 수입 PreBL 기능 보완 요청 | [요청번호]C20200722_73084 */                                                                                                              
			                                       /*2021.02.09 이아름 [CSR ID:4349890] [LG전자] 중계건에 대한 PreBL 전송 기능 개선 */                                                                                                               
			          ,(CASE                                                                                                                
			                WHEN D.EXCT_BIZPTNR_CD = 'F100'                                                                                                     
			                THEN ' '                                                                                                        
			                WHEN D.EXCT_BIZPTNR_CD = 'E700'                                                                                                     
			                THEN ' '                                                                                                        
			                ELSE B.CST_OBU_CD                                                                                                       
			           END) AS CST_OBU_CD   /* 고객OBU코드 */   /*2021.09.08 : LGE PRE BL 법인 확장 러시아 브라질  RITM0140802 안영수*/                                                                                                              
			          ,(SELECT S.REF_NO                                                                                                             
			            FROM   TB_FWD_INTG_REF_NO S                                                                                                             
			            WHERE  1=1                                                                                                              
			            AND    S.INTG_KEY_ID = A.BL_ID                                                                                                              
			            AND    S.DEL_YN = 'N'                                                                                                               
			            AND    S.REF_NO_SPR_CD = 'PO'                                                                                                               
			            LIMIT  1)  AS PO_NO                                                                                                             
			          , A.NCV_YN       /* 무환화물여부 */                                                                                                                             
			          ,(SELECT S.REF_NO                                                                                                             
			            FROM   TB_FWD_INTG_REF_NO S                                                                                                             
			            WHERE  1=1                                                                                                              
			            AND    S.INTG_KEY_ID = A.BL_ID                                                                                                              
			            AND    S.DEL_YN = 'N'                                                                                                               
			            AND    S.REF_NO_SPR_CD = 'IN'                                                                                                               
			            LIMIT  1) AS  INVOICE_NO                                                                                                                
			          , '' AS INVC_DT /* 확인필요 */                                                                                                                
			          , A.INVC_CUR_CD  /* 상업송장통화코드 */                                                                                                                       
			          , A.INVC_AMT     /* 상업송장금액 */                                                                                                                 
			          , A.CUR_CD                                                                                                                        
			          , IFNULL(A.HUB_BILG_YN, 'N') AS HUB_BILG_YN  /* 허브청구여부 */                                                                                                                         
			          , A.CUR_CD AS FRT_CURR_CD  /* 확인필요 */                                                                                                             
			          , CASE 
			                 WHEN A.EXCT_SPR_CD = 'OC'
			                 THEN IF(IFNULL(A.HUB_BILG_YN,'N') = 'Y', NULL, (SELECT  SUM(S.CTRT_FRGH_AMT)                                                                                                              
                                                                                               FROM    TB_ISM_SELLBUY S                                                                                                         
                                                                                               WHERE   S.BL_ID = A.BL_ID                                                                                                            
                                                                                               AND     S.ADJ_YN = 'Y'                                                                                                           
                                                                                               AND     S.SELLBUY_SPR_CD = 'SO'                                                                                                          
                                                                                               AND     S.DOM_ABRD_BIZPTNR_TYPE_CD = '1' /* 국내거래처 */                                                                                                         
                                                                                               AND     S.ADJ_CONF_SPR_CD NOT IN ('05')  /* 전표 미생성분만 가능 01:TEMP 02:CREATION 03:CHECK 04:INVOICE 05:SLIP */                                                                                                           
                                                                                               AND     S.ADJ_STN_TYPE_CD IN ('01','02')                                                                                                         
                                                                                               AND     S.CTRT_CUR_CD = 'USD'                                                                                                            
                                                                                               AND     S.DEL_YN = 'N'                                                                                                           
                                                                                               AND     S.EXPIMP_SPR_CD = 'I'                                                                                                            
                                                                                               AND     S.OFFSET_SMT_NO1 IS NULL))
                             WHEN A.EXCT_SPR_CD = 'AR' 
                             THEN IF(IFNULL(A.HUB_BILG_YN,'N') = 'Y', NULL, (SELECT  SUM(IF(S.CTRT_CUR_CD = A.CUR_CD, S.CTRT_FRGH_AMT, 0))                                                                                                                
                                                                                           FROM    TB_ISM_SELLBUY S                                                                                                             
                                                                                           WHERE   S.BL_ID = A.BL_ID                                                                                                                
                                                                                           AND     S.SELLBUY_SPR_CD = 'SO'                                                                                                              
                                                                                           AND     S.DOM_ABRD_BIZPTNR_TYPE_CD = '1'                                                                                                             
                                                                                           AND     S.ADJ_STN_TYPE_CD = '01'                                                                                                             
                                                                                           AND     S.EXPIMP_SPR_CD = 'I'                                                                                                                
                                                                                           AND     S.DEL_YN = 'N'))
                                                                                           
                        END AS FRT_AMT                                               
			            /* [TODO] VW_ED_STATUS_01 Table이 현재 없음*/                                                                                                    
			            /*  (SELECT IF(COUNT(*) = 0,'N','Y')                                                                                                
			                FROM   VW_ED_STATUS_01 X                                                                                                            
			                WHERE  X.BL_ID = A.BL_ID                                                                                                            
			                AND    X.BL_NO = A.BL_NO                                                                                                        
			                AND    X.SO_NO = A.SO_NO                                                                                                            
			                AND    X.EO_NO = A.EO_NO                                                                                                            
			                AND    X.DOC_TYPE = (CASE                                                                                                           
			                                        WHEN A.EXCT_SPR_CD = 'AR'                                                                               
			                                        THEN '48'                                                                               
			                                        WHEN A.EXCT_SPR_CD = 'OC'                                                                               
			                                        THEN '04'                                                                               
			                                 END )) AS BL_IMG_YN*/                                                                                      
			          , 'N' AS BL_IMG_YN                                                                                                            
			          /* [TODO] VW_ED_STATUS_01 Table이 현재 없음 */                                                                                                             
			          /*    (SELECT IF(COUNT(*) = 0,'N','Y')                                                                                                            
			                 FROM   VW_ED_STATUS_01 X                                                                                                               
			                 WHERE  X.BL_ID = A.BL_ID                                                                                                               
			                 AND    X.BL_NO = A.BL_NO                                                                                                               
			                 AND    X.SO_NO = A.SO_NO                                                                                                               
			                 AND    X.EO_NO = A.EO_NO                                                                                                               
			                 AND    X.DOC_TYPE = '08') AS CI_IMG_YN*/                                                                                                               
			          , 'N' AS CI_IMG_YN                                                                                                            
			          /* [TODO] VW_ED_STATUS_01 Table이 현재 없음 */                                                                                                         
			          /*    (SELECT IF(COUNT(*) = 0,'N','Y')                                                                                                    
			                 FROM   VW_ED_STATUS_01 X                                                                                                               
			                 WHERE  X.BL_ID = A.BL_ID                                                                                                               
			                 AND    X.BL_NO = A.BL_NO                                                                                                               
			                 AND    X.SO_NO = A.SO_NO                                                                                                               
			                 AND    X.EO_NO = A.EO_NO                                                                                                               
			                 AND    X.DOC_TYPE = '09') AS PL_IMG_YN*/                                                                                                               
			          , 'N' AS PL_IMG_YN                                                                                                            
			           /* [TODO] VW_ED_STATUS_01 Table이 현재 없음 */                                                                                                            
			           /*   (SELECT IF(COUNT(*) = 0,'N','Y')                                                                                                    
			                 FROM   VW_ED_STATUS_01 X                                                                                                               
			                 WHERE  X.BL_ID = A.BL_ID                                                                                                               
			                 AND    X.BL_NO = A.BL_NO                                                                                                               
			                 AND    X.SO_NO = A.SO_NO                                                                                                               
			                 AND    X.EO_NO = A.EO_NO                                                                                                               
			                 AND    X.DOC_TYPE = '31') AS CIPL_IMG_YN*/                                                                                                                             
			          , 'N' AS CIPL_IMG_YN                                                                                                                                                      
			          , A.NTPR_CD                                                                                                               
			          , A.NTPR_NM                                                                                                               
			          , A.CNEE_CD                                                                                                               
			          , A.CNEE_NM                                                                                                               
			          ,(SELECT S.REF_NO                                                                                                             
			            FROM   TB_FWD_INTG_REF_NO S                                                                                                             
			            WHERE  1=1                                                                                                              
			            AND    S.INTG_KEY_ID = A.BL_ID                                                                                                              
			            AND    S.DEL_YN = 'N'                                                                                                               
			            AND    S.REF_NO_SPR_CD = 'LC'                                                                                                               
			            LIMIT  1)  AS LC_NO                                                                                                             
			         , A.TT_LC_TYPE_CD                                                                                                              
			         , CASE                                                                                                             
			                WHEN A.EXCT_SPR_CD = 'OC'                                                                                                       
			                THEN IFNULL((SELECT S.BIZPTNR_OFCR_NM                                                                                                       
			                              FROM   TB_FWD_INTG_PIC S                                                                                                          
			                              WHERE  1=1                                                                                                            
			                              AND    S.INTG_KEY_ID = A.BL_ID                                                                                                            
			                              AND    S.DEL_YN = 'N'                                                                                                                     
			                              AND    S.OFCR_SPR_CD = '08'                                                                                                           
			                              LIMIT  1), /* ACTL NTFY */                                                                                                            
			                             (SELECT S.BIZPTNR_OFCR_NM                                                                                                          
			                              FROM   TB_FWD_INTG_PIC S                                                                                                                                  
			                              WHERE  1=1                                                                                                            
			                              AND    S.INTG_KEY_ID = A.BL_ID                                                                                                            
			                              AND    S.DEL_YN = 'N'                                                                                                                     
			                              AND    S.OFCR_SPR_CD = '09'                                                                                                           
			                              LIMIT  1)) /* NTFY */                                                                                                             
			                WHEN A.EXCT_SPR_CD = 'AR'                                                                                                           
			                THEN (SELECT S.BIZPTNR_OFCR_NM                                                                                                          
			                      FROM   TB_FWD_INTG_PIC S                                                                                                                                      
			                      WHERE  1=1                                                                                                                
			                      AND    S.INTG_KEY_ID = A.BL_ID                                                                                                                
			                      AND    S.DEL_YN = 'N'                                                                                                                         
			                      AND    S.OFCR_SPR_CD = '09'                                                                                                               
			                      LIMIT  1)                                                                                                             
			           END AS LG_USER                                                                                                               
			           , IF( A.EXCT_SPR_CD = 'EX',(SELECT S.EMAIL_ADDR                                                                                                              
			                                       FROM   TB_FWD_INTG_PIC S                                                                                                 
			                                       WHERE  1=1                                                                                                   
			                                       AND    S.INTG_KEY_ID = A.BL_ID                                                                                                   
			                                       AND    S.DEL_YN = 'N'                                                                                                    
			                                       AND    S.OFCR_SPR_CD = '07'                                                                                                  
			                                       LIMIT  1), '') AS PIC_MAIL                                                                                                  
			         , B.CST_SHPP_CD /* 고객송화주코드 */                                                                                                              
			         /*FC_CM_GET_BIZPTNR_NM2(B.CST_SHPP_CD, 'EF') - SubQuery 처리*/                                                                                                               
			         , (SELECT BIZPTNR_ENG_ACRN_NM                                                                                                              
			            FROM   TB_COM_BIZPTNR                                                                                                           
			            WHERE  BIZPTNR_CD = B.CST_SHPP_CD) AS CST_SHPP_NM                                                                                                           
			         /*FC_CM_MPNG_TRANSMIT('OM','01','PORT_CODE', A.POL_CD,'','', 1) - SubQuery로 처리*/                                                                                                               
			         , IFNULL( (SELECT OUTR_CD                                                                                                              
			                      FROM   TB_COM_CD_MPNG                                                                                                 
			                      WHERE  CD_TYPE_CD = 'C'                                     /*DETAIL 맵핑코드*/                                                                                                   
			                      AND    CD_MPNG_SPR_NM = 'PORT_CODE'                         /*맵핑구분*/                                                                                                  
			                      AND    SYS_TYPE_CD LIKE 'OM%'                       /*시스템 유형*/                                                                                                    
			                      AND    MPNG_DRCT_CD IN ('T', 'D')                           /*송신 (양뱡향 'RT' 추가)*/                                                                                                  
			                      AND    ('01' IS NULL OR RLT_BIZPTNR_CD = '01')       /*관계거래처코드*/                                                                                                  
			                      AND    INSD_CD = A.POL_CD                                                                                                 
			                      AND    ('' IS NULL OR INSD_CD2 = '')                                                                                                  
			                      AND    ('' IS NULL OR INSD_CD3 = '')                                                                                                  
			                      AND    USE_YN = 'Y'                                                                                                       
			                      LIMIT  1), '') AS LGE_POL                                                                                                 
			         , CASE                                                                                                                 
			                WHEN A.EXCT_SPR_CD = 'OC'                                                                                                       
			                THEN NULL                                                                                                       
			                WHEN A.EXCT_SPR_CD = 'AR'                                                                                                       
			                THEN (SELECT BB.BIZPTNR_GRP_ENG_ACRN_NM                                                                                                     
			                      FROM   TB_COM_BIZPTNR AA                                                                                                              
			                            ,TB_COM_BIZPTNR_GRP_CD BB                                                                                                               
			                      WHERE  AA.BIZPTNR_GRP_CD = BB.BIZPTNR_GRP_CD                                                                                                              
			                      AND    AA.BIZPTNR_CD = D.CARR_CD)                                                                                                             
			           END AS AIRLINE_CODE                                                                                                              
			         /* 특송 : 기본 4개 코드 이외의 코드는 항공(항공사약어)과 동일한 방식으로 추가, 이자영D 요청 2013-03-14, 운송사코드 추가 2204715 박해수C 요청 2014-02-05  */                                                                                                           
			         , A.POL_CD                                                                                                             
			         , A.POD_CD                                                                                                                 
			         , A.MBL_NO                                                                                                                 
			         , A.PKG_QTY                                                                                                                
			         , A.SELL_CBM                                                                                                               
			         , A.SELL_GWT                                                                                                               
			         , A.SELL_CWT                                                                                                               
			         , A.FLT_VSL_NM                                                                                                             
			         , A.INCOT_CD                                                                                                               
			         , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                            <property name="clasCd" value="'0077'"/>
                            <property name="dtlCd" value="A.CARGO_TYPE_CD"/>
                        </include>) AS CARGO_TYPE /* PJS:: FC_CM_GET_ETC_CD_NM('0077', A.CARGO_TYPE_CD) - MySql Include로 구현*/                                                                                                                 
			         , A.EXCT_SPR_CD                                                                                                                
			         , C.ASGN_PLC_CD /* 배정장소코드 */                                                                                                               
			         /*FC_CM_GET_LOC_NM(C.ASGN_PLC_CD,'LOC_NM') AS ASGN_PLC_NM -Subquery로 처리*/                                                                                                              
			         ,(SELECT IFNULL(IFNULL(LOC_NM, ENG_LOC_NM), LOC_CD)                                                                                                                
			           FROM   TB_COM_LOC                                                                                                            
			           WHERE  LOC_CD = TRIM(C.ASGN_PLC_CD)) AS ASGN_PLC_NM /* 배정장소명 */                                                                                                      
			         ,(SELECT CASE IF_STATUS_CODE WHEN 'R' THEN 'Ready'        /*--전송 대기 상태*/                                                                                                               
			                                       WHEN 'P' THEN 'Pending'      /*--EAI시스템에서 처리중인상황*/                                                                                                               
			                                       WHEN 'E' THEN 'Error'        /*--I/F 처리 중 에러발생*/                                                                                                             
			                                       WHEN 'D' THEN 'Done'         /*--외부파트너 전송성공*/                                                                                                                
			                                       ELSE          'None' END                                                                                                             
			            /*SELECT SUBSTRB(FC_FW_REPLACE('SA',MESSAGE),1,50)*/                                                                                                                
			            FROM NFINF.TB_EDI_MASTER_S                                                                                                              
			            WHERE INTERFACE_ID = (SELECT MAX(INTERFACE_ID)                                                                                                              
			                                  FROM NFINF.TB_FWD_INT109                                                                                                              
			                                  WHERE HOUSE_BL_NO = A.BL_NO                                                                                                               
			                                 )                                                                                                                                              
			             ) AS SEND_PROCESS /*--전송상태*/                                                                                                               
			         ,(SELECT MESSAGE                                                                                                               
			            FROM NFINF.TB_EDI_MASTER_S                                                                                                              
			            WHERE INTERFACE_ID = (SELECT MAX(INTERFACE_ID)                                                                                                              
			                                  FROM NFINF.TB_FWD_INT109                                                                                                              
			                                  WHERE HOUSE_BL_NO = A.BL_NO                                                                                                               
			                                 )                                                                                                                                              
			             ) AS SEND_MSG                                                                                                              
			         , A.FRGTTERM_CD                                                                                                                    
			         , D.INTG_TASK_NO                                                                                                               
			         , A.MBL_ID                                                                                                                 
			         , (SELECT BB.INTG_TASK_NO                                                                                                              
			            FROM TB_FWD_BL AA                                                                                                               
			               , TB_SMT_INTG_TASK_DEPT BB                                                                                                               
			            WHERE AA.BL_ID = A.MBL_ID                                                                                                               
			            AND AA.EO_NO = BB.EO_NO                                                                                                             
			            AND AA.BL_ID = BB.CST_BL_ID                                                                                                             
			            AND IFNULL(AA.DEL_YN, 'N') = 'N'                                                                                                                
			            AND IFNULL(BB.DEL_YN, 'N') = 'N'                                                                                                                
			            AND BB.TASK_SPR_CD = 'IMP'                                                                                                              
			            LIMIT 1) AS MBL_INTG_TASK_NO                                                                                                                
			         , A.SMT_NO                                                                                                             
			         , A.EO_NO                                                                                                                  
			         , (SELECT BLOB_FILE_NM FROM TB_FWD_PREBL_IMG WHERE BL_ID = A.BL_ID) AS ATTACH_FILE                                                                                                             
			         , A.LADG_TYPE_CD                                                                                                               
			         , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                            <property name="clasCd" value="'0036'"/>
                            <property name="dtlCd" value="A.LADG_TYPE_CD"/>
                        </include>) AS LADG_TYPE_NM /* PJS:: FC_CM_GET_ETC_CD_NM('0036', A.LADG_TYPE_CD) AS LADG_TYPE_NM - MySql Include로 구현*/                                                                                                                
			         , (SELECT IF(COUNT(1) = 0, 'N', 'Y')                                                                                                               
			            FROM NFINF.TB_FWD_INT109                                                                                                                
			            WHERE HOUSE_BL_NO       = A.BL_NO) AS SEND_YN                                                                                                               
			         , (SELECT MAX(DATE_FORMAT(NOW(), '%Y%m%d'))                                                                                                                            
			              FROM NFINF.TB_FWD_INT109                                                                                                              
			             WHERE HOUSE_BL_NO = A.BL_NO) AS LAST_SEND_YMD                                                                                                              
			         , D.EXCT_BIZPTNR_CD                                                                                                                
			         , #{autoSendYn2} AS AUTO_SEND_YN                                                                                                               
			         /* start [CSR ID:4349890] [LG전자] 중계건에 대한 PreBL 전송 기능 개선 */                                                                                                             
			         , CASE WHEN D.EXCT_BIZPTNR_CD='C100' THEN CASE WHEN EXISTS (SELECT 1                                                                                                               
			                                                                       FROM TB_SMT_INTG_TASK_DEPT T1,                                                               
			                                                                            TB_FWD_BL T2                                                                
			                                                                      WHERE T1.CST_BL_ID = T2.BL_ID                                                                                         
			                                                                        AND T2.BL_ID IN (SELECT T.BL_ID                                                                                                             
			                                                                                           FROM TB_FWD_BL T                                                                                                             
			                                                                                          WHERE T.BL_NO = A.BL_NO)                                                                                                                  
			                                                                        AND T1.EXCT_BIZPTNR_CD = 'A100'                                                                                         
			                                                                        AND ((T1.TASK_SPR_CD = 'TRD' AND T2.BL_SWITCH_YN = 'Y')                                                                                         
			                                                                             OR                                                                                         
			                                                                             (T1.TASK_SPR_CD = 'ADJ'))) THEN 'TRD or ADJ' /* 인니향 중계선적                                                                                           
			                                                                                                                          1.C100:IMP, A100:TRD, BL_SWITCH_YN='Y'                                                                                            
			                                                                                                                          2.C100:IMP, A100:ADJ */                                                                                                   
			                                                        ELSE 'IMP'  /*인니향 직선적*/                                                                                                 
			                                                   END                                                                                                  
			                ELSE 'NA' /*해당없음*/                                                                                                  
			            END AS TASK_SPR_CD                                                                                                  
			            /* 2021.09.08 : LGE PRE BL 법인 확장 러시아 브라질  RITM0140802 안영수  브라질은 ESSP, 러시아는 ERRA   */                                                                                                        
			         , CASE  WHEN D.EXCT_BIZPTNR_CD='F100' OR D.EXCT_BIZPTNR_CD='E700' THEN IF(D.EXCT_BIZPTNR_CD = 'F100','ERRA','ESSP')                                                                                                                
			                 WHEN D.EXCT_BIZPTNR_CD='C100' AND NOT EXISTS (SELECT 1                                                                                                                 
			                                                                FROM TB_SMT_INTG_TASK_DEPT T1,                                                                          
			                                                                     TB_FWD_BL T2                                                               
			                                                               WHERE T1.CST_BL_ID = T2.BL_ID                                                                                            
			                                                                 AND T2.BL_ID IN (SELECT T.BL_ID                                                                                                                
			                                                                                    FROM TB_FWD_BL T                                                                                                                
			                                                                                   WHERE T.BL_NO = A.BL_NO)                                                                                                                                                         
			                                                                 AND T1.EXCT_BIZPTNR_CD = 'A100'                                                                                            
			                                                                 AND ((T1.TASK_SPR_CD = 'TRD' AND T2.BL_SWITCH_YN = 'Y')                                                                                            
			                                                                      OR                                                                                            
			                                                                      (T1.TASK_SPR_CD = 'ADJ'))) THEN (SELECT OUTR_CD3                                                                                          
			                                                                                                         FROM TB_COM_CD_MPNG                                                                                
			                                                                                                        WHERE CD_MPNG_SPR_NM = 'GERP_DIVISION_PREBL_CODE'                                                                               
			                                                                                                          AND SYS_TYPE_CD = 'FW'                                                                                                            
			                                                                                                          AND INSD_CD2 ='C100'                                                                                                              
			                                                                                                          AND INSD_CD = A.CNEE_CD                                                                                                               
			                                                                                                          AND INSD_CD3 = B.CST_OBU_CD                                                                                                           
			                                                                                                          AND USE_YN = 'Y'                                                                                                          
			                                                                                                          LIMIT 1) /*인니향 직선적:EAIN*/                                                                                                         
			                ELSE IF(#{empNo}='PREBLAT', 'ENUS', (SELECT INSD_CD                                                                                                         
			                                                     FROM TB_COM_CD_MPNG                                                                            
			                                                     WHERE CD_MPNG_SPR_NM = 'GERP_MAPP_CODE'                                                                        
			                                                     /* AND OUTR_CD ='03' LG마그나 법인 추가로 수정 */                                                                        
			                                                     AND OUTR_CD = IF(IFNULL(I.BIZPTNR_GRP_CD,'XXXX') = '1006001', '08', '03')                                                                      
			                                                     LIMIT 1))                                                                      
			           END AS AFFILIATE_CODE                                                                                                                
			         , CASE WHEN D.EXCT_BIZPTNR_CD='C100' AND NOT EXISTS (SELECT 1                                                                                                              
			                                                                FROM TB_SMT_INTG_TASK_DEPT T1,                                                                  
			                                                                     TB_FWD_BL T2                                                               
			                                                               WHERE T1.CST_BL_ID = T2.BL_ID                                                                                            
			                                                                 AND T2.BL_ID IN (SELECT T.BL_ID                                                                                                                
			                                                                                    FROM TB_FWD_BL T                                                                                                                
			                                                                                   WHERE T.BL_NO = A.BL_NO)                                                                                                                                                         
			                                                                 AND T1.EXCT_BIZPTNR_CD = 'A100'                                                                                            
			                                                                 AND ((T1.TASK_SPR_CD = 'TRD' AND T2.BL_SWITCH_YN = 'Y')                                                                                            
			                                                                      OR                                                                                            
			                                                                      (T1.TASK_SPR_CD = 'ADJ'))) THEN (SELECT ATTR_NM1                                                                                          
			                                                                                                         FROM TB_COM_CD_MPNG                                                                                            
			                                                                                                        WHERE CD_MPNG_SPR_NM = 'GERP_DIVISION_PREBL_CODE'                                                                                               
			                                                                                                          AND SYS_TYPE_CD ='FW'                                                                                                                 
			                                                                                                          AND INSD_CD2 ='C100'                                                                                                                  
			                                                                                                          AND INSD_CD = A.CNEE_CD                                                                                                                   
			                                                                                                          AND INSD_CD3 = B.CST_OBU_CD                                                                                                               
			                                                                                                          AND USE_YN = 'Y'                                                                                                              
			                                                                                                          LIMIT 1) /*인니향 직선적:IDR*/                                                                                                              
			                ELSE IF(A.EXCT_SPR_CD = 'OC','USD',A.CUR_CD)                                                                                                                
			           END AS FREIGHT_CURRENCY_CODE                                                                                                             
			         , CASE WHEN D.EXCT_BIZPTNR_CD='C100' THEN CASE WHEN EXISTS (SELECT 1                                                                                                               
			                                                                       FROM TB_SMT_INTG_TASK_DEPT T1,                                                               
			                                                                            TB_FWD_BL T2                                                                
			                                                                      WHERE T1.CST_BL_ID = T2.BL_ID                                                                                         
			                                                                        AND T2.BL_ID IN (SELECT T.BL_ID                                                                                                             
			                                                                                           FROM TB_FWD_BL T                                                                                                             
			                                                                                          WHERE T.BL_NO = A.BL_NO)                                                                                                                                                                  
			                                                                        AND T1.EXCT_BIZPTNR_CD = 'A100'                                                                                         
			                                                                        AND ((T1.TASK_SPR_CD = 'TRD' AND T2.BL_SWITCH_YN = 'Y')                                                                                         
			                                                                             OR                                                                                         
			                                                                             (T1.TASK_SPR_CD = 'ADJ'))) THEN 'CTRD' /* 인니향 중계선적                                                                                         
			                                                                                                                       1.C100:IMP, A100:TRD, BL_SWITCH_YN='Y'                                                                                           
			                                                                                                                       2.C100:IMP, A100:ADJ */                                                                                                  
			                                                        ELSE 'CIMP'  /*인니향 직선적*/                                                                                                    
			                                                   END                                                                                                  
			                ELSE 'NA' /*해당없음*/                                                                                                  
			            END AS C_GUBUN                                                                                                  
			         /* end [CSR ID:4349890] [LG전자] 중계건에 대한 PreBL 전송 기능 개선 */                                                                                                               
			       FROM TB_FWD_BL A                                                                                                             
			       INNER JOIN TB_FWD_BL_CST_EXPND B ON  B.BL_ID = A.BL_ID                                                                                                               
			                                        AND B.DEL_YN = 'N'                                                                          
			       INNER JOIN TB_FWD_BL_EXPND C ON C.BL_ID = A.BL_ID                                                                                                                
			       INNER JOIN TB_SMT_INTG_TASK_DEPT D ON  D.CST_BL_ID = A.BL_ID /* 통합실행부서*/                                                                                                                 
			                                          AND D.EO_NO = A.EO_NO                                                                         
			                                          AND D.DEL_YN = 'N'                                                                            
			                                          AND D.TASK_SPR_CD = 'IMP'                                                                         
			       INNER JOIN TB_SMT_ORD E ON  E.SMT_NO = A.SMT_NO                                                                                                          
			                               AND E.DEL_YN = 'N'                                                                                   
			       INNER JOIN TB_COM_BIZPTNR H ON  H.BIZPTNR_CD =  A.NTPR_CD        /* LG마그나 법인 추가 */                                                                                                                   
			       LEFT OUTER JOIN TB_COM_BIZPTNR I ON I.BIZPTNR_CD =  IF(IFNULL(H.MBIZPTNR_YN,'N')='Y', H.BIZPTNR_CD, H.MBIZPTNR_CD)         /* LG마그나 법인 추가 */                                                                                                                 
			       WHERE 1=1                                                                                                                
			       AND A.BL_SPR_CD IN ('H','D')                                                                                                             
			       AND A.DEL_YN = 'N'  
			       /* {#AUTO_SEND} */
			       <choose>
                        <when test = 'autoSendYn == "Y" and autoSendYnNa == "US"'>
	                        AND A.CNEE_CD IN (SELECT ETC_CONT1 FROM TB_COM_ETC_CD 
					                          WHERE CLAS_CD = '2001'
					                          AND DTL_CD_NM = 'CNEE'                          
					                          AND ETC_CONT1 IS NOT NULL
					                          AND USE_YN = 'Y') /*  [CSR ID:4056114] 미주향 LGE PRE BL (수입) 전송 로직 추가건  */
					        AND A.FDEST_CD LIKE 'US%'  
					        AND A.BL_ID = #{blId}
                        </when>
                        <when test = 'autoSendYn == "Y" and autoSendYnNa == "RU"'>
	                        AND A.CNEE_CD IN (SELECT  T.BIZPTNR_CD
					                          FROM TB_COM_BIZPTNR T 
					                          WHERE 1=1
					                          AND T.NATN_CD = 'RU' 
					                          AND T.USE_YN = 'Y'
					                          /* [TODO] PJS:: CONNECT BY START WITH.. 일단 주석 처리함. */
					                          /* CONNECT BY PRIOR T.BIZPTNR_CD = T.UPPR_BIZPTNR_CD START WITH T.BIZPTNR_GRP_CD = '1001001') */
					                          ) 
					        AND A.FDEST_CD LIKE 'RU%'  
					        AND A.BL_ID = #{blId}  /*[CSR ID:RITM0140802]2021.09.08 : LGE PRE BL 법인 확장 러시아 브라질   안영수  */
                        </when>
			            <when test = 'autoSendYn == "Y" and autoSendYnNa == "BR"'>
                            AND A.CNEE_CD IN (SELECT  T.BIZPTNR_CD
                                              FROM TB_COM_BIZPTNR T 
                                              WHERE 1=1
                                              AND T.NATN_CD = 'BR' 
                                              AND T.USE_YN = 'Y'
                                              /* [TODO] PJS:: CONNECT BY START WITH.. 일단 주석 처리함. */
                                              /* CONNECT BY PRIOR T.BIZPTNR_CD = T.UPPR_BIZPTNR_CD START WITH T.BIZPTNR_GRP_CD = '1001001') */ 
                                              )
                            AND A.FDEST_CD LIKE 'BR%'  
                            AND A.BL_ID = #{blId}  /*[CSR ID:RITM0140802]2021.09.08 : LGE PRE BL 법인 확장 러시아 브라질   안영수  */
                        </when>
                        <when test = 'autoSendYn2 == "Y"'>
                            AND A.CNEE_CD IN (SELECT ETC_CONT1 FROM TB_COM_ETC_CD 
					                          WHERE  CLAS_CD = '2001'
					                          AND    DTL_CD_NM = 'CNEE'
					                          AND    ETC_CONT1 IS NOT NULL
					                          AND    USE_YN = 'Y') /*  [CSR ID:4056114] 미주향 LGE PRE BL (수입) 전송 로직 추가건  */
					        AND A.FDEST_CD LIKE 'US%'
					        AND A.ONBR_YMD  BETWEEN #{fromDt} AND #{toDt} /* 입항일자 */
                        </when>
                        <otherwise>
                            AND D.EXCT_BIZPTNR_CD = #{corpCd}  
                            /* {#1}         */
                            <if test='dateSprCd != null and dateSprCd == "AR"'>
				               AND A.ARR_YMD  BETWEEN #{fromDt} AND #{toDt} /* 입항일자 */
				            </if>
				            <if test='dateSprCd != null and dateSprCd == "OB"'>
                               AND A.ONBR_YMD  BETWEEN #{fromDt} AND #{toDt} /* 입항일자 */
                            </if>
                            <if test='exctSprCd != null and exctSprCd != ""'>
                               AND A.EXCT_SPR_CD = #{exctSprCd}
                            </if>
                            <if test='cneeCd != null and cneeCd != ""'>
                               AND A.CNEE_CD = #{cneeCd}
                            </if>
                            <if test='shppCd != null and shppCd != ""'>
                               AND A.SHPP_CD = #{shppCd}
                            </if>
                            <if test='blNo != null and blNo != ""'>
                               AND A.BL_NO IN 
                               <foreach collection="blNoList" item="blNo" separator="," open="(" close=")" >
		                            #{blNo}
		                       </foreach>
                            </if>
                            <if test='hubBilgYn != null and hubBilgYn == "Y"'>
                               AND A.HUB_BILG_YN = 'Y'
                            </if>
                            <if test='hubBilgYn != null and hubBilgYn == "N"'>
                               AND IFNULL(A.HUB_BILG_YN, 'N') = 'N'
                            </if>
                            <if test='result != null and result != ""'>
                               AND (<include refid="fwd.common.fwdFuncInclude.fwdFcFwB2biGetCode">
                                     <property name="tag" value="'GERP_IN_PRE_RESULT'"/>
                                     <property name="param1" value="'RESULT_CD'"/>
                                     <property name="param2" value="A.BL_NO"/>
                                     <property name="param3" value="NULL"/>
                                     <property name="param4" value="NULL"/>
                                   </include>) = #{result} /* PJS:: Include 처리. FC_FW_B2BI_GET_CODE('GERP_IN_PRE_RESULT', 'RESULT_CD',  A.BL_NO, '', '') */
                            </if>
                            <if test='polCd != null and polCd != ""'>
                               AND     A.POL_CD LIKE CONCAT(#{polCd},'%')
                            </if>
                            <if test='podCd != null and podCd != ""'>
                               AND     A.POL_CD LIKE CONCAT(#{podCd},'%')
                            </if>
                            <if test='sendYn != null and sendYn == "Y"'>
                               <![CDATA[
                               AND     (SELECT COUNT(1)
                                         FROM NFINF.TB_FWD_INT109
                                         WHERE HOUSE_BL_NO       = A.BL_NO) > 0
                               ]]> 
                            </if>
                            <if test='sendYn != null and sendYn == "N"'>
                               <![CDATA[
                               AND     (SELECT COUNT(1)
                                         FROM NFINF.TB_FWD_INT109
                                         WHERE HOUSE_BL_NO       = A.BL_NO) = 0
                               ]]> 
                            </if>
                            /* start [CSR ID:4349890] [LG전자] 중계건에 대한 PreBL 전송 기능 개선 */
                            <if test='taskSprCd != null and taskSprCd == "IMP"'>
                                AND D.EXCT_BIZPTNR_CD='C100'
                                AND NOT EXISTS (SELECT 1 
                                                  FROM TB_SMT_INTG_TASK_DEPT T1,
                                                       TB_FWD_BL T2
                                                 WHERE T1.CST_BL_ID = T2.BL_ID
                                                  AND T2.BL_ID IN (SELECT T.BL_ID
                                                                     FROM TB_FWD_BL T
                                                                    WHERE T.BL_NO = A.BL_NO)                               
                                                   AND T1.EXCT_BIZPTNR_CD = 'A100'
                                                   AND ((T1.TASK_SPR_CD = 'TRD' AND T2.BL_SWITCH_YN = 'Y')
                                                        OR
                                                        (T1.TASK_SPR_CD = 'ADJ')))
                            </if>
                            
                            <if test='taskSprCd != null and taskSprCd == "TRD"'>
                                AND D.EXCT_BIZPTNR_CD='C100'
                                AND EXISTS (SELECT 1 
                                              FROM TB_SMT_INTG_TASK_DEPT T1,
                                                   TB_FWD_BL T2
                                             WHERE T1.CST_BL_ID = T2.BL_ID
                                               AND T2.BL_ID IN (SELECT T.BL_ID
                                                                  FROM TB_FWD_BL T
                                                                 WHERE T.BL_NO = A.BL_NO)
                                               AND T1.EXCT_BIZPTNR_CD = 'A100'
                                               AND ((T1.TASK_SPR_CD = 'TRD' AND T2.BL_SWITCH_YN = 'Y')
                                                    OR
                                                    (T1.TASK_SPR_CD = 'ADJ')))
                            </if>
                            /*end [CSR ID:4349890] [LG전자] 중계건에 대한 PreBL 전송 기능 개선 */
                            
                            <if test='cstSprCd != null and cstSprCd != "" and cstSprCd == "LGE"'>
                                AND    NOT EXISTS (
                                                   SELECT 1
                                                   FROM TB_COM_BIZPTNR SA
                                                       ,TB_COM_BIZPTNR SB
                                                   WHERE 1 = 1
                                                   AND  SA.BIZPTNR_CD     = A.NTPR_CD
                                                   AND  SB.BIZPTNR_CD     = IF(IFNULL(SA.MBIZPTNR_YN,'N')='Y', SA.BIZPTNR_CD, SA.MBIZPTNR_CD) 
                                                   AND  SB.BIZPTNR_GRP_CD = '1006001' /* LG마그나 거래처그룹코드 */                       
                                                  )
                            </if>
                            <!-- LG마그나 추가 START -->
                            <if test='cstSprCd != null and cstSprCd != "" and cstSprCd == "LGMG"'>
                                AND    EXISTS (
                                                   SELECT 1
                                                   FROM TB_COM_BIZPTNR SA
                                                       ,TB_COM_BIZPTNR SB
                                                   WHERE 1 = 1
                                                   AND  SA.BIZPTNR_CD     = A.NTPR_CD
                                                   AND  SB.BIZPTNR_CD     = IF(IFNULL(SA.MBIZPTNR_YN,'N')='Y', SA.BIZPTNR_CD, SA.MBIZPTNR_CD) 
                                                   AND  SB.BIZPTNR_GRP_CD = '1006001' /* LG마그나 거래처그룹코드 */                       
                                                  )
                            </if>
                            <if test='exctSprCd != null and exctSprCd == "AR"'>
                                AND    A.NTPR_CD IN (SELECT  BIZPTNR_CD
						                             FROM    TB_COM_BIZPTNR  /* MAIN */
						                             WHERE   BIZPTNR_GRP_CD IN ('1001001','1006001')  /* LG마그나 */
						                             AND     USE_YN = 'Y'
						                             AND     MBIZPTNR_YN = 'Y'
						                             UNION ALL
						                             SELECT  A.BIZPTNR_CD
						                             FROM    TB_COM_BIZPTNR A  /* SUB */
					                                       , TB_COM_BIZPTNR B  /* MAIN */
						                             WHERE   A.USE_YN = 'Y'
						                             AND     A.MBIZPTNR_YN = 'N'
						                             AND     A.MBIZPTNR_CD = B.BIZPTNR_CD
						                             AND     B.BIZPTNR_GRP_CD IN ('1001001','1006001')  /* LG마그나 */
						                             UNION ALL
						                             SELECT  C.BIZPTNR_CD
						                             FROM    TB_COM_BIZPTNR C
						                             WHERE   C.USE_YN = 'Y'
						                             AND     C.BIZPTNR_CD IN ( '1029701' , '1008349')/*  HLDS 혜주건 추가 2013-03-01, 말레이시아 법인건 추가 2018-12-11 */)  
	                            AND A.NTPR_CD NOT IN ('2000089', '2000102', '2000101', '2000003') /* 거래처매핑 */
	                            /*{#2}*/
	                            <if test='ntprCd != null and ntprCd != ""'>
		                            AND A.NTPR_CD IN (SELECT BIZPTNR_CD
	                                                  FROM TB_COM_BIZPTNR
	                                                  WHERE  IF(IFNULL(#{groupYn}, 'N')='Y', 1, 1 /*LEVEL*/) = 1
	                                                  /* [TODO] PJS:: CONNECT BY START WITH.. 일단 주석 처리함. 위의 LEVEL도 처리해야 함.*/
	                                                  /*CONNECT BY PRIOR BIZPTNR_CD = UPPR_BIZPTNR_CD START WITH BIZPTNR_CD = ntprCd) */
	                                                  )
	                            </if>
                            </if>
                            <!-- LG마그나 -->
                            <if test='exctSprCd != null and exctSprCd == "OC"'>
	                            AND    A.NTPR_CD IN (SELECT  BIZPTNR_CD
	                                                 FROM    TB_COM_BIZPTNR  /* MAIN */
	                                                 WHERE   BIZPTNR_GRP_CD IN ('1001001','1006001')  /* LG마그나 */
	                                                 AND     USE_YN = 'Y'
	                                                 AND     MBIZPTNR_YN = 'Y'
	                                                 UNION ALL
	                                                 SELECT  A.BIZPTNR_CD
	                                                 FROM    TB_COM_BIZPTNR A  /* SUB */
	                                                       , TB_COM_BIZPTNR B  /* MAIN */
	                                                 WHERE   A.USE_YN = 'Y'
	                                                 AND     A.MBIZPTNR_YN = 'N'
	                                                 AND     A.MBIZPTNR_CD = B.BIZPTNR_CD
	                                                 AND     B.BIZPTNR_GRP_CD IN ('1001001','1006001')  /* LG마그나 */
	                                                 UNION ALL
	                                                 SELECT  C.BIZPTNR_CD
	                                                 FROM    TB_COM_BIZPTNR C
	                                                 WHERE   C.USE_YN = 'Y'
	                                                 AND     C.BIZPTNR_CD IN ( '1029701' , '1008349')/*  HLDS 혜주건 추가 2013-03-01, 말레이시아 법인건 추가 2018-12-11 */
	                                                 )
	                             /*{#2}*/
	                            <if test='ntprCd != null and ntprCd != ""'>
                                    AND A.NTPR_CD IN (SELECT BIZPTNR_CD
                                                      FROM TB_COM_BIZPTNR
                                                      WHERE  IF(IFNULL(#{groupYn}, 'N')='Y', 1, 1 /*LEVEL*/) = 1
                                                      /* [TODO] PJS:: CONNECT BY START WITH.. 일단 주석 처리함. 위의 LEVEL도 처리해야 함. */
                                                      /*CONNECT BY PRIOR BIZPTNR_CD = UPPR_BIZPTNR_CD START WITH BIZPTNR_CD = ntprCd) */
                                                      )
                                </if>                    
                            </if>
                            <!-- LG마그나 -->
                            <if test='exctSprCd != null and exctSprCd == "EX"'>
	                            AND    A.CNEE_CD IN (SELECT  BIZPTNR_CD
	                                                 FROM    TB_COM_BIZPTNR  /* MAIN */
	                                                 WHERE   BIZPTNR_GRP_CD IN ('1001001','1006001')  /* LG마그나 */
	                                                 AND     USE_YN = 'Y'
	                                                 AND     MBIZPTNR_YN = 'Y'
	                                                 UNION ALL
	                                                 SELECT  A.BIZPTNR_CD
	                                                 FROM    TB_COM_BIZPTNR A  /* SUB */
	                                                       , TB_COM_BIZPTNR B  /* MAIN */
	                                                 WHERE   A.USE_YN = 'Y'
	                                                 AND     A.MBIZPTNR_YN = 'N'
	                                                 AND     A.MBIZPTNR_CD = B.BIZPTNR_CD
	                                                 AND     B.BIZPTNR_GRP_CD IN ('1001001','1006001')  /* LG마그나 */
	                                                 UNION ALL
	                                                 SELECT  C.BIZPTNR_CD
	                                                 FROM    TB_COM_BIZPTNR C
	                                                 WHERE   C.USE_YN = 'Y'
	                                                 AND     C.BIZPTNR_CD IN ( '1029701' , '1008349')/*  HLDS 혜주건 추가 2013-03-01, 말레이시아 법인건 추가 2018-12-11 */)
	                            AND A.CNEE_CD NOT IN ('2000089', '2000102', '2000101', '2000003') /* 거래처매핑 */
	                            /*{#3}*/
	                            <if test='ntprCd != null and ntprCd != ""'>
	                               AND A.CNEE_CD IN (SELECT BIZPTNR_CD
                                                  FROM TB_COM_BIZPTNR
                                                  WHERE  IF(IFNULL(#{groupYn}, 'N')='Y', 1, 1 /*LEVEL*/) = 1
                                                  /* [TODO] PJS:: CONNECT BY START WITH.. 일단 주석 처리함. 위의 LEVEL도 처리해야 함.*/
                                                  /* CONNECT BY PRIOR BIZPTNR_CD = UPPR_BIZPTNR_CD START WITH BIZPTNR_CD = ntprCd) */
	                            </if>
                            </if>
                        </otherwise>
			       </choose>
                   /* {/#AUTO_SEND} */   
			       ) AA                                                                                                                 
			       ORDER BY AA.ARR_YMD, AA.BL_NO                                                                                                                
    </select>
    
    <select id="selectLgEPreBlImg" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgEPreBlImg */
        SELECT  COUNT(1) AS CNT 
        FROM    TB_FWD_PREBL_IMG
        WHERE   1=1 
        AND     BL_ID = #{blId} 
    </select>
    
    <!-- LGE인터페이스테이블Cnt조회 -->
    <update id="updateLgEPreBlImgFileNm" parameterType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.updateLgEPreBlImgFileNm */
        UPDATE  TB_FWD_PREBL_IMG
        SET     BLOB_FILE_NM = #{ifId}
        WHERE   BL_ID = #{blId}
    </update>
    
    <!-- LGEPreBL인터페이스테이블 데이터 조회 -->
    <select id="selectLgEPreBlIfTblData" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgEPreBlIfTblData */
        SELECT 
			  #{interfaceId} AS INTERFACE_ID
			        /* --,FC_FW_GET_NO('LGE_DOC_ID') DOC_ID*/
			        ,#{docId} AS DOC_ID
			        ,(SELECT INSD_CD
			            FROM TB_COM_CD_MPNG
			           WHERE CD_MPNG_SPR_NM = 'GERP_MAPP_CODE'
			             AND OUTR_CD ='01') AS SENDER_ID  /* 687822338 */                   
			        ,'F' AS PRE_BL_SOURCE_TYPE_CODE
			        ,IFNULL(A.DECL_BL_NO, A.BL_NO) AS HOUSE_BL_NO
			        ,A.ONBR_YMD AS SHIPMENT_DATE
			        ,CASE  WHEN D.EXCT_BIZPTNR_CD='F100' OR D.EXCT_BIZPTNR_CD='E700' 
			            THEN IF(D.EXCT_BIZPTNR_CD='F100','ERRA','ESSP')
			               WHEN #{cGubun}='CIMP' THEN (SELECT  OUTR_CD3
			                   FROM  TB_COM_CD_MPNG
			                      WHERE  CD_MPNG_SPR_NM = 'GERP_DIVISION_PREBL_CODE'   
			                                           AND   SYS_TYPE_CD = 'FW'  
			                                           AND   INSD_CD2 ='C100'  
			                                           AND   INSD_CD = A.CNEE_CD    
			                                           AND   INSD_CD3 = B.CST_OBU_CD
			                                           AND   USE_YN = 'Y'
			                                           LIMIT    1) /*인니향 직선적:EAIN*/
			               ELSE IF(#{empNo}='PREBLAT', 'ENUS', (SELECT  INSD_CD
			                    FROM  TB_COM_CD_MPNG
			                    WHERE  CD_MPNG_SPR_NM = 'GERP_MAPP_CODE'
			                           /* AND OUTR_CD ='03' LG마그나 법인 추가로 수정 */
			                    AND  OUTR_CD = IF(IFNULL(I.BIZPTNR_GRP_CD,'XXXX')='1006001', '08', '03')
			                    LIMIT  1))
			         END AS AFFILIATE_CODE /* EKHQ 본사 기준*/
			                               /*2020.10.21 김정숙 [CSR ID:4273084] [인니/태국] LG전자 수입 PreBL 기능 보완 요청 | [요청번호]C20200722_73084 */
			                    /*2021.02.05 이아름 [CSR ID:4349890] [LG전자] 중계건에 대한 PreBL 전송 기능 개선 */                         
			        ,CASE WHEN #{cGubun}='CIMP' 
			           THEN ( SELECT OUTR_CD2
			      FROM TB_COM_CD_MPNG
			     WHERE CD_MPNG_SPR_NM = 'GERP_DIVISION_PREBL_CODE'   
			                      AND SYS_TYPE_CD ='FW'  
			                      AND INSD_CD2 ='C100'  
			                      AND INSD_CD = A.CNEE_CD    
			                      AND INSD_CD3= B.CST_OBU_CD
			                      AND USE_YN = 'Y'
			                      LIMIT 1) /*인니향 직선적*/
			              ELSE CASE WHEN #{empNo} ='PREBLAT' 
			                 THEN 'USTN'
			                 /* LG마그나 법인일 경우 법인코드 세팅 */
			                        WHEN IFNULL(I.BIZPTNR_GRP_CD,'XXXX') = '1006001' 
			                        THEN (SELECT INSD_CD
			                             FROM TB_COM_CD_MPNG
			                            WHERE CD_MPNG_SPR_NM = 'GERP_MAPP_CODE'
			                              AND OUTR_CD ='08'
			                            LIMIT 1)                          
			                        WHEN A.EXCT_SPR_CD IN ('OC','AR') AND IFNULL(A.HUB_BILG_YN,'N')='Y' 
			                        THEN /*FC_CM_GET_EDI_NM2('PKE_EDI코드', '75', A.NTPR_CD ,'') - SubQuery로 처리*/
			                         (SELECT OUTR_CD
			              FROM   TB_COM_CD_MPNG
			              WHERE  UPPR_CD_MPNG_NO = '75'
			              AND    INSD_CD = A.NTPR_CD
			              AND    USE_YN = 'Y'
			              LIMIT 1)
			                        ELSE (SELECT INSD_CD
			                                FROM TB_COM_CD_MPNG
			                               WHERE CD_MPNG_SPR_NM = 'GERP_DIVISION_CODE'
			                                 AND OUTR_CD = B.CST_OBU_CD
			                                 AND SYS_TYPE_CD = 'FW')
			                   END
			         END AS BILLING_REGION_CODE /*2020.10.21 김정숙 [CSR ID:4273084] [인니/태국] LG전자 수입 PreBL 기능 보완 요청 | [요청번호]C20200722_73084 */
			                                    /*2021.02.05 이아름 [CSR ID:4349890] [LG전자] 중계건에 대한 PreBL 전송 기능 개선*/
			        ,CASE WHEN #{cGubun}='CIMP' 
			           THEN (SELECT OUTR_CD
			        FROM TB_COM_CD_MPNG
			       WHERE CD_MPNG_SPR_NM = 'GERP_DIVISION_PREBL_CODE'   
			               AND SYS_TYPE_CD = 'FW'  
			               AND INSD_CD2 = 'C100'  
			               AND INSD_CD = A.CNEE_CD    
			               AND INSD_CD3 = B.CST_OBU_CD
			               LIMIT 1) /*인니향 직선적*/
			              ELSE IF(#{empNo}='PREBLAT', 'NU8', B.CST_OBU_CD) /*인니향 중계선적과 나머지*/
			         END AS ORGANIZATION_CODE /* EDMS연동 : Y, 화면에서 이미지Attach : N 으로 세팅*/
			                                  /*2020.10.21 김정숙 [CSR ID:4273084] [인니/태국] LG전자 수입 PreBL 기능 보완 요청 | [요청번호]C20200722_73084 */
			                                  /*2021.02.05 이아름 [CSR ID:4349890] [LG전자] 중계건에 대한 PreBL 전송 기능 개선*/
			        ,CASE  WHEN A.EXCT_SPR_CD = 'OC'
			          THEN IFNULL((SELECT  S.BIZPTNR_OFCR_NM
			                           FROM   TB_FWD_INTG_PIC S 
			                        WHERE   1=1
			                        AND     S.INTG_KEY_ID = A.BL_ID
			                        AND     S.DEL_YN = 'N'          
			                        AND     S.OFCR_SPR_CD = '08'
			                        LIMIT  1),
			                          (SELECT  S.BIZPTNR_OFCR_NM
			                           FROM    TB_FWD_INTG_PIC S                        
			                           WHERE   1=1
			                           AND     S.INTG_KEY_ID = A.BL_ID
			                           AND     S.DEL_YN = 'N'          
			                           AND     S.OFCR_SPR_CD = '09'
			                            LIMIT  1))
			           WHEN A.EXCT_SPR_CD = 'AR'
			           THEN (SELECT S.BIZPTNR_OFCR_NM
			                      FROM   TB_FWD_INTG_PIC S                        
			                      WHERE  1=1
			                      AND    S.INTG_KEY_ID = A.BL_ID
			                      AND    S.DEL_YN = 'N'          
			                      AND    S.OFCR_SPR_CD = '09'
			                      LIMIT  1) 
			               WHEN A.EXCT_SPR_CD = 'EX'
			               THEN (SELECT S.BIZPTNR_OFCR_NM
			                      FROM   TB_FWD_INTG_PIC S                        
			                      WHERE  1=1
			                      AND    S.INTG_KEY_ID = A.BL_ID
			                   AND    S.DEL_YN = 'N'          
			                      AND    S.OFCR_SPR_CD = '09'
			                      LIMIT  1)
			        END AS PURCHASER_NAME
			        ,CASE  WHEN #{cGubun}='CIMP' 
			    THEN (SELECT FMLA_CD
			      FROM TB_COM_CD_MPNG
			        WHERE CD_MPNG_SPR_NM = 'GERP_DIVISION_PREBL_CODE'   
			                      AND SYS_TYPE_CD = 'FW'  
			                      AND INSD_CD2 = 'C100'  
			                      AND INSD_CD = A.CNEE_CD    
			                      AND INSD_CD3 = B.CST_OBU_CD
			                      AND  USE_YN = 'Y'
			                         LIMIT 1) /*인니향 직선적*/
			               ELSE IF(#{empNo}='PREBLAT', 'US012514', (SELECT INSD_CD
			                       FROM  TB_COM_CD_MPNG
			                  WHERE  CD_MPNG_SPR_NM = 'GERP_MAPP_CODE'
			                     AND  OUTR_CD ='02')) /*인니향 중계선적과 나머지*/                                 
			         END AS PARTNER_CODE /*2020.10.21 김정숙 [CSR ID:4273084] [인니/태국] LG전자 수입 PreBL 기능 보완 요청 | [요청번호]C20200722_73084 */
			                              /*2021.02.05 이아름 [CSR ID:4349890] [LG전자] 중계건에 대한 PreBL 전송 기능 개선*/
			        ,CASE  WHEN #{cGubun}='CIMP' 
			       THEN (SELECT FMLA_CD2
			      FROM TB_COM_CD_MPNG
			        WHERE CD_MPNG_SPR_NM = 'GERP_DIVISION_PREBL_CODE'   
			                      AND SYS_TYPE_CD ='FW'  
			                      AND INSD_CD2 ='C100'
			                      AND INSD_CD = A.CNEE_CD    
			                      AND INSD_CD3 = B.CST_OBU_CD
			                      AND USE_YN = 'Y'
			                      LIMIT 1) /*인니향 직선적*/
			               ELSE IF(#{empNo} = 'PREBLAT', 'X', 'F')
			         END AS PARTNER_TYPE_CODE /*2020.11.03   김정숙   [CSR ID:4327838] [지급요청] 인도네시아 PreBL 로직 수정 보완 | [요청번호]C20201103_27838*/
			                                  /*2021.02.05 이아름 [CSR ID:4349890] [LG전자] 중계건에 대한 PreBL 전송 기능 개선*/                   
			        ,A.MBL_NO AS MASTER_BL_NO                                      
			        ,CASE
			          WHEN A.EXCT_SPR_CD = 'OC'
			          THEN A.INVC_CUR_CD
			          WHEN A.EXCT_SPR_CD = 'EX'
			          THEN A.INVC_CUR_CD
			          ELSE IF(SUBSTR(A.POL_CD,1,2)='JP','JPY','USD')
			         END AS CURRENCY_CODE
			         /* 박유미K요청으로 해운 A.CUR_CD -> A.INVC_CUR_CD 으로 변경 
			            이자영D요청으로 특송 A.INVC_CUR_CD 로 변경 */
			         /* GSI HBL MGT(수입)화면상 CUR CD 입력필드 없음 */                                                                     
			        ,IF(A.EXCT_SPR_CD='OC',A.INCOT_CD, IF(IFNULL(A.HUB_BILG_YN,'N')='Y','DDU',A.INCOT_CD)) AS PRICE_TERMS_CODE            
			        ,IF(A.EXCT_SPR_CD='OC','SEA','AIR') AS SHIPMENT_METHOD_CODE
			        /* Port코드 매핑시 IDTJP->IDTPP를 IDTPP->IDTPP로 변경, By SuperUser 김주영 요청(CSR번호: 7602)  */
			        ,SUBSTR(/*FC_CM_MPNG_TRANSMIT('OM','01','PORT_CODE', A.POL_CD,'','', 1) - SubQuery로 대처*/
			          IFNULL( (SELECT OUTR_CD
			          FROM   TB_COM_CD_MPNG
			          WHERE  CD_TYPE_CD = 'C'                                     /*DETAIL 맵핑코드*/
			          AND    CD_MPNG_SPR_NM = 'PORT_CODE'                         /*맵핑구분*/
			          AND    SYS_TYPE_CD LIKE 'OM%'                       /*시스템 유형*/
			          AND    MPNG_DRCT_CD IN ('T', 'D')                           /*송신 (양뱡향 'RT' 추가)*/
			          AND    ('01' IS NULL OR RLT_BIZPTNR_CD = '01')       /*관계거래처코드*/
			          AND    INSD_CD = A.POL_CD
			          AND    ('' IS NULL OR INSD_CD2 = '')
			          AND    ('' IS NULL OR INSD_CD3 = '')
			          AND    USE_YN = 'Y'   
			          LIMIT  1), '')
			      , 1, 2) AS SHIPMENT_COUNTRY_CODE 
			        ,CASE 
			          WHEN SUBSTR(A.POD_CD, 1, 2) = 'KR' AND A.POL_CD = 'JPKIX' 
			          THEN 'JPOSA'  
			           ELSE SUBSTR(/*FC_CM_MPNG_TRANSMIT('OM','01','PORT_CODE', A.POL_CD,'','', 1) - SubQuery 처리*/
			              IFNULL( (SELECT OUTR_CD
			             FROM   TB_COM_CD_MPNG
			             WHERE  CD_TYPE_CD = 'C'                                     /*DETAIL 맵핑코드*/
			             AND    CD_MPNG_SPR_NM = 'PORT_CODE'                         /*맵핑구분*/
			             AND    SYS_TYPE_CD LIKE 'OM%'                       /*시스템 유형*/
			             AND    MPNG_DRCT_CD IN ('T', 'D')                           /*송신 (양뱡향 'RT' 추가)*/
			             AND    ('01' IS NULL OR RLT_BIZPTNR_CD = '01')       /*관계거래처코드*/
			             AND    INSD_CD = A.POL_CD
			             AND    ('' IS NULL OR INSD_CD2 = '')
			             AND    ('' IS NULL OR INSD_CD3 = '')
			             AND    USE_YN = 'Y'   
			             LIMIT  1), '')
			            , 1,5) END AS SHIPMENT_PORT_CODE
			        ,(SELECT BIZPTNR_STRNM_NM FROM TB_COM_CST_COM_SUPR WHERE BIZPTNR_CD = B.CST_SHPP_CD) AS SHIPPER_NAME                    
			        ,IF(A.EXCT_SPR_CD='OC',0,A.SELL_VOL_WGT) AS VOLUME_WEIGHT /* asis 본사 SHPR_GRS_VOL(항공), 0(해운) */
			        ,CASE
			          WHEN A.EXCT_SPR_CD='OC'
			          THEN NULL 
			          WHEN A.EXCT_SPR_CD='AR'
			          THEN (SELECT BB.BIZPTNR_GRP_ENG_ACRN_NM
			                      FROM   TB_COM_BIZPTNR AA
			                           ,TB_COM_BIZPTNR_GRP_CD BB
			                  WHERE   AA.BIZPTNR_GRP_CD = BB.BIZPTNR_GRP_CD
			                     AND     AA.BIZPTNR_CD = D.CARR_CD) 
			         END  AS AIRLINE_CODE
			        ,A.ARR_YMD                                          AS ETA_DATE
			        ,A.ARR_YMD                                          AS ARRIVAL_DATE
			        ,CASE WHEN A.EXCT_SPR_CD = 'AR' AND A.POD_CD = 'KRPUS' 
			        THEN 'KRKMH'    
			        ELSE SUBSTR(/*FC_CM_MPNG_TRANSMIT('OM','01','PORT_CODE', A.POD_CD,'','', 1) - SubQuery 처리 */
			               IFNULL( (SELECT OUTR_CD
			               FROM   TB_COM_CD_MPNG
			               WHERE  CD_TYPE_CD = 'C'                                     /*DETAIL 맵핑코드*/
			               AND    CD_MPNG_SPR_NM = 'PORT_CODE'                         /*맵핑구분*/
			               AND    SYS_TYPE_CD LIKE 'OM%'                       /*시스템 유형*/
			               AND    MPNG_DRCT_CD IN ('T', 'D')                           /*송신 (양뱡향 'RT' 추가)*/
			               AND    ('01' IS NULL OR RLT_BIZPTNR_CD = '01')       /*관계거래처코드*/
			               AND    INSD_CD = A.POL_CD
			               AND    ('' IS NULL OR INSD_CD2 = '')
			               AND    ('' IS NULL OR INSD_CD3 = '')
			               AND    USE_YN = 'Y'   
			               LIMIT  1), ''), 1, 5) 
			         END AS ARRIVAL_PORT_CODE  /* 20130618 CSR : C20130618_51662(최우석k) 요청으로 수정 KRKMH 하드코딩 로직 추가 */
			        ,CASE 
			       WHEN #{cGubun}='CIMP' 
			       THEN (SELECT ATTR_NM1
			                        FROM TB_COM_CD_MPNG
			                       WHERE CD_MPNG_SPR_NM = 'GERP_DIVISION_PREBL_CODE'   
			                         AND SYS_TYPE_CD ='FW'  
			                         AND INSD_CD2 ='C100'  
			                         AND INSD_CD = A.CNEE_CD    
			                         AND INSD_CD3 = B.CST_OBU_CD
			                         AND USE_YN = 'Y'
			                         LIMIT 1) /*인니향 직선적:IDR*/
			               ELSE IF(A.EXCT_SPR_CD='OC','USD',A.CUR_CD)
			         END AS FREIGHT_CURRENCY_CODE /*2021.02.05 이아름 [CSR ID:4349890] [LG전자] 중계건에 대한 PreBL 전송 기능 개선*/
			        ,CASE
			          WHEN A.EXCT_SPR_CD = 'OC'
			          THEN IF(IFNULL(A.HUB_BILG_YN,'N')='Y', NULL, (SELECT  SUM(S.CTRT_FRGH_AMT)
			                                                              FROM    TB_ISM_SELLBUY S
			                                                              WHERE   S.BL_ID = A.BL_ID
			                                                              AND     S.ADJ_YN = 'Y'
			                                                              AND     S.SELLBUY_SPR_CD = 'SO'
			                                                              AND     S.DOM_ABRD_BIZPTNR_TYPE_CD = '1' /* 국내거래처 */
			                                                              AND     S.ADJ_CONF_SPR_CD NOT IN ('05')  /* 전표 미생성분만 가능 01:TEMP 02:CREATION 03:CHECK 04:INVOICE 05:SLIP */
			                                                              AND     S.ADJ_STN_TYPE_CD IN ('01','02')
			                                                              AND     S.CTRT_CUR_CD = 'USD'
			                                                              AND     S.DEL_YN = 'N'
			                                                              AND     S.EXPIMP_SPR_CD = 'I'
			                                                              AND     S.OFFSET_SMT_NO1 IS NULL))
			               WHEN A.EXCT_SPR_CD = 'AR'
			               THEN IF(IFNULL(A.HUB_BILG_YN,'N')='Y', NULL, (SELECT  SUM(IF(S.CTRT_CUR_CD = A.CUR_CD, S.CTRT_FRGH_AMT, 0))
			                                                              FROM    TB_ISM_SELLBUY S
			                                                              WHERE   S.BL_ID = A.BL_ID
			                                                              AND     S.SELLBUY_SPR_CD = 'SO'
			                                                              AND     S.DOM_ABRD_BIZPTNR_TYPE_CD = '1'
			                                                              AND     S.ADJ_STN_TYPE_CD = '01'
			                                                              AND     S.EXPIMP_SPR_CD = 'I'
			                                                              AND     S.DEL_YN = 'N'))
			         END AS TOTAL_FRN_CURR_FREIGHT_AMOUNT
			        ,A.SELL_GWT AS GROSS_WEIGHT
			        ,IF(A.EXCT_SPR_CD='AR',
			         (CASE
			          WHEN A.SELL_WGT_UNIT_CD = 'KG'
			          THEN 'KG'
			          WHEN A.SELL_WGT_UNIT_CD = 'K'
			          THEN 'KG'
			          ELSE 'LB'
			         END), 'KG') AS GROSS_WEIGHT_UOM_CODE
			        ,A.PKG_QTY                        AS PACKING_QTY
			        ,IF(A.EXCT_SPR_CD='OC',
			         (CASE
			          WHEN A.PKG_UNIT_CD = 'PL'
			          THEN 'GT'
			          WHEN A.PKG_UNIT_CD = 'WC'
			          THEN 'GT'
			          ELSE A.PKG_UNIT_CD
			         END), 'CT') AS PACKING_UNIT_CODE
			        ,IF(A.EXCT_SPR_CD = 'OC',0,A.SELL_CWT)                                         AS CHARGABLE_WEIGHT
			        ,IF(A.EXCT_SPR_CD = 'OC',A.SELL_CBM,'00000000000.000')                         AS TOTAL_CBM /* asis SHPR_GRS_VOL */
			        ,IF(A.EXCT_SPR_CD = 'OC',SUBSTR(A.VOYAGE,1,7),NULL)                            AS VOYAGE_NO
			        ,CASE
			          WHEN A.EXCT_SPR_CD = 'OC'
			          THEN SUBSTR(A.FLT_VSL_NM, 1, 30)        /*--asis, SUBSTR(A.VSL_IATA_NM, 1, 30)*/
			          WHEN A.EXCT_SPR_CD = 'AR'
			          THEN REPLACE(A.FLT_VSL_NM, 'CK', 'MU')  /*--asis, REPLACE(A.VOYAGE_FLT_NO,'CK','MU')*/
			         END AS VESSEL_FLIGHT_NAME
			        ,IF(A.EXCT_SPR_CD = 'EX', A.INVC_AMT, IF(IFNULL(A.HUB_BILG_YN,'N') = 'Y',NULL,A.INVC_AMT)) AS FRN_CURR_SHIPMENT_AMOUNT
			        ,A.NCV_YN AS NCV_FLAG /* asis 해상,항공->DECODE(A.SO_LC_YN, 'Y', 'N', 'Y') 특송->DECODE(A.AI_TT_LC_TERM,'1','N','2','N','3','Y','N') 2007.12.17 LEE MOD. A.SO_LC_YN --> AI_TT_LC_TERM으로 변경 */
			        ,IF(A.EXCT_SPR_CD='OC',A.LADG_TYPE_CD, '') AS CARGO_TYPE_CODE
			        ,''                                        AS CY_DUE_DATE  /*--ASIS CU_PU_DT(특송PICKUP일자), TOBE BL확장테이블에서 관리X*/
			        /* --항공특송,NULL                                              -- CY_DUE_DATE
			         --해운,DECODE(A.CU_PU_DT, '00000000', '', A.CU_PU_DT)
			        */
			        ,NULL AS MERCHANDISE_TYPE_CODE -- TOBE ITEM TYPE관리 X 이슈
			        /* --항공특송,NULL                                              -- MERCHANDISE_TYPE_CODE
			           --해운,SUBSTR(FC_FW_GET_NM2('대표ITEM_SI', 'L', A.HBL_MNGR_NO), 1, 2)
			        */
			        ,CASE
			          WHEN A.FRGTTERM_CD = 'PP'
			          THEN 'P'
			          WHEN A.FRGTTERM_CD = 'CC'
			          THEN 'C'
			          ELSE A.FRGTTERM_CD
			         END AS FREIGHT_TERMS_NAME
			        ,IF(A.EXCT_SPR_CD = 'EX','Y','N') AS COURIER_FLAG
			        ,CASE
			          WHEN A.EXCT_SPR_CD = 'OC'
			          THEN IF(A.TRN_TYPE_CD = 'FRY', 'F', IF(A.CARGO_TYPE_CD = 'D','D','N'))  /*--F: Ferry, D: Dangerous, N: Normal*/
			          WHEN A.EXCT_SPR_CD = 'AR'
			          THEN 
			            CASE
			              WHEN A.CARGO_TYPE_CD = 'U'
			              THEN 'E'
			              WHEN A.CARGO_TYPE_CD = 'D'
			              THEN 'D'
			              ELSE 'N'
			            END /*--E: Express, D: Dangerous, N: Normal*/
			         END AS FREIGHT_CONTRACT_TYPE_CODE
			        ,IFNULL(A.HUB_BILG_YN, 'N') AS VMI_FLAG
			        ,IF(#{empNo}='PREBLAT', 'N', (CASE
			                 WHEN #{attachIncludeYn} =  'Y'
			                 THEN 'N'
			                 WHEN #{attachIncludeYn} =  'N'
			                 THEN 'Y'
			                                     END)) AS IMAGE_ATTACH_INCLUDE_YN /* EDMS연동 : Y, 화면에서 이미지Attach : N 으로 세팅*/
			        ,DATE_FORMAT(NOW(), '%Y%m%d%H%i%s') AS CREATION_DATE
			        ,#{empNo}                           AS INS_ID
			        ,NOW()                              AS TIMESTAMP
			        ,A.BL_ID                            AS BL_ID
			        ,IF(A.EXCT_SPR_CD='OC',(SELECT OUTR_CD_NM FROM TB_COM_CD_MPNG A WHERE CD_MPNG_SPR_NM = 'LGE_BNDWHS_CODE' AND INSD_CD = F.BONDED_AREA_CD), '') AS ENTRANCE_WHARF_CODE
			        ,'' AS PIC_MAIL
			        
			        <if test='attachIncludeYn != null and attachIncludeYn != "" and attachIncludeYn == "Y"'>
	                    , E.BLOB_FILE_NM
	                    , E.BLOB_CONT
                    </if>
			        
			  FROM   TB_FWD_BL A
			  INNER JOIN TB_FWD_BL_CST_EXPND B ON  B.BL_ID = A.BL_ID
			             AND B.DEL_YN = 'N'
			  INNER JOIN TB_FWD_BL_EXPND C ON C.BL_ID = A.BL_ID
			  INNER JOIN TB_SMT_INTG_TASK_DEPT D  ON  D.CST_BL_ID = A.BL_ID/* 통합실행부서*/
			             AND D.EO_NO = A.EO_NO
			             AND D.TASK_SPR_CD  = 'IMP'
			             AND D.EXCT_BIZPTNR_CD = #{corpCd}
			             AND D.DEL_YN = 'N'
			  LEFT OUTER JOIN TB_FWD_PREBL_IMG E ON E.BL_ID = A.BL_ID
			  LEFT OUTER JOIN TB_COM_LOC F ON F.LOC_CD = C.ASGN_HRBR_CD
			  INNER JOIN TB_SMT_ORD  G ON G.SMT_NO = A.SMT_NO  /* LG마그나 법인 추가 */
			  INNER JOIN TB_COM_BIZPTNR H ON  H.BIZPTNR_CD =  A.NTPR_CD       /* LG마그나 법인 추가 */    
			  LEFT OUTER JOIN TB_COM_BIZPTNR I ON I.BIZPTNR_CD = IF(IFNULL(H.MBIZPTNR_YN,'N')='Y', H.BIZPTNR_CD, H.MBIZPTNR_CD)  /* LG마그나 법인 추가 */
			  WHERE  A.BL_ID = #{blId}
			  AND    A.DEL_YN = 'N'
			  
              <if test="exctSprCd != null and exctSprCd != '' and exctSprCd== 'EX' ">
                    AND IFNULL(A.HUB_BILG_YN,'N') = 'N'
              </if>
    </select>


    <!-- LGE인터페이스테이블Cnt조회 -->
    <insert id="insertLgEPreBlIfTbl" parameterType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.insertLgEPreBlIfTbl */
        INSERT INTO NFINF.TB_FWD_INT109 (
							               INTERFACE_ID
							              ,DOC_ID
							              ,SENDER_ID
							              ,PRE_BL_SOURCE_TYPE_CODE
							              ,HOUSE_BL_NO
							              ,SHIPMENT_DATE
							              ,AFFILIATE_CODE
							              ,BILLING_REGION_CODE
							              ,ORGANIZATION_CODE
							              ,PURCHASER_NAME
							              ,PARTNER_CODE
							              ,PARTNER_TYPE_CODE
							              ,MASTER_BL_NO
							              ,CURRENCY_CODE
							              ,PRICE_TERMS_CODE
							              ,SHIPMENT_METHOD_CODE
							              ,SHIPMENT_COUNTRY_CODE
							              ,SHIPMENT_PORT_CODE
							              ,SHIPPER_NAME
							              ,VOLUME_WEIGHT
							              ,AIRLINE_CODE
							              ,ETA_DATE
							              ,ARRIVAL_DATE                    
							              ,ARRIVAL_PORT_CODE
							              ,FREIGHT_CURRENCY_CODE                   
							              ,TOTAL_FRN_CURR_FREIGHT_AMOUNT                    
							              ,GROSS_WEIGHT
							              ,GROSS_WEIGHT_UOM_CODE
							              ,PACKING_QTY
							              ,PACKING_UNIT_CODE
							              ,CHARGEABLE_WEIGHT
							              ,TOTAL_CBM
							              ,VOYAGE_NO
							              ,VESSEL_FLIGHT_NAME
							              ,FRN_CURR_SHIPMENT_AMOUNT
							              ,NCV_FLAG
							              ,CARGO_TYPE_CODE
							              ,CY_DUE_DATE
							              ,MERCHANDISE_TYPE_CODE
							              ,FREIGHT_TERMS_NAME
							              ,COURIER_FLAG
							              ,FREIGHT_CONTRACT_TYPE_CODE
							              ,VMI_FLAG
							              ,ATTACH_INCLUDE_YN
							              ,CREATION_DATE
							              ,INS_ID
							              ,TIMESTAMP
							              ,BL_ID
							              ,ENTRANCE_WHARF_CODE /*해운추가*/
							              ,ATTRIBUTE1 /*특송추가*/
							              <if test='attachIncludeYn != null and attachIncludeYn != "" and attachIncludeYn == "Y"'>
							                  , ATTACH_FILE_NAME
							                  , ATTACH_FILE_CONTENT
							              </if>
							             )
							             VALUES (
							               IFNULL(#{interfaceId},'' )
							         , IFNULL(#{docId},'' )
							         , IFNULL(#{senderId},0 )
							         , IFNULL(#{preBlSourceTypeCode},'' )
							         , IFNULL(#{houseBlNo},'' )
							         , IFNULL(#{shipmentDate},'' )
							         , IFNULL(#{affiliateCode},0 )
							         , IFNULL(#{billingCegionCode},'' )
							         , IFNULL(#{organizationCode},'' )
							         , IFNULL(#{purchaserName},'' )
							         , IFNULL(#{partnerCode},'' )
							         , IFNULL(#{partnerTypeCode},'' )
							         , IFNULL(#{masterBlNo},'' )
							         , IFNULL(#{currencyCode},'' )
							         , IFNULL(#{priceTermsCode},'' )
							         , IFNULL(#{shipmentMethodCode},'' )
							         , IFNULL(#{shipmentCountryCode},'' )
							         , IFNULL(#{shipmentPortCode},'' )
							         , IFNULL(#{shipperName},'' )
							         , IFNULL(#{volumeWeight}, 0 )
							         , IFNULL(#{airlineCode},'' )
							         , IFNULL(#{etaDate},'' )
							         , IFNULL(#{arrivalDate},'' )
							         , IFNULL(#{arrivalPortCode},'')
							         , IFNULL(#{freightCurrencyCode},'' )
							         , IFNULL(#{totalFrnCurrFreightAmount}, 0 )
							         , IFNULL(#{grossWeight}, 0)
							         , IFNULL(#{grossWeightUomCode},'' )
							         , IFNULL(#{packingQty}, 0 )
							         , IFNULL(#{packingUnitCode},'' )
							         , IFNULL(#{chargeableWeight}, 0 )
							         , IFNULL(#{totalCbm}, 0 )
							         , IFNULL(#{voyageNo},'' )
							         , IFNULL(#{vesselFlightName},'' )
							         , IFNULL(#{frnCurrShipmentAmount}, 0 )
							         , IFNULL(#{ncvFlag},'' )
							         , IFNULL(#{cargoTypeCode},'' )
							         , IFNULL(#{cyDueDate},'' )
							         , IFNULL(#{merchandiseTypeCode},'' )
							         , IFNULL(#{freightTermsName},'' )
							         , IFNULL(#{courierFlag},'' )
							         , IFNULL(#{freightContractTypeCode},'' )
							         , IFNULL(#{vmiFlag},'' )
							         , IFNULL(#{attachIncludeYn},'' )
							         , IFNULL(#{creationDate},'' )
							         , IFNULL(#{insId},'' )
							         , IFNULL(#{timestamp},'' )
							         , IFNULL(#{blId},'' )
							         , IFNULL(#{entranceWharfCode},'' )  /*해운추가*/
							         , IFNULL(#{attribute1},'' )   /*특송추가*/
							         <if test='attachIncludeYn != null and attachIncludeYn != "" and attachIncludeYn == "Y"'>
							                   , IFNULL(#{attachFileName},'' )
							                   , IFNULL(#{attachFileContent},'' )
							                  </if>
							             )
                   
    </insert>   
                   
                   
    <!-- 컨테이너매핑정보조회  -->
    <select id="selectCntrMpngInfo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectCntrMpngInfo */
        SELECT COUNT(CNTR_YN) CNTR_NULL_CNT
        FROM   ( SELECT   
                        (CASE 
                            WHEN /*FC_COM_GET_EDI_NM2('PKE_EDI코드', '427', S.CNTR_SIZE_CD || S.CNTR_TYPE_CD ,'') IS NULL - Subquery로 처리*/
                                (SELECT OUTR_CD
				                 FROM   TB_COM_CD_MPNG
				                 WHERE  UPPR_CD_MPNG_NO = '427'
				                 AND    INSD_CD = CONCAT(S.CNTR_SIZE_CD, S.CNTR_TYPE_CD)
				                 AND    USE_YN = 'Y'
				                 LIMIT  1) IS NULL
                            THEN 'N' 
                            ELSE 'Y'
                         END) AS CNTR_YN
                 FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
                       ,TB_SMT_INTG_ITEM S /* 컨테이너  */
                 WHERE  1=1
                 AND    T.DEL_YN = 'N' /* 삭제여부 */
                 AND    S.DEL_YN = 'N' /* 삭제여부 */
                 AND    T.BL_ID = #{blId}
                 AND    T.INTG_ITEM_NO = S.INTG_ITEM_NO
                 AND    S.CNTR_YN = 'Y' ) AA
          WHERE AA.CNTR_YN = 'N'
    </select>
    
    
    <!-- LGEPreBL컨테이너등록  -->
    <insert id="insertLgEPreBlCntr" parameterType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.insertLgEPreBlCntr */
        INSERT INTO NFINF.TB_FWD_INT110
                      (
                        INTERFACE_ID
                       ,INTERFACE_LINE_ID
                       ,CONTAINER_NO
                       ,CONTAINER_TYPE_CODE
                       ,CREATION_DATE
                       ,TIMESTAMP
                      )
              SELECT   #{interfaceId} 
                     , @rownum:=@rownum+1  
                     , SUBSTR(S.CNTR_NO, 1, 11) AS CNTR_NO
                     /*FC_COM_GET_EDI_NM2('PKE_EDI코드', '427', S.CNTR_SIZE_CD || S.CNTR_TYPE_CD ,'') AS CNTR_TYPE_CD - Subquery로 처리*/
                     ,(SELECT OUTR_CD
	                   FROM   TB_COM_CD_MPNG
	                   WHERE  UPPR_CD_MPNG_NO = '427'
	                   AND    INSD_CD = CONCAT(S.CNTR_SIZE_CD, S.CNTR_TYPE_CD)
	                   AND    USE_YN = 'Y'
	                   LIMIT  1) AS CNTR_TYPE_CD
                     , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
                     , NOW()
              FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
              INNER JOIN TB_SMT_INTG_ITEM S ON  S.INTG_ITEM_NO = T.INTG_ITEM_NO /* 컨테이너  */
                      AND S.DEL_YN = 'N' /* 삭제여부 */
                      AND S.CNTR_YN = 'Y'
              INNER JOIN (SELECT @rownum:=0) TMP
              WHERE  1=1
              AND    T.DEL_YN = 'N' /* 삭제여부 */
              AND    T.BL_ID = #{blId}
    </insert>
    

    <!-- LGEPreBL참조번호등록  -->
    <insert id="insertLgEPreBlRefNo" parameterType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.insertLgEPreBlRefNo */
        INSERT INTO NFINF.TB_FWD_INT111
                        (
                          INTERFACE_ID
                         ,INTERFACE_LINE_ID
                         ,PURCHASE_ORDER_NO
                         ,INVOICE_NO
                         ,ORGANIZATION_CODE
                         ,PURCHASER_NAME
                         ,LC_NO
                         ,INVOICE_DATE
                         ,ITEM_NO
                         ,SHIPMENT_QTY
                         ,ORIG_CNTRY_CODE
                         ,CREATION_DATE
                         ,TIMESTAMP
                        )
			              SELECT #{interfaceId}
			                     ,  1
			                     ,  A.REF_NO  AS PO_NO
			                     ,(SELECT S.REF_NO
			                       FROM   TB_FWD_INTG_REF_NO S
			                       WHERE  1=1
			                       AND    S.INTG_KEY_ID = A.INTG_KEY_ID
			                       AND    S.DEL_YN = 'N'
			                       AND    S.REF_NO_SPR_CD = 'IN'
			                       LIMIT  1) AS INVOICE_NO
			                     ,(SELECT (CASE
			                         WHEN S.CST_OBU_CD = 'CHZ'
			                         THEN 'CVZ'
			                         WHEN S.CST_OBU_CD = 'DVZ'
			                         THEN 'CVZ'
			                         ELSE S.CST_OBU_CD 
			                          END) 
			                       FROM   TB_FWD_BL T
			                             ,TB_FWD_BL_CST_EXPND S
			                       WHERE  1=1
			                       AND    T.BL_ID = S.BL_ID
			                       AND    T.BL_ID = A.INTG_KEY_ID
			                       AND    T.DEL_YN = 'N'
			                       LIMIT  1) AS ORGANIZATION_CODE
			                     ,IF(#{exctSprCd}='OC', IFNULL((SELECT S.BIZPTNR_OFCR_NM
			                                                      FROM   TB_FWD_INTG_PIC S
			                                                      WHERE  1=1
			                                                      AND    S.INTG_KEY_ID = A.INTG_KEY_ID
			                                                      AND    S.DEL_YN = 'N'
			                                                      AND    S.OFCR_SPR_CD = '08')
			                                                    ,(SELECT S.BIZPTNR_OFCR_NM
			                                                      FROM   TB_FWD_INTG_PIC S
			                                                      WHERE  1=1
			                                                      AND    S.INTG_KEY_ID = A.INTG_KEY_ID
			                                                      AND    S.DEL_YN = 'N'
			                                                      AND    S.OFCR_SPR_CD = '09')), '')  AS PURCHASER_NAME
			                     ,(SELECT S.REF_NO
			                       FROM   TB_FWD_INTG_REF_NO S
			                       WHERE  1=1
			                       AND    S.INTG_KEY_ID = A.INTG_KEY_ID
			                       AND    S.DEL_YN = 'N'
			                       AND    S.REF_NO_SPR_CD = 'LC'
			                       LIMIT  1)  AS LC_NO
			                     ,''
			                     ,''
			                     ,0
			                     ,''
			                     ,DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
			                     ,NOW()    
			               FROM   TB_FWD_INTG_REF_NO A
			               WHERE  1=1
			               AND    A.INTG_KEY_ID = #{blId}
			               AND    A.DEL_YN = 'N'
			               AND    A.REF_NO_SPR_CD = 'PO'
			               LIMIT  1
    </insert>
    
    <!-- LGEPreBL이미지전송정보조회 -->
    <select id="selectLgEPreBlImgSendInfo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgEPreBlImgSendInfo */
        SELECT COUNT(CNTR_YN) CNTR_NULL_CNT
        FROM   ( SELECT   
                        (CASE 
                            WHEN /*FC_COM_GET_EDI_NM2('PKE_EDI코드', '427', S.CNTR_SIZE_CD || S.CNTR_TYPE_CD ,'') IS NULL - Subquery로 처리*/
                                (SELECT OUTR_CD
                                 FROM   TB_COM_CD_MPNG
                                 WHERE  UPPR_CD_MPNG_NO = '427'
                                 AND    INSD_CD = CONCAT(S.CNTR_SIZE_CD, S.CNTR_TYPE_CD)
                                 AND    USE_YN = 'Y'
                                 LIMIT  1) IS NULL
                            THEN 'N' 
                            ELSE 'Y'
                         END) AS CNTR_YN
                 FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
                       ,TB_SMT_INTG_ITEM S /* 컨테이너  */
                 WHERE  1=1
                 AND    T.DEL_YN = 'N' /* 삭제여부 */
                 AND    S.DEL_YN = 'N' /* 삭제여부 */
                 AND    T.BL_ID = #{blId}
                 AND    T.INTG_ITEM_NO = S.INTG_ITEM_NO
                 AND    S.CNTR_YN = 'Y' ) AA
          WHERE AA.CNTR_YN = 'N'
    </select>
    
    <!-- 이미지전송요청등록 -->
    <insert id="insertImgSendRqst" parameterType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.insertImgSendRqst */
        INSERT INTO NFINF.TB_FWD_INT1010 ( 
              INTERFACE_ID, 
              IF_WRK_GRP_NM, 
              FTP_TARGET_ID, 
              SO_NO, 
              EO_NO, 
              BL_ID, 
              BL_NO, 
              REF_NO, 
              IMG_DOC_SPR_CD, 
              CORP_CD, 
              DOC_MERG_YN, 
              BLOB_ATCH_YN, 
              BLOB_FILE_NM, 
              BLOB_CONT, 
              IMG_SEND_TYPE_NM, 
              RSTR_ID, 
              UPDR_ID, 
              REG_DT, 
              UPD_DT,              
              SND_STAT_CD, 
              ERR_MSG, 
              RECV_SYS_CD, 
              SND_STAT_CD_SP, 
              ERR_MSG_SP, 
              SND_YMD, 
              SND_HMS,
              RQST_FILE_NM  
          ) VALUES (
                #{interfaceId}
              , #{ifWrkGrpNm}
              , #{ftpTargetId}
              , #{soNo}
              , #{eoNo}
              , #{blId}
              , #{blNo}
              , #{refNo}
              , #{imgDocSprCd}
              , #{corpCd}
              , #{docMergYn}
              , #{blobAtchYn}
              , #{blobFileNm}
              , #{BlobCont}
              , #{imgSendTypeNm}
              , #{rstrId}
              , #{updrId}
              , NOW()
              , NOW()           
              , 'R'
              , ''
              , 'EDMS'
              , ''
              , ''
              , DATE_FORMAT(NOW(), '%Y%m%d')
              , DATE_FORMAT(NOW(), '%H%i%s')
              , #{rqstFileNm}
          )
    </insert>
    
    
    <!-- 이미지전송요청상세정보조회 -->
    <select id="selectImgSendRqstDtlInfo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectImgSendRqstDtlInfo */
        SELECT 
		          #{interfaceId} AS INTERFACE_ID
		        , (@rownum:=@rownum+1) AS SEQ
		        , CASE  WHEN IF(#{ifSingleId}='b2bFW0200', 'b2bFW1340', #{ifSingleId}) = 'b2bFW1340' AND OUTR_CD = '48' 
		          THEN 
		            (CASE
		              WHEN #{exctSprCd}='AR'
		              THEN '48'
		              WHEN #{exctSprCd}='OC'
		              THEN '04'
		            END) /*테스트를 위해 임시처리*/ 
		            ELSE OUTR_CD                                         
		          END  EDMS_DOC_TYPE_CD -- b2bFW0200 : 크레텍책임, b2bFW1340 : LGE PRE BL , 크레텍책임일 경우 전자와 동일
		FROM   TB_COM_CD_MPNG A
		       , (SELECT @rownum:=0) TMP
		WHERE  1=1
		AND    CD_TYPE_CD = 'C'
		AND    CD_MPNG_SPR_NM = 'EDMS_IMG_REQ_IF_DOC_KIND'
		AND    A.USE_YN = 'Y'
		AND    A.INSD_CD = IF(#{ifSingleId}='b2bFW0200', 'b2bFW1340', #{ifSingleId})
		
		<if test='expClassCode != null and expClassCode != ""'>
            AND   A.INSD_CD2 LIKE CONCAT(IFNULL(#{expClassCode}, '') , '%')
        </if>  
    </select>
    
    <!-- 이미지전송요청상세등록 -->
    <insert id="insertImgSendRqstDtl" parameterType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.insertImgSendRqstDtl */
        INSERT INTO NFINF.TB_FWD_INT1011 ( 
              INTERFACE_ID, 
              SEQ, 
              EDMS_DOC_TYPE_CD
          ) VALUES (
                #{interfaceId}
              , #{seq}
              , #{edmsDocTypeCd}
          )
    </insert>
    
    
    <!-- LGEPreBL이미지저장 -->
    <insert id="insertLgEPreBlImg" parameterType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt."insertLgEPreBlImg" */
		INSERT INTO TB_FWD_PREBL_IMG(
		  BL_ID  /* BL ID */
		      , BLOB_FILE_NM  /* BLOB파일명 */
		      , BLOB_CONT    /* BLOB파일 */
		      , REG_DT      /* 등록일시 */
		      , RSTR_ID  
		      , UPD_DT  /* 수정일시 */
		      , UPDR_ID  
		  ) VALUES (
		  #{blId}
		  , #{blobFileNm}
		  , #{blobCont}
		  , NOW()
		  , #{rstrId}
		  , NOW()
		  , #{updrId}
		  )
		  ON DUPLICATE KEY UPDATE
           BLOB_FILE_NM  = #{blobFileNm}
	       , BLOB_CONT = #{blobCont}        
	       , UPDR_ID = #{updrId}
	       , UPD_DT = NOW()
    </insert>
    
    <!-- 이미지전송요청상세정보조회 -->
    <select id="selectLgdHblInfo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgdHblInfo */
        SELECT  
			    'F' AS CHK 
			    , (SELECT CAST(IFNULL(COUNT(INTERFACE_ID), 0) AS CHAR(10))
			          FROM   NFINF.TB_FWD_INT434 
			          WHERE  BL_NO      = A.BL_NO
			          AND    INVOICE_NO = F.REF_NO) AS SEND_CNT  /* 전송회수 */
			       , (SELECT MAX(SUBSTR(CREATION_DATE,1,8))
			          FROM   NFINF.TB_FWD_INT434
			          WHERE  BL_NO      = A.BL_NO
			          AND    INVOICE_NO = F.REF_NO) AS SEND_DT  /* 전송일자 */
			       , A.BL_ID       /* BL ID */
			       , A.MBL_ID        /* MBL ID */
			       , A.BL_NO   /* BL NO */
			       , A.ONBR_CLOS_YN
			       , IF(A.BL_SPR_CD='D', A.BL_NO, A.MBL_NO) AS MBL_NO
			       , A.BL_SPR_CD
			       /* mybatis include로 처리 :: FC_CM_GET_ETC_CD_NM('0055',A.BL_SPR_CD) AS BL_SPR_NM*/
			       , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
	                     <property name="clasCd" value="'0055'"/>
	                     <property name="dtlCd" value="A.BL_SPR_CD"/>
	                 </include>) AS BL_SPR_NM 
			       , F.REF_NO AS  INVOICE_NO /* REF NO */
			       , A.ONBR_YMD /* 선적일자 */           
			       , A.POR_CD   /* POR코드 */
			       , A.POR_NM   /* POR명 */    
			       , A.POL_CD   /* POL코드 */
			       , A.POL_NM   /* POL명 */ 
			       , A.POD_CD   /* POD코드 */
			       , A.POD_NM   /* POD명 */ 
			       , A.PDEL_CD  /* PDEL코드 */
			       , A.PDEL_NM  /* PDEL명*/
			       , A.FDEST_CD /* FDEST코드 */
			       , A.FDEST_NM /* FDEST명 */
			       , A.TRN_TYPE_CD
			       /* mybatis include로 처리 :: FC_CM_GET_ETC_CD_NM('0002',A.TRN_TYPE_CD) AS TRN_TYPE_NM*/
			       , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                         <property name="clasCd" value="'0002'"/>
                         <property name="dtlCd" value="A.TRN_TYPE_CD"/>
                     </include>) AS TRN_TYPE_NM 
			       , F.RPRS_YN AS REP_YN           
			       , A.EXCT_SPR_CD
			       , CASE
			          WHEN 
	                       (<include refid="fwd.common.fwdFuncInclude.fwdFcFwB2biGetCode">
                                <property name="tag" value="'LGD_BL_RESPONSE'"/>
                                <property name="param1" value="'YN'"/>
                                <property name="param2" value="F.REF_NO"/>
                                <property name="param3" value="A.BL_NO"/>
                                <property name="param4" value="NULL"/>
                           </include>) = 'S' /* mybatis include로 처리 :: FC_FW_B2BI_GET_CODE('LGD_BL_RESPONSE', 'YN',  F.REF_NO, A.BL_NO, '')*/
			          THEN 'SUCCESS'
			          WHEN 
			               (<include refid="fwd.common.fwdFuncInclude.fwdFcFwB2biGetCode">
                                <property name="tag" value="'LGD_BL_RESPONSE'"/>
                                <property name="param1" value="'YN'"/>
                                <property name="param2" value="F.REF_NO"/>
                                <property name="param3" value="A.BL_NO"/>
                                <property name="param4" value="NULL"/>
                           </include>) = 'E' /* mybatis include로 처리 :: FC_FW_B2BI_GET_CODE('LGD_BL_RESPONSE', 'YN',  F.REF_NO, A.BL_NO, '')*/
			          THEN 'ERROR'
			         END AS RESULT /*--참조번호, INVOICE번호 확인*/
	               /* mybatis include로 처리 ::FC_CM_GET_ETC_CD_NM('0025', A.EXCT_SPR_CD) EXCT_SPR_NM */
			       , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                         <property name="clasCd" value="'0025'"/>
                         <property name="dtlCd" value="A.EXCT_SPR_CD"/>
                     </include>) AS EXCT_SPR_NM /* BL 구분*/  
			       , D.TASK_SPR_CD
			       , A.CARR_NM
			       , D.CARR_CD
			       , A.PKG_QTY
			       , A.SELL_CWT
			       , (SELECT  IFNULL(CAST(SUM(S.QTY) AS CHAR(10)), 0)
			          FROM    TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
			                , TB_SMT_INTG_ITEM S /* 컨테이너  */
			          WHERE  1=1
			          AND    T.DEL_YN = 'N' /* 삭제여부 */
			          AND    S.DEL_YN = 'N' /* 삭제여부 */
			          AND    T.BL_ID = A.BL_ID
			          AND    T.INTG_ITEM_NO = S.INTG_ITEM_NO
			          AND    S.CNTR_YN = 'Y'
			          <![CDATA[  
			          AND    S.CNTR_SIZE_CD <= '20') AS CNTR_20   /* 컨테이너20 */
			          ]]> 
			       , (SELECT  IFNULL(CAST(SUM(S.QTY) AS CHAR(10)), 0)
			          FROM    TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
			                , TB_SMT_INTG_ITEM S /* 컨테이너  */
			          WHERE  1=1
			          AND    T.DEL_YN = 'N' /* 삭제여부 */
			          AND    S.DEL_YN = 'N' /* 삭제여부 */
			          AND    T.BL_ID = A.BL_ID
			          AND    T.INTG_ITEM_NO = S.INTG_ITEM_NO
			          AND    S.CNTR_YN = 'Y'
			          AND    S.CNTR_SIZE_CD > '20') AS CNTR_40   /* 컨테이너40 */
			       , D.INTG_TASK_NO 
			       , (SELECT BB.INTG_TASK_NO
			          FROM  TB_FWD_BL AA
			              , TB_SMT_INTG_TASK_DEPT BB
			          WHERE AA.BL_ID = A.MBL_ID
			          AND  AA.BL_ID = BB.CST_BL_ID
			          AND  AA.EO_NO = BB.EO_NO
			          AND  IFNULL(AA.DEL_YN, 'N') = 'N'
			          AND  IFNULL(BB.DEL_YN, 'N') = 'N'
			          AND  BB.TASK_SPR_CD = 'EXP'
			          LIMIT 1 ) AS MBL_INTG_TASK_NO
			       , A.SMT_NO
			       , A.EO_NO
			       , RANK() OVER (PARTITION BY A.BL_ID ORDER BY F.REF_NO) AS CHK_RNK   
			       , 'F' AS HBL_CHK
			  FROM   TB_FWD_BL A
			  INNER JOIN TB_SMT_INTG_TASK_DEPT D ON  D.CST_BL_ID = A.BL_ID
			            AND D.EO_NO = A.EO_NO
			            AND IFNULL(D.DEL_YN, 'N') = 'N'
			            AND D.TASK_SPR_CD IN ('EXP', 'TRD')
			  INNER JOIN TB_SMT_ORD E ON  E.SMT_NO = A.SMT_NO
			          AND E.DEL_YN = 'N'       
			  LEFT OUTER JOIN (SELECT S.INTG_KEY_ID, S.REF_NO, S.RPRS_YN
			             FROM   TB_FWD_INTG_REF_NO S
			             WHERE  S.REF_NO_SPR_CD = 'IN'
			             AND    S.DEL_YN = 'N'
			             AND    IF(SUBSTR(#{corpCd},1,1)='B', S.RPRS_YN, 'Y') = 'Y' /* 중국의 경우 MAIN INV만 보이도록 */
			              ) F ON F.INTG_KEY_ID = A.BL_ID
			  WHERE  1=1
			  AND    A.DEL_YN = 'N'
			  AND    A.EXCT_SPR_CD IN ('AR', 'OC', 'EX', 'RL')
			  AND    A.BL_SPR_CD IN ('H','D')
			  AND    EXISTS (SELECT  /*+ NO_UNNEST */ 1 
			                     FROM    TB_COM_CD_MPNG
			                     WHERE   CD_TYPE_CD = 'C'
			                     AND     USE_YN = 'Y'
			                     AND     INSD_CD = E.ORD_BIZPTNR_CD
			                     AND     CD_MPNG_SPR_NM = 'ORDER_CUSTOMER_CODE'
			                     AND     RLT_BIZPTNR_NM = 'LGD'
			                         )
              <![CDATA[  
			  AND    A.ONBR_YMD >= #{fromDt}   
			  AND    A.ONBR_YMD <= #{toDt}
			  ]]> 
			  AND    D.EXCT_BIZPTNR_CD = #{corpCd}
			  
			  <if test='trnTypeCd != null and trnTypeCd != ""'>
                    AND A.TRN_TYPE_CD = #{trnTypeCd}
              </if> 
              <if test='taskSprCd != null and taskSprCd != ""'>
                    AND A.TRN_TYPE_CD = #{taskSprCd}
              </if> 
			  <if test='result != null and result != ""'>
                    AND (<include refid="fwd.common.fwdFuncInclude.fwdFcFwB2biGetCode">
                                <property name="tag" value="'LGD_BL_RESPONSE'"/>
                                <property name="param1" value="'YN'"/>
                                <property name="param2" value="F.REF_NO"/>
                                <property name="param3" value="A.BL_NO"/>
                                <property name="param4" value="NULL"/>
                           </include>) = #{result}
              </if> 
              <if test='blNo != null and blNo != ""'>
                 AND A.BL_NO IN 
                 <foreach collection="blNoList" item="blNo" separator="," open="(" close=")" >
                      #{blNo}
                 </foreach>
              </if>
              <if test='polCd != null and polCd != ""'>
                    AND A.POL_CD LIKE CONCAT(#{polCd}, '%')
              </if>
              <if test='podCd != null and podCd != ""'>
                    AND A.POD_CD LIKE CONCAT(#{podCd}, '%')
              </if>
              <if test='ofcrEmpno != null and ofcrEmpno != ""'>
                    AND D.OFCR_EMPNO = #{ofcrEmpno}
              </if>
              <if test='onbrClosYn != null and onbrClosYn != ""'>
                    AND A.ONBR_CLOS_YN = #{onbrClosYn}
              </if>
              <if test='invoiceNo != null and invoiceNo != ""'>
                    AND (SELECT S.REF_NO
	                     FROM   TB_FWD_INTG_REF_NO S
                         WHERE  1=1
	                     AND    S.INTG_KEY_ID = A.BL_ID
	                     AND    S.DEL_YN = 'N'
	                     AND    S.REF_NO_SPR_CD = 'IN'
	                     LIMIT  1) LIKE CONCAT(#{invoiceNo}, '%')
              </if>
              <if test='cstCd != null and cstCd != ""'>
                    AND (SELECT C.CO_ORG_CD
                         FROM   TB_SMT_CO C
                         WHERE  C.CO_NO = F.REF_NO
                         GROUP BY C.CO_ORG_CD ) = #{cstCd}
              </if>
              <if test='blSprCd != null and blSprCd != ""'>
                    AND A.BL_SPR_CD = #{blSprCd}
              </if>
              <if test='exctSprCd != null and exctSprCd != ""'>
                    AND A.EXCT_SPR_CD = #{exctSprCd}
              </if>
    </select>

    <!-- 이미지전송요청상세정보조회 -->
    <select id="selectLgdHblSendInfo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgdHblSendInfo */
        SELECT A.SENDER_NAME
		       , A.DOCUMENT_STATUS_CODE 
		       , CASE
		          WHEN A.DOCUMENT_STATUS_CODE = 'S'
		          THEN 'SUCCESS'
		          WHEN A.DOCUMENT_STATUS_CODE = 'E'
		          THEN 'ERROR'
		         END AS DOCUMENT_STATUS
		       , A.ERROR_EXPLANATION_TEXT
		       , A.RECEIVE_DATE
		       , A.INTERFACE_ID
		       , A.SEND_RECEIVE_FILE_NAME
		       , A.RESPONSE_DATE
		FROM   NFINF.TB_ISM_INT431 A
		WHERE  1=1
		AND    (( A.DOCUMENT_TYPE_CODE = 'BL' AND A.KEY_FIELD1_NAME LIKE CONCAT(#{invoiceNo}, '%')) AND A.KEY_FIELD2_NAME = #{blNo})
		ORDER BY A.RECEIVE_DATE DESC
    </select>


    <!-- 이미지전송요청상세정보조회 -->
    <select id="selectLgdCarInfo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgdCarInfo */
        SELECT  
			  'F' AS CHK
			    , (SELECT CAST(IFNULL(COUNT(INTERFACE_ID), 0) AS CHAR(10))
			          FROM   NFINF.TB_FWD_INT434 
			          WHERE  BL_NO      = D.RPRS_HBL_NO
			          AND    INVOICE_NO = G.REF_NO) AS SEND_CNT  /* 전송회수 */
			       , (SELECT MAX(SUBSTR(CREATION_DATE,1,8))
			          FROM   NFINF.TB_FWD_INT434
			          WHERE  BL_NO      = D.RPRS_HBL_NO
			          AND    INVOICE_NO = G.REF_NO) AS SEND_DT  /* 전송일자 */
			       , D.SMT_NO        AS BL_ID       /* BL ID */
			       , ''        AS MBL_ID        /* MBL ID */
			       , D.RPRS_HBL_NO   AS BL_NO   /* BL NO */
			       , ''              AS ONBR_CLOS_YN
			       , ''              AS MBL_NO
			       , ''              AS BL_SPR_CD
			       , ''              AS BL_SPR_NM
			       , G.REF_NO        AS INVOICE_NO
			       , D.ONBR_RQST_YMD AS ONBR_YMD /* 선적일자 */           
			       , D.POR_CD   /* POR코드 */
			       /* mybatis include로 처리 :: FC_CM_GET_LOC_NM(D.POR_CD,'ENG_LOC_NM')  */
			       , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetLocNm">
                         <property name="param1" value="D.POR_CD"/>
                         <property name="tag" value="'ENG_LOC_NM'"/>
                     </include>) AS POR_NM   /* POR명 */    
			       , D.POL_CD   /* POL코드 */
			       /* mybatis include로 처리 :: FC_CM_GET_LOC_NM(D.POL_CD,'ENG_LOC_NM')  */
			       , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetLocNm">
                         <property name="param1" value="D.POL_CD"/>
                         <property name="tag" value="'ENG_LOC_NM'"/>
                     </include>) AS POL_NM   /* POL명 */ 
			       , D.POD_CD   /* POD코드 */
			       /* mybatis include로 처리 :: FC_CM_GET_LOC_NM(D.POD_CD,'ENG_LOC_NM')  */
			       , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetLocNm">
                         <property name="param1" value="D.POD_CD"/>
                         <property name="tag" value="'ENG_LOC_NM'"/>
                     </include>) AS POD_NM   /* POD명 */ 
			       , D.PDEL_CD  /* PDEL코드 */
			       /* mybatis include로 처리 :: FC_CM_GET_LOC_NM(D.PDEL_CD,'ENG_LOC_NM') */
			       , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetLocNm">
                         <property name="param1" value="D.PDEL_CD"/>
                         <property name="tag" value="'ENG_LOC_NM'"/>
                     </include>) AS PDEL_NM  /* PDEL명*/
			       , D.PDEL_CD AS FDEST_CD /* FDEST코드 */
			       /* mybatis include로 처리 :: FC_CM_GET_LOC_NM(D.PDEL_CD,'ENG_LOC_NM') */
			       , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetLocNm">
                         <property name="param1" value="D.PDEL_CD"/>
                         <property name="tag" value="'ENG_LOC_NM'"/>
                     </include>) AS FDEST_NM /* FDEST명 */
			       , D.TRN_TYPE_CD
			       /* mybatis include로 처리 :: FC_CM_GET_ETC_CD_NM('0002',D.TRN_TYPE_CD) */
			       , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
	                     <property name="clasCd" value="'0002'"/>
	                     <property name="dtlCd" value="D.TRN_TYPE_CD"/>
	                 </include>) AS TRN_TYPE_NM
			       , ''              AS REP_YN           
			       , 'TRK'           AS EXCT_SPR_CD
			       , CASE
			           WHEN (<include refid="fwd.common.fwdFuncInclude.fwdFcFwB2biGetCode">
                                <property name="tag" value="'LGD_BL_RESPONSE'"/>
                                <property name="param1" value="'YN'"/>
                                <property name="param2" value="G.REF_NO"/>
                                <property name="param3" value="D.RPRS_HBL_NO"/>
                                <property name="param4" value="NULL"/>
                           </include>) = 'S' /* mybatis include로 처리 :: FC_FW_B2BI_GET_CODE('LGD_BL_RESPONSE', 'YN', G.REF_NO, D.RPRS_HBL_NO, '')*/
			           THEN 'SUCCESS'
			           WHEN (<include refid="fwd.common.fwdFuncInclude.fwdFcFwB2biGetCode">
                                <property name="tag" value="'LGD_BL_RESPONSE'"/>
                                <property name="param1" value="'YN'"/>
                                <property name="param2" value="G.REF_NO"/>
                                <property name="param3" value="D.RPRS_HBL_NO"/>
                                <property name="param4" value="NULL"/>
                           </include>) = 'E' /* mybatis include로 처리 :: FC_FW_B2BI_GET_CODE('LGD_BL_RESPONSE', 'YN', G.REF_NO, D.RPRS_HBL_NO, '')*/
			           THEN 'ERROR'
			         END AS RESULT /* 참조번호, INVOICE번호 확인 */
			       , 'Truck'         AS EXCT_SPR_NM /* BL 구분*/
			       , F.TASK_SPR_CD
			       , (SELECT X.CARR_CD
			          FROM   TB_SMT_ORD_TRN_DTL X
			          WHERE  X.SMT_NO = D.SMT_NO
			          AND    X.DEL_YN = 'N'
			          LIMIT  1
			          ) AS CARR_CD
			       , (SELECT X.CARR_CD
			          FROM   TB_SMT_ORD_TRN_DTL X
			          WHERE  X.SMT_NO = D.SMT_NO
			          AND    X.DEL_YN = 'N'
			    LIMIT  1
			          ) AS CARR_NM
			       , D.ORD_QTY    AS PKG_QTY
			       , D.ORD_WGT    AS SELL_CWT
			       , (SELECT  IFNULL(CAST(SUM(S.QTY) AS CHAR(10)), 0)
			          FROM    TB_SMT_INTG_ITEM S /* 컨테이너  */
			          WHERE  1=1
			          AND    S.DEL_YN = 'N' /* 삭제여부 */
			          AND    S.SMT_NO = D.SMT_NO
			          AND    S.CNTR_YN = 'Y'
			          <![CDATA[  
			          AND    S.CNTR_SIZE_CD <= '20') AS CNTR_20 /* 컨테이너20 */
			          ]]> 
			       , (SELECT  IFNULL(CAST(SUM(S.QTY) AS CHAR(10)), 0)
			          FROM    TB_SMT_INTG_ITEM S /* 컨테이너  */
			          WHERE  1=1
			          AND    S.DEL_YN = 'N' /* 삭제여부 */
			          AND    S.SMT_NO = D.SMT_NO
			          AND    S.CNTR_YN = 'Y'
			          <![CDATA[  
			          AND    S.CNTR_SIZE_CD > '20') AS CNTR_40 /* 컨테이너40 */
			          ]]>
			       , F.INTG_TASK_NO 
			       , ''              AS MBL_INTG_TASK_NO
			       , E.SMT_NO
			       , E.EO_NO   
			       , 'CAR' AS  CHK_RNK  
			  FROM   TB_SMT_ORD D  
			  INNER JOIN TB_SMT_ORD_SVC_TYPE E ON  E.SMT_NO = D.SMT_NO
			             AND E.STG_SPR_CD = '1' 
			             AND E.SVC_TYPE_CD = '0040' /* 트럭 */ 
			             AND E.DEL_YN = 'N' 
			  INNER JOIN TB_SMT_INTG_TASK_DEPT F ON  F.SMT_NO = E.SMT_NO
			            AND F.TASK_SPR_CD = 'EXP'
			            AND F.DEL_YN = 'N' 
			  INNER JOIN (SELECT S.INTG_KEY_ID, S.REF_NO, S.RPRS_YN
			           FROM   TB_FWD_INTG_REF_NO S
			           WHERE  S.REF_NO_SPR_CD = 'IN'
			           AND    S.DEL_YN = 'N'
			           AND    S.RPRS_YN = 'Y'
			            ) G ON G.INTG_KEY_ID = D.SMT_NO
			  WHERE  1=1 
			  AND    F.EO_NO = (SELECT  MAX(EO_NO)
			                 FROM TB_SMT_ORD_SVC_TYPE
			                 WHERE E.SMT_NO = SMT_NO
			                 AND  STG_SPR_CD = '1'
			                 AND  SVC_TYPE_CD = '0040' /* 트럭 */
			                 AND  DEL_YN = 'N')               
			/*  --AND    D.SO_PROG_STAT_CD = '40' /* 운송완료 */
			  AND   D.ORD_TYPE_CD IN ('ITRK','DTRK') /* 국제트럭, 국내트럭 */
			  AND   D.DEL_YN = 'N' 
			  AND   D.RPRS_HBL_NO IS NOT NULL 
			  AND    F.EXCT_BIZPTNR_CD = #{corpCd}
			  <![CDATA[  
			  AND    D.ONBR_RQST_YMD >= #{fromDt}   
			  AND    D.ONBR_RQST_YMD <= #{toDt}
			   ]]>
			  AND    D.ORD_BIZPTNR_CD IN (SELECT INSD_CD 
			                              FROM TB_COM_CD_MPNG 
			                              WHERE CD_TYPE_CD = 'C' 
			                              AND USE_YN = 'Y' 
			                              AND CD_MPNG_SPR_NM = 'ORDER_CUSTOMER_CODE' 
			                              AND RLT_BIZPTNR_NM = 'LGD' ) 
			                              
			  <if test='trnTypeCd != null and trnTypeCd != ""'>
                    AND D.TRN_TYPE_CD = #{trnTypeCd}
              </if> 
              <if test='taskSprCd != null and taskSprCd != ""'>
                    AND F.TRN_TYPE_CD = #{taskSprCd}
              </if> 
              <if test='result != null and result != ""'>
                    AND (<include refid="fwd.common.fwdFuncInclude.fwdFcFwB2biGetCode">
                                <property name="tag" value="'LGD_BL_RESPONSE'"/>
                                <property name="param1" value="'YN'"/>
                                <property name="param2" value="A.CO_NO"/>
                                <property name="param3" value="D.RPRS_HBL_NO"/>
                                <property name="param4" value="NULL"/>
                           </include>) = #{result}
              </if> 
              <if test='blNo != null and blNo != ""'>
                 AND D.RPRS_HBL_NO IN 
                 <foreach collection="blNoList" item="blNo" separator="," open="(" close=")" >
                      #{blNo}
                 </foreach>
              </if>
              <if test='polCd != null and polCd != ""'>
                    AND D.POL_CD LIKE CONCAT(#{polCd}, '%')
              </if>
              <if test='podCd != null and podCd != ""'>
                    AND D.POD_CD LIKE CONCAT(#{podCd}, '%')
              </if>
              <if test='ofcrEmpno != null and ofcrEmpno != ""'>
                    AND F.OFCR_EMPNO = #{ofcrEmpno}
              </if>
              <if test='invoiceNo != null and invoiceNo != ""'>
                    AND (SELECT S.REF_NO
                         FROM   TB_FWD_INTG_REF_NO S
                         WHERE  1=1
                         AND    S.INTG_KEY_ID = A.BL_ID
                         AND    S.DEL_YN = 'N'
                         AND    S.REF_NO_SPR_CD = 'IN'
                         LIMIT  1) LIKE CONCAT(#{invoiceNo}, '%')
              </if>
              <if test='cstCd != null and cstCd != ""'>
                    AND (SELECT C.CO_ORG_CD
                         FROM   TB_SMT_CO C
                         WHERE  C.CO_NO = G.REF_NO
                         GROUP BY C.CO_ORG_CD ) = #{cstCd}
              </if>
    </select>
    
    <!-- invoice존재여부조회 -->
    <select id="selectInvExstYn" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectInvExstYn */
        SELECT COUNT(1) AS LN_CNT
	           , DATE_FORMAT(NOW(), '%Y%m%d') AS LV_TODAY
        FROM   TB_FWD_INTG_REF_NO S
        WHERE  1=1
        AND    S.INTG_KEY_ID = #{blId}
        AND    S.DEL_YN = 'N'
        AND    S.REF_NO_SPR_CD = 'IN'
        AND    S.REF_NO = #{invoiceNo}
    </select>
    
    <!-- mainInvoice번호조회 -->
    <select id="selectMaIninVoIceNo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectMaIninVoIceNo */
        SELECT MAX(A.CO_RECV_NO) AS CO_RECV_NO
        FROM   TB_SMT_CO A
        WHERE  A.CO_NO     = #{invoiceNo}
        AND    A.CO_SPR_CD = #{coSprCd}
        AND    A.CO_CST_GRP_CD = #{coCstGrpCd}
    </select>

    <!-- CO확정정보조회 -->
    <select id="selectCoConfInfo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectCoConfInfo */
        SELECT IFNULL(MAX(A.CO_CONF_YN), 'N') AS LV_CONF_YN  /* 확정여부 */
        FROM   TB_SMT_CO A
        WHERE  A.CO_NO = #{invoiceNo}
        AND    A.CO_SPR_CD = '02' /* CI/PL */
        AND    A.DEL_YN = 'N'
    </select>
    
    <!-- 대표Invoice번호조회 -->
    <select id="selectRprsInvNo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectRprsInvNo */
        SELECT S.REF_NO AS CO_RECV_NO
        FROM   TB_FWD_INTG_REF_NO S
        WHERE  1=1
        AND    S.DEL_YN = 'N'
        AND    S.RPRS_YN = 'Y'
        AND    S.INTG_KEY_ID = #{blId}
        AND    S.REF_NO_SPR_CD = 'IN'
        LIMIT  1
    </select>

    <!-- LGD트럭송신정보조회 -->
    <select id="selectLgdCarSndInfo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgdCarSndInfo */
        SELECT      A.RPRS_HBL_NO AS BL_NO   /* BL 번호 */
			      , A.ONBR_RQST_YMD AS ONBR_YMD /* 출항일자 */
			      , A.ONBR_RQST_YMD AS ARR_YMD  /* 입항일자 일단 출항일자와 동일하게 */
			      , A.CST_INCOT_CD AS INCOT_CD /* INCOT 코드 */
			      , A.TRN_TYPE_CD AS TRN_TYPE_CD /* 운송유형코드 */
			      , 'TRK' AS EXCT_SPR_CD /* 실행구분코드 */
			      , A.ORD_WGT AS SELL_GWT /* 매출총중량  */
			      , A.WGT_UNIT_CD AS SELL_WGT_UNIT_CD  /* 매출중량단위코드  */
			      , (SELECT SUM(X.VOL_WGT)
			         FROM   TB_SMT_INTG_ITEM X
			         WHERE  X.SMT_NO = A.SMT_NO
			         AND    X.CNTR_YN = 'Y'
			         AND    X.DEL_YN = 'N' ) AS SELL_VOL_WGT /* 매출부피중량  */
			      , A.CWT AS SELL_CWT  /* 매출CWT  */
			      , A.ORD_VOL AS SELL_CBM  /* 매출CBM */
			      , (SELECT X.CARR_CD
			         FROM   TB_SMT_ORD_TRN_DTL X
			         WHERE  X.SMT_NO = A.SMT_NO
			         AND    X.DEL_YN = 'N'
			         LIMIT  1
			         ) AS CARR_CD               
			      , A.POR_CD
			      , A.POL_CD
			      , A.POD_CD
			      , A.PDEL_CD AS FDEST_CD
			      , IF(#{corpCd}='A100','KRW','USD') AS CUR_CD /* 본사'KRW' 중국 'USD'로 하드코딩  */
			      /* mybatis include로 처리 :: IFNULL(SUBSTR(FC_CM_GET_EDI_NM1('LGD_PORT_MAP_OUT', A.POR_CD ), 1, 5), '') AS LV_POR */ 
			      , IFNULL(SUBSTR((<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm1">
				                         <property name="tag" value="'LGD_PORT_MAP_OUT'"/>
				                         <property name="param1" value="A.POR_CD"/>
			                         </include>), 1, 5), '') AS LV_POR
			      /* mybatis include로 처리 :: IFNULL(SUBSTR(FC_CM_GET_EDI_NM1('LGD_PORT_MAP_OUT', A.POL_CD ), 1, 5), '') AS LV_POL */
			      , IFNULL(SUBSTR((<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm1">
                                         <property name="tag" value="'LGD_PORT_MAP_OUT'"/>
                                         <property name="param1" value="A.POL_CD"/>
                                     </include>), 1, 5), '') AS LV_POL
			      /* mybatis include로 처리 :: IFNULL(IFNULL(FC_CM_GET_EDI_NM1('LGD_PORT_MAP_OUT',A.POD_CD),FC_CM_GET_EDI_NM1('LGD_PORT_MAP_OUT',A.POD_CD )),FC_CM_GET_EDI_NM1('LGD_PORT_MAP_OUT',A.PDEL_CD))*/ 
			      , IFNULL(
			                  IFNULL(   (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm1">
	                                         <property name="tag" value="'LGD_PORT_MAP_OUT'"/>
	                                         <property name="param1" value="A.POD_CD"/>
	                                     </include>)
			                          , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm1">
                                             <property name="tag" value="'LGD_PORT_MAP_OUT'"/>
                                             <property name="param1" value="A.POD_CD"/>
                                         </include>) 
                                     )
			                , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm1">
                                             <property name="tag" value="'LGD_PORT_MAP_OUT'"/>
                                             <property name="param1" value="A.PDEL_CD"/>
                                         </include>) ) AS LV_POD /* 필수 값 */
			      /* mybatis include로 처리 :: IFNULL(IFNULL(FC_CM_GET_EDI_NM1('LGD_PORT_MAP_OUT',A.PDEL_CD),FC_CM_GET_EDI_NM1('LGD_PORT_MAP_OUT',A.PDEL_CD)), A.PDEL_CD)*/
			      , IFNULL(
			                 IFNULL(
			                           (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm1">
                                             <property name="tag" value="'LGD_PORT_MAP_OUT'"/>
                                             <property name="param1" value="A.PDEL_CD"/>
                                         </include>)
                                      , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm1">
                                             <property name="tag" value="'LGD_PORT_MAP_OUT'"/>
                                             <property name="param1" value="A.PDEL_CD"/>
                                         </include>) 
		                            )
			                , A.PDEL_CD) AS LV_FDEST /* 필수 값 */
			      , A.SMT_NO            
		FROM      TB_SMT_ORD A
		WHERE     1=1
		AND       A.DEL_YN = 'N'
		AND       A.SMT_NO = #{blId}
    </select>

    <!-- HBL정보조회 -->
    <select id="selectHblInfo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectHblInfo */
        SELECT  A.BL_NO   /* BL 번호 */
		      , A.ONBR_YMD /* 출항일자 */
		      , A.ARR_YMD  /* 입항일자 */
		      , A.INCOT_CD /* INCOT 코드 */
		      , A.TRN_TYPE_CD /* 운송유형코드 */
		      , A.EXCT_SPR_CD /* 실행구분코드 */
		      , A.SELL_GWT /* 매출총중량  */
		      , A.SELL_WGT_UNIT_CD  /* 매출중량단위코드  */
		      , A.SELL_VOL_WGT /* 매출부피중량  */
		      , A.SELL_CWT  /* 매출CWT  */
		      , A.SELL_CBM  /* 매출CBM */
		      , D.CARR_CD   /* 운송사코드 */               
		      , A.POR_CD
		      , A.POL_CD
		      , A.POD_CD
		      , A.FDEST_CD
		      , IF(#{corpCd}='A100','KRW','USD') AS CUR_CD /* 본사'KRW' 중국 'USD'로 하드코딩  */
		      /* mybatis include로 처리 :: IFNULL(FC_CM_MPNG_TRANSMIT('OM','02','CUSTOMER_CODE',D.CARR_CD,NULL,NULL,'1'),FC_CM_MPNG_TRANSMIT('OM','02','CUSTOMER_CODE',D.AGNT_CD,NULL,NULL,'1')) LV_LINE_CD */
		      , IFNULL( (<include refid="fwd.common.fwdFuncInclude.fwdFcCmMpgnTransmit">
                             <property name="param1" value="'OM'"/>
                             <property name="param2" value="'02'"/>
                             <property name="param3" value="'CUSTOMER_CODE'"/>
                             <property name="param4" value="D.CARR_CD"/>
                             <property name="param5" value="NULL"/>
                             <property name="param6" value="NULL"/>
                             <property name="param7" value="'1'"/>
                         </include>)
		                ,
		                (<include refid="fwd.common.fwdFuncInclude.fwdFcCmMpgnTransmit">
                             <property name="param1" value="'OM'"/>
                             <property name="param2" value="'02'"/>
                             <property name="param3" value="'CUSTOMER_CODE'"/>
                             <property name="param4" value="D.AGNT_CD"/>
                             <property name="param5" value="NULL"/>
                             <property name="param6" value="NULL"/>
                             <property name="param7" value="'1'"/>
                         </include>)) AS LV_LINE_CD /* AGEN_CD 추가, GSI 운송사 방식 변경 LGD팀 서희정D 요청 */
		      /* mybatis include로 처리 :: IFNULL(SUBSTR(FC_CM_GET_EDI_NM1('LGD_PORT_MAP_OUT', A.POR_CD ), 1, 5), '') LV_POR*/
		      , IFNULL(SUBSTR((<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm1">
                                   <property name="tag" value="'LGD_PORT_MAP_OUT'"/>
                                   <property name="param1" value="A.POR_CD"/>
                               </include>)
                              , 1, 5), '') AS LV_POR
		      /* mybatis include로 처리 :: IFNULL(SUBSTR(FC_CM_GET_EDI_NM1('LGD_PORT_MAP_OUT', A.POL_CD ), 1, 5), '')   LV_POL*/
		      , IFNULL(SUBSTR((<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm1">
                                   <property name="tag" value="'LGD_PORT_MAP_OUT'"/>
                                   <property name="param1" value="A.POL_CD"/>
                               </include>)
                              , 1, 5), '') AS LV_POL
		      /* mybatis include로 처리 :: DECODE(corpCd,'A100',IFNULL(SUBSTR(FC_CM_GET_EDI_NM1('LGD_PORT_MAP_OUT', A.POD_CD ), 1, 5), ''),IFNULL(IFNULL(FC_CM_GET_EDI_NM1('LGD_PORT_MAP_OUT',A.POD_CD ),FC_CM_GET_EDI_NM1('LGD_PORT_MAP_OUT',A.POD_CD)),FC_CM_GET_EDI_NM1('LGD_PORT_MAP_OUT',A.FDEST_CD))) AS LV_POD*/
		      , IF(#{corpCd}= 'A100'
		                      , IFNULL( SUBSTR((<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm1">
				                                    <property name="tag" value="'LGD_PORT_MAP_OUT'"/>
				                                    <property name="param1" value="A.POD_CD"/>
				                                </include>), 1, 5)
				                        , '')
                              , IFNULL(
                                         IFNULL(
                                                  (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm1">
	                                                    <property name="tag" value="'LGD_PORT_MAP_OUT'"/>
	                                                    <property name="param1" value="A.POD_CD"/>
	                                                </include>)
                                                , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm1">
                                                        <property name="tag" value="'LGD_PORT_MAP_OUT'"/>
                                                        <property name="param1" value="A.POD_CD"/>
                                                    </include>)
                                               )
                                       , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm1">
                                              <property name="tag" value="'LGD_PORT_MAP_OUT'"/>
                                              <property name="param1" value="A.FDEST_CD"/>
                                          </include>)
                                       )
                ) AS LV_POD                
		      /* mybatis include로 처리 :: DECODE(corpCd,'A100',IFNULL(SUBSTR(FC_CM_GET_EDI_NM1('LGD_PORT_MAP_OUT', A.FDEST_CD ), 1, 5), ''),IFNULL(IFNULL(FC_CM_GET_EDI_NM1('LGD_PORT_MAP_OUT',A.FDEST_CD),FC_CM_GET_EDI_NM1('LGD_PORT_MAP_OUT',A.FDEST_CD)), A.FDEST_CD)) AS LV_FDEST*/            
		    , IF(#{corpCd} = 'A100'
		                    , IFNULL( SUBSTR((<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm1">
                                                    <property name="tag" value="'LGD_PORT_MAP_OUT'"/>
                                                    <property name="param1" value="A.FDEST_CD"/>
                                                </include>), 1, 5)
                                        , '')
                            , IFNULL(
                                       IFNULL(
                                                 (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm1">
	                                                    <property name="tag" value="'LGD_PORT_MAP_OUT'"/>
	                                                    <property name="param1" value="A.FDEST_CD"/>
	                                                </include>)
                                               , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm1">
	                                                    <property name="tag" value="'LGD_PORT_MAP_OUT'"/>
	                                                    <property name="param1" value="A.FDEST_CD"/>
	                                                </include>)
                                              )
                                     , A.FDEST_CD
                              )
               ) AS LV_FDEST                        
		      , (SELECT X.SHIPPING_LINE1_CODE  
		         FROM  NFINF.TB_FWD_INT454 X
		         WHERE  BL_NO = A.BL_NO
		         AND  X.SHIPPING_LINE1_CODE  IS NOT NULL
		         LIMIT  1) AS OTH_SHIPPING_LINE1_CODE                                   
		FROM   TB_FWD_BL A
		     , TB_SMT_INTG_TASK_DEPT D  /* 통합실행부서*/
		WHERE  1=1
		AND    A.BL_ID = D.CST_BL_ID
		AND    A.EO_NO = D.EO_NO
		AND    A.BL_SPR_CD IN ('H','D')
		AND    D.TASK_SPR_CD = 'EXP'
		AND    A.DEL_YN = 'N'
		AND    D.DEL_YN = 'N'
		AND    A.BL_ID = #{blId}
    </select>
    
    <!-- CIPL정보조회 -->
    <select id="selectCiPlInfo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectCiPlInfo */
        SELECT A.CO_NO /* co번호 */
		     , A.CO_ORG_CD /* co조직코드 */
		     , A.CO_INVC_CUR_CD /* co상업송장통화코드  */
		     , A.CO_INVC_YMD    /* co상업송장일자 */
		     , A.CO_TRN_TYPE_CD /* co운송유형코드 */
		     , A.CO_GWT /* co총중량 */
		     , A.CO_CBM /* cocbm */
		     , A.CO_EXP_DECL_NO /* co수출신고번호 */
		     , A.CO_INVC_REPRT_YN /* co상업송장재발행여부 */
		     , A.CO_INVC_REPRT_ORIGN_NO /* co상업송장재발행원본여부 */
		     , A.CO_INVC_SPLIT_YN /* co상업송장분할여부 */
		     , A.CO_INVC_SPLIT_ORIGN_NO /* co상업송장분할원본번호 */
		     , A.CO_COMB_YN /* co콤바인여부 */
		     , A.CO_SHPP_NM /* co송화주명 */
		     , A.CO_CNEE_NM /* co수화주명 */
		     , A.CO_SHIPLN1_CD /* co선사1코드 */
		     , A.CO_SHIPLN2_CD /* co선사2코드 */
		     , A.CO_NTPR_NM 
		     , B.CO_SALES_EMP_ID /* CO영업사원ID */
		     , B.CO_SALES_EMP_NM /* CO영업사원명 */
		     , B.CO_ARRPLC_TRN_TYPE_CD /* CO도착지운송유형코드 */
		     , B.CO_SHTT_TRN_CNT /* CO셔틀운송건수 */
		     , B.CO_CARR1_CD /* CO운송사1코드 */
		     , B.CO_CARR2_CD /* CO운송사2코드 */
		     , B.CO_DOM_EXP_SPR_CD /* CO국내수출구분코드 */
		     , B.CO_MLT_CNT_FDEST_YN /* CO다수FDEST여부 */
		     , B.CO_MLT_CNT_FDEST_CD  /* CO다수FDEST코드 */
		     , A.CO_INVC_AMT /* CO상업송장금액  */
		     , A.CO_INCOT_CD /* COINCOT코드 */
		     , A.CO_RECV_NO /* CO수신번호 */
		     , SUBSTR(B.CO_SHPP_ADDR1,1,100) CO_SHPP_ADDR1 /* 중국 트럭건의 경우 100자리 넘게 들어오는 경우가 있음 */
		     , SUBSTR(B.CO_SHPP_ADDR2,1,100) CO_SHPP_ADDR2 /* 중국 트럭건의 경우 100자리 넘게 들어오는 경우가 있음 */
		     , B.CO_SHPP_ADDR3
		     , B.CO_SHPP_ADDR4
		     , B.CO_SHPP_ADDR5
		     , B.CO_CNEE_TEL_NO1
		     , B.CO_CNEE_TEL_NO2
		     , B.CO_CNEE_ADDR1
		     , B.CO_CNEE_ADDR2
		     , B.CO_CNEE_ADDR3
		     , B.CO_CNEE_ADDR4
		     , B.CO_CNEE_ADDR5
		     , B.CO_CNEE_TEL_NO1
		     , B.CO_CNEE_TEL_NO2
		     , B.CO_NTPR_ADDR1
		     , B.CO_NTPR_ADDR2
		     , B.CO_NTPR_ADDR3
		     , B.CO_NTPR_ADDR4
		     , B.CO_NTPR_ADDR5
		     , B.CO_NTPR_TEL_NO1
		     , B.CO_NTPR_TEL_NO2
		     /* mybatis include로 처리 :: IFNULL(FC_CM_GET_EDI_NM1('LGD_PORT_MAP_OUT', A.POR_CD ), A.POL_CD)   LV_POR_CN*/
		     , IFNULL((<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm1">
                           <property name="tag" value="'LGD_PORT_MAP_OUT'"/>
                           <property name="param1" value="A.POR_CD"/>
                       </include>), A.POL_CD) AS LV_POR_CN
		     /* mybatis include로 처리 :: IFNULL(FC_CM_GET_EDI_NM1('LGD_PORT_MAP_OUT', A.POL_CD ), A.POL_CD)   LV_POL_CN*/
		     , IFNULL((<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm1">
                           <property name="tag" value="'LGD_PORT_MAP_OUT'"/>
                           <property name="param1" value="A.POL_CD"/>
                       </include>), A.POL_CD) AS LV_POL_CN
		     /* mybatis include로 처리 :: IFNULL(FC_CM_GET_EDI_NM1('LGD_PORT_MAP_OUT', A.POD_CD ), A.PDEL_CD) LV_POD_CN*/  
		     , IFNULL((<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm1">
                           <property name="tag" value="'LGD_PORT_MAP_OUT'"/>
                           <property name="param1" value="A.POD_CD"/>
                       </include>), A.PDEL_CD) AS LV_POD_CN
		     /* mybatis include로 처리 :: IFNULL(FC_CM_GET_EDI_NM1('LGD_PORT_MAP_OUT', A.PDEL_CD ), A.PDEL_CD) LV_PDEL_CN*/
		     , IFNULL((<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm1">
                           <property name="tag" value="'LGD_PORT_MAP_OUT'"/>
                           <property name="param1" value="A.PDEL_CD"/>
                       </include>), A.PDEL_CD) AS LV_PDEL_CN
		     , IF(#{corpCd}='A100','',(SELECT CONCAT(MAX(CAST(IFNULL(FILE_SEQ,'0') AS UNSIGNED)) + 1,'FM00')
		                               FROM   NFINF.TB_FWD_INT434 X
		                               WHERE  X.INVOICE_NO = A.CO_NO
		                               AND    SUBSTR(X.CREATION_DATE,1,8) = DATE_FORMAT(NOW(), '%Y%m%d'))) AS LV_FILE_SEQ
		FROM   TB_SMT_CO A
		      ,TB_SMT_CO_EXPND B
		WHERE  1=1
		AND    A.CO_RECV_NO = B.CO_RECV_NO
		AND    A.CO_SPR_CD = '02' /* CI/PL */
		AND    A.CO_RECV_NO = #{coRecvNo}
		AND    A.DEL_YN = 'N'
    </select>
    
    <!-- 중국CIPL정보조회 -->
    <select id="selectChnCiPlInfo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectChnCiPlInfo */
        SELECT A.CO_NO /* co번호 */
		     , A.CO_ORG_CD /* co조직코드 */
		     , A.CO_INVC_CUR_CD /* co상업송장통화코드  */
		     , A.CO_INVC_YMD    /* co상업송장일자 */
		     , A.CO_TRN_TYPE_CD /* co운송유형코드 */
		     , A.CO_GWT /* co총중량 */
		     , A.CO_CBM /* cocbm */
		     , A.CO_EXP_DECL_NO /* co수출신고번호 */
		     , A.CO_INVC_REPRT_YN /* co상업송장재발행여부 */
		     , A.CO_INVC_REPRT_ORIGN_NO /* co상업송장재발행원본여부 */
		     , A.CO_INVC_SPLIT_YN /* co상업송장분할여부 */
		     , A.CO_INVC_SPLIT_ORIGN_NO /* co상업송장분할원본번호 */
		     , A.CO_COMB_YN /* co콤바인여부 */
		     , A.CO_SHPP_NM /* co송화주명 */
		     , A.CO_CNEE_NM /* co수화주명 */
		     , A.CO_SHIPLN1_CD /* co선사1코드 */
		     , A.CO_SHIPLN2_CD /* co선사2코드 */
		     , A.CO_NTPR_NM 
		     , B.CO_SALES_EMP_ID /* CO영업사원ID */
		     , B.CO_SALES_EMP_NM /* CO영업사원명 */
		     , B.CO_ARRPLC_TRN_TYPE_CD /* CO도착지운송유형코드 */
		     , B.CO_SHTT_TRN_CNT /* CO셔틀운송건수 */
		     , B.CO_CARR1_CD /* CO운송사1코드 */
		     , B.CO_CARR2_CD /* CO운송사2코드 */
		     , B.CO_DOM_EXP_SPR_CD /* CO국내수출구분코드 */
		     , B.CO_MLT_CNT_FDEST_YN /* CO다수FDEST여부 */
		     , B.CO_MLT_CNT_FDEST_CD  /* CO다수FDEST코드 */
		     , A.CO_INVC_AMT /* CO상업송장금액  */
		     , A.CO_INCOT_CD /* COINCOT코드 */
		     , A.CO_RECV_NO /* CO수신번호 */
		     , SUBSTR(B.CO_SHPP_ADDR1,1,100) CO_SHPP_ADDR1 /* 중국 트럭건의 경우 100자리 넘게 들어오는 경우가 있음 */
		     , SUBSTR(B.CO_SHPP_ADDR2,1,100) CO_SHPP_ADDR2 /* 중국 트럭건의 경우 100자리 넘게 들어오는 경우가 있음 */
		     , B.CO_SHPP_ADDR3
		     , B.CO_SHPP_ADDR4
		     , B.CO_SHPP_ADDR5
		     , B.CO_CNEE_TEL_NO1
		     , B.CO_CNEE_TEL_NO2
		     , B.CO_CNEE_ADDR1
		     , B.CO_CNEE_ADDR2
		     , B.CO_CNEE_ADDR3
		     , B.CO_CNEE_ADDR4
		     , B.CO_CNEE_ADDR5
		     , B.CO_CNEE_TEL_NO1
		     , B.CO_CNEE_TEL_NO2
		     , B.CO_NTPR_ADDR1
		     , B.CO_NTPR_ADDR2
		     , B.CO_NTPR_ADDR3
		     , B.CO_NTPR_ADDR4
		     , B.CO_NTPR_ADDR5
		     , B.CO_NTPR_TEL_NO1
		     , B.CO_NTPR_TEL_NO2
		     /* mybatis include로 처리 :: IFNULL(FC_CM_GET_EDI_NM1('LGD_PORT_MAP_OUT', A.POR_CD ), A.POL_CD)   LV_POR_CN*/
             , IFNULL((<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm1">
                           <property name="tag" value="'LGD_PORT_MAP_OUT'"/>
                           <property name="param1" value="A.POR_CD"/>
                       </include>), A.POL_CD) AS LV_POR_CN
             /* mybatis include로 처리 :: IFNULL(FC_CM_GET_EDI_NM1('LGD_PORT_MAP_OUT', A.POL_CD ), A.POL_CD)   LV_POL_CN*/
             , IFNULL((<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm1">
                           <property name="tag" value="'LGD_PORT_MAP_OUT'"/>
                           <property name="param1" value="A.POL_CD"/>
                       </include>), A.POL_CD) AS LV_POL_CN
             /* mybatis include로 처리 :: IFNULL(FC_CM_GET_EDI_NM1('LGD_PORT_MAP_OUT', A.POD_CD ), A.PDEL_CD) LV_POD_CN*/  
             , IFNULL((<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm1">
                           <property name="tag" value="'LGD_PORT_MAP_OUT'"/>
                           <property name="param1" value="A.POD_CD"/>
                       </include>), A.PDEL_CD) AS LV_POD_CN
             /* mybatis include로 처리 :: IFNULL(FC_CM_GET_EDI_NM1('LGD_PORT_MAP_OUT', A.PDEL_CD ), A.PDEL_CD) LV_PDEL_CN*/
             , IFNULL((<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm1">
                           <property name="tag" value="'LGD_PORT_MAP_OUT'"/>
                           <property name="param1" value="A.PDEL_CD"/>
                       </include>), A.PDEL_CD) AS LV_PDEL_CN
		     , IF(#{corpCd}='A100','',(SELECT CONCAT(MAX(CAST(IFNULL(FILE_SEQ,'0') AS UNSIGNED)) + 1,'FM00')
		                               FROM   NFINF.TB_FWD_INT434 X
		                               WHERE  X.INVOICE_NO = A.CO_NO
		                               AND    SUBSTR(X.CREATION_DATE,1,8) = DATE_FORMAT(NOW(), '%Y%m%d'))) AS LV_FILE_SEQ
		FROM   TB_SMT_CO A
		INNER JOIN TB_SMT_CO_EXPND B ON B.CO_RECV_NO = A.CO_RECV_NO
		INNER JOIN TB_SMT_ORD_CO_RELT C ON  C.CO_RECV_NO = A.CO_RECV_NO
		        AND C.DEL_YN = 'N'
		WHERE  1=1
		AND    A.CO_SPR_CD = '02' /* CI/PL */
		AND    A.CO_NO = #{coRecvNo}
		AND    A.DEL_YN = 'N'
    </select>
    
    <!-- 중국CIPL정보조회 -->
    <select id="selectIfSeq" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectIfSeq */
        SELECT (IFNULL(MAX(INTERFACE_SEQ_NO),0) + 1) AS LN_INTERFACE_SEQ_NO
		FROM   NFINF.TB_FWD_INT434
		WHERE  BL_NO        =   #{blNo}   
		AND    INVOICE_NO   =   #{invoiceNo}
    </select>
    
    
    <!-- LGD인터페이스434테이블등록 -->
    <insert id="insertLgdIf434Tbl" parameterType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.insertLgdIf434Tbl */
        INSERT INTO NFINF.TB_FWD_INT434 
                          ( INTERFACE_ID
                           ,BL_NO                                     /* 선하증권번호 */ 
                           ,INTERFACE_SEQ_NO                          /* 인터페이스일련순서번호(Invoice별 전송 횟수) */
                           ,INVOICE_NO                                /* 송장번호(물류비 정산 단위) */
                           ,ORGANIZATION_CODE                         /* 조직코드 */
                           ,BL_DATE                                   /* BL 발행일자 */
                           ,INVOICE_DATE                              /* 송장일자 */
                           ,INVOICE_CURRENCY_CODE                     /* 송장통화코드 */
                           ,INVOICE_AMOUNT                            /* 송장금액 */
                           ,PRICE_TERMS_CODE                          /* 가격조건코드(매출 확정 TERM (DDU, CIF) -Incoterms) */
                           ,SALESPERSON_ID                            /* 영업사원아이디(Invoice 생성 영업사원 또는 통문 정보 생성자 ID) */
                           ,SALESPERSON_NAME                          /* 영업사원명(Invoice 생성 영업사원 또는 통문 정보 생성자 이름) */
                           ,SHIP_METHOD_CODE                          /* 운송방법코드(SEA:SEA SAA:SEA_AIR AIR:AIR, FRY:FERRY TRN:RAIL TRK:TRUCK) */
                           ,SHIPPING_METHOD_CODE                      /* 출하방법코드(000001_AIR_A_EXP_AIR, 000001_SEA_O_EXP_SEA) */
                           ,DEST_SHIPMENT_METHOD_CODE                 /* 목적지운송방법코드(R:RAIL T:TRUCK) */
                           ,SHUTTLE_COUNT                             /* 셔틀횟수(0:셔틀아님 1:One Way 2:Two Way) */
                           ,SHIPPING_LINE1_CODE                       /* 선사1코드 */
                           ,SHIPPING_LINE2_CODE                       /* 선사2코드 */
                           ,CARRIER1_CODE                             /* 운송사1코드(국내 내륙 운송사1코드  ) */
                           ,CARRIER2_CODE                             /* 운송사2코드(국내 내륙 운송사2코드 ) */
                           ,DEPARTURE_PLACE_CODE                      /* 출발지장소코드(출발지: 파주, 구미, 남경) */
                           ,LOADING_PORT_CODE                         /* 선적항코드(출발항: 인천, 부산, 군산) */
                           ,VIA_PORT_CODE                             /* via항구코드(경유항: 위해, 연천) */
                           ,DESTINATION_PORT_CODE                     /* 목적항코드(도착항: 남경, 암스테르담) */
                           ,FINAL_DESTINATION_CODE                    /* 최종목적지코드(최종도착지: 남경, 뒤셀도르프) */
                           ,NET_WEIGHT                                /* 순중량 */
                           ,GROSS_WEIGHT                              /* 총체중량 */
                           ,WEIGHT_UOM_CODE                           /* 총체중량UOM코드 */
                           ,TOTAL_CBM                                 /* 총CBM */
                           ,CHARGEABLE_WEIGHT                         /* 2008.7.14 추가 */
                           ,DOMESTIC_EXPORT_CODE                      /* 내수수출유형코드(수출, 내수 구분) */
                           ,EXPORT_DECLARATION_NO                     /* 수출신고번호(세관에서 통관절차후 발행하는 수출 허가번호) */
                           ,CC_NO                                     /* 수출통관번호 */
                           ,CC_DATE                                   /* 통관일자 */
                           ,REINVOICE_FLAG                            /* 매출재생성여부(Reinvoice 여부) */
                           ,REINVOICE_ORIGIN_INVOICE_NO               /* 매출재생성원천송장번호(Reinvoice 이전의 orginal invoice Number) */
                           ,INVOICE_SPLIT_FLAG                        /* 송장분할여부 */
                           ,ORIGINAL_INVOICE_NO                       /* 원송장번호 */
                           ,COMBINE_FLAG                              /* 컴바인여부(복수의 INVOICE가 한 CONTAINER에 선적되는 경우) */
                           ,MULTI_FINAL_DESTINATION_FLAG              /* 복수최종목적지여부(MULTI DORP 여부) */
                           ,MULTI_FINAL_DESTINATION_CODE              /* 복수최종목적지코드 */
                           ,APPOINTMENT_FROM_DATE                     /* 약정 From일자 */
                           ,APPOINTMENT_TO_DATE                       /* 약정 To일자 */
                           ,SHIPPER_NAME                              /* 화주명 */
                           ,SHIPPER_ADDRESS1_INFO                     /* 화주주소1정보 */
                           ,SHIPPER_ADDRESS2_INFO                     /* 화주주소2정보 */
                           ,SHIPPER_CITY_NAME                         /* 화주시명 */
                           ,SHIPPER_STATE_NAME                        /* 화주도명 */
                           ,SHIPPER_POSTAL_CODE                       /* 화주우편번호 */
                           ,SHIPPER_PHONE1_NO                         /* 화주전화1번호 */
                           ,SHIPPER_PHONE2_NO                         /* 화주전화2번호 */
                           ,CONSIGNEE_NAME                            /* 수하인명(Bill To Name) */
                           ,CONSIGNEE_ADDRESS1_INFO                   /* 수하인주소1정보(Bill To Address 1) */
                           ,CONSIGNEE_ADDRESS2_INFO                   /* 수하인주소2정보(Bill To Address 2) */
                           ,CONSIGNEE_CITY_NAME                       /* 수하인시명(Bill To City Name) */
                           ,CONSIGNEE_STATE_NAME                      /* 수하인도명(Bill To State Name) */
                           ,CONSIGNEE_POSTAL_CODE                     /* 수하인우편번호(Bill To Zip Code) */
                           ,CONSIGNEE_PHONE1_NO                       /* 수하인전화1번호(Bill To Telephone Number1) */
                           ,CONSIGNEE_PHONE2_NO                       /* 수하인전화2번호(Bill To Telephone Number1) */
                           ,NOTIFY_PARTY_NAME                         /* 통지인명(Ship To Name) */
                           ,NOTIFY_PARTY_ADDRESS1_INFO                /* 통지인주소1정보(Ship To Address 1) */
                           ,NOTIFY_PARTY_ADDRESS2_INFO                /* 통지인주소2정보(Ship To Address 2) */
                           ,NOTIFY_PARTY_CITY_NAME                    /* 통지인시명(Ship To City Name) */
                           ,NOTIFY_PARTY_STATE_NAME                   /* 통지인도명(Ship To State Name) */
                           ,NOTIFY_PARTY_POSTAL_CODE                  /* 통지인우편번호(Ship To Zip Code) */
                           ,NOTIFY_PARTY_PHONE1_NO                    /* 통지인전화1번호(Ship To Telephone Number1) */
                           ,NOTIFY_PARTY_PHONE2_NO                    /* 통지인전화2번호(Ship To Telephone Number1) */
                           ,FREIGHT_CURRENCY_CODE                     /* 물류비통화코드 */
                           ,REMARK_DESC                               /* 소견설명 */
                           ,CANCEL_FLAG                               /* 취소여부 */
                           ,CANCEL_DATE                               /* 취소일자 */
                           ,CANCEL_REASON_DESC                        /* 취소사유설명 */
                           ,CANCEL_USER_ID                            /* 취소사용자아이디 */
                           ,SEND_TYPE_CODE                            /* 발신유형코드(I:신규 U:수정 D:삭제) */
                           ,TRANSFER_FLAG                             /* 전송여부(SEO 마스터 반영 여부) */
                           ,TRANSFER_DATE                             /* 전송일자(SEO 마스터 반영 일자) */
                           ,ERROR_MESSAGE_TEXT                        /* 오류메세지텍스트(SEO 마스터 반영 오류) */
                           ,SEND_RECEIVE_FILE_NAME                    /* 선사에서 발생한 문서 이름 */
                           ,CREATION_DATE                             /* 생성일자 */
                           ,CREATED_BY                                /* 생성자 */
                           ,LAST_UPDATE_DATE                          /* 최종수정일자 */
                           ,LAST_UPDATED_BY                           /* 최종수정자 */
                           ,LAST_UPDATE_LOGIN                         /* 최종수정로그인 */
                           ,INS_ID
                           ,TIMESTAMP
                           ,FILE_SEQ
                           ,ATTRIBUTE6
                           ,ATTRIBUTE7
                           ,ATTRIBUTE8
                          )
                   VALUES ( #{interfaceId}            /* INTERFACE_ID */
                           ,#{blNo}                   /* BL_NO */
                           ,#{interfaceSeqNo}         /* INTERFACE_SEQ_NO */
                           ,#{coNo}                   /* INVOICE_NO */
                           ,#{coOrgCd}                /* ORGANIZATION_CODE */
                           ,RPAD(#{onbrYmd},14,'0')  /* BL_DATE -- ONBOARD로 변경 */
                           ,RPAD(#{coInvcYmd},14,'0') /* INVOICE_DATE  */
                           ,#{coInvcCurCd}            /* INVOICE_CURRENCY_CODE */
                           ,IFNULL(#{coInvcAmt},0)       /* INVOICE_AMOUNT */
                           ,#{incotCd}                /* PRICE_TERMS_CODE */
                           ,#{salesPersonId}          /* SALESPERSON_ID */
                           ,#{salesPersonNm}          /* SALESPERSON_NAME  */
                           ,#{coTrnTypeCd}            /* SHIP_METHOD_CODE -- 중요컬럼 */
                           ,NULL                      /* SHIPPING_METHOD_CODE */
                           ,#{coArrplcTrnTypeCd}      /* DEST_SHIPMENT_METHOD_CODE */
                           ,#{coShttTrnCnt}           /* SHUTTLE_COUNT */
                           ,#{coShipln1Cd} 
                           /* 
                           SHIPPING_LINE1_CODE 중국 : 'CN003188', 'CN000734', 본사 : 'KR001634'
                           --SHIPPING_LINE1_CODE 본사 :,(SELECT INSD_CD FROM TB_CM_CD_MPNG WHERE CD_MPNG_SPR_NM = 'LGD_GSI_CM_CODE' AND OUTR_CD ='01')
                           --SHIPPING_LINE1_CODE 중국 : SAJ011.SHIP_LINE1_CD
                           */
                           ,#{lvLineCd} 
                           /*
                            SHIPPING_LINE2_CODE
                           --SHIPPING_LINE2_CODE 본사 : DECODE(FWJ010.SHIP_METHOD, 'FRY', LV_LINE_CD, LV_LINE_CD) => 전환 DECODE({coTrnTypeCd}, 'FRY', {lvLineCd} ,{lvLineCd})
                           --SHIPPING_LINE2_CODE 중국 : DECODE(Fc_Cm_Get_Cd('OUT','603',SAJ010.SHIP_METHOD), 'TRK', SAJ011.SHIP_LINE2_CD, Fc_Cm_Get_Cd('OUT','612',SAC001.CARRIER_CD))
                           */
                           ,#{coCarr1Cd}              /* CARRIER1_CODE */
                           ,#{coCarr2Cd}              /* CARRIER2_CODE */
                           ,#{lvPor}                  /* DEPARTURE_PLACE_CODE */
                           ,#{lvPol}                  /* LOADING_PORT_CODE */
                           ,(CASE
                              WHEN #{trnTypeCd} = 'SAA'
                              THEN #{lvPod}
                              WHEN #{trnTypeCd} = 'RAL'
                              THEN #{lvPod}
                              ELSE NULL
                            END)       /* VIA_PORT_CODE Sea / Air 인 경우 Via Port Code로 전송 */
                           ,IF(#{trnTypeCd}='SAA', #{lvFdest}, #{lvPod})  /* DESTINATION_PORT_CODE */
                           ,#{lvFdest}                /* FINAL_DESTINATION_CODE */
                           ,NULL                      /* NET_WEIGHT --  bl은 순중량 관리 없음 */
                           ,IF(#{exctSprCd}='OC', #{coGwt}, #{sellGwt})   /* GROSS_WEIGHT -- 해운일 경우 수신된 GROSS_WEIGHT 를, 해운이 아니 경우 HBL상의 SHPR_GRS_WT 송신 */
                           ,(SELECT OUTR_CD FROM TB_COM_CD_MPNG  WHERE CD_MPNG_SPR_NM='ITEM_UNIT_CODE' AND SYS_TYPE_CD = 'OM' AND INSD_CD =IFNULL(#{sellWgtUnitCd}, 'KG')) /* WEIGHT_UOM_CODE */
                           ,IF(#{exctSprCd}='OC', #{coCbm}, IFNULL(#{sellCbm},1))  /* TOTAL_CBM   해운일 경우 수신된 MEASURE 를, 해운이 아니 경우 HBL상의 SHPR_GRS_VOL 송신 */
                           ,IFNULL(#{sellCwt}, 0)        /* CHARGEABLE_WEIGHT */
                           ,#{coDomExpSprCd}          /* DOMESTIC_EXPORT_CODE  , FWJ011.DOM_EXP_CD*/
                           ,#{coExpDeclNo}            /* EXPORT_DECLARATION_NO , FWJ011.LICENSE_NO*/
                           ,(SELECT CO_LICE_NO  
                             FROM  TB_SMT_CO_LICE 
                             WHERE  CO_RECV_NO = #{coRecvNo} 
                             LIMIT  1)  /* CC_NO                         , FWJ011.EXP_DECL_NO*/
                           ,(SELECT CO_DECL_YMD 
                             FROM  TB_SMT_CO_LICE 
                             WHERE  CO_RECV_NO = #{coRecvNo} 
                             LIMIT  1)  /* CC_DATE   , TO_CHAR(FWJ011.LICENSE_DT,'YYYYMMDDHH24MISS')*/
                           ,#{coInvcReprtYn}          /* REINVOICE_FLAG */
                           ,#{coInvcReprtOrignNo}     /* REINVOICE_ORIGIN_INVOICE_NO */
                           ,#{coInvcSplitYn}          /* INVOICE_SPLIT_FLAG */
                           ,#{coInvcSplitOrignNo}     /* ORIGINAL_INVOICE_NO */
                           ,#{coCombYn}               /* COMBINE_FLAG */
                           ,#{coMltCntFdestYn}        /* MULTI_FINAL_DESTINATION_FLAG */
                           ,#{coMltCntFdestCd}        /* MULTI_FINAL_DESTINATION_CODE */
                           ,RPAD(#{onbrYmd}, 14, '0') /* APPOINTMENT_FROM_DATE */
                           ,RPAD(#{arrYmd}, 14, '0')  /* APPOINTMENT_TO_DATE */
                           ,#{coShppNm}               /* SHIPPER_NAME */
                           ,#{coShppAddr1}            /* SHIPPER_ADDRESS1_INFO */
                           ,#{coShppAddr2}            /* SHIPPER_ADDRESS2_INFO */
                           ,#{coShppAddr3}            /* SHIPPER_CITY_NAME */
                           ,#{coShppAddr4}            /* SHIPPER_STATE_NAME */
                           ,#{coShppAddr5}            /* SHIPPER_POSTAL_CODE */
                           ,#{coShppTelNo1}           /* SHIPPER_PHONE1_NO */
                           ,#{coShppTelNo2}           /* SHIPPER_PHONE2_NO */
                           ,#{coCneeNm}               /* CONSIGNEE_NAME */
                           ,#{coCneeAddr1}            /* CONSIGNEE_ADDRESS1_INFO */
                           ,#{coCneeAddr2}            /* CONSIGNEE_ADDRESS2_INFO */
                           ,#{coCneeAddr3}            /* CONSIGNEE_CITY_NAME */
                           ,#{coCneeAddr4}            /* CONSIGNEE_STATE_NAME */
                           ,#{coCneeAddr5}            /* CONSIGNEE_POSTAL_CODE */
                           ,#{coCneeTelNo1}           /* CONSIGNEE_PHONE1_NO */
                           ,#{coCneeTelNo2}           /* CONSIGNEE_PHONE2_NO */
                           ,#{coNtprNm}               /* NOTIFY_PARTY_NAME */
                           ,#{coNtprAddr1}            /* NOTIFY_PARTY_ADDRESS1_INFO */
                           ,#{coNtprAddr2}            /* NOTIFY_PARTY_ADDRESS2_INFO */
                           ,#{coNtprAddr3}            /* NOTIFY_PARTY_CITY_NAME */
                           ,#{coNtprAddr4}            /* NOTIFY_PARTY_STATE_NAME */
                           ,#{coNtprAddr5}            /* NOTIFY_PARTY_POSTAL_CODE */
                           ,#{coNtprTelNo1}           /* NOTIFY_PARTY_PHONE1_NO */
                           ,#{coNtprTelNo2}           /* NOTIFY_PARTY_PHONE2_NO */ 
                           ,#{curCd}                  /* FREIGHT_CURRENCY_CODE --BL CURR가 아닐런지.. .
                                                         본사는 'KRW' 
                                                         중국은 'USD' 하드코딩
                                                      */
                           ,NULL                      /* REMARK_DESC */
                           ,'N'                       /* CANCEL_FLAG */
                           ,NULL                      /* CANCEL_DATE */
                           ,NULL                      /* CANCEL_REASON_DESC */
                           ,NULL                      /* CANCEL_USER_ID */
                           ,IF(#{interfaceSeqNo}=1,'I','U') /*  SEND_TYPE_CODE  -- 발신유형코드(I:신규 U:수정 D:삭제)  */
                           ,'N'                       /* TRANSFER_FLAG */
                           ,NULL                      /* TRANSFER_DATE */
                           ,NULL                      /* ERROR_MESSAGE_TEXT */
                           ,NULL                      /* SEND_RECEIVE_FILE_NAME */
                           ,DATE_FORMAT(NOW(),'%Y%m%d%H%i%s')   /*  CREATION_DATE */
                           ,-1                        /* CREATED_BY */
                           ,DATE_FORMAT(NOW(),'%Y%m%d%H%i%s')   /* LAST_UPDATE_DATE */
                           ,-1                        /* LAST_UPDATED_BY */
                           ,NULL                      /* LAST_UPDATE_LOGIN */
                           ,#{usrId}                  /* INS_ID */
                           ,NOW()
                           ,#{lvFileSeq}              /* FILE_SEQ */
                           ,#{attribute6}
                           ,#{attribute7}
                           ,#{attribute8}
                          )
    </insert>
    
    <!-- LGD수신상세정보조회 -->
    <select id="selectLgdRecvDtlInfo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgdRecvDtlInfo */
        SELECT  A.INVOICE_NO
		      , A.INTERFACE_SEQ_NO
		      , A.ITEM_SEQ_NO
		      , A.ORGANIZATION_CODE
		      , A.REAL_CUSTOMER_PO_NO
		      , A.LOADING_TYPE_CODE
		      , A.CONTAINER_TYPE_CODE
		      , A.CONTAINER_NO
		      , A.SEAL_NO
		      , A.VESSEL_NAME
		      , A.VESSEL_FLIGHT_NAME
		      , A.TRUCK_NO
		      , A.TRUCK_TON_TYPE_CODE
		      , A.DRIVER_NAME
		      , A.ITEM_CODE
		      , A.ITEM_DESCRIPTION
		      , A.ITEM_QTY
		      , A.UNIT_CODE
		      , A.PACKING_QTY
		      , A.PACKING_UNIT_CODE
		      , A.PALLET_QTY
		      , A.NET_WEIGHT
		      , A.GROSS_WEIGHT
		      , A.WEIGHT_UNIT_CODE
		      , IFNULL(A.TOTAL_CBM, 0.1) AS TOTAL_CBM
		      , A.WAREHOUSE_CODE
		      , A.FROM_SUBINVENTORY_CODE
		      , A.TO_SUBINVENTORY_CODE
		      , SUBSTR(A.INVOICE_MODEL_CODE,1,20) AS INVOICE_MODEL_CODE
		      , A.INVOICE_SUFFIX_CODE
		      , A.INVOICE_MODEL_GRADE_CODE
		      , A.INVOICE_UNIT_PRICE
		      , A.INVOICE_AMOUNT
		      , SUBSTR(A.CUSTOMER_PART_NO,1,20) AS CUSTOMER_PART_NO
		      , A.RMA_NO
		      , A.COUNTRY_OF_ORIGIN_CODE 
		      , A.CREATION_DATE           
		      , A.CREATED_BY              
		      , A.LAST_UPDATE_DATE        
		      , A.LAST_UPDATED_BY         
		      , A.LAST_UPDATE_LOGIN
		      , NULL   AS CANCEL_FLAG
		      , NULL   AS CANCEL_DATE
		      , NULL   AS CANCEL_USER_ID
		      , NULL   AS CANCEL_USER_NAME
		      , NULL   AS TRANSFER_FLAG
		      , NULL   AS TRANSFER_DATE
		      , NULL   AS ERROR_MESSAGE_TEXT
		      , IFNULL((SELECT MAX(S.CNTR_NO)
		             FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
		                  , TB_SMT_INTG_ITEM S /* 컨테이너  */
		             WHERE  1=1
		             AND    T.DEL_YN = 'N' /* 삭제여부 */
		             AND    S.DEL_YN = 'N' /* 삭제여부 */
		             AND    T.BL_ID = #{blId}
		             AND    T.INTG_ITEM_NO = S.INTG_ITEM_NO
		             AND    S.CNTR_YN = 'Y'), 'N/A') AS CNTR_NO
		FROM   NFINF.TB_SMT_INT433 A
		WHERE  1=1
		AND    A.INTERFACE_ID = ( SELECT B.CO_IF_NO
		                          FROM   TB_SMT_CO B
		                          WHERE  B.CO_SPR_CD = '02' /* CI/PL */
		                          AND    B.CO_RECV_NO = #{coRecvNo} )
    </select>
    
    <!-- 중국LGD트럭상세정보조회 -->
    <select id="selectChnLgdCarDtlInfo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectChnLgdCarDtlInfo */
        WITH CNTR_INFO AS (
	        SELECT  A.SMT_NO, C.CNTR_NO, C.SEAL1, C.CNTR_SIZE_CD, C.CNTR_TYPE_CD, COUNT(CNTR_NO) OVER (PARTITION BY A.SMT_NO ORDER BY CNTR_NO) AS CNTR_CNT
	        FROM   TB_SMT_ORD A 
	             , TB_SMT_INTG_ITEM C
	        WHERE A.SMT_NO = C.SMT_NO
	        AND   A.DEL_YN = 'N'
	        AND   C.CNTR_YN = 'Y'
	        AND   A.SMT_NO = #{blId}
        )
		SELECT  G.INVOICE_NO 
		      , G.INTERFACE_SEQ_NO 
		      , G.ITEM_SEQ_NO 
		      , G.ORGANIZATION_CODE /* 사용안함 */
		      , G.REAL_CUSTOMER_PO_NO /* 사용안함 */
		      , G.LOADING_TYPE_CODE 
		      , (SELECT OUTR_CD FROM TB_COM_CD_MPNG WHERE CD_MPNG_SPR_NM = 'CONTAINER_TYPE_CODE' AND SYS_TYPE_CD = 'OM' AND INSD_CD2 = F.CNTR_SIZE_CD || F.CNTR_TYPE_CD ) AS CONTAINER_TYPE_CODE 
		      , IFNULL(F.CNTR_NO, 'N/A') AS CNTR_NO /* 사용안함 */
		      , F.SEAL1 AS SEAL_NO  
		      , '' AS VESSEL_NAME 
		      , '' AS VESSEL_FLIGHT_NAME 
		      , '' AS TRUCK_NO 
		      , G.TRUCK_TON_TYPE_CODE 
		      , '' AS DRIVER_NAME 
		      , G.ITEM_CODE 
		      , G.ITEM_DESCRIPTION /* 사용안함 */
		      , G.ITEM_QTY 
		      , 'EA' AS UNIT_CODE 
		      , G.PACKING_QTY /* 확인 필요*/
		      /* mybatis include로 처리 ::  FC_CM_MPNG_RECEIVE('OM', C.CO_CST_GRP_CD, 'ITEM_UNIT_CODE', G.PACKING_UNIT_CODE, '', '', '1') AS PACKING_UNIT_CODE*/
		      , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmMpgnReceive">
                             <property name="param1" value="'OM'"/>
                             <property name="param2" value="C.CO_CST_GRP_CD"/>
                             <property name="param3" value="'ITEM_UNIT_CODE'"/>
                             <property name="param4" value="G.PACKING_UNIT_CODE"/>
                             <property name="param5" value="NULL"/>
                             <property name="param6" value="NULL"/>
                             <property name="param7" value="'1'"/>
                 </include>) AS PACKING_UNIT_CODE
		      , G.PALLET_QTY /* 확인 필요*/
		      , G.NET_WEIGHT /* 확인 필요*/
		      , G.GROSS_WEIGHT /* 확인 필요*/
		      , 'KG' AS WEIGHT_UNIT_CODE 
		      , E.ORD_VOL AS TOTAL_CBM 
		      , E.ORD_WGT  AS CHARGEABLE_WEIGHT
		      , G.WAREHOUSE_CODE /* 확인 필요*/
		      , G.FROM_SUBINVENTORY_CODE 
		      , G.TO_SUBINVENTORY_CODE 
		      , SUBSTR(G.INVOICE_MODEL_CODE,1,20) As INVOICE_MODEL_CODE 
		      , G.INVOICE_SUFFIX_CODE 
		      , G.INVOICE_MODEL_GRADE_CODE 
		      , G.INVOICE_UNIT_PRICE 
		      , G.INVOICE_AMOUNT 
		      , SUBSTR(G.CUSTOMER_PART_NO,1,20) AS CUSTOMER_PART_NO 
		      , IF( G.RMA_NO='NULL','',G.RMA_NO) AS RMA_NO 
		      , G.COUNTRY_OF_ORIGIN_CODE /* 사용안함 */
		      , DATE_FORMAT (NOW(),'%Y%m%d%H%i%s') AS CREATION_DATE 
		      , -1 AS CREATED_BY              
		      , DATE_FORMAT (NOW(),'%Y%m%d%H%i%s') AS LAST_UPDATE_DATE 
		          , -1 AS LAST_UPDATED_BY 
		          , NULL AS LAST_UPDATE_LOGIN   
		          , NULL AS CANCEL_FLAG 
		          , NULL AS CANCEL_DATE 
		          , NULL AS CANCEL_USER_ID 
		          , NULL AS CANCEL_USER_NAME 
		          , NULL AS TRANSFER_FLAG 
		          , NULL AS TRANSFER_DATE 
		          , NULL AS ERROR_MESSAGE_TEXT 
		  FROM   TB_SMT_ORD_CO_RELT B
		  INNER JOIN TB_SMT_CO C ON  C.CO_RECV_NO = B.CO_RECV_NO
		         AND C.DEL_YN = 'N'
		         AND C.CO_CST_GRP_CD ='02'
		         AND C.CO_NO = #{coRecvNo}
		  INNER JOIN TB_SMT_ORD E ON  E.SMT_NO = B.SMT_NO
		          AND E.DEL_YN = 'N'
		          AND E.SO_NO = #{blId}
		  LEFT OUTER JOIN CNTR_INFO F ON F.SMT_NO = E.SMT_NO
		  INNER JOIN NFINF.TB_SMT_INT433 G 
		  WHERE  1=1
		  AND    B.DEL_YN = 'N'
		  AND   G.INTERFACE_ID = C.CO_IF_NO
    </select>
    
    <!-- 중국LGD수신상세정보조회 -->
    <select id="selectChnLgdRecvDtlInfo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectChnLgdRecvDtlInfo */
        WITH CNTR_INFO AS (
	       SELECT  A.BL_ID, C.CNTR_NO, C.SEAL1, C.CNTR_SIZE_CD, C.CNTR_TYPE_CD, COUNT(CNTR_NO) OVER (PARTITION BY A.BL_ID ORDER BY CNTR_NO) AS CNTR_CNT
	       FROM   TB_FWD_BL A 
	            , TB_FWD_BL_ITEM_MPNG B
	            , TB_SMT_INTG_ITEM C
	       WHERE A.BL_ID = B.BL_ID
	       AND   B.INTG_ITEM_NO = C.INTG_ITEM_NO
	       AND   A.DEL_YN = 'N'
	       AND   B.DEL_YN = 'N'
	       AND   C.CNTR_YN = 'Y'
	       AND   A.BL_ID = #{blId}
	   )
	    SELECT  TMP.INVOICE_NO 
	          , TMP.INTERFACE_SEQ_NO 
	          , TMP.ITEM_SEQ_NO 
	          , TMP.ORGANIZATION_CODE /* 사용안함 */
	          , TMP.REAL_CUSTOMER_PO_NO /* 사용안함 */
	          , IFNULL(TMP.LOADING_TYPE_CODE, 
	             (CASE
	               WHEN A.LADG_TYPE_CD = 'F'
	               THEN 'FCL'
	               WHEN A.LADG_TYPE_CD = 'L'
	               THEN 'LCL'
	               ELSE ''
	              END)) AS LOADING_TYPE_CODE 
	          , (SELECT OUTR_CD FROM TB_COM_CD_MPNG WHERE CD_MPNG_SPR_NM = 'CONTAINER_TYPE_CODE' AND SYS_TYPE_CD = 'OM' AND INSD_CD2 = F.CNTR_SIZE_CD || F.CNTR_TYPE_CD ) AS CONTAINER_TYPE_CODE
	          , IFNULL(F.CNTR_NO, 'N/A') AS CNTR_NO /* 사용안함 */
	          , F.SEAL1 AS SEAL_NO  
	          , IF(A.EXCT_SPR_CD='AR', A.VOYAGE, '') AS VESSEL_NAME 
	          , IF(A.EXCT_SPR_CD='OC', A.FLT_VSL_NM, '') AS VESSEL_FLIGHT_NAME 
	          , '' AS TRUCK_NO 
	          , TMP.TRUCK_TON_TYPE_CODE 
	          , '' AS DRIVER_NAME 
	          , TMP.ITEM_CODE 
	          , TMP.ITEM_DESCRIPTION /* 사용안함 */
	          , TMP.ITEM_QTY 
	          , 'EA' AS UNIT_CODE 
	          , TMP.PACKING_QTY /* 확인 필요*/
	          /* mybatis include로 처리 ::  FC_CM_MPNG_RECEIVE('OM', C.CO_CST_GRP_CD, 'ITEM_UNIT_CODE', TMP.PACKING_UNIT_CODE, '', '', '1') AS PACKING_UNIT_CODE*/
	          , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmMpgnReceive">
                             <property name="param1" value="'OM'"/>
                             <property name="param2" value="C.CO_CST_GRP_CD"/>
                             <property name="param3" value="'ITEM_UNIT_CODE'"/>
                             <property name="param4" value="TMP.PACKING_UNIT_CODE"/>
                             <property name="param5" value="NULL"/>
                             <property name="param6" value="NULL"/>
                             <property name="param7" value="'1'"/>
                 </include>) AS PACKING_UNIT_CODE
	          , TMP.PALLET_QTY /* 확인 필요*/
	          , TMP.NET_WEIGHT /* 확인 필요*/
	          , TMP.GROSS_WEIGHT /* 확인 필요*/
	          , 'KG' AS WEIGHT_UNIT_CODE 
	          , A.SELL_CBM AS TOTAL_CBM 
	          , (CASE
	            WHEN A.EXCT_SPR_CD = 'AR'
	            THEN A.BUY_CWT
	            WHEN A.EXCT_SPR_CD = 'OC'
	            THEN A.SELL_GWT
	            END) AS CHARGEABLE_WEIGHT
	          , TMP.WAREHOUSE_CODE /* 확인 필요*/
	          , TMP.FROM_SUBINVENTORY_CODE 
	          , TMP.TO_SUBINVENTORY_CODE 
	          , SUBSTR(TMP.INVOICE_MODEL_CODE,1,20) AS INVOICE_MODEL_CODE 
	          , TMP.INVOICE_SUFFIX_CODE 
	          , TMP.INVOICE_MODEL_GRADE_CODE 
	          , TMP.INVOICE_UNIT_PRICE 
	          , TMP.INVOICE_AMOUNT 
	          , SUBSTR(TMP.CUSTOMER_PART_NO,1,20) AS CUSTOMER_PART_NO 
	          , IF( TMP.RMA_NO='NULL','',TMP.RMA_NO) AS RMA_NO 
	          , TMP.COUNTRY_OF_ORIGIN_CODE /* 사용안함 */
	          , DATE_FORMAT (NOW(),'%Y%m%d%H%i%s') AS CREATION_DATE 
	          , -1 AS CREATED_BY              
	          , DATE_FORMAT (NOW(),'%Y%m%d%H%i%s') AS  LAST_UPDATE_DATE 
	          , -1 AS LAST_UPDATED_BY 
	          , NULL AS LAST_UPDATE_LOGIN   
	          , NULL AS CANCEL_FLAG 
	          , NULL AS CANCEL_DATE 
	          , NULL AS CANCEL_USER_ID 
	          , NULL AS CANCEL_USER_NAME 
	          , NULL AS TRANSFER_FLAG 
	          , NULL AS TRANSFER_DATE 
	          , NULL AS ERROR_MESSAGE_TEXT 
	  FROM   TB_FWD_BL A 
	  INNER JOIN TB_SMT_ORD_CO_RELT B ON  B.SMT_NO = A.SMT_NO
	            AND B.DEL_YN = 'N'
	  INNER JOIN TB_SMT_CO C ON  C.CO_RECV_NO = B.CO_RECV_NO
	         AND C.DEL_YN = 'N'
	         AND C.CO_CST_GRP_CD ='02'
	         AND C.CO_NO = #{coRecvNo}
	  INNER JOIN TB_SMT_ORD E ON  E.SMT_NO = A.SMT_NO
	          AND E.DEL_YN = 'N'
	  LEFT OUTER JOIN CNTR_INFO F ON F.BL_ID = A.BL_ID
	  INNER JOIN NFINF.TB_SMT_INT433 TMP ON TMP.INTERFACE_ID = C.CO_IF_NO
	  WHERE  1=1
	  AND    A.DEL_YN = 'N'
	  AND    A.BL_SPR_CD IN ('H','D')
	  AND    A.BL_ID = #{blId}
    </select>
    
    <!-- LGD인터페이스435테이블등록 -->
    <insert id="insertLgdIf435Tbl" parameterType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.insertLgdIf435Tbl */
        INSERT INTO NFINF.TB_FWD_INT435 
        (                   INTERFACE_ID
                           ,BL_NO                         /*-- 선하증권번호*/
                           ,INTERFACE_SEQ_NO              /*-- 인터페이스일련순서번호*/
                           ,ITEM_SEQ_NO                   /*-- 품목일련순서번호*/
                           ,INVOICE_NO                    /*-- 송장번호*/
                           ,CARGO_TYPE_CODE               /*-- 화물유형코드(화물의 적재형태에 따룬 구분코드(F:FCL, L:LCL, B:BULK, A:AIR))*/
                           ,CONTAINER_TYPE_CODE           /*-- 컨테이너유형코드*/
                           ,CONTAINER_NO                  /*-- 컨테이너번호*/
                           ,SEAL_NO                       /*-- 봉인번호*/
                           ,VESSEL_NAME                   /*-- 선박명*/
                           ,VESSEL_FLIGHT_NAME            /*-- 선기명(운송항공기명)*/
                           ,TRUCK_NO                      /*-- 차량번호*/
                           ,TRUCK_TON_TYPE_CODE           /*-- 트럭톤수*/
                           ,DRIVER_NAME                   /*-- 드라이버명*/
                           ,ITEM_CODE                     /*-- 품목코드*/
                           ,ITEM_QTY                      /*-- 품목수량*/
                           ,UOM_CODE                      /*-- UOM코드*/
                           ,PACKING_QTY                   /*-- 포장수량*/
                           ,PACKING_UNIT_CODE             /*-- 포장단위*/
                           ,PALLET_QTY                    /*-- 팔레트수량*/
                           ,NET_WEIGHT                    /*-- 순중량*/
                           ,GROSS_WEIGHT                  /*-- 총체적중량*/
                           ,WEIGHT_UOM_CODE               /*-- 중량UOM코드*/
                           ,TOTAL_CBM                     /*-- 총CBM*/
                           ,CHARGEABLE_WEIGHT             /*-- CWT (중국만 사용)*/
                           ,WAREHOUSE_CODE                /*-- 창고코드(LGD 법인의 도착 창고)*/
                           ,FROM_SUBINVENTORY_CODE        /*-- FROM창고코드*/
                           ,TO_SUBINVENTORY_CODE          /*-- TO창고코드*/
                           ,CANCEL_FLAG                   /*-- 취소여부*/
                           ,CANCEL_DATE                   /*-- 취소일자*/
                           ,CANCEL_USER_ID                /*-- 취소사용자아이디*/
                           ,CANCEL_USER_NAME              /*-- 취소사용자명*/
                           ,TRANSFER_FLAG                 /*-- 전송여부*/
                           ,TRANSFER_DATE                 /*-- 전송일자*/
                           ,ERROR_MESSAGE_TEXT            /*-- 오류메세지텍스트*/
                           ,INVOICE_MODEL_CODE            /*-- 송장모델코드(PACKING LIST 출력 MODEL명 (Suffix1 Level까지))*/
                           ,INVOICE_SUFFIX_CODE           /*-- 송장Suffix코드(PACKING LIST 출력 MODEL명 (Suffix2 Level))*/
                           ,INVOICE_MODEL_GRADE_CODE      /*-- 송장모델등급코드(PACKING LIST 출력 GRADE)*/
                           ,INVOICE_UNIT_PRICE            /*-- 송장단가(Model별 Unit Price)*/
                           ,INVOICE_AMOUNT                /*-- 송장금액(Model별 Unit Price 총액)*/
                           ,CUSTOMER_PART_NO              /*-- 고객부품번호(Customer Model의 내용)*/
                           ,RMA_NO                        /*-- RMA번호(PACKING LIST RMA NUMBER - 확인 필요)*/
                           ,CREATION_DATE                 /*-- 생성일자*/
                           ,CREATED_BY                    /*-- 생성자*/
                           ,LAST_UPDATE_DATE              /*-- 최종수정일자*/
                           ,LAST_UPDATED_BY               /*-- 최종수정자*/
                           ,LAST_UPDATE_LOGIN             /*-- 최종수정로그인*/
                           ,INS_ID
                           ,TIMESTAMP
                          )
                   VALUES ( #{interfaceId}
                           ,#{blNo}                
                           ,#{lnInterfaceSqeNo}          
                           ,(SELECT IFNULL(MAX(ITEM_SEQ_NO),0) + 1
                             FROM   NFINF.TB_FWD_INT435
                             WHERE  BL_NO            =  #{blNo}
                             AND    INTERFACE_SEQ_NO =  #{lnInterfaceSqeNo}
                             AND    INVOICE_NO       =  #{invoiceNo})              
                           ,#{invoiceNo}              
                           ,#{loadingTypeCode} 
                           ,#{containerTypeCode}     
                           ,#{cntrNo}          
                           ,#{sealNo}                 
                           ,#{vesselName}             
                           ,#{vesselFlightName}      
                           ,#{truckNo}                
                           ,#{truckTonTypeCode}     
                           ,#{driverName}             
                           ,#{itemCode}               
                           ,#{itemQty}                
                           ,#{unitCode}               
                           ,#{packingQty}             
                           ,#{packingUnitCode}       
                           ,#{palletQty}              
                           ,#{netWeight}              
                           ,#{grossWeight}            
                           ,#{weightUnitCode}        
                           ,#{totalCbm}
                           ,#{chargeableWeight}     
                           ,#{warehouseCode}          
                           ,#{fromSubinventoryCode}
                           ,#{toSubinventoreCode}
                           ,#{cancelFlag}             
                           ,#{cancelDate}             
                           ,#{cancelUserId}          
                           ,#{cancelUserName}        
                           ,#{transferFlag}           
                           ,#{transferDate}           
                           ,#{errorMessageText}      
                           ,#{invoiceModelCode}      
                           ,#{invoiceSuffixCode}     
                           ,#{invoiceModelGradeCode}
                           ,#{invoiceUnitPrice}      
                           ,#{invoiceAmount}          
                           ,#{customerPartNo}        
                           ,#{rmaNo}                  
                           ,#{creationDate}           
                           ,#{createdBy}              
                           ,#{lastUpdateDate}        
                           ,#{lastUpdatedBy}         
                           ,#{lastUpdateLogin}       
                           ,#{usrId}
                           ,NOW()  
               )       
    </insert>
    
    
    <!--  LGD 인터페이스 060 테이블등록   -->
    <insert id="insertLgdIf060Tbl" parameterType="dataItem" >
        /* fwd.edi.fwdCstComIfMgnt.insertLgdIf060Tbl */
        INSERT INTO NFINF.TB_FWD_INT060(
                      INTERFACE_ID
					  ,CONVERSATION_ID
					  ,IMPORT_TYPE   
					  ,PARTNER_DUNS_NO
					  ,BL_DATE
					  ,HOUSE_BLNO   
					  ,MASTER_BLNO
					  ,PARTNER
					  ,CONSIGNEE   
					  ,VEND_CODE
					  ,PRICE_RATE
					  ,RATE_APPLY_YN   
					  ,PRICE_CONDITION
					  ,TOTAL_FARE
					  ,CURRENCY   
					  ,GROSS_WEIGHT
					  ,CHARGABLE_WEIGHT
					  ,VOLUME_WEIGHT   
					  ,WEIGHT_UNIT
					  ,SHPPING_MARK
					  ,SHIPPER   
					  ,SHIP_DATE
					  ,ETA_DATE
					  ,ETA_TIME   
					  ,SHIP_PORT   
					  ,SHIP_NATION   
					  ,ARRIVAL_PORT   
					  ,ARRIVAL_NATION
					  ,PACK_QTY
					  ,PACK_UNIT   
					  ,AIRLINE_NAME
					  ,ACCOUNT_INFO
					  ,IATA_CODE   
					  ,HANDLING
					  ,CARRIAGE
					  ,CUSTOMS   
					  ,FARE_CONDITION
					  ,GOODS_KIND
					  ,DIMENSION   
					  ,DESCRIPTION
					  ,ORIGIN
					  ,PART_NO   
					  ,PART_QTY
					  ,FILE_NO
					  ,HUB_YN   
					  ,ATTRIBUTE1
					  ,ATTRIBUTE2
					  ,ATTRIBUTE3   
					  ,ATTRIBUTE4
					  ,INS_ID
					  ,TIMESTAMP   
					  ,OTHER_FARE_CONDITION
                 )
         VALUES (
	                   IFNULL(#{interfaceId},'' )
	                   , IFNULL(#{conversationId},'' )
	                   , IFNULL(#{importType},'' )
	                   , IFNULL(#{partnerDunsNo},'' )
	                   , IFNULL(#{blDate},'' )
	                   , IFNULL(#{houseBlno},'' )
	                   , IFNULL(#{masterBlno},'' )
	                   , IFNULL(#{partner},'' )
	                   , IFNULL(#{consignee},'' )
	                   , IFNULL(#{vendCode},'' )
	                   , IFNULL(#{priceRate},0 )
	                   , IFNULL(#{rateApplyYn},'' )
	                   , IFNULL(#{priceCondition},'' )
	                   , IFNULL(#{totalFare},0 )
	                   , IFNULL(#{currency},'' )
	                   , IFNULL(#{grossWeight},0 )
	                   , IFNULL(#{chargableWeight},0 )
	                   , IFNULL(#{volumeWeight},0 )
	                   , IFNULL(#{weightUnit},'' )
	                   , IFNULL(#{shppingMark},'' )
	                   , IFNULL(#{shipper},'' )
	                   , IFNULL(#{shipDate},'' )
	                   , IFNULL(#{etaDate},'' )
	                   , IFNULL(#{etaTime},'' ) 
	                   , IFNULL(#{shipPort},'' )
	                   , IFNULL(#{shipNation},'' )
	                   , IFNULL(#{arrivalPort},'' )
	                   , IFNULL(#{arrivalNation},'' )
	                   , IFNULL(#{packQty},0 )
	                   , IFNULL(#{packUnit},'' )
	                   , IFNULL(#{airlineName},'' )
	                   , IFNULL(#{accountInfo},'' )
	                   , IFNULL(#{iataCode},'' )
	                   , IFNULL(#{handling},'' )
	                   , IFNULL(#{carriage},'' )
	                   , IFNULL(#{customs},'' )
	                   , IFNULL(#{fareCondition},'' )
	                   , IFNULL(#{goodsKind},'' )
	                   , IFNULL(#{dimension},'' )
	                   , IFNULL(#{description},'' )
	                   , IFNULL(#{origin},'' )
	                   , IFNULL(#{partNo},'' )
	                   , IFNULL(#{partQty},0 )
	                   , IFNULL(#{fileNo},'' )
	                   , IFNULL(#{hubYn},'' )
	                   , IFNULL(#{attribute1},'' )
	                   , IFNULL(#{attribute2},'' )
	                   , IFNULL(#{attribute3},'' ) 
	                   , IFNULL(#{attribute4},'' )
	                   , IFNULL(#{insId},'' )
	                   , IFNULL(#{timestamp}, '' )
	                   , IFNULL(#{otherFareCondition},'' )
                )     
    </insert>
    
    
    <!--  LGD인터페이스061테이블등록   -->
    <insert id="insertLgdIf061Tbl" parameterType="dataItem" >
        /* fwd.edi.fwdCstComIfMgnt.insertLgdIf061Tbl */
        INSERT INTO NFINF.TB_FWD_INT061(
                      INTERFACE_ID
                      ,CONVERSATION_ID
                      ,IMPORT_TYPE   
                      ,PARTNER_DUNS_NO
                      ,BL_DATE
                      ,HOUSE_BLNO   
                      ,MASTER_BLNO
                      ,PARTNER
                      ,CONSIGNEE   
                      ,VEND_CODE
                      ,PRICE_RATE
                      ,RATE_APPLY_YN   
                      ,PRICE_CONDITION
                      ,TOTAL_FARE
                      ,CURRENCY   
                      ,GROSS_WEIGHT
                      ,CBM
                      ,WEIGHT_UNIT
                      ,SHPPING_MARK
                      ,SHIPPER   
                      ,SHIP_DATE
                      ,ETA_DATE
                      ,ETA_TIME   
                      ,SHIP_PORT   
                      ,SHIP_NATION   
                      ,ARRIVAL_PORT   
                      ,ARRIVAL_NATION
                      ,PACK_QTY
                      ,PACK_UNIT   
                      ,AIRLINE_NAME
                      ,VOYAGE_NO
                      ,RECEIPT_PLACE
					  ,DELIVERY_PLACE   
					  ,BL_ISSUE_PLACE
                      ,PARTY
					  ,CARRIAGE_BY   
					  ,SEAL_NO
					  ,NOTE
                      ,TOTAL_CONTAINER   
					  ,BL_QTY
					  ,FARE_CONDITION
					  ,VESSEL_TYPE   
					  ,NOTIFY_PARTY
					  ,ORIGIN
                      ,PART_NO   
                      ,PART_QTY
                      ,FILE_NO
                      ,HUB_YN   
                      ,ATTRIBUTE1
                      ,ATTRIBUTE2
                      ,ATTRIBUTE3   
                      ,ATTRIBUTE4
                      ,ATTRIBUTE5
                      ,INS_ID
                      ,TIMESTAMP   
                      ,OTHER_FARE_CONDITION
                      ,SPEC   
                      ,DESCRIPTION
                 )
         VALUES (
                       IFNULL(#{interfaceId},'' )
                       , IFNULL(#{conversationId},'' )
                       , IFNULL(#{importType},'' )
                       , IFNULL(#{partnerDunsNo},'' )
                       , IFNULL(#{blDate},'' )
                       , IFNULL(#{houseBlno},'' )
                       , IFNULL(#{masterBlno},'' )
                       , IFNULL(#{partner},'' )
                       , IFNULL(#{consignee},'' )
                       , IFNULL(#{vendCode},'' )
                       , IFNULL(#{priceRate},0 )
                       , IFNULL(#{rateApplyYn},'' )
                       , IFNULL(#{priceCondition},'' )
                       , IFNULL(#{totalFare},0 )
                       , IFNULL(#{currency},'' )
                       , IFNULL(#{grossWeight},0 )
                       , IFNULL(#{cbm},0 )
                       , IFNULL(#{weightUnit},'' )
                       , IFNULL(#{shppingMark},'' )
                       , IFNULL(#{shipper},'' )
                       , IFNULL(#{shipDate},'' )
                       , IFNULL(#{etaDate},'' )
                       , IFNULL(#{etaTime},'' ) 
                       , IFNULL(#{shipPort},'' )
                       , IFNULL(#{shipNation},'' )
                       , IFNULL(#{arrivalPort},'' )
                       , IFNULL(#{arrivalNation},'' )
                       , IFNULL(#{packQty},0 )
                       , IFNULL(#{packUnit},'' )
                       , IFNULL(#{airlineName},'' )
                       , IFNULL(#{voyageNo},'' )
                       , IFNULL(#{receiptPlace},'' )
                       , IFNULL(#{deliveryPlace},'' )
                       , IFNULL(#{blIssuePlace},'' )
                       , IFNULL(#{party},'' )
                       , IFNULL(#{carriageBy},'' )
                       , IFNULL(#{sealNo},'' )
                       , IFNULL(#{note},'' )
                       , IFNULL(#{totalContainer},0 )
                       , IFNULL(#{blQty},0 )
                       , IFNULL(#{fareCondition},'' )
                       , IFNULL(#{vesselType},'' )
                       , IFNULL(#{notifyParty},'' )
                       , IFNULL(#{origin},'' )
                       , IFNULL(#{partNo},'' )
                       , IFNULL(#{partQty},0 )
                       , IFNULL(#{fileNo},'' )
                       , IFNULL(#{hubYn},'' )
                       , IFNULL(#{attribute1},'' )
                       , IFNULL(#{attribute2},'' )
                       , IFNULL(#{attribute3},'' ) 
                       , IFNULL(#{attribute4},'' )
                       , IFNULL(#{attribute5},'' )
                       , IFNULL(#{insId},'' )
                       , IFNULL(#{timestamp},'' )
                       , IFNULL(#{otherFareCondition},'' )
                       , IFNULL(#{spec},'' )
                       , IFNULL(#{description},'' )
                )     
    </insert>
    
    <!-- 중국LGD수신상세정보조회 -->
    <select id="selectLgdImpHbl" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgdImpHbl */
        SELECT 
              CHK
	          ,SEND_CNT /* 전송회수 */
	          ,SEND_DT /* 전송일자 */
	          ,CNEE
	          ,EXCT_SPR_CD
	          ,CASE WHEN EXCT_SPR_CD='OC' 
	            THEN 'Ocean'
	                WHEN EXCT_SPR_CD='AR' 
	                THEN 'Air' 
	            END AS EXCT_SPR_NM
	          ,BL_NO /* HBL NO */
	          ,IF(BL_SPR_CD='D',BL_NO, MBL_NO) AS MBL_NO
	          ,BL_ID /* BL ID */
	          ,MBL_ID /* MBL ID */
	          ,INVOICE_NO /* REF NO */
	          ,DPTR_PTNR_CD
	          ,NTPR_CD
	          ,IPCHE
	          ,POL_CD /* POL코드 */
	          ,POL_NM /* POL명 */
	          ,POD_CD /* POD코드 */
	          ,POD_NM /* POD명 */
	          ,PARTNER_NO
	          ,ARR_YMD /* 선적일자 */
	          ,ARR_CLOS_YN
	          ,INCOT_CD
	          ,BUY_GWT
	          ,BUY_WGT_UNIT_CD
	          ,BUY_CBM
	          ,PKG_QTY
	          ,CUR_CD
	          ,APLY_EXCHGRT
	          ,FLT_VSL_NM
	          ,CARGO_TYPE_CD
	          ,LADG_TYPE_CD
	          ,HUB_BILG_YN
	          ,PO_NO /* REF NO */
	          ,INVOICE_CNT
	          ,SEND_STATUS
	          ,INTG_TASK_NO
	          ,MBL_INTG_TASK_NO
	          ,SMT_NO
	          ,EO_NO
	          ,VESSEL_TYPE
	    FROM
		    (SELECT 'F' CHK
		          ,A.BL_SPR_CD
		          ,CASE 
			            WHEN A.EXCT_SPR_CD='OC' 
			            THEN (SELECT CAST(IFNULL(COUNT(INTERFACE_ID), 0) AS CHAR(10))             
			                  FROM NFINF.TB_FWD_INT060           
			                  WHERE HOUSE_BLNO = A.BL_NO) 
			            ELSE (SELECT CAST(IFNULL(COUNT(INTERFACE_ID), 0) AS CHAR(10))            
			                  FROM NFINF.TB_FWD_INT061           
			                  WHERE HOUSE_BLNO = A.BL_NO) 
		           END AS SEND_CNT /* 전송회수 */
		          ,CASE WHEN A.EXCT_SPR_CD='OC' 
			            THEN (SELECT MAX(DATE_FORMAT(NOW(), '%Y%m%d'))              
			                  FROM NFINF.TB_FWD_INT060
			                  WHERE HOUSE_BLNO = A.BL_NO) 
	                    ELSE (SELECT MAX(DATE_FORMAT(NOW(), '%Y%m%d'))            
			                  FROM NFINF.TB_FWD_INT061
			                  WHERE HOUSE_BLNO = A.BL_NO) 
		           END AS SEND_DT /* 전송일자 */ 
		          ,CASE WHEN  A.EXCT_SPR_CD='OC' 
		                THEN  (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm2">
	                                <property name="tag" value="'PKE_EDI코드'"/>
	                                <property name="param1" value="'81'"/>
	                                <property name="param2" value="A.NTPR_CD"/>
	                                <property name="param3" value="NULL"/>
	                            </include>) /* Mybatis Include로 처리 :: FC_CM_GET_EDI_NM2('PKE_EDI코드','81',A.NTPR_CD,'')*/ 
		                ELSE  (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm2">
	                                <property name="tag" value="'PKE_EDI코드'"/>
	                                <property name="param1" value="'81'"/>
	                                <property name="param2" value="A.CNEE_CD"/>
	                                <property name="param3" value="NULL"/>
	                            </include>) /* Mybatis Include로 처리 :: FC_CM_GET_EDI_NM2('PKE_EDI코드','81',A.CNEE_CD,'')*/ 
		           END AS CNEE  
	              ,A.EXCT_SPR_CD
		          ,A.BL_NO /* HBL NO */
		          ,IF(A.BL_SPR_CD='D', A.BL_NO, A.MBL_NO) AS MBL_NO
		          ,A.BL_ID /* BL ID */
		          ,CASE WHEN IFNULL(A.BL_SWITCH_YN, 'N') = 'Y' 
	                    THEN (<include refid="fwd.common.fwdFuncInclude.fwdFcFwGetSwitchInfoEdi">
	                                <property name="tag" value="'NORMBLID'"/>
	                                <property name="param1" value="A.BL_ID"/>
	                                <property name="param2" value="NULL"/>
	                          </include>)  /* Mybatis Include로 처리 :: FC_FW_GET_SWITCH_INFO('NORMBLID', A.BL_ID)*/
		                ELSE A.MBL_ID 
		           END AS MBL_ID
		          ,(SELECT  S.REF_NO
		              FROM  TB_FWD_INTG_REF_NO S
		             WHERE  1 = 1
		               AND  S.INTG_KEY_ID = A.BL_ID
		               AND  S.DEL_YN = 'N'
		               AND  S.REF_NO_SPR_CD = 'IN'
		               LIMIT 1) AS INVOICE_NO /* REF NO */
		          ,(SELECT  EXCT_BIZPTNR_CD
		              FROM  TB_SMT_INTG_TASK_DEPT
		             WHERE  EO_NO = A.EO_NO
		               AND  CST_BL_ID = A.BL_ID 
		               AND  TASK_SPR_CD = 'EXP') AS DPTR_PTNR_CD
		          ,IF(A.NTPR_CD='1000369','2000256',A.NTPR_CD) AS NTPR_CD /*--일본발, 남경도착, Nofi : 1000369 인경우*/
		          ,'N' IPCHE
		          ,A.POL_CD /* POL코드 */
		          ,A.POL_NM /* POL명 */
		          ,A.POD_CD /* POD코드 */
		          ,A.POD_NM /* POD명 */
		          ,IF(SUBSTR(A.POL_CD, 0, 2) = 'JP'
		                 ,CASE 
		                   WHEN (SELECT EXCT_BIZPTNR_CD
		                         FROM   TB_SMT_INTG_TASK_DEPT
		                         WHERE  EO_NO = A.EO_NO
		                         AND    CST_BL_ID = A.BL_ID
		                         AND    TASK_SPR_CD = 'EXP') = '1014189'
		                        /*--,'007925' ,'JP001' 삭제된 BIZPTNR_CD*/
		                        THEN 'JP002'
		                        WHEN (SELECT EXCT_BIZPTNR_CD
		                         FROM   TB_SMT_INTG_TASK_DEPT
		                         WHERE  EO_NO = A.EO_NO
		                         AND    CST_BL_ID = A.BL_ID
		                         AND    TASK_SPR_CD = 'EXP') = '1014188'
		                        THEN 'JP003'
		                        WHEN (SELECT EXCT_BIZPTNR_CD
		                         FROM   TB_SMT_INTG_TASK_DEPT
		                         WHERE  EO_NO = A.EO_NO
		                         AND    CST_BL_ID = A.BL_ID
		                         AND    TASK_SPR_CD = 'EXP') = 'H100'
		                        THEN IF(A.CARGO_TYPE_CD='G'
		                          , (CASE 
		                            WHEN A.FLT_VSL_NM = 'PO'
		                            THEN 'JP005'
		                            WHEN A.FLT_VSL_NM = 'NW'
		                            THEN 'JP005'
		                            WHEN A.FLT_VSL_NM = 'SU'
		                            THEN 'JP005'
		                            ELSE 'JP004'
		                           END)
		                                , 'JP004')
		                  END
		                 ,'') AS PARTNER_NO
		          ,A.ARR_YMD /* 선적일자 */
		          ,A.ARR_CLOS_YN
		          ,A.INCOT_CD
		          ,A.SELL_GWT BUY_GWT 
		          ,A.SELL_WGT_UNIT_CD AS BUY_WGT_UNIT_CD
		          ,A.SELL_CBM BUY_CBM
		          ,A.PKG_QTY
		          ,IFNULL(A.CUR_CD, 'USD') AS CUR_CD
		          ,IFNULL(A.APLY_EXCHGRT, 0) AS APLY_EXCHGRT
		          ,A.FLT_VSL_NM
		          ,A.CARGO_TYPE_CD
		          ,A.LADG_TYPE_CD
		          ,IFNULL(A.HUB_BILG_YN,'N') AS HUB_BILG_YN
		          ,(SELECT S.REF_NO
		              FROM TB_FWD_INTG_REF_NO S
		             WHERE 1 = 1
		               AND S.INTG_KEY_ID = A.BL_ID
		               AND S.DEL_YN = 'N'
		               AND S.REF_NO_SPR_CD = 'PO'
		               LIMIT 1) AS PO_NO /* REF NO */
		          ,(SELECT COUNT(S.REF_NO)
		              FROM TB_FWD_INTG_REF_NO S
		             WHERE 1 = 1
		               AND S.INTG_KEY_ID = A.BL_ID
		               AND S.DEL_YN = 'N'
		               AND S.REF_NO_SPR_CD = 'IN') AS INVOICE_CNT
		          , (<include refid="fwd.common.fwdFuncInclude.fwdFcFwdEdiStatusNm">
	                       <property name="tag" value="'LPL SEND STATUS'"/>
	                       <property name="param1" value="A.EXCT_SPR_CD"/>
	                       <property name="param2" value="A.BL_NO"/>
	                 </include>) AS SEND_STATUS /* Mybatis Include로 처리 :: FC_FW_EDI_STATUS_NM('LPL SEND STATUS', A.EXCT_SPR_CD, A.BL_NO) SEND_STATUS*/
		          ,C.INTG_TASK_NO
		          ,(<include refid="fwd.common.fwdFuncInclude.fwdFcFwGetMblTaskNo">
	                       <property name="blId" value="A.BL_ID"/>
	                       <property name="intgTaskNo" value="C.INTG_TASK_NO"/>
	                 </include>) AS MBL_INTG_TASK_NO /* Mybatis Include로 처리 :: FC_FW_GET_MBL_TASK_NO(A.BL_ID,C.INTG_TASK_NO) MBL_INTG_TASK_NO*/
		          ,A.SMT_NO
		          ,A.EO_NO
		          , (CASE
			            WHEN C.CARR_CD = '1004004'
			            THEN '1'
			            WHEN C.CARR_CD = '1004056'
			            THEN '1'
			            WHEN C.CARR_CD = '1004113'
			            THEN '1'
			            WHEN C.CARR_CD = '1004115'
			            THEN '1'
			            WHEN C.CARR_CD = '1004370'
			            THEN '1'
			            WHEN C.CARR_CD = '1004450'
			            THEN '1'
			            ELSE '2'
		           END) AS  VESSEL_TYPE
		      FROM TB_FWD_BL A, 
	               TB_SMT_INTG_TASK_DEPT C
		     WHERE 1 = 1
			       AND A.BL_ID = C.CST_BL_ID
			       AND A.EO_NO = C.EO_NO
			       AND A.DEL_YN = 'N'
			       AND IFNULL(C.DEL_YN, 'N') = 'N'
			       AND A.EXCT_SPR_CD IN ('AR', 'OC')
			       AND A.BL_SPR_CD IN ('H', 'D')
			       AND IFNULL(A.BL_KIND_CD, 'N') = 'N'
			       AND (C.TASK_SPR_CD = 'IMP' OR (C.TASK_SPR_CD = 'ADJ' AND A.NTPR_CD = '1000369'))
			       AND A.NTPR_CD IN (SELECT A.BIZPTNR_CD
			                           FROM TB_COM_BIZPTNR A
			                          WHERE A.MBIZPTNR_YN = 'Y'
			                            AND A.BIZPTNR_GRP_CD = '1001002'
			                            AND A.NATN_CD IN ('KR', 'CN')
			                         UNION ALL
			                      SELECT C.BIZPTNR_CD
			                        FROM TB_COM_BIZPTNR C
			                       WHERE C.MBIZPTNR_YN = 'N'
			                         AND C.MBIZPTNR_CD IN
			                                 (SELECT B.BIZPTNR_CD
			                                    FROM TB_COM_BIZPTNR B
			                                   WHERE B.MBIZPTNR_YN = 'Y'
			                                     AND B.BIZPTNR_GRP_CD = '1001002'
			                                     AND B.NATN_CD IN ('KR', 'CN'))
			                        UNION ALL 
			                        SELECT '1000369' FROM DUAL)
			       AND A.BL_SPR_CD IN ( 'H','D')
			       <![CDATA[
			       AND A.ARR_YMD >= #{fromDt}
			       AND A.ARR_YMD <= #{toDt}
			       ]]>
			       AND C.EXCT_BIZPTNR_CD = #{corpCd}
			       <if test='ntfyCd != null and ntfyCd != ""'>
	                    AND   A.NTPR_CD = #{ntfyCd}
	               </if>
	               <if test='exctSprCd != null and exctSprCd != ""'>
	                    AND   A.EXCT_SPR_CD = #{exctSprCd}
	               </if>
	               <if test='blNo != null and blNo != ""'>
	                    AND   A.BL_NO LIKE CONCAT('%',#{blNo},'%') 
	               </if>
	       ) XX
	       WHERE 1=1
	           <if test='ptnrCd != null and ptnrCd != ""'>
                   AND     PARTNER_NO = #{ptnrCd}
               </if>
               <if test='result != null and result != ""'>
                   AND     SEND_STATUS = #{result}
               </if>
    </select>
    
    
    <!--  LGD수입HBL전송정보조회  -->
    <select id="selectLgdImpHblSendInfo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgdImpHblSendInfo */
        SELECT A.MASTER_BLNO
	          ,A.HOUSE_BLNO
	          ,A.SHIP_DATE
	          ,A.ETA_DATE ARR_DT
	          ,A.CONVERSATION_ID
	          ,DATE_FORMAT(NOW(), '%Y%m%d%H%i%s') AS INS_DT
	       /*{#1}*/
	       <choose>
	           <when test = 'exctSprCd != null and exctSprCd != "" and exctSprCd == "OC"'>
	               FROM   NFINF.TB_FWD_INT061 A
	           </when>
	           <otherwise>
	               FROM   NFINF.TB_FWD_INT060 A
	           </otherwise>
	       </choose>
	       /*{/#1}*/
	    WHERE  HOUSE_BLNO = #{hblNo}
	    ORDER  BY TIMESTAMP DESC
    </select>
    
    <!--  LGD수입HBL응답정보조회  -->
    <select id="selectLgdImpHblAnsInfo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgdImpHblAnsInfo */
        SELECT A.REF_DOC_ID
		      ,A.REF_ISSUE_DT
		      ,A.RESULT_TYPE_CODE
		      ,B.MSG_DESC
		      ,DATE_FORMAT(NOW(), '%Y%m%d%H%i%s') AS INS_DT
		FROM  NFINF.TB_FWD_INT065 A
		LEFT OUTER JOIN NFINF.TB_FWD_INT066 B ON B.INTERFACE_ID = A.INTERFACE_ID
		WHERE 1=1
		   /*{#1}*/
		   <choose>
               <when test = 'exctSprCd != null and exctSprCd != "" and exctSprCd == "OC"'>
                   AND   A.REF_CONV_ID IN
							               (SELECT CONVERSATION_ID 
							                FROM NFINF.TB_FWD_INT061 
							                WHERE HOUSE_BLNO = #{hblNo})
               </when>
               <otherwise>
                   AND   A.REF_CONV_ID IN
							               (SELECT CONVERSATION_ID 
							                FROM NFINF.TB_FWD_INT060 
							                WHERE HOUSE_BLNO = #{hblNo})
               </otherwise>
           </choose>
		  /*{/#1}*/
		ORDER BY A.TIMESTAMP DESC
    </select>
    
    
    <!-- invoice존재여부조회 -->
    <select id="selectImpInvExstYn" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectImpInvExstYn */
        SELECT COUNT(1) LN_CNT
		       , DATE_FORMAT (NOW(), '%Y%m%d') AS LV_TODAY
		FROM   TB_FWD_INTG_REF_NO S
		WHERE  1=1
		AND    S.INTG_KEY_ID = #{blId}
		AND    S.DEL_YN = 'N'
		AND    S.REF_NO_SPR_CD = 'IN'
    </select>
    
    <!-- invoice존재여부조회 -->
    <select id="selectLgdImpAirHblInfo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgdImpAirHblInfo */
        SELECT 
		     BL_NO
		    ,MBL_NO        
		    ,IFNULL( (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm2">
                           <property name="tag" value="'PKE_EDI코드'"/>
                           <property name="param1" value="'81'"/>
                           <property name="param2" value="A.CNEE_CD"/>
                           <property name="param3" value="NULL"/>
                       </include>) /* Mybatis Include로 처리 :: FC_CM_GET_EDI_NM2('PKE_EDI코드', '81', A.CNEE_CD, '')*/, 'K')  AS CONSIGNEE       
		    ,A.INCOT_CD
		    ,A.INVC_AMT
		    ,A.CUR_CD AS CURRENCY
		    ,A.SELL_GWT AS GROSS_WEIGHT
		    ,A.SELL_CWT AS CHARGABLE_WEIGHT
		    ,A.SELL_VOL_WGT AS VOLUME_WEIGHT     
		    ,A.ONBR_YMD AS SHIP_DATE
		    ,A.ARR_YMD AS ETA_DATE   
		    ,SUBSTR(A.POL_CD, 0, 2) AS SHIP_NATION
		    ,IFNULL(SUBSTR( (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm1">
	                               <property name="tag" value="'LGD_PORT_MAP_OUT'"/>
	                               <property name="param1" value="A.POD_CD"/>
                              </include>) /* Mybatis Include로 처리 :: FC_CM_GET_EDI_NM1('LGD_PORT_MAP_OUT', A.POD_CD)*/, 3, 3)
		        ,SUBSTR(A.POD_CD, 3, 3))  AS ARRIVAL_PORT
		    ,SUBSTR(A.POD_CD, 0, 2) AS ARRIVAL_NATION
		    ,A.PKG_QTY
		    ,A.FLT_VSL_NM         
		    ,SUBSTR(FC_FWD_STR_RTN(FC_FWD_TRIM_CHAR((SELECT S.VERT_LEN || 'x     ' || S.WTH_LEN || 'x     ' || S.HGT || 'x     ' ||
		                                                   S.PKG_QTY || 'CTN'
		                                              FROM TB_FWD_INTG_DIM S
		                                             WHERE 1 = 1
		                                               AND S.INTG_KEY_ID = A.BL_ID
		                                               AND S.DEL_YN = 'N'
		                                               LIMIT 1)),1,0,'X','X'),0,100) AS DIMENSION
		        ,D.MNFST_ITEM_NM
		        ,SUBSTR(A.POL_CD, 0, 2) AS ORIGIN     
		       ,A.SHPP_NM      
		FROM  TB_FWD_BL A
		INNER JOIN TB_FWD_BL_PRT_EXPND B ON B.BL_ID = A.BL_ID
		INNER JOIN TB_SMT_ORD C ON C.SMT_NO = A.SMT_NO
		INNER JOIN TB_FWD_BL_TASK_SPC_DTL D ON  D.BL_ID = A.BL_ID
		           AND D.TASK_SPR_CD ='IMP'
		WHERE A.BL_ID = #{blId}
    </select>
    
    
    <!--  invoice목록조회   -->
    <select id="selectInvList" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectInvList */
        SELECT  @rownum:=@rownum+1 AS DETAIL_SEQ,
		     /*{#REPLACE}*/
		     <choose>
               <when test = 'exctSprCd != null and exctSprCd != "" and exctSprCd == "AR"'>
                   'A' AS FARE_TYPE,
               </when>
               <otherwise>
                   'S' AS FARE_TYPE,
               </otherwise>
           </choose>
		     /*{/#REPLACE}*/ 
		     S.REF_NO AS INVOICE_NO
		FROM    TB_FWD_INTG_REF_NO S,
		       (SELECT @rownum:=0) TMP
		WHERE   1 = 1
		AND     S.INTG_KEY_ID = #{blId}
		AND     S.DEL_YN = 'N'
		AND     S.REF_NO_SPR_CD = 'IN'
    </select>
    
    <!--  selectLgdIf060TblData   -->
    <select id="selectLgdIf060TblData" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgdIf060TblData */
        SELECT  #{ifId} AS INTERFACE_ID
		        ,#{conversationId} AS CONVERSATION_ID
		         ,'I' AS IMPORT_TYPE
		        ,'687822338' AS PARTNER_DUNS_NO
		        ,IFNULL(A.BL_PRT_YMD, A.ONBR_YMD) AS BL_DATE
		        ,BL_NO AS HOUSE_BLNO
		        ,IF(A.BL_SPR_CD='D', BL_NO, MBL_NO) AS MASTER_BLNO
		        ,IFNULL((<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm1">
                              <property name="tag" value="'거래처영문명'"/>
                              <property name="param1" value="(SELECT EXCT_BIZPTNR_CD
					                                          FROM   TB_SMT_INTG_TASK_DEPT
					                                          WHERE  EO_NO = A.EO_NO
					                                          AND    CST_BL_ID = A.BL_ID 
					                                          AND    TASK_SPR_CD = 'EXP')"/>
                         </include>) /* Mybatis Include로 처리 :: FC_CM_GET_EDI_NM1('거래처영문명'
		                              ,(SELECT EXCT_BIZPTNR_CD
		                                 FROM TB_OM_INTG_TASK_DEPT
		                                WHERE EO_NO = A.EO_NO
		                                  AND CST_BL_ID = A.BL_ID 
		                                  AND TASK_SPR_CD = 'EXP'))*/
		            ,'LX PANTOS CO., LTD.') AS PARTNER
		        ,IFNULL( (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm2">
	                           <property name="tag" value="'PKE_EDI코드'"/>
	                           <property name="param1" value="'81'"/>
	                           <property name="param2" value="A.CNEE_CD"/>
	                           <property name="param3" value="NULL"/>
	                       </include>) /* Mybatis Include로 처리 :: FC_CM_GET_EDI_NM2('PKE_EDI코드', '81', A.CNEE_CD, '')*/, 'K') AS CONSIGNEE
		        ,'KR001634' AS VEND_CODE
		        ,0 AS PRICE_RATE
		        ,'N' AS RATE_APPLY_YN
		        ,A.INCOT_CD AS PRICE_CONDITION
		        ,A.INVC_AMT AS TOTAL_FARE
		        ,A.CUR_CD AS CURRENCY
		        ,A.SELL_GWT AS GROSS_WEIGHT
		        ,A.SELL_CWT AS CHARGABLE_WEIGHT
		        ,A.SELL_VOL_WGT AS VOLUME_WEIGHT
		        ,'KG' AS WEIGHT_UNIT
		        ,SUBSTR(FC_FWD_STR_RTN(FC_FWD_TRIM_CHAR((SELECT S.FRM_CONT
		                                                FROM TB_FWD_INTG_RMK S
		                                               WHERE 1 = 1
		                                                 AND S.INTG_KEY_ID = A.BL_ID
		                                                 AND S.DEL_YN = 'N'
		                                                 AND S.RMK_SPR_CD = 'MARK'
		                                                 LIMIT 1)),1,0,'X','X'),0,300) AS SHPPING_MARK
		        ,SUBSTR(FC_FWD_STR_RTN(FC_FWD_TRIM_CHAR((SELECT  S.INTG_ADDR                            
		                                              FROM   TB_FWD_INTG_ADDR S                        
		                                              WHERE  1=1
		                                              AND    S.INTG_KEY_ID = A.BL_ID
		                                              AND    S.DEL_YN = 'N'           
		                                              AND    S.ADDR_SPR_CD = 'BS'  
		                                              LIMIT  1                      
		                                           )),1,0,'X','X'),0,150) AS SHIPPER
		        ,A.ONBR_YMD AS SHIP_DATE
		        ,A.ARR_YMD AS ETA_DATE
		        ,'' AS ETA_TIME
		        ,IFNULL(SUBSTR( (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm1">
                                    <property name="tag" value="'LGD_PORT_MAP_OUT'"/>
                                    <property name="param1" value="A.POL_CD"/>
                                </include>) /* Mybatis Include로 처리 :: FC_CM_GET_EDI_NM1('LGD_PORT_MAP_OUT', A.POL_CD)*/, 3, 3)
		            ,SUBSTR(A.POL_CD, 3, 3)) AS SHIP_PORT
		        ,SUBSTR(A.POL_CD, 0, 2) AS SHIP_NATION
		        ,IFNULL(SUBSTR( (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm1">
                                    <property name="tag" value="'LGD_PORT_MAP_OUT'"/>
                                    <property name="param1" value="A.POD_CD"/>
                                </include>) /* Mybatis Include로 처리 :: FC_CM_GET_EDI_NM1('LGD_PORT_MAP_OUT', A.POD_CD)*/, 3, 3)
		            ,SUBSTR(A.POD_CD, 3, 3)) AS ARRIVAL_PORT
		        ,SUBSTR(A.POD_CD, 0, 2) AS ARRIVAL_NATION
		        ,A.PKG_QTY
		        ,'GT' AS PACK_UNIT
		        ,SUBSTR(A.FLT_VSL_NM, 1, 20) AS AIRLINE_NAME
		        ,'' AS ACCOUNT_INFO
		        ,'' AS IATA_CODE
		        ,SUBSTR(FC_FWD_STR_RTN(FC_FWD_TRIM_CHAR((SELECT  S.FRM_CONT
		                                                  FROM   TB_FWD_INTG_RMK S
		                                                 WHERE  1 = 1
		                                                  AND   S.INTG_KEY_ID = A.BL_ID
		                                                  AND   S.DEL_YN = 'N'
		                                                  AND   S.RMK_SPR_CD = 'HNDL'
		                                                  LIMIT  1)),1,0,'X','X'),0,200) AS HANDLING
		        ,'' AS CARRIAGE
		        ,'' AS CUSTOMS
		        ,(CASE
		          WHEN A.FRGTTERM_CD='PP'
		          THEN 'PREPAID'
		          WHEN A.FRGTTERM_CD='CC'
		          THEN 'COLLECT'
		         END) AS FARE_CONDITION
		        ,(CASE 
		          WHEN C.CARR_CD = '1014188'
		          THEN ( CASE
		             WHEN A.CARGO_TYPE_CD='G'
		             THEN 'F'
		             WHEN A.CARGO_TYPE_CD='U'
		             THEN 'B'
		             WHEN A.CARGO_TYPE_CD='D'
		             THEN 'G'
		             WHEN A.CARGO_TYPE_CD='S'
		             THEN 'L'
		             ELSE SUBSTR(A.CARGO_TYPE_CD, 1, 1)
		              END )
		          WHEN C.CARR_CD = '1014189'
		          THEN ( CASE
		             WHEN A.CARGO_TYPE_CD='G'
		             THEN 'M'
		             WHEN A.CARGO_TYPE_CD='U'
		             THEN 'N'
		             WHEN A.CARGO_TYPE_CD='D'
		             THEN 'O'
		             WHEN A.CARGO_TYPE_CD='S'
		             THEN 'P'
		             ELSE SUBSTR(A.CARGO_TYPE_CD, 1, 1)
		              END )
		       WHEN C.CARR_CD = 'H100'
		          THEN ( CASE
		             WHEN A.CARGO_TYPE_CD='G'
		             THEN 'R'
		             WHEN A.CARGO_TYPE_CD='U'
		             THEN 'S'
		             WHEN A.CARGO_TYPE_CD='D'
		             THEN 'T'
		             WHEN A.CARGO_TYPE_CD='S'
		             THEN 'U'
		             ELSE SUBSTR(A.CARGO_TYPE_CD, 1, 1)
		              END )
		          ELSE ( CASE
		             WHEN A.CARGO_TYPE_CD='G'
		             THEN 'A'
		             WHEN A.CARGO_TYPE_CD='U'
		             THEN 'C'
		             WHEN A.CARGO_TYPE_CD='D'
		             THEN 'D'
		             WHEN A.CARGO_TYPE_CD='S'
		             THEN 'E'
		             ELSE SUBSTR(A.CARGO_TYPE_CD, 1, 1)
		              END )    
		         END) AS GOODS_KIND
		        ,SUBSTR(FC_FWD_STR_RTN(FC_FWD_TRIM_CHAR((SELECT S.VERT_LEN || 'x     ' || S.WTH_LEN || 'x     ' || S.HGT || 'x     ' ||
		                                                       S.PKG_QTY || 'CTN'
		                                                  FROM TB_FWD_INTG_DIM S
		                                                 WHERE 1 = 1
		                                                   AND S.INTG_KEY_ID = A.BL_ID
		                                                   AND S.DEL_YN = 'N'
		                                                   LIMIT 1)),1,0,'X','X'),0,100) AS DIMENSION
		        ,D.MNFST_ITEM_NM AS DESCRIPTION
		        ,SUBSTR(A.POL_CD, 0, 2) AS ORIGIN
		        ,(SELECT S.REF_NO
		           FROM TB_FWD_INTG_REF_NO S
		          WHERE 1 = 1
		            AND S.INTG_KEY_ID = A.BL_ID
		            AND S.DEL_YN = 'N'
		            AND S.REF_NO_SPR_CD = 'PA'
		   LIMIT 1) AS PART_NO
		        ,0 AS PART_QTY
		        ,SUBSTR((SELECT S.REF_NO
		             FROM TB_FWD_INTG_REF_NO S
		            WHERE 1 = 1
		              AND S.INTG_KEY_ID = A.BL_ID
		              AND S.DEL_YN = 'N'
		              AND S.REF_NO_SPR_CD = 'PO'
		              LIMIT 1),1,20) AS FILE_NO
		        ,IFNULL(A.HUB_BILG_YN,'N') AS HUB_YN
		        ,'' AS ATTRIBUTE1
		        ,SUBSTR(FC_FWD_STR_RTN(FC_FWD_TRIM_CHAR((SELECT  S.FRM_CONT
		                                               FROM   TB_FWD_INTG_RMK S
		                                               WHERE  1 = 1
		                                               AND   S.INTG_KEY_ID = A.BL_ID
		                                               AND   S.DEL_YN = 'N'
		                                               AND    S.RMK_SPR_CD = 'GODS'
		                                               LIMIT 1)),1,0,'X','X'),0,200) AS ATTRIBUTE2
		        ,A.SHPP_NM AS ATTRIBUTE3
		        ,'' AS ATTRIBUTE4
		        ,'EAI' AS INS_ID
		        ,NOW() AS TIMESTAMP
		        ,(CASE
		          WHEN A.FRGTTERM_CD='PP'
		          THEN 'PREPAID'
		          WHEN A.FRGTTERM_CD='CC'
		          THEN 'COLLECT'
		         END) AS OTHER_FARE_CONDITION
		FROM  TB_FWD_BL A 
		INNER JOIN TB_FWD_BL_PRT_EXPND B ON B.BL_ID = A.BL_ID
		INNER JOIN TB_SMT_ORD C ON C.SMT_NO = A.SMT_NO
		INNER JOIN TB_FWD_BL_TASK_SPC_DTL D ON  D.BL_ID = A.BL_ID
		         AND D.TASK_SPR_CD ='IMP'
		WHERE  1=1
		AND  A.BL_ID = #{blId}
    </select>
    
    <!--  invoice중복조회  -->
    <select id="selectInvDup" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectInvDup */
        SELECT  COUNT(1) AS CNT
		FROM  TB_FWD_INTG_REF_NO     B
		       ,TB_FWD_BL             C
		       ,TB_SMT_INTG_TASK_DEPT D
		WHERE  1=1
		AND  B.INTG_KEY_ID = C.BL_ID
		AND  C.BL_ID = D.CST_BL_ID
		AND  C.EO_NO = D.EO_NO
		AND  B.DEL_YN = 'N'
		AND  B.REF_NO_SPR_CD = 'IN'
		AND  C.EXCT_SPR_CD = #{exctSprCd}
		AND  D.TASK_SPR_CD = 'IMP'
		AND  C.DEL_YN = 'N'
		AND  B.REF_NO = #{invNo}
		AND  C.CNEE_CD IN
		      (SELECT A.BIZPTNR_CD
		          FROM   TB_COM_BIZPTNR A
		          WHERE  A.MBIZPTNR_YN = 'Y'
		          AND   A.BIZPTNR_GRP_CD = '1001002'
		          AND   A.NATN_CD = 'KR'
		          UNION ALL
		          SELECT C.BIZPTNR_CD
		          FROM   TB_COM_BIZPTNR C
		          WHERE  C.MBIZPTNR_YN = 'N'
		          AND   C.MBIZPTNR_CD IN (SELECT B.BIZPTNR_CD
		                                   FROM   TB_COM_BIZPTNR B
		                                   WHERE  B.MBIZPTNR_YN = 'Y'
		                                   AND    B.BIZPTNR_GRP_CD = '1001002'
		                                   AND    B.NATN_CD = 'KR'))
    </select>
    
    <!--  LGD인터페이스062테이블등록  -->
    <insert id="insertLgdIf062Tbl" parameterType="dataItem" >
        /* fwd.edi.fwdCstComIfMgnt.insertLgdIf062Tbl */
        INSERT INTO NFINF.TB_FWD_INT062
								      (INTERFACE_ID
								      ,DETAIL_SEQ
								      ,FARE_TYPE
								      ,INVOICE_NO
								      ,ATTRIBUTE1
								      ,ATTRIBUTE2
								      ,ATTRIBUTE3
								      ,ATTRIBUTE4
								      ,ATTRIBUTE5
								      ,INS_ID
								      ,TIMESTAMP)
								    VALUES
								      (#{ifId}
								      ,#{detailSeq}
								      ,#{fareType}
								      ,#{invoiceNo}
								      ,''
								      ,''
								      ,''
								      ,''
								      ,''
								      ,'EAI'
								      ,NOW())   
    </insert>
    
    <!-- insertLgdIf061Tbl에 들어갈 데이터 조회 -->
    <select id="selectLgdIf061TblData" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgdIf061TblData */
        SELECT #{ifId} AS INTERFACE_ID
			   ,#{conversationId} AS CONVERSATION_ID
			   , 'I' AS IMPORT_TYPE
			   ,'687822338' AS PARTNER_DUNS_NO
			   ,A.ONBR_YMD AS BL_DATE
			   ,A.BL_NO AS HOUSE_BLNO
			   ,IF(A.BL_SPR_CD='D', A.BL_NO, A.MBL_NO) AS MASTER_BLNO
			   ,IFNULL( (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm1">
                              <property name="tag" value="'거래처영문명'"/>
                              <property name="param1" value="(SELECT EXCT_BIZPTNR_CD
                                                              FROM   TB_SMT_INTG_TASK_DEPT
                                                              WHERE  EO_NO = A.EO_NO
                                                              AND    CST_BL_ID = A.BL_ID 
                                                              AND    TASK_SPR_CD = 'EXP')"/>
                         </include>) /* Mybatis Include로 처리 :: FC_CM_GET_EDI_NM1('거래처영문명'
			                                     ,(SELECT EXCT_BIZPTNR_CD
			                                        FROM TB_SMT_INTG_TASK_DEPT
			                                       WHERE EO_NO = A.EO_NO
			                                         AND CST_BL_ID = A.BL_ID
			                                         AND TASK_SPR_CD = 'EXP'))*/
			       ,'LX PANTOS CO., LTD.') AS PARTNER
			   ,IFNULL( (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm2">
                               <property name="tag" value="'PKE_EDI코드'"/>
                               <property name="param1" value="'81'"/>
                               <property name="param2" value="A.CNEE_CD"/>
                               <property name="param3" value="NULL"/>
                           </include>) /* Mybatis Include로 처리 :: FC_CM_GET_EDI_NM2('PKE_EDI코드', '81', A.CNEE_CD,'')*/, 'P') AS CONSIGNEE
			   ,'KR001634' AS VEND_CODE
			   ,0 AS PRICE_RATE
			   ,'N' AS RATE_APPLY_YN
			   ,A.INCOT_CD AS PRICE_CONDITION
			   ,0 AS TOTAL_FARE
			   ,CASE WHEN (  (IFNULL(A.SHPP_CD,'')||IFNULL(TRN_TYPE_CD,'')||IFNULL(INCOT_CD,'')  IN (SELECT  IFNULL(SA.ETC_CONT2,'')||IFNULL(SA.ETC_CONT3,'')||IFNULL(SA.ETC_CONT4,'')
			                                                                           FROM TB_COM_ETC_CD SA 
			                                                                           WHERE SA.CLAS_CD ='2360'
			                                                                           AND SA.ETC_CONT1 = 'LGDCN'))  /* 2020.05.26 김정숙 [CSR ID:4232003]  LGD 남중국발 한국향 CURR 단위 USD  ( SHPP_CD, TRN_TYPE_CD, INCOT_CD 조합값) */
			                      OR 
			                      (IFNULL(A.SHPP_CD,'')||IFNULL(CNEE_CD,'')||IFNULL(INCOT_CD,'')  IN (SELECT  IFNULL(SA.ETC_CONT2,'')||IFNULL(SA.ETC_CONT3,'')||IFNULL(SA.ETC_CONT4,'')
			                                                                           FROM TB_COM_ETC_CD SA 
			                                                                           WHERE SA.CLAS_CD ='2360'
			                                                                           AND SA.ETC_CONT1 = 'LGDVH' ))   /* 2020.05.26 김정숙 [CSR ID:4232003]  LGD 베트남발 한국향 CURR 단위 USD ( SHPP_CD, CNEE_CD, INCOT_CD 조합값) */
			                    )                                                     
			            THEN  'USD'
			            ELSE   IFNULL(A.CUR_CD,'USD' )
			        END AS CURRENCY   
			   ,A.SELL_GWT AS GROSS_WEIGHT
			   ,A.SELL_CBM AS CBM
			   ,'KG' AS WEIGHT_UNIT   
			   ,SUBSTR(FC_FWD_STR_RTN(FC_FWD_TRIM_CHAR((SELECT X.FRM_CONT
			                                            FROM  TB_FWD_INTG_RMK X
			                                            WHERE  1 = 1
			                                            AND   X.INTG_KEY_ID = A.BL_ID
			                                            AND   X.DEL_YN = 'N'
			                                            AND   X.RMK_SPR_CD = 'MARK'
			                                            LIMIT    1)),1,0,'X','X'),0,200) AS SHPPING_MARK
			   ,SUBSTR(FC_FWD_TRIM_CHAR((SELECT  S.INTG_ADDR                            
			                             FROM    TB_FWD_INTG_ADDR S                        
			                             WHERE   1=1
			                             AND     S.INTG_KEY_ID = A.BL_ID
			                             AND     S.DEL_YN = 'N'          
			                             AND     S.ADDR_SPR_CD = 'BS'  
			                             LIMIT   1                      
			                          )),0,150) AS SHIPPER
			   ,A.ONBR_YMD AS SHIP_DATE
			   ,A.ARR_YMD AS ETA_DATE
			   ,'0000' AS ETA_TIME
			   ,IFNULL(SUBSTR( (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm1">
                                    <property name="tag" value="'LGD_PORT_MAP_OUT'"/>
                                    <property name="param1" value="A.POL_CD"/>
                                </include>) /* Mybatis Include로 처리 :: FC_CM_GET_EDI_NM1('LGD_PORT_MAP_OUT', A.POL_CD)*/, 3, 3)
			         ,SUBSTR(A.POL_CD, 3, 3)) AS SHIP_PORT
			   ,SUBSTR(A.POL_CD, 0, 2) AS SHIP_NATION
			   ,IFNULL(SUBSTR( (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm1">
                                    <property name="tag" value="'LGD_PORT_MAP_OUT'"/>
                                    <property name="param1" value="A.POD_CD"/>
                                </include>) /* Mybatis Include로 처리 :: FC_CM_GET_EDI_NM1('LGD_PORT_MAP_OUT', A.POD_CD)*/, 3, 3)
			       ,SUBSTR(A.POD_CD, 3, 3)) AS ARRIVAL_PORT
			   ,SUBSTR(A.POD_CD, 0, 2) AS ARRIVAL_NATION
			   ,A.PKG_QTY AS PACK_QTY
			   ,IFNULL((SELECT OUTR_CD FROM TB_FWD_CD_MPNG WHERE INSD_CD = A.PKG_UNIT_CD AND UPPR_CD_MPNG_NO='4'),'GT') AS PACK_UNIT
			   /*--,DECODE(A.PKG_UNIT_CD, 'BX', 'CT','PK','PT','PL','PT','GT')*/
			   ,A.FLT_VSL_NM AS AIRLINE_NAME
			   ,A.VOYAGE AS VOYAGE_NO
			   ,A.POR_NM AS RECEIPT_PLACE
			   ,A.PDEL_NM AS DELIVERY_PLACE
			   ,'' AS BL_ISSUE_PLACE
			   ,SUBSTR(FC_FWD_TRIM_CHAR((SELECT BL_MARK_ADDR
			                         FROM TB_COM_BIZPTNR
			                        WHERE BIZPTNR_CD = D.EXCT_BIZPTNR_CD)),0,200) AS PARTY
			   ,'' AS CARRIAGE_BY
			   ,(SELECT  T.SEAL1
			       FROM  TB_FWD_BL_ITEM_MPNG I
			         ,TB_SMT_INTG_ITEM T
			         ,TB_FWD_BL B
			      WHERE  1 = 1
			        AND  I.INTG_ITEM_NO = T.INTG_ITEM_NO
			        AND  I.BL_ID = B.BL_ID
			        AND  I.MPNG_KIND_CD = 'OMI'
			        AND  T.CNTR_YN = 'Y'
			        AND  I.BL_ID = A.BL_ID
			        AND  I.DEL_YN = 'N'
			        AND  T.DEL_YN = 'N'
			        AND  B.DEL_YN = 'N'
			        LIMIT 1) AS SEAL_NO
			   ,'' AS NOTE
			   ,(SELECT  SUM(T.QTY)
			     FROM    TB_FWD_BL_ITEM_MPNG I        
			            ,TB_SMT_INTG_ITEM T
			     WHERE   1 = 1
			     AND     I.INTG_ITEM_NO = T.INTG_ITEM_NO
			     AND     I.MPNG_KIND_CD = 'OMI'
			     AND     T.CNTR_YN = 'Y'
			     AND     I.BL_ID = A.BL_ID
			     AND     I.DEL_YN = 'N'
			     AND     T.DEL_YN = 'N') AS TOTAL_CONTAINER
			   ,0 AS BL_QTY
			   ,(CASE 
			     WHEN A.FRGTTERM_CD='PP'
			     THEN 'PREPAID'
			     WHEN A.FRGTTERM_CD='CC'
			     THEN 'COLLECT'
			    END) AS FARE_CONDITION
			   ,(CASE 
			     WHEN D.CARR_CD='1004004'
			     THEN '1'
			     WHEN D.CARR_CD='1004056'
			     THEN '1'
			     WHEN D.CARR_CD='1004113'
			     THEN '1'
			     WHEN D.CARR_CD='1004115'
			     THEN '1'
			     WHEN D.CARR_CD='1004370'
			     THEN '1'
			     WHEN D.CARR_CD='1004450'
			     THEN '1'
			     ELSE '2'
			    END) AS VESSEL_TYPE
			   ,'' AS ANOTIFY_PARTY
			   ,SUBSTR(A.POL_CD, 0, 2) AS ORIGIN
			   ,(SELECT S.REF_NO
			       FROM  TB_FWD_INTG_REF_NO S
			      WHERE  1 = 1
			        AND  S.INTG_KEY_ID = A.BL_ID
			        AND  S.DEL_YN = 'N'
			        AND  S.REF_NO_SPR_CD = 'PA'
			        LIMIT 1) AS PART_NO
			   ,0 AS PART_QTY
			   ,SUBSTR((SELECT  S.REF_NO
			           FROM  TB_FWD_INTG_REF_NO S
			      WHERE  1 = 1
			         AND   S.INTG_KEY_ID = A.BL_ID
			            AND   S.DEL_YN = 'N'
			         AND   S.REF_NO_SPR_CD = 'PO'
			            LIMIT  1),1,20) AS FILE_NO
			   ,IFNULL(A.HUB_BILG_YN,'N') AS HUB_YN
			   ,SUBSTR(FC_FWD_STR_RTN(FC_FWD_TRIM_CHAR((SELECT  X.FRM_CONT
			                                            FROM  TB_FWD_INTG_RMK X
			                                            WHERE  1 = 1
			                                            AND   X.INTG_KEY_ID = A.BL_ID
			                                            AND   X.DEL_YN = 'N'
			                                            AND   X.RMK_SPR_CD = 'SAY'
			                                            LIMIT 1)),1,0,'X','X'),0,200) AS ATTRIBUTE1
			   ,SUBSTR(FC_FWD_STR_RTN(FC_FWD_TRIM_CHAR((SELECT  X.FRM_CONT
			                                            FROM  TB_FWD_INTG_RMK X
			                                            WHERE  1 = 1
			                                            AND   X.INTG_KEY_ID = A.BL_ID
			                                            AND   X.DEL_YN = 'N'
			                                            AND   X.RMK_SPR_CD = 'DESC'
			                                            LIMIT  1)),1,0,'X','X'),0,200) AS ATTRIBUTE2
			   ,A.SHPP_NM AS ATTRIBUTE3
			   ,'' AS ATTRIBUTE4
			   ,'' AS ATTRIBUTE5
			   ,'EAI' AS INS_ID
			   ,NOW() AS TIMESTAMP
			   ,(CASE 
			     WHEN A.FRGTTERM_CD='PP'
			     THEN 'PREPAID'
			     WHEN A.FRGTTERM_CD='CC'
			     THEN 'COLLECT'
			    END) AS OTHER_FARE_CONDITION
			   ,'' AS SPEC
			   ,E.MNFST_ITEM_NM AS DESCRIPTION
			FROM  TB_FWD_BL A 
			INNER JOIN TB_FWD_BL_PRT_EXPND B ON B.BL_ID = A.BL_ID
			INNER JOIN TB_SMT_INTG_TASK_DEPT D ON  D.EO_NO = A.EO_NO
			           AND D.CST_BL_ID = A.BL_ID
			           AND D.TASK_SPR_CD = 'IMP'
			           AND D.DEL_YN = 'N'
			INNER JOIN TB_FWD_BL_TASK_SPC_DTL E ON  E.BL_ID = A.BL_ID
			         AND E.TASK_SPR_CD = 'IMP'
			         AND E.DEL_YN ='N'
			WHERE 1=1
			AND   A.BL_ID = #{blId}
			AND   A.DEL_YN ='N'
    </select>
    
    <!--  LGDHBL컨테이너목록조회  -->
    <select id="selectLgdSeaHblCntrDtl" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgdSeaHblCntrDtl */
        SELECT  B.CNTR_NO
		        ,IFNULL((<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm2">
                               <property name="tag" value="'PKE_EDI코드'"/>
                               <property name="param1" value="'82'"/>
                               <property name="param2" value="B.CNTR_SIZE_CD || B.CNTR_TYPE_CD"/>
                               <property name="param3" value="NULL"/>
                           </include>) /* /* [TODO-PJS] Mybatis Include로 처리 :: FC_CM_GET_EDI_NM2('PKE_EDI코드'
		                                ,'82'
		                                ,B.CNTR_SIZE_CD || B.CNTR_TYPE_CD
		                                ,'')*/
		              ,'XX') AS CONTAINER_TYPE
		        ,1 AS CONTAINER_QTY
		FROM   TB_FWD_BL_ITEM_MPNG A, 
		       TB_SMT_INTG_ITEM B
		WHERE  1 = 1
		AND    A.INTG_ITEM_NO = B.INTG_ITEM_NO
		AND    A.MPNG_KIND_CD = 'OMI'
		AND    B.CNTR_YN = 'Y'
		AND    A.BL_ID = #{blId}
		AND    A.DEL_YN = 'N'
		AND    B.DEL_YN = 'N'
    </select>
    
    <!--  LGD인터페이스063테이블등록   -->
    <insert id="insertLgdIf063Tbl" parameterType="dataItem" >
        /* fwd.edi.fwdCstComIfMgnt.insertLgdIf063Tbl */
        INSERT INTO NFINF.TB_FWD_INT063
								      (INTERFACE_ID   
								      ,CONTAINER_NO   
								      ,CONTAINER_TYPE   
								      ,CONTAINER_QTY   
								      ,ATTRIBUTE1   
								      ,ATTRIBUTE2   
								      ,ATTRIBUTE3   
								      ,ATTRIBUTE4   
								      ,ATTRIBUTE5   
								      ,INS_ID   
								      ,TIMESTAMP)
								    VALUES
								      (#{ifId}   
								      ,#{cntrNo}   
								      ,#{containerType}   
								      ,#{containerQty}   
								      ,''   
								      ,''   
								      ,''   
								      ,''   
								      ,''   
								      ,'EAI'   
								      ,NOW())  
    </insert>

    <!-- LG상사수출BL조회 -->
    <select id="selectLgiExpBl" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgiExpBl */
        SELECT   
			  '' AS CHK
			        ,A.BL_ID
			        ,A.BL_SPR_CD
			        ,(<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                         <property name="clasCd" value="'0055'"/>
                         <property name="dtlCd" value="A.BL_SPR_CD"/>
                     </include>) AS BL_SPR_NM /* Mybatis Include로 처리 :: FC_CM_GET_ETC_CD_NM('0055',A.BL_SPR_CD) AS BL_SPR_NM*/
			        ,A.BL_NO AS HBL_NO
			        ,A.MBL_NO
			        ,(SELECT  S.REF_NO
			          FROM    TB_FWD_INTG_REF_NO S
			          WHERE   A.BL_ID = S.INTG_KEY_ID
			          AND     S.REF_NO_SPR_CD = 'SR'
			          AND     S.RPRS_YN = 'Y'
			          AND     S.DEL_YN = 'N'
			          LIMIT   1) AS SR_NO      
			        ,A.ONBR_YMD
			        ,A.SHPP_CD
			        ,A.SHPP_NM
			        ,A.CNEE_CD
			        ,A.CNEE_NM
			        ,A.CUR_CD
			        ,A.POL_CD
			        ,A.POL_NM
			        ,A.POD_CD
			        ,A.POD_NM
			        ,A.CARR_NM
			        ,A.TRN_TYPE_CD
			        ,(<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                         <property name="clasCd" value="'0002'"/>
                         <property name="dtlCd" value="A.TRN_TYPE_CD"/>
                     </include>) AS TRN_TYPE_NM /* Mybatis Include로 처리 :: FC_CM_GET_ETC_CD_NM('0002', A.TRN_TYPE_CD) TRN_TYPE_NM*/
			        ,A.PKG_QTY
			        ,A.SELL_GWT
			        ,A.INCOT_CD
			        ,(<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm2">
                          <property name="tag" value="'LGI_BL_LST_SND_DT'"/>
                          <property name="param1" value="A.BL_NO"/>
                          <property name="param2" value="NULL"/>
                          <property name="param3" value="NULL"/>
                      </include>) AS LAST_SEND_DT /* Mybatis Include로 처리 :: FC_CM_GET_EDI_NM2('LGI_BL_LST_SND_DT', A.BL_NO, '', '') AS LAST_SEND_DT*/
			        ,(<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm2">
                          <property name="tag" value="'LGI_BL_SND_YN'"/>
                          <property name="param1" value="A.BL_NO"/>
                          <property name="param2" value="NULL"/>
                          <property name="param3" value="NULL"/>
                      </include>) AS SEND_YN /* Mybatis Include로 처리 :: FC_CM_GET_EDI_NM2('LGI_BL_SND_YN', A.BL_NO, '', '') AS SEND_YN*/
			        ,CASE WHEN (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm2">
                                    <property name="tag" value="'LGI_RESPONSE'"/>
                                    <property name="param1" value="A.BL_NO"/>
                                    <property name="param2" value="'CODE'"/>
                                    <property name="param3" value="NULL"/>
                                </include>) /* Mybatis Include로 처리 :: FC_CM_GET_EDI_NM2('LGI_RESPONSE', A.BL_NO, 'CODE', '')*/ = 'C' THEN 'Confirm'
			              WHEN (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm2">
                                    <property name="tag" value="'LGI_RESPONSE'"/>
                                    <property name="param1" value="A.BL_NO"/>
                                    <property name="param2" value="'CODE'"/>
                                    <property name="param3" value="NULL"/>
                                </include>) /* Mybatis Include로 처리 :: FC_CM_GET_EDI_NM2('LGI_RESPONSE', A.BL_NO, 'CODE', '')*/ = 'N' THEN 'Normal'
			              WHEN (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm2">
                                    <property name="tag" value="'LGI_RESPONSE'"/>
                                    <property name="param1" value="A.BL_NO"/>
                                    <property name="param2" value="'CODE'"/>
                                    <property name="param3" value="NULL"/>
                                </include>) /* Mybatis Include로 처리 :: FC_CM_GET_EDI_NM2('LGI_RESPONSE', A.BL_NO, 'CODE', '')*/ = 'E' THEN 'Error'
			              WHEN (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm2">
                                    <property name="tag" value="'LGI_RESPONSE'"/>
                                    <property name="param1" value="A.BL_NO"/>
                                    <property name="param2" value="'CODE'"/>
                                    <property name="param3" value="NULL"/>
                                </include>) /* Mybatis Include로 처리 :: FC_CM_GET_EDI_NM2('LGI_RESPONSE', A.BL_NO, 'CODE', '')*/ = 'R' THEN 'Reject'
			         END AS CONF_RCV_YN
			        ,(<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm2">
                          <property name="tag" value="'LGI_RESPONSE'"/>
                          <property name="param1" value="A.BL_NO"/>
                          <property name="param2" value="'CODE'"/>
                          <property name="param3" value="NULL"/>
                      </include>) AS LGI_RTN_CD /* Mybatis Include로 처리 :: FC_CM_GET_EDI_NM2('LGI_RESPONSE', A.BL_NO, 'CODE', '') AS LGI_RTN_CD*/
			        ,(<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm2">
                          <property name="tag" value="'LGI_RESPONSE'"/>
                          <property name="param1" value="A.BL_NO"/>
                          <property name="param2" value="'MSG'"/>
                          <property name="param3" value="NULL"/>
                      </include>) AS LGI_RTN_MSG /* Mybatis Include로 처리 :: FC_CM_GET_EDI_NM2('LGI_RESPONSE', A.BL_NO, 'MSG', '') AS LGI_RTN_MSG*/
			        ,(<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm2">
                          <property name="tag" value="'LGI_IMG_SND'"/>
                          <property name="param1" value="A.BL_NO"/>
                          <property name="param2" value="'YN'"/>
                          <property name="param3" value="NULL"/>
                      </include>) AS IMG_ATT_YN /* Mybatis Include로 처리 :: FC_CM_GET_EDI_NM2('LGI_IMG_SND', A.BL_NO, 'YN', '')  AS IMG_ATT_YN*/
			        ,(<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEdiNm2">
                          <property name="tag" value="'LGI_IMG_SND'"/>
                          <property name="param1" value="A.BL_NO"/>
                          <property name="param2" value="'MSG'"/>
                          <property name="param3" value="NULL"/>
                      </include>) AS IMG_ATT_DT /* Mybatis Include로 처리 :: FC_CM_GET_EDI_NM2('LGI_IMG_SND', A.BL_NO, 'MSG', '') AS IMG_ATT_DT*/
			        ,A.SMT_NO
			        ,A.EO_NO
			        ,A.EXCT_SPR_CD
			        ,B.INTG_TASK_NO
			        ,C.ORD_SPR_CD 
			        ,A.NON_EXCT_BL_YN
			        ,CASE 
			             WHEN IFNULL(A.BL_SWITCH_YN, 'N') = 'Y' 
			             THEN (<include refid="fwd.common.fwdFuncInclude.fwdFcFwGetSwitchInfoEdi">
                                     <property name="tag" value="'NORMBLID'"/>
                                     <property name="param1" value="A.BL_ID"/>
                                     <property name="param2" value="NULL"/>
                               </include>) /* Mybatis Include로 처리 :: FC_FW_GET_SWITCH_INFO('NORMBLID', A.BL_ID)*/
		                 ELSE A.MBL_ID END AS MBL_ID
			        ,(<include refid="fwd.common.fwdFuncInclude.fwdFcFwGetMblTaskNo">
                           <property name="blId" value="A.BL_ID"/>
                           <property name="intgTaskNo" value="B.INTG_TASK_NO"/>
                     </include>) AS MBL_INTG_TASK_NO /* Mybatis Include로 처리 :: FC_FW_GET_MBL_TASK_NO(A.BL_ID,B.INTG_TASK_NO) AS MBL_INTG_TASK_NO*/
			        ,#{statusType} AS STATUS_TYPE
			        ,'' AS CHK_EDMS_YN /* [TODO-PJS] VW_ED_STATUS_01 정의되어 있지 않음
			              (SELECT  CASE 
			               WHEN COUNT(X.IMG_STATUS) = 0 
			               THEN 'N'
			                          ELSE (CASE
			                             WHEN MAX(X.IMG_STATUS)='C'
			                             THEN 'Y'
			                             WHEN MAX(X.IMG_STATUS)='U'
			                             THEN 'Y'
			                             ELSE 'N'
			                              END) 
			                      END     
			               FROM   VW_ED_STATUS_01 X
			               WHERE  X.BL_ID = A.BL_ID
			               AND    X.BL_NO = A.BL_NO
			               AND    X.SO_NO = A.SO_NO
			               AND    X.EO_NO = A.EO_NO
			               AND    X.DOC_TYPE = '71'
			               AND    ROWNUM =1) AS CHK_EDMS_YN*/
			        ,'' AS ORG_EDMS_YN /* [TODO-PJS] VW_ED_STATUS_01 정의되어 있지 않음
			             (SELECT CASE WHEN COUNT(X.IMG_STATUS) = 0 
			                  THEN 'N'
			                           ELSE (CASE
			                              WHEN MAX(X.IMG_STATUS)='C'
			                              THEN 'Y'
			                              WHEN MAX(X.IMG_STATUS)='U'
			                              THEN 'Y'
			                              ELSE 'N'
			                               END)
			                      END     
			               FROM   VW_ED_STATUS_01 X
			               WHERE  X.BL_ID = A.BL_ID
			               AND    X.BL_NO = A.BL_NO
			               AND    X.SMT_NO = A.SMT_NO
			               AND    X.EO_NO = A.EO_NO
			               AND    X.DOC_TYPE IN ('04', '28')
			               LIMIT  1) AS ORG_EDMS_YN*/  
			FROM     TB_FWD_BL A /* HBL */
			INNER JOIN TB_SMT_INTG_TASK_DEPT B ON  B.EO_NO = A.EO_NO
			           AND B.CST_BL_ID = A.BL_ID
			           AND B.TASK_SPR_CD IN ('EXP', 'TRD')
			           AND B.EXCT_BIZPTNR_CD = 'A100' /* 본사전용 */
			INNER JOIN TB_SMT_ORD C ON C.SMT_NO = A.SMT_NO 
			INNER JOIN TB_SMT_ORD_SELL_BILG D ON  D.SMT_NO = C.SMT_NO 
			          AND D.SELL_BIZPTNR_CD = B.EXCT_BIZPTNR_CD
			WHERE    1=1
			AND      A.BL_SPR_CD IN ('H', 'D')
			AND      A.EXCT_SPR_CD IN ('OC', 'AR')
			AND      D.BILG_BIZPTNR_CD IN (SELECT  A.BIZPTNR_CD
			                               FROM    TB_COM_BIZPTNR A/* MAIN */ 
			                               WHERE   A.BIZPTNR_GRP_CD = '1001034' 
			                               AND     A.USE_YN = 'Y'
			                               AND     A.MBIZPTNR_YN = 'Y'
			                               UNION ALL
			                               SELECT  A.BIZPTNR_CD
			                               FROM    TB_COM_BIZPTNR A /* SUB */
			                                      ,TB_COM_BIZPTNR B /* MAIN */
			                               WHERE   A.USE_YN = 'Y'
			                               AND     A.MBIZPTNR_YN = 'N'
			                               AND     A.MBIZPTNR_CD = B.BIZPTNR_CD
			                               AND     B.BIZPTNR_GRP_CD =  '1001034'  ) 
			                              
			/*
			{#REPLACE}
			{#1}
			{/#REPLACE}
			{#2}
			*/
			/* HBL NO가 NULL String이고 SR NO가 NULL String인 경우만 처리*/ 
			<if test="(hblNo == null or hblNo == '')">
                <if test="(srNo == null or srNo == '')">
                    <if test="frDt != null and frDt != ''">
	                    AND  A.ONBR_YMD BETWEEN #{frDt} AND #{toDt}
	                </if>
	                <if test="exctSprCd != null and exctSprCd != ''">
	                    AND  A.EXCT_SPR_CD = #{exctSprCd}
	                </if>
	                <if test="shppCd != null and shppCd != ''">
	                    AND  A.SHPP_CD = #{shppCd}
	                </if>
	                <if test='polCd != null and polCd != "" and polType == "CT"'>
	                    AND A.POL_CD = #{polCd}
	                </if>
	                <if test='polCd != null and polCd != "" and polType == "NA"'>
	                    AND    EXISTS (SELECT  1
	                                   FROM    TB_COM_LOC X 
	                                   WHERE   1=1
	                                   AND     X.USE_YN = 'Y'
	                                   AND     X.LOC_CD = A.POL_CD
	                                   AND     X.NATN_CD = #{polCd})
	                </if>
	                <if test='polCd != null and polCd != "" and polType == "RG"'>
	                    AND    EXISTS (SELECT  1
	                                   FROM    TB_COM_LOC X 
	                                   WHERE   1=1
	                                   AND     X.USE_YN = 'Y'
	                                   AND     X.LOC_CD = A.POL_CD
	                                   AND     X.REGN_CD = #{polCd})
	                </if>
	                <if test='podCd != null and podCd != "" and podType == "CT"'>
	                    AND A.POD_CD = #{podCd}
	                </if>
	                <if test='podCd != null and podCd != "" and podType == "NA"'>
	                    AND    EXISTS (SELECT  1
	                                   FROM    TB_COM_LOC X 
	                                   WHERE   1=1
	                                   AND     X.USE_YN = 'Y'
	                                   AND     X.LOC_CD = A.POD_CD
	                                   AND     X.NATN_CD = #{podCd})
	                </if>
	                <if test='podCd != null and podCd != "" and podType == "RG"'>
	                    AND    EXISTS (SELECT  1
	                                   FROM    TB_COM_LOC X 
	                                   WHERE   1=1
	                                   AND     X.USE_YN = 'Y'
	                                   AND     X.LOC_CD = A.POD_CD
	                                   AND     X.REGN_CD = #{podCd})
	                </if>
	           </if>
            </if>
			<if test='hblNo != null and hblNo != ""'>
                    AND A.BL_NO = #{hblNo}
            </if>
            <if test='srNo != null and srNo != ""'>
                    AND A.SR_NO = #{srNo}
            </if>
			
			ORDER BY A.ONBR_YMD
    </select>
    
    <!-- LG상사수출전송가능여부조회 -->
    <select id="selectLgiExpSendPosbYn" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgiExpSendPosbYn */
        SELECT   COUNT(A.BL_ID) AS BL_CNT 
		FROM     TB_FWD_BL A
		INNER JOIN TB_SMT_ORD B ON B.SMT_NO = A.SMT_NO
		INNER JOIN TB_SMT_ORD_SELL_BILG C ON C.SMT_NO = B.SMT_NO
		WHERE    1=1
		AND      A.BL_ID = #{blId}
		AND      C.BILG_BIZPTNR_CD IN (SELECT  A.BIZPTNR_CD
		                               FROM    TB_COM_BIZPTNR A/* MAIN */
		                               WHERE   A.BIZPTNR_GRP_CD = '1001034' 
		                               AND     A.USE_YN = 'Y'
		                               AND     A.MBIZPTNR_YN = 'Y'
		                               UNION ALL
		                               SELECT  A.BIZPTNR_CD
		                               FROM    TB_COM_BIZPTNR A /* SUB */
		                                      ,TB_COM_BIZPTNR B /* MAIN */
		                               WHERE   A.USE_YN = 'Y'
		                               AND     A.MBIZPTNR_YN = 'N'
		                               AND     A.MBIZPTNR_CD = B.BIZPTNR_CD
		                               AND     B.BIZPTNR_GRP_CD =  '1001034')
    </select>
    
    <!-- LG상사수출BL전송설정조회 -->
    <select id="selectLgiExpBlSendSetp" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgiExpBlSendSetp */
        SELECT 
                #{xmlMsgId} AS XML_MSG_ID /* JAVA에서 채번해서 내려준다. :: FC_FW_GET_NO('KLNET','XPLI') AS XML_MSG_ID*/
			     , IF(IFNULL(#{statusType}, 'O')='C', 'CHK', 'ORG') AS STATUS_CODE
			     , #{fileNm} AS FILE_NM /* JAVA에서 채번해서 내려준다. :: FC_FW_GET_NO('LGIBLIMAGE', A.BL_NO) AS FILE_NM*/
			     , (SELECT  S.REF_NO
			        FROM    TB_FWD_INTG_REF_NO S
			        WHERE   A.BL_ID = S.INTG_KEY_ID
			        AND     S.REF_NO_SPR_CD = 'SR'
			        AND     S.RPRS_YN = 'Y'
			        AND     S.DEL_YN = 'N'
			        LIMIT   1) AS SR_NO
			FROM  TB_FWD_BL A
			WHERE  A.BL_ID = #{blId}
    </select>
    
    <!-- LG상사수출BL기본조회 -->
    <select id="selectLgiExpBlBasis" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgiExpBlBasis */
        SELECT    
              A.BL_ID
		      , (CASE
		            WHEN BL_SPR_CD='H'
		            THEN 'HBL'
		            WHEN BL_SPR_CD='D'
		            THEN 'DBL'
		         END) AS BL_TYPE_CODE 
		      , 'E' AS EXIM_TYPE_CODE
		      , (CASE
		            WHEN BL_SPR_CD='OC'
		            THEN 'S'
		            WHEN BL_SPR_CD='AR'
		            THEN 'A'
		         END) AS BIZ_BOUND_CODE 
		      , A.BL_NO AS BL_NO
		      ,(SELECT IFNULL(COUNT(1),0)+1
		        FROM   NFINF.TB_FWD_INT676 X
		        WHERE  X.BL_ID = A.BL_ID) AS SEND_COUNT
		      , '' AS CONTACT_NAME
		      , '' AS CONTACT_DEPARTMENT_NAME
		      , '' AS CONTACT_PHONE_NO
		      , A.BL_PRT_YMD AS BL_ISSUE_DATE
		      , A.INCOT_CD AS PRICE_TERMS_CODE
		      , A.APLY_EXCHGRT AS EXCHANGE_RATE
		      , '' AS TRANSFER_CONDITION_DESC
		      , A.MBL_NO AS MASTER_BL_NO
		      , A.SR_NO AS SR_NO
		      , '' AS SERVICE_TYPE_CODE
		      , A.RPRS_REF_NO AS INVOICE_NO
		      , '' AS LC_NO
		      , A.VOYAGE AS VOYAGE_SEQS
		      , A.FLT_VSL_NM AS VESSEL_NAME
		      , A.ONBR_YMD  AS SHIPPING_DATE
		      , A.ARR_YMD AS ARRIVAL_DATE
		      , SUBSTR(A.POL_CD, 1, 2) AS LOADING_NATION_CODE
		      , SUBSTR(A.POL_CD, 3, 3) AS LOADING_PORT_CODE  /*-- Mapping 필요 233*/
		      , A.POL_NM AS LOADING_PORT_NAME 
		      , SUBSTR(A.POD_CD, 1, 2) AS DISCHARGE_NATION_CODE
		      , SUBSTR(A.POD_CD, 3, 3) AS DISCHARGE_PORT_CODE
		      , A.POD_NM AS DISCHARGE_PORT_NAME
		      , IF(A.EXCT_SPR_CD='OC', SUBSTR(A.PDEL_CD, 1, 2), SUBSTR(A.FDEST_CD, 1, 2)) AS FINAL_DEST_NATION_CODE
		      , IF(A.EXCT_SPR_CD='OC', SUBSTR(A.PDEL_CD, 3, 3), SUBSTR(A.FDEST_CD, 3, 3)) AS FINAL_DESTINATION_CODE
		      , IF(A.EXCT_SPR_CD='OC', A.PDEL_NM, A.FDEST_NM) AS FINAL_DESTINATION_NAME
		      , NULL AS ACCEPTANCE_NATION_CODE
		      , NULL AS ACCEPTANCE_PORT_CODE
		      , NULL AS ACCEPTANCE_PORT_NAME
		      , NULL AS DELIVERY_NATION_CODE
		      , NULL AS DELIVERY_PORT_CODE
		      , NULL AS DELIVERY_PORT_NAME
		      , NULL AS SHIPPER_CODE 
		      , SUBSTR(FC_FWD_STR_RTN(XX.INTG_ADDR,1,1,'X','H'),1,50) AS SHIPPER_NAME
		      , SUBSTR(FC_FWD_STR_RTN(XX.INTG_ADDR,2,2,'X','H'),1,35) AS SHIPPER_ADDR1
		      , SUBSTR(FC_FWD_STR_RTN(XX.INTG_ADDR,3,3,'X','H'),1,35) AS SHIPPER_ADDR2
		      , SUBSTR(FC_FWD_STR_RTN(XX.INTG_ADDR,4,4,'X','H'),1,35) AS SHIPPER_ADDR3
		      , SUBSTR(FC_FWD_STR_RTN(XX.INTG_ADDR,5,5,'X','H'),1,35) AS SHIPPER_ADDR4
		      , SUBSTR(FC_FWD_STR_RTN(XX.INTG_ADDR,6,6,'X','H'),1,35) AS SHIPPER_ADDR5
		      , SUBSTR(FC_FWD_STR_RTN(YY.INTG_ADDR,1,1,'X','H'),1,50) AS CONSIGNEE_NAME
		      , SUBSTR(FC_FWD_STR_RTN(YY.INTG_ADDR,2,2,'X','H'),1,35) AS CONSIGNEE_ADDR1
		      , SUBSTR(FC_FWD_STR_RTN(YY.INTG_ADDR,3,3,'X','H'),1,35) AS CONSIGNEE_ADDR2
		      , SUBSTR(FC_FWD_STR_RTN(YY.INTG_ADDR,4,4,'X','H'),1,35) AS CONSIGNEE_ADDR3
		      , SUBSTR(FC_FWD_STR_RTN(YY.INTG_ADDR,5,5,'X','H'),1,35) AS CONSIGNEE_ADDR4
		      , SUBSTR(FC_FWD_STR_RTN(YY.INTG_ADDR,6,6,'X','H'),1,35) AS CONSIGNEE_ADDR5
		      , SUBSTR(FC_FWD_STR_RTN(ZZ.INTG_ADDR,1,1,'X','H'),1,50) AS NOTIFY_NAME
		      , SUBSTR(FC_FWD_STR_RTN(ZZ.INTG_ADDR,2,2,'X','H'),1,35) AS NOTIFY_ADDR1
		      , SUBSTR(FC_FWD_STR_RTN(ZZ.INTG_ADDR,3,3,'X','H'),1,35) AS NOTIFY_ADDR2
		      , SUBSTR(FC_FWD_STR_RTN(ZZ.INTG_ADDR,4,4,'X','H'),1,35) AS NOTIFY_ADDR3
		      , SUBSTR(FC_FWD_STR_RTN(ZZ.INTG_ADDR,5,5,'X','H'),1,35) AS NOTIFY_ADDR4
		      , SUBSTR(FC_FWD_STR_RTN(ZZ.INTG_ADDR,6,6,'X','H'),1,35) AS NOTIFY_ADDR5
		      , (SELECT  X.INSD_CD_NM
		         FROM    TB_COM_CD_MPNG X
		         WHERE   1=1
		         AND     X.SYS_TYPE_CD = 'FW'
		         AND     X.CD_MPNG_SPR_NM = 'LGI_FIXED_VALUE'
		         AND     X.INSD_CD = '01'
		         LIMIT   1) AS SHIPPING_LINE1_CODE
		      , SUBSTR((<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetBizptnrNm2">
                   <property name="tag" value="'EF'"/>
                   <property name="param1" value="'A100'"/>
               </include>),1,50) AS SHIPPING_LINE1_NAME /* Mybatis Include로 처리 ::  SUBSTR(FC_CM_GET_BIZPTNR_NM2('A100', 'EF'),1,50) AS SHIPPING_LINE1_NAME*/ 
		      , '' AS SHIPPING_LINE2_CODE
		      , A.CARR_NM AS SHIPPING_LINE2_NAME
		      , NULL AS BL_ISSUE_CODE
		      , NULL AS BL_ISSUE_ADDR
		      , NULL AS PREPAY_CODE
		      , NULL AS PREPAY_PLACE_NAME
		      , NULL AS COLLECTION_CODE
		      , NULL AS COLLECTION_NAME
		      , NULL AS SEND_DEPARTMENT_TYPE_CODE
		      , B.BL_PRT_CNT AS BL_ISSUE_COUNT
		      , A.PKG_QTY AS PACKING_QTY
		      , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmMpgnTransmit">
                   <property name="param1" value="'FW'"/>
                   <property name="param2" value="NULL"/>
                   <property name="param3" value="'LGI_PKG_UNIT'"/>
                   <property name="param4" value="A.PKG_UNIT_CD"/>
                   <property name="param5" value="NULL"/>
                   <property name="param6" value="NULL"/>
                   <property name="param7" value="NULL"/>
               </include>) AS PACKING_TYPE_CODE /* [TODO-PJS] Mybatis Include로 처리 :: FC_CM_MPNG_TRANSMIT('FW','','LGI_PKG_UNIT', A.PKG_UNIT_CD, '', '', '') AS PACKING_TYPE_CODE*/
		      , NULL AS CONTAINER_COUNT_DESC
		      , A.SELL_GWT AS TOTAL_WEIGHT
		      , A.SELL_CBM AS TOTAL_CBM
		      , NULL AS BL_AMOUNT
		      , NULL AS SENDER_EMAIL_ADDR
		      , NULL AS RECEIVER_NAME
		      , NULL AS RECEIVER_EMAIL_ADDR
		      , NULL AS RECEIVER_PHONE_NO
		      , NULL AS RECEIVER_DEPARTMENT_NAME
		      , A.CUR_CD AS CURRENCY_CODE
		      , SUBSTR(A.FRGTTERM_CD, 1,1) AS CHARGE_TYPE_CODE
		      , (CASE
		            WHEN BL_SPR_CD='OC'
		            THEN '10'
		            WHEN BL_SPR_CD='AR'
		            THEN '40'
		         END) AS DELIVERY_METHOD_CODE 
		      , NULL AS FREIGHT_ROUTE_TYPE_CODE
		      , A.LADG_TYPE_CD AS LOAD_TYPE_CODE
		      , IF(A.EXP_TS_TYPE_CD='R', 'Y','N') AS TRANSIT_TRADE_FLAG
		      , (SELECT  X.INSD_CD_NM
		         FROM    TB_COM_CD_MPNG X
		         WHERE   1=1
		         AND     X.SYS_TYPE_CD = 'FW'
		         AND     X.CD_MPNG_SPR_NM = 'LGI_FIXED_VALUE'
		         AND     X.INSD_CD = '02'
		         LIMIT   1) AS AFFILIATE_CODE
		      , '' AS ATTR1 /*-- 이미지 File명 */
		      , 'Y' AS ATTR2  /*-- 이미지 Attach여부*/ 
		      , DATE_FORMAT(NOW(), '%Y%m') AS ATTR3
		      , NULL AS ATTR4
		      , NULL AS ATTR5
		      , NULL AS ATTR6
		      , NULL AS ATTR7
		      , NULL AS ATTR8
		      , NULL AS ATTR9
		      , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s') AS CREATE_DATE
		      , #{rstrId} AS INS_ID
		      , A.BL_ID  
		      , A.LADG_TYPE_CD
		FROM  TB_FWD_BL A
		INNER JOIN TB_FWD_BL_PRT_EXPND B ON B.BL_ID = A.BL_ID
		LEFT OUTER JOIN (SELECT ADDR.INTG_KEY_ID
		                        , ADDR.INTG_ADDR 
		                 FROM TB_FWD_INTG_ADDR ADDR 
		                 WHERE 1=1
		                 AND #{blId} = ADDR.INTG_KEY_ID
		                 AND ADDR.DEL_YN = 'N'
		                 AND ADDR.ADDR_SPR_CD = 'BS') XX ON XX.INTG_KEY_ID = A.BL_ID
		LEFT OUTER JOIN (SELECT ADDR.INTG_KEY_ID
		                        , ADDR.INTG_ADDR  
		                 FROM TB_FWD_INTG_ADDR ADDR 
		                 WHERE 1=1
		                 AND #{blId} = ADDR.INTG_KEY_ID
		                 AND ADDR.DEL_YN = 'N'
		                 AND ADDR.ADDR_SPR_CD = 'BC') YY ON YY.INTG_KEY_ID = A.BL_ID
		LEFT OUTER JOIN (SELECT ADDR.INTG_KEY_ID
		                        , ADDR.INTG_ADDR  
		                 FROM TB_FWD_INTG_ADDR ADDR 
		                 WHERE 1=1
		                 AND #{blId} = ADDR.INTG_KEY_ID
		                 AND ADDR.DEL_YN = 'N'
		                 AND ADDR.ADDR_SPR_CD = 'BN') ZZ ON YY.INTG_KEY_ID = A.BL_ID       
		WHERE   1=1
		AND     A.BL_ID = #{blId}
		AND     A.BL_SPR_CD IN ('H', 'D')
		AND     A.EXCT_SPR_CD IN ('OC', 'AR')   
    </select>
    
    <!-- LG상사수출BL전송기본등록 -->
    <insert id="insertLgiExpBlSendBasis" parameterType="dataItem" >
        /* fwd.edi.fwdCstComIfMgnt.insertLgiExpBlSendBasis */
        INSERT INTO NFINF.TB_FWD_INT676(
				     INTERFACE_ID             
				    ,XML_DOCUMENT_NO          
				    ,BL_STATUS_CODE           
				    ,BL_TYPE_CODE             
				    ,EXIM_TYPE_CODE           
				    ,BIZ_BOUND_CODE           
				    ,BL_NO                    
				    ,SEND_COUNT               
				    ,CONTACT_NAME             
				    ,CONTACT_DEPARTMENT_NAME  
				    ,CONTACT_PHONE_NO         
				    ,BL_ISSUE_DATE            
				    ,PRICE_TERMS_CODE         
				    ,EXCHANGE_RATE            
				    ,TRANSFER_CONDITION_DESC  
				    ,MASTER_BL_NO             
				    ,SR_NO                    
				    ,SERVICE_TYPE_CODE        
				    ,INVOICE_NO               
				    ,LC_NO                    
				    ,VOYAGE_SEQS              
				    ,VESSEL_NAME              
				    ,SHIPPING_DATE            
				    ,ARRIVAL_DATE             
				    ,LOADING_NATION_CODE      
				    ,LOADING_PORT_CODE        
				    ,LOADING_PORT_NAME        
				    ,DISCHARGE_NATION_CODE    
				    ,DISCHARGE_PORT_CODE      
				    ,DISCHARGE_PORT_NAME      
				    ,FINAL_DEST_NATION_CODE   
				    ,FINAL_DESTINATION_CODE   
				    ,FINAL_DESTINATION_NAME   
				    ,ACCEPTANCE_NATION_CODE   
				    ,ACCEPTANCE_PORT_CODE     
				    ,ACCEPTANCE_PORT_NAME     
				    ,DELIVERY_NATION_CODE     
				    ,DELIVERY_PORT_CODE       
				    ,DELIVERY_PORT_NAME       
				    ,SHIPPER_CODE             
				    ,SHIPPER_NAME             
				    ,SHIPPER_ADDR1            
				    ,SHIPPER_ADDR2            
				    ,SHIPPER_ADDR3            
				    ,SHIPPER_ADDR4            
				    ,SHIPPER_ADDR5            
				    ,CONSIGNEE_NAME           
				    ,CONSIGNEE_ADDR1          
				    ,CONSIGNEE_ADDR2          
				    ,CONSIGNEE_ADDR3          
				    ,CONSIGNEE_ADDR4          
				    ,CONSIGNEE_ADDR5          
				    ,NOTIFY_NAME              
				    ,NOTIFY_ADDR1             
				    ,NOTIFY_ADDR2             
				    ,NOTIFY_ADDR3             
				    ,NOTIFY_ADDR4             
				    ,NOTIFY_ADDR5             
				    ,SHIPPING_LINE1_CODE      
				    ,SHIPPING_LINE1_NAME      
				    ,SHIPPING_LINE2_CODE      
				    ,SHIPPING_LINE2_NAME      
				    ,BL_ISSUE_CODE            
				    ,BL_ISSUE_ADDR            
				    ,PREPAY_CODE              
				    ,PREPAY_PLACE_NAME        
				    ,COLLECTION_CODE          
				    ,COLLECTION_NAME          
				    ,SEND_DEPARTMENT_TYPE_CODE
				    ,BL_ISSUE_COUNT           
				    ,PACKING_QTY              
				    ,PACKING_TYPE_CODE        
				    ,CONTAINER_COUNT_DESC     
				    ,TOTAL_WEIGHT             
				    ,TOTAL_CBM                
				    ,STATUS_CODE              
				    ,BL_AMOUNT                
				    ,SENDER_EMAIL_ADDR        
				    ,RECEIVER_NAME            
				    ,RECEIVER_EMAIL_ADDR      
				    ,RECEIVER_PHONE_NO        
				    ,RECEIVER_DEPARTMENT_NAME 
				    ,CURRENCY_CODE            
				    ,CHARGE_TYPE_CODE         
				    ,DELIVERY_METHOD_CODE     
				    ,FREIGHT_ROUTE_TYPE_CODE  
				    ,LOAD_TYPE_CODE           
				    ,TRANSIT_TRADE_FLAG       
				    ,AFFILIATE_CODE           
				    ,ATTR1                    
				    ,ATTR2                    
				    ,ATTR3                    
				    ,ATTR4                    
				    ,ATTR5                    
				    ,ATTR6                    
				    ,ATTR7                    
				    ,ATTR8                    
				    ,ATTR9                    
				    ,CREATE_DATE              
				    ,INS_ID                   
				    ,BL_ID              
				    )
		    VALUES
				    (
				     #{interfaceId}               
				    ,#{xmlDocumentNo}             
				    ,#{blStatusCode}              
				    ,#{blTypeCode}                
				    ,#{eximTypeCode}              
				    ,#{bizBoundCode}              
				    ,#{blNo}                      
				    ,#{sendCount}                 
				    ,#{contactName}               
				    ,#{contactDepartmentName}     
				    ,#{contactPhoneNo}            
				    ,#{blIssueDate}               
				    ,#{priceTermsCode}            
				    ,#{exchangeRate}              
				    ,#{transferConditionDesc}     
				    ,#{masterBlNo}                
				    ,#{srNo}                      
				    ,#{serviceTypeCode}           
				    ,#{invoiceNo}                 
				    ,#{lcNo}                      
				    ,#{voyageSeqs}                
				    ,#{vesselName}                
				    ,#{shippingDate}              
				    ,#{arrivalDate}               
				    ,#{loadingNationCode}         
				    ,#{loadingPortCode}           
				    ,#{loadingPortName}           
				    ,#{dischargeNationCode}       
				    ,#{dischargePortCode}         
				    ,#{dischargePortName}         
				    ,#{finalDestNationCode}       
				    ,#{finalDestinationCode}      
				    ,#{finalDestinationName}      
				    ,#{acceptanceNationCode}      
				    ,#{acceptancePortCode}        
				    ,#{acceptancePortName}        
				    ,#{deliveryNationCode}        
				    ,#{deliveryPortCode}          
				    ,#{deliveryPortName}          
				    ,#{shipperCode}               
				    ,#{shipperName}               
				    ,#{shipperAddr1}              
				    ,#{shipperAddr2}              
				    ,#{shipperAddr3}              
				    ,#{shipperAddr4}              
				    ,#{shipperAddr5}              
				    ,#{consigneeName}             
				    ,#{consigneeAddr1}            
				    ,#{consigneeAddr2}            
				    ,#{consigneeAddr3}            
				    ,#{consigneeAddr4}            
				    ,#{consigneeAddr5}            
				    ,#{notifyName}                
				    ,#{notifyAddr1}               
				    ,#{notifyAddr2}               
				    ,#{notifyAddr3}               
				    ,#{notifyAddr4}               
				    ,#{notifyAddr5}               
				    ,#{shippingLine1Code}         
				    ,#{shippingLine1Name}         
				    ,#{shippingLine2Code}         
				    ,#{shippingLine2Name}         
				    ,#{blIssueCode}               
				    ,#{blIssueAddr}               
				    ,#{prepayCode}                
				    ,#{prepayPlaceName}           
				    ,#{collectionCode}            
				    ,#{collectionName}            
				    ,#{sendDepartmentTypeCode}    
				    ,#{blIssueCount}              
				    ,#{packingQty}                
				    ,#{packingTypeCode}           
				    ,#{containerCountDesc}        
				    ,#{totalWeight}               
				    ,#{totalCbm}                  
				    ,#{statusCode}                
				    ,#{blAmount}                  
				    ,#{senderEmailAddr}           
				    ,#{receiverName}              
				    ,#{receiverEmailAddr}         
				    ,#{receiverPhoneNo}           
				    ,#{receiverDepartmentName}    
				    ,#{currencyCode}              
				    ,#{chargeTypeCode}            
				    ,#{deliveryMethodCode}        
				    ,#{freightRouteTypeCode}      
				    ,#{loadTypeCode}              
				    ,#{transitTradeFlag}          
				    ,#{affiliateCode}             
				    ,#{attr1}                     
				    ,#{attr2}                     
				    ,#{attr3}                     
				    ,#{attr4}                     
				    ,#{attr5}                     
				    ,#{attr6}                     
				    ,#{attr7}                     
				    ,#{attr8}                     
				    ,#{attr9}                     
				    ,#{createDate}                
				    ,#{insId}                     
				    ,#{blId}                 
			     )
    </insert>
    
    <!-- LG상사수출BL컨테이너조회 -->
    <select id="selectLgiExpBlCntr" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgiExpBlCntr */
        SELECT  @rownum:=@rownum+1 AS CONTAINER_SEQ_NO
		       ,A.CNTR_NO AS CONTAINER_NO
		       ,(<include refid="fwd.common.fwdFuncInclude.fwdFcCmMpgnTransmit">
                   <property name="param1" value="'FW'"/>
                   <property name="param2" value="NULL"/>
                   <property name="param3" value="'LGI_CNTR_TYPE'"/>
                   <property name="param4" value="A.CNTR_SIZE_CD||A.CNTR_TYPE_CD"/>
                   <property name="param5" value="NULL"/>
                   <property name="param6" value="NULL"/>
                   <property name="param7" value="NULL"/>
               </include>) AS CONTAINER_TYPE_SIZE /* Mybatis Include로 처리 :: FC_CM_MPNG_TRANSMIT('FW','','LGI_CNTR_TYPE', A.CNTR_SIZE_CD||A.CNTR_TYPE_CD, '', '', '') AS CONTAINER_TYPE_SIZE*/
		       ,A.WGT AS CONTAINER_WEIGHT
		       ,A.VOL AS CONTAINER_CBM
		       ,A.SEAL1 AS SEAL_NO
		       ,A.PKG_QTY AS CONTAINER_CARTON_QTY
		       ,A.PKG_QTY AS CARTON_QTY
		       ,(<include refid="fwd.common.fwdFuncInclude.fwdFcCmMpgnTransmit">
                   <property name="param1" value="'FW'"/>
                   <property name="param2" value="NULL"/>
                   <property name="param3" value="'LGI_PKG_UNIT'"/>
                   <property name="param4" value="A.PKG_UNIT_CD"/>
                   <property name="param5" value="NULL"/>
                   <property name="param6" value="NULL"/>
                   <property name="param7" value="NULL"/>
               </include>) AS CARTON_UNIT_CODE /* Mybatis Include로 처리 :: FC_CM_MPNG_TRANSMIT('FW','','LGI_PKG_UNIT', A.PKG_UNIT_CD, '', '', '') AS CARTON_UNIT_CODE*/
		FROM    TB_SMT_INTG_ITEM A
		INNER JOIN TB_FWD_BL_ITEM_MPNG B ON  B.INTG_ITEM_NO = A.INTG_ITEM_NO
		         AND B.DEL_YN = 'N'
		INNER JOIN (SELECT @rownum:=0) TMP
		WHERE 1=1
		AND     A.DEL_YN = 'N'
		AND     B.BL_ID = #{blId}
    </select>
    
    <!-- LG상사수출BL전송컨테이너등록 -->
    <insert id="insertLgiExpBlSendCntr" parameterType="dataItem" >
        /* fwd.edi.fwdCstComIfMgnt.insertLgiExpBlSendCntr */
        INSERT INTO NFINF.TB_FWD_INT677(
						     INTERFACE_ID
						    ,CONTAINER_SEQ_NO
						    ,CONTAINER_NO
						    ,CONTAINER_TYPE_SIZE
						    ,CONTAINER_WEIGHT
						    ,CONTAINER_CBM
						    ,SEAL_NO
						    ,CONTAINER_CARTON_QTY
						    ,LCL_FLAG
						    ,LOAD_CONFIRM_FLAG
						    ,CARTON_QTY
						    ,CARTON_UNIT_CODE
						    ,ATTR1
						    ,ATTR2
						    ,ATTR3
						    ,ATTR4
						    ,ATTR5
						    )
				VALUES
						    (
						     #{interfaceId}
						    ,#{containerSeqNo}
						    ,#{containerNo}
						    ,#{containerTypeSize}
						    ,#{containerWeight}
						    ,#{containerCbm}
						    ,#{sealNo}
						    ,#{containerCartonQty}
						    ,#{lclFlag}
						    ,#{loadConfirmFlag}
						    ,#{cartonQty}
						    ,#{cartonUnitCode}
						    ,#{attr1}
						    ,#{attr2}
						    ,#{attr3}
						    ,#{attr4}
						    ,#{attr5}
						    )
    </insert>
    
    <!-- LG상사수출BLDesc조회 -->
    <select id="selectLgiExpBlDesc" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgiExpBlDesc */
        SELECT  A.FRM_CONT
	           ,C.COL_NO AS LINE_SEQ_NO
	           ,FC_FWD_STR_RTN(A.FRM_CONT, 5 * (C.COL_NO - 1) + 1, 5 * (C.COL_NO - 1) + 1, 'X','X') AS GOODS1_DESC
	           ,FC_FWD_STR_RTN(A.FRM_CONT, 5 * (C.COL_NO - 1) + 2, 5 * (C.COL_NO - 1) + 2, 'X','X') AS GOODS2_DESC
		       ,FC_FWD_STR_RTN(A.FRM_CONT, 5 * (C.COL_NO - 1) + 3, 5 * (C.COL_NO - 1) + 3, 'X','X') AS GOODS3_DESC
		       ,FC_FWD_STR_RTN(A.FRM_CONT, 5 * (C.COL_NO - 1) + 4, 5 * (C.COL_NO - 1) + 4, 'X','X') AS GOODS4_DESC
		       ,FC_FWD_STR_RTN(A.FRM_CONT, 5 * (C.COL_NO - 1) + 5, 5 * (C.COL_NO - 1) + 5, 'X','X') AS GOODS5_DESC
		FROM   TB_FWD_INTG_RMK A
		       ,TB_FWD_COPY  C
		WHERE  1=1
		AND    A.INTG_KEY_ID  = #{blId}
		AND    A.RMK_SPR_CD IN ('DESC')
		<![CDATA[
		AND    C.COL_NO  <= CEIL(FC_FWD_STR_CNT_RTN(A.FRM_CONT)/ 5)
		]]>
		ORDER BY C.COL_NO
    </select>
    
    <!-- LG상사수출BL전송Desc등록 -->
    <insert id="insertLgiExpBlSendDesc" parameterType="dataItem" >
        /* fwd.edi.fwdCstComIfMgnt.insertLgiExpBlSendDesc */
        INSERT INTO NFINF.TB_FWD_INT678(
				      INTERFACE_ID
				     ,LINE_SEQ_NO
				     ,GOODS1_DESC
				     ,GOODS2_DESC
				     ,GOODS3_DESC
				     ,GOODS4_DESC
				     ,GOODS5_DESC
				     ,ATTR1
				     ,ATTR2
				     ,ATTR3
				     )
		      VALUES
				     (
				      #{interfaceId}
				     ,#{lineSeqNo}
				     ,#{goods1Desc}
				     ,#{goods2Desc}
				     ,#{goods3Desc}
				     ,#{goods4Desc}
				     ,#{goods5Desc}
				     ,#{attr1}
				     ,#{attr2}
				     ,#{attr3}
				     )
    </insert>
    
    <!-- LG상사수출BLMark조회 -->
    <select id="selectLgiExpBlMark" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgiExpBlMark */
        SELECT A.FRM_CONT
	          ,C.COL_NO AS LINE_SEQ_NO
	          ,FC_FWD_STR_RTN(A.FRM_CONT, 10 * (C.COL_NO - 1) + 1, 10 * (C.COL_NO - 1) + 1, 'X','X') AS SHIPPING_MARK1_INFO
	          ,FC_FWD_STR_RTN(A.FRM_CONT, 10 * (C.COL_NO - 1) + 2, 10 * (C.COL_NO - 1) + 2, 'X','X') AS SHIPPING_MARK2_INFO
	          ,FC_FWD_STR_RTN(A.FRM_CONT, 10 * (C.COL_NO - 1) + 3, 10 * (C.COL_NO - 1) + 3, 'X','X') AS SHIPPING_MARK3_INFO        
	          ,FC_FWD_STR_RTN(A.FRM_CONT, 10 * (C.COL_NO - 1) + 4, 10 * (C.COL_NO - 1) + 4, 'X','X') AS SHIPPING_MARK4_INFO
	          ,FC_FWD_STR_RTN(A.FRM_CONT, 10 * (C.COL_NO - 1) + 5, 10 * (C.COL_NO - 1) + 5, 'X','X') AS SHIPPING_MARK5_INFO
	          ,FC_FWD_STR_RTN(A.FRM_CONT, 10 * (C.COL_NO - 1) + 6, 10 * (C.COL_NO - 1) + 6, 'X','X') AS SHIPPING_MARK6_INFO        
	          ,FC_FWD_STR_RTN(A.FRM_CONT, 10 * (C.COL_NO - 1) + 7, 10 * (C.COL_NO - 1) + 7, 'X','X') AS SHIPPING_MARK7_INFO
	          ,FC_FWD_STR_RTN(A.FRM_CONT, 10 * (C.COL_NO - 1) + 8, 10 * (C.COL_NO - 1) + 8, 'X','X') AS SHIPPING_MARK8_INFO
	          ,FC_FWD_STR_RTN(A.FRM_CONT, 10 * (C.COL_NO - 1) + 9, 10 * (C.COL_NO - 1) + 9, 'X','X') AS SHIPPING_MARK9_INFO
	          ,FC_FWD_STR_RTN(A.FRM_CONT, 10 * (C.COL_NO - 1) + 10, 10 * (C.COL_NO - 1) + 10, 'X','X') AS SHIPPING_MARK10_INFO                                 
	    FROM   TB_FWD_INTG_RMK A
	          ,TB_FWD_COPY  C
	    WHERE  1=1
	     AND   A.INTG_KEY_ID  = #{blId}
	     AND   A.RMK_SPR_CD IN ('MARK')
	     <![CDATA[
	     AND   C.COL_NO  <= CEIL(FC_FWD_STR_CNT_RTN(A.FRM_CONT)/ 10)
	     ]]>
	    ORDER BY C.COL_NO
    </select>
    
    <!-- LG상사수출BL전송Mark등록 -->
    <insert id="insertLgiExpBlSendMark" parameterType="dataItem" >
        /* fwd.edi.fwdCstComIfMgnt.insertLgiExpBlSendMark */
        INSERT INTO NFINF.TB_FWD_INT679 (
					     INTERFACE_ID
					    ,LINE_SEQ_NO
					    ,SHIPPING_MARK1_INFO
					    ,SHIPPING_MARK2_INFO
					    ,SHIPPING_MARK3_INFO
					    ,SHIPPING_MARK4_INFO
					    ,SHIPPING_MARK5_INFO
					    ,SHIPPING_MARK6_INFO
					    ,SHIPPING_MARK7_INFO
					    ,SHIPPING_MARK8_INFO
					    ,SHIPPING_MARK9_INFO
					    ,SHIPPING_MARK10_INFO
					    ,ATTR1
					    ,ATTR2
					    ,ATTR3
					    )
			    VALUES
					    (
					     #{interfaceId}
					    ,#{lineSeqNo}
					    ,#{shippingMark1Info}
					    ,#{shippingMark2Info}
					    ,#{shippingMark3Info}
					    ,#{shippingMark4Info}
					    ,#{shippingMark5Info}
					    ,#{shippingMark6Info}
					    ,#{shippingMark7Info}
					    ,#{shippingMark8Info}
					    ,#{shippingMark9Info}
					    ,#{shippingMark10Info}
					    ,#{attr1}
					    ,#{attr2}
					    ,#{attr3}
					    )
    </insert>
    
    
    <!-- LGIBL이미지전송정보조회 -->
    <select id="selectLgiBlImgSendInfo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgiBlImgSendInfo */
        SELECT  
		       'LGI' AS IF_WRK_GRP_NM               
		       ,A.EXCT_SPR_CD
		       ,A.BL_NO
		       ,A.SMT_NO
		       ,A.EO_NO
		       ,A.BL_ID
		       ,'' AS REF_NO
		       ,'BL' AS IMG_DOC_SPR_CD
		       ,'Y' AS DOC_MERG_YN
		       ,'N' AS BLOB_ATCH_YN
		       ,'' AS BLOB_CONT
		       ,'XML' AS IMG_SEND_TYPE_NM
		       ,B.STATUS_CODE AS EXP_CLASS_CODE
		       ,B.INS_ID AS RSTR_ID
		       ,B.INS_ID AS UPDR_ID
		       ,B.ATTR1 AS RQST_FILE_NM
		FROM    TB_FWD_BL A
		       ,(SELECT  BL_ID
		                ,STATUS_CODE
		                ,ATTR1
		                ,INS_ID
		         FROM    NFINF.TB_FWD_INT676
		         WHERE   INTERFACE_ID = #{interfaceId}) B
		WHERE   A.BL_ID = B.BL_ID
		AND     A.DEL_YN = 'N'
    </select>
    
    
    <!-- GS칼텍스BL조회 -->
    <select id="selectGsctexBl" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectGsctexBl */
        SELECT  
			     'F' CHK
			     , A.BL_ID
			     , A.BL_NO 
			     , C.INTG_TASK_NO
			     , (SELECT  INTG_TASK_NO 
			        FROM  TB_SMT_INTG_TASK_DEPT 
			        WHERE  EO_NO = B.EO_NO 
			        AND    CST_BL_ID = B.BL_ID
			        AND  TASK_SPR_CD = C.TASK_SPR_CD
			        AND  DEL_YN = 'N') AS MBL_INTG_TASK_NO   /* MBL 역할번호 */
			     , IFNULL((SELECT CASE IF_STATUS_CODE WHEN 'R' THEN 'Ready'        /*--전송 대기 상태*/
			                                         WHEN 'P' THEN 'Pending'      /*--EAI시스템에서 처리중인상황*/
			                                          WHEN 'E' THEN 'Error'        /*--I/F 처리 중 에러발생*/
			                                          WHEN 'D' THEN 'Done'         /*--외부파트너 전송성공*/
			                                          ELSE          'None' END
			            FROM NFINF.TB_EDI_MASTER_S
			            WHERE INTERFACE_ID = (SELECT MAX(INTERFACE_ID)
			                                  FROM   NFINF.TB_FWD_INT215
			                                  WHERE  HBL_NO = A.BL_NO)
			       ),'미전송') AS SEND_STATUS
			     , IFNULL((SELECT CASE IF_STATUS_CODE WHEN 'R' THEN 'Ready'        /*--전송 대기 상태*/
			                                          WHEN 'P' THEN 'Pending'      /*--EAI시스템에서 처리중인상황*/
			                                          WHEN 'E' THEN 'Error'        /*--I/F 처리 중 에러발생*/
			                                          WHEN 'D' THEN 'Done'         /*--외부파트너 전송성공*/
			                                          ELSE          'None' END
			            FROM NFINF.TB_EDI_MASTER_S
			            WHERE INTERFACE_ID = (SELECT MAX(INTERFACE_ID)
			                                  FROM   NFINF.TB_FWD_INT404
			                                  WHERE  HBL_NO = A.BL_NO)
			       ),'미전송') AS PMIS_SEND_STATUS                   
			     , A.MBL_ID
			     , A.MBL_NO
			     , A.SMT_NO
			     , A.EO_NO 
			     /*--, D.SEND_DT*/
			     , (SELECT MAX(SEND_DT) FROM NFINF.TB_FWD_INT215 WHERE HBL_NO = A.BL_NO) AS SEND_DT
			     , (SELECT S.REF_NO                      
			             FROM   TB_FWD_INTG_REF_NO S                        
			             WHERE  1=1
			             AND    S.INTG_KEY_ID = A.BL_ID
			             AND    S.DEL_YN = 'N'          
			             AND    S.REF_NO_SPR_CD = 'PO'                        
			        ) AS PO_NO
			     , '' AS BL_IMG_YN /* [TODO-PJS] VW_ED_STATUS_01 VIEW Table 없음. {#2} 처리햐야 함. :: (SELECT IF(COUNT(*)=0,'N','Y')
			                               FROM   VW_ED_STATUS_01 X
			                               WHERE  X.BL_ID = A.BL_ID
			                               AND    X.BL_NO = A.BL_NO
			                               AND    X.SMT_NO = A.SMT_NO
			                               AND    X.EO_NO = A.EO_NO
			                               {#2} ) AS BL_IMG_YN*/
			      , '' AS CI_IMG_YN /* [TODO-PJS] VW_ED_STATUS_01 VIEW Table 없음 :: (SELECT IF(COUNT(*)=0,'N','Y')
			                           FROM   VW_ED_STATUS_01 X
			                           WHERE  X.BL_ID = A.BL_ID
			                           AND    X.BL_NO = A.BL_NO
			                           AND    X.SMT_NO = A.SMT_NO
			                           AND    X.EO_NO = A.EO_NO
			                           AND    X.DOC_TYPE = '08') AS CI_IMG_YN*/
			       , '' AS PL_IMG_YN /* [TODO-PJS] VW_ED_STATUS_01 VIEW Table 없음 :: (SELECT IF(COUNT(*)=0,'N','Y')
			                               FROM   VW_ED_STATUS_01 X
			                               WHERE  X.BL_ID = A.BL_ID
			                               AND    X.BL_NO = A.BL_NO
			                               AND    X.SMT_NO = A.SMT_NO
			                               AND    X.EO_NO = A.EO_NO
			                               AND    X.DOC_TYPE = '09') AS PL_IMG_YN*/
			       , ''  AS CIPL_IMG_YN  /* [TODO-PJS] VW_ED_STATUS_01 VIEW Table 없음 ::(SELECT IF(COUNT(*)=0,'N','Y')
			                                FROM   VW_ED_STATUS_01 X
			                                WHERE  X.BL_ID = A.BL_ID
			                                AND    X.BL_NO = A.BL_NO
			                                AND    X.SMT_NO = A.SMT_NO
			                                AND    X.EO_NO = A.EO_NO
			                                 AND    X.DOC_TYPE = '31') AS CIPL_IMG_YN  */
			       , A.NEGO_ONBR_YMD
			       , A.ONBR_YMD
			       , A.ETA_YMD
			       , A.ARR_YMD  
			       , A.FLT_VSL_NM
			       , A.VOYAGE
			       , A.INCOT_CD  
			       , A.FRGTTERM_CD
			       , A.POL_CD
			       , A.POL_NM
			       , A.POD_CD
			       , A.POD_NM 
			       , C.CARR_CD 
			       , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetBizptnrNm">
	                     <property name="bizptnrCd" value="C.CARR_CD"/>
	                 </include>) AS CARR_NM   /* Mybatis Include 처리 :: FC_CM_GET_BIZPTNR_NM(C.CARR_CD) AS CARR_NM*/
			       , A.SELL_GWT
			       , A.SELL_CBM
			       , A.PKG_QTY
			       , A.PKG_UNIT_CD      
			       , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                         <property name="clasCd" value="'0134'"/>
                         <property name="dtlCd" value="A.PKG_UNIT_CD"/>
                     </include>) AS PKG_UNIT_NM  /*Mybatis Include 처리 :: FC_CM_GET_ETC_CD_NM('0134' , A.PKG_UNIT_CD) AS PKG_UNIT_NM*/ 
			       , (SELECT IFNULL(SUM(S.QTY), 0)
			          FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
			               , TB_SMT_INTG_ITEM S /* 컨테이너  */
			          WHERE  1=1
			          AND    T.DEL_YN = 'N' /* 삭제여부 */
			          AND    S.DEL_YN = 'N' /* 삭제여부 */
			          AND    T.BL_ID = A.BL_ID
			          AND    T.INTG_ITEM_NO = S.INTG_ITEM_NO
			          AND    S.CNTR_YN = 'Y'
			          <![CDATA[
			          AND    S.CNTR_SIZE_CD <= '20'   
			          ]]>   
			          AND    S.CNTR_TYPE_CD = 'DR') AS DR20
			       , (SELECT IFNULL(SUM(S.QTY), 0)
			          FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
			               , TB_SMT_INTG_ITEM S /* 컨테이너  */
			          WHERE  1=1
			          AND    T.DEL_YN = 'N' /* 삭제여부 */
			          AND    S.DEL_YN = 'N' /* 삭제여부 */
			          AND    T.BL_ID = A.BL_ID
			          AND    T.INTG_ITEM_NO = S.INTG_ITEM_NO
			          AND    S.CNTR_YN = 'Y'
			          <![CDATA[
			          AND    S.CNTR_SIZE_CD > '20' 
			          ]]>      
			          AND    S.CNTR_TYPE_CD = 'DR') AS DR40     
			       , (SELECT IFNULL(SUM(S.QTY), 0)
			          FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
			               , TB_SMT_INTG_ITEM S /* 컨테이너  */
			          WHERE  1=1
			          AND    T.DEL_YN = 'N' /* 삭제여부 */
			          AND    S.DEL_YN = 'N' /* 삭제여부 */
			          AND    T.BL_ID = A.BL_ID
			          AND    T.INTG_ITEM_NO = S.INTG_ITEM_NO
			          AND    S.CNTR_YN = 'Y'
			          AND    S.CNTR_SIZE_CD = '40'       
			          AND    S.CNTR_TYPE_CD = 'HC') AS HC40
			/*          --, D.INS_ID
			          --, D.INTERFACE_ID*/
			      , (SELECT INS_ID FROM NFINF.TB_FWD_INT215 WHERE HBL_NO = A.BL_NO LIMIT 1) AS INS_ID
			      , (SELECT MAX(INTERFACE_ID) FROM NFINF.TB_FWD_INT215 WHERE HBL_NO = A.BL_NO) AS INTERFACE_ID                      
			      , E.BFT_AMT
			      , E.CFT_AMT 
			      , E.OFT_AMT
			      , A.RPRS_ITEM_NM
			      , A.EXCT_SPR_CD
			FROM TB_FWD_BL A
			INNER JOIN  TB_FWD_BL B ON  B.BL_ID = A.MBL_ID
			      AND B.DEL_YN = 'N'
			INNER JOIN  TB_SMT_INTG_TASK_DEPT C ON  C.EO_NO = A.EO_NO
			         AND C.CST_BL_ID = A.BL_ID
			         AND C.TASK_SPR_CD = 'IMP' 
			         AND IFNULL(C.DEL_YN, 'N') = 'N'
			         AND C.EXCT_BIZPTNR_CD = #{corpCd}
			/*   --, TB_FW_INT215 D /* 재전송시 두 줄나오지 않도록 주석처리*/
			LEFT OUTER JOIN  (  SELECT SUM(IF(CC.FRGH_CD='BAF', CC.LOCL_FRGH_AMT, 0)) AS BFT_AMT            
			                  , SUM(IF(CC.FRGH_CD='CAF', CC.LOCL_FRGH_AMT, 0)) AS CFT_AMT            
			                  , SUM(IF(CC.FRGH_CD=IF(AA.EXCT_SPR_CD='OC', 'OFT', 'AFT'), CC.LOCL_FRGH_AMT, 0)) AS OFT_AMT            
			                  , MAX(AA.BL_ID) AS BL_ID
			           FROM     TB_FWD_BL AA     /* HBL */            
			                  , TB_ISM_SELLBUY CC            
			           WHERE    1=1            
			           AND      AA.BL_ID = CC.BL_ID            
			           AND      AA.DEL_YN  = 'N'            
			           AND      CC.DEL_YN = 'N'            
			           AND      AA.BL_SPR_CD IN ('H','D')            
			           AND      CC.SELLBUY_SPR_CD = 'SO'            
			           AND      CC.DOM_ABRD_BIZPTNR_TYPE_CD = '1' /* 국내거래처 */            
			           AND      CC.BILG_BIZPTNR_CD =  '1004105' /* GS칼텍스 */            
			           AND      CC.OFFSET_SMT_NO1 IS NULL) E ON E.BL_ID = A.BL_ID
			WHERE 1=1 
			/*--AND A.BL_NO = D.HBL_NO(+)*/
			AND A.DEL_YN = 'N'
			AND A.BL_SPR_CD = 'H'
			AND A.ARR_YMD  BETWEEN #{fromDt} AND #{toDt} /* 입항일자 */
			AND A.CNEE_CD  = '1004105'
			/*{#1}*/
			<if test="exctSprCd != null and exctSprCd != ''">
               AND   A.EXCT_SPR_CD = #{exctSprCd}
            </if>
			<if test="blNo != null and blNo != ''">
               AND   A.BL_NO LIKE #{blNo} || '%'
            </if>
			<if test="polCd != null and polCd != ''">
               AND   A.POL_CD = #{polCd}
            </if>
            <if test="podCd != null and podCd != ''">
               AND   A.POD_CD = #{podCd}
            </if>
			<if test="incotCd != null and incotCd != ''">
               AND   A.INCOT_CD = #{incotCd}
            </if>
			<if test="poNo != null and poNo != ''">
               AND   (SELECT S.REF_NO                      
	                  FROM   TB_FWD_INTG_REF_NO S                        
	                  WHERE  1=1
	                  AND    S.INTG_KEY_ID = A.BL_ID
	                  AND    S.DEL_YN = 'N'            
	                  AND    S.REF_NO_SPR_CD = 'PO'                        
	                   ) = #{poNo}
            </if>
			
			ORDER BY A.ARR_YMD, A.BL_NO 
    </select>
    
    
    <!-- 크레텍책임BL조회 -->
    <select id="selectCretRsbtyBl" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectCretRsbtyBl */
        SELECT 
			     'F' CHK
			     , IFNULL((SELECT CASE IF_STATUS_CODE WHEN 'R' THEN 'Ready'        /*--전송 대기 상태*/
			                                          WHEN 'P' THEN 'Pending'      /*--EAI시스템에서 처리중인상황*/
			                                          WHEN 'E' THEN 'Error'        /*--I/F 처리 중 에러발생*/
			                                          WHEN 'D' THEN 'Done'         /*--외부파트너 전송성공*/
			                                          ELSE          'None' END
			              FROM NFINF.TB_EDI_MASTER_S
			              WHERE INTERFACE_ID = (SELECT MAX(INTERFACE_ID)
			                                      FROM NFINF.TB_FWD_INT237
			                                      WHERE HBL_NO = A.BL_NO)
			       ),'미전송') AS SEND_STATUS
			     , (SELECT MESSAGE
			              FROM NFINF.TB_EDI_MASTER_S
			              WHERE INTERFACE_ID = (SELECT MAX(INTERFACE_ID)
			                                      FROM NFINF.TB_FWD_INT237
			                                      WHERE HBL_NO = A.BL_NO)
			       ) AS MESSAGE
			     , (SELECT IF_STATUS_CODE
			              FROM NFINF.TB_EDI_MASTER_S
			              WHERE INTERFACE_ID = (SELECT MAX(INTERFACE_ID)
			                                      FROM NFINF.TB_FWD_INT237
			                                      WHERE HBL_NO = A.BL_NO)
			       ) AS STATUS_CD
			     , A.BL_ID
			     , A.BL_NO
			     , B.INTG_TASK_NO
			     , (SELECT  BB.INTG_TASK_NO 
			        FROM  TB_FWD_BL AA
			              , TB_SMT_INTG_TASK_DEPT BB 
			        WHERE  AA.BL_ID = A.MBL_ID
			        AND  AA.EO_NO = BB.EO_NO
			        AND  AA.BL_ID = BB.CST_BL_ID
			        AND  IFNULL(AA.DEL_YN, 'N') = 'N'
			        AND  IFNULL(BB.DEL_YN, 'N') = 'N'
			        AND  BB.TASK_SPR_CD = 'IMP'
			        LIMIT   1) AS MBL_INTG_TASK_NO
			     , A.MBL_ID
			     , A.MBL_NO     
			     , A.BL_PRT_YMD
			     , (CASE
			       WHEN A.EXCT_SPR_CD='OC'
			       THEN 'SEA'
			       WHEN A.EXCT_SPR_CD='AR'
			       THEN 'AIR'
			       END) AS EXCT_SPR_NM
			     , A.EXCT_SPR_CD     
			     , A.SHPP_CD
			     , A.RMK AS SHPP_NM
			     , A.FLT_VSL_NM
			     , A.VOYAGE     
			     , (SELECT S.CNTR_NO
			         FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
			              , TB_SMT_INTG_ITEM S /* 컨테이너  */
			         WHERE  1=1
			         AND    T.DEL_YN = 'N' /* 삭제여부 */
			         AND    S.DEL_YN = 'N' /* 삭제여부 */
			         AND    T.BL_ID = A.BL_ID
			         AND    T.INTG_ITEM_NO = S.INTG_ITEM_NO
			         AND    S.CNTR_YN = 'Y'
			       LIMIT  1) AS CNTR_NO 
			     , (SELECT CNTR_SIZE_CD||CNTR_TYPE_CD 
			         FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
			              , TB_SMT_INTG_ITEM S /* 컨테이너  */
			         WHERE  1=1
			         AND    T.DEL_YN = 'N' /* 삭제여부 */
			         AND    S.DEL_YN = 'N' /* 삭제여부 */
			         AND    T.BL_ID = A.BL_ID
			         AND    T.INTG_ITEM_NO = S.INTG_ITEM_NO
			         AND    S.CNTR_YN = 'Y'
			         LIMIT 1) AS CNTR_SIZE_TYPE     
			     , (SELECT SUM(S.QTY)
			         FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
			              , TB_SMT_INTG_ITEM S /* 컨테이너  */
			         WHERE  1=1
			         AND    T.DEL_YN = 'N' /* 삭제여부 */
			         AND    S.DEL_YN = 'N' /* 삭제여부 */
			         AND    T.BL_ID = A.BL_ID
			         AND    T.INTG_ITEM_NO = S.INTG_ITEM_NO
			         AND    S.CNTR_YN = 'Y') AS CNTR_TOT_CNT
			      , A.POL_CD
			      , A.POL_NM
			      , A.POD_CD
			      , A.POD_NM
			      , A.INCOT_CD
			      , A.SELL_GWT
			      , A.SELL_CBM
			      , A.PKG_QTY
			      , A.PKG_UNIT_CD
			      , A.LADG_TYPE_CD
			      , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                         <property name="clasCd" value="'0064'"/>
                         <property name="dtlCd" value="A.LADG_TYPE_CD"/>
                     </include>) AS LADG_TYPE_NM /* Mybatis Include 처리 :: FC_CM_GET_ETC_CD_NM('0064' , A.LADG_TYPE_CD) LADG_TYPE_NM*/
			      , A.BL_PRT_YMD
			      , '' AS CLEARANCE_YMD
			      , E.DO_SEND_YMD      
			      , (SELECT '' /*[TODO_PJS] 필드 생성되었으면 주석 푼다. FACT_GR_YMD*/
			         FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
			              , TB_SMT_INTG_ITEM S /* 컨테이너  */
			         WHERE  1=1
			         AND    T.DEL_YN = 'N' /* 삭제여부 */
			         AND    S.DEL_YN = 'N' /* 삭제여부 */
			         AND    T.BL_ID = A.BL_ID
			         AND    T.INTG_ITEM_NO = S.INTG_ITEM_NO
			         AND    S.CNTR_YN = 'Y'
			       LIMIT 1) AS FACT_GR_YMD  
			      , (SELECT '' /*[TODO_PJS] 필드 생성되었으면 주석 푼다. CY_TAKOUT_YMD*/
			         FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
			              , TB_SMT_INTG_ITEM S /* 컨테이너  */
			         WHERE  1=1
			         AND    T.DEL_YN = 'N' /* 삭제여부 */
			         AND    S.DEL_YN = 'N' /* 삭제여부 */
			         AND    T.BL_ID = A.BL_ID
			         AND    T.INTG_ITEM_NO = S.INTG_ITEM_NO
			         AND    S.CNTR_YN = 'Y'
			    LIMIT  1) AS CY_TAKOUT_YMD  
			      , A.NEGO_ONBR_YMD
			      , A.ONBR_YMD
			      , A.ETA_YMD 
			      , A.ARR_YMD   
			      , A.SMT_NO
			      , A.EO_NO
			      , '' AS BL_IMG_YN /* [TODO-PJS] VW_ED_STATUS_01 VIEW Table 없음 :: (SELECT IF(COUNT(*)=0,'N','Y')
			                            FROM   VW_ED_STATUS_01 X
			                            WHERE  X.BL_NO = A.BL_NO 
			                            AND    X.DOC_TYPE IN ('04')
			                            AND    X.IMG_STATUS != 'D'
			                            ) AS BL_IMG_YN*/                /* 파트너가 이미지 올린 경우 HBL_MNGR_NO로 찾을 수 없으므로 HBL번호로 찾음 */
			      , '' AS CIPL_IMG_YN /* [TODO-PJS] VW_ED_STATUS_01 VIEW Table 없음 :: (SELECT IF(COUNT(*)=0,'N','Y')
			                           FROM   VW_ED_STATUS_01 X
			                           WHERE  X.BL_NO = A.BL_NO 
			                           AND    X.DOC_TYPE IN ('08', '09', '31')
			                           AND    X.IMG_STATUS != 'D') AS CIPL_IMG_YN */               /* 파트너가 이미지 올린 경우 HBL_MNGR_NO로 찾을 수 없으므로 HBL번호로 찾음 */                     
			      , (SELECT IF(COUNT(*)=0, 'N', 'Y')
			         FROM  NFINF.TB_FWD_INT237 
			         WHERE 1=1 
			         AND BL_ID = A.BL_ID ) AS SEND_YN            
			FROM TB_FWD_BL A
			INNER JOIN TB_SMT_INTG_TASK_DEPT B ON  B.EO_NO = A.EO_NO
			           AND B.CST_BL_ID = A.BL_ID
			           AND B.TASK_SPR_CD = 'IMP'
			           AND IFNULL(B.DEL_YN, 'N') = 'N'
			           AND B.EXCT_BIZPTNR_CD = #{corpCd}
			LEFT OUTER JOIN TB_FWD_BL_PRT_EXPND C ON C.BL_ID = A.BL_ID
			LEFT OUTER JOIN TB_FWD_BL_EXPND E ON E.BL_ID = A.BL_ID
			WHERE 1=1
			AND   A.EXCT_SPR_CD IN ('OC', 'AR')
			AND   A.DEL_YN = 'N' 
			AND   A.BL_SPR_CD IN ('H','D')
			AND   A.ARR_YMD  BETWEEN #{fromDt} AND #{toDt} /* 입항일자 */
			AND   A.CNEE_CD  IN ('1004806','1004810', '1111533' ) /* 크레텍책임, 크레텍웰딩 */
			/*{#1}*/
			<if test="exctSprCd != null and exctSprCd != ''">
               AND   A.EXCT_SPR_CD = #{exctSprCd}
            </if>
            <if test="blNo != null and blNo != ''">
               AND   A.BL_NO LIKE #{blNo} || '%'
            </if>
            <if test="polCd != null and polCd != ''">
               AND   A.POL_CD = #{polCd}
            </if>
            <if test="podCd != null and podCd != ''">
               AND   A.POD_CD = #{podCd}
            </if>
            <if test="incotCd != null and incotCd != ''">
               AND   A.INCOT_CD = #{incotCd}
            </if>
            <if test="poNo != null and poNo != ''">
               AND   (SELECT S.REF_NO                      
	                   FROM   TB_FWD_INTG_REF_NO S                        
	                   WHERE  1=1
	                   AND    S.INTG_KEY_ID = A.BL_ID
	                   AND    S.DEL_YN = 'N'            
	                   AND    S.REF_NO_SPR_CD = 'PO'                        
	                   ) = #{poNo}
            </if>
			ORDER BY A.ARR_YMD, A.BL_NO
    </select>
    
    
    <!-- GS칼텍스BL전송정보조회 -->
    <select id="selectGsctexBlSendInfo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectGsctexBlSendInfo */
        SELECT    
			  A.BL_ID
			     , A.BL_NO
			     , A.MBL_ID
			     , A.MBL_NO
			     , A.SMT_NO
			     , A.EO_NO 
			     , DATE_FORMAT(NOW(),'%Y%m%d%H%i%s') AS SEND_DT
			     , (SELECT S.REF_NO                      
			         FROM   TB_FWD_INTG_REF_NO S                        
			         WHERE  1=1
			         AND    S.INTG_KEY_ID = A.BL_ID
			         AND    S.DEL_YN = 'N'          
			         AND    S.REF_NO_SPR_CD = 'PO'                        
			       ) AS PO_NO               
			       , A.NEGO_ONBR_YMD
			       , A.ONBR_YMD
			       , A.ETA_YMD 
			       , A.ARR_YMD  
			       , A.FLT_VSL_NM
			       , A.VOYAGE  
			       , A.FRGTTERM_CD
			       , A.POL_CD
			       , A.POL_NM
			       , A.POR_CD
			       , A.POR_NM
			       , A.POD_CD
			       , A.POD_NM 
			       , ( SELECT OUTR_CD 
			           FROM   TB_COM_CD_MPNG 
			           WHERE  CD_TYPE_CD = 'C' 
			           AND    CD_MPNG_SPR_NM = 'NEW_OLD_BIZPTNR_CD_MPNG'
			           AND    SYS_TYPE_CD = 'FW'
			           AND    INSD_CD = C.CARR_CD
			           LIMIT  1 ) AS CARR_CD /* 신거래처를 구거래처로 매핑 후 전송 */ 
			       , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetBizptnrNm">
                         <property name="bizptnrCd" value="C.CARR_CD"/>
                     </include>) AS CARR_NM /* Mybatis Include 처리 :: FC_CM_GET_BIZPTNR_NM(C.CARR_CD) AS CARR_NM*/     
			       , A.SELL_GWT
			       , A.SELL_VOL_WGT
			       , A.SELL_CBM
			       , A.PKG_QTY
			       , A.PKG_UNIT_CD      
			       , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                         <property name="clasCd" value="'0134'"/>
                         <property name="dtlCd" value="A.PKG_UNIT_CD"/>
                     </include>) AS PKG_UNIT_NM /* Mybatis Include 처리 :: FC_CM_GET_ETC_CD_NM('0134' , A.PKG_UNIT_CD) AS PKG_UNIT_NM*/         
			       , (SELECT IFNULL(SUM(S.QTY), 0)
			          FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
			               , TB_SMT_INTG_ITEM S /* 컨테이너  */
			          WHERE  1=1
			          AND    T.DEL_YN = 'N' /* 삭제여부 */
			          AND    S.DEL_YN = 'N' /* 삭제여부 */
			          AND    T.BL_ID = A.BL_ID
			          AND    T.INTG_ITEM_NO = S.INTG_ITEM_NO
			          AND    S.CNTR_YN = 'Y'
			          <![CDATA[
			          AND    S.CNTR_SIZE_CD <= '20'    
			          ]]>  
			          AND    S.CNTR_TYPE_CD = 'DR') AS DR20
			       , (SELECT IFNULL(SUM(S.QTY), 0)
			          FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
			               , TB_SMT_INTG_ITEM S /* 컨테이너  */
			          WHERE  1=1
			          AND    T.DEL_YN = 'N' /* 삭제여부 */
			          AND    S.DEL_YN = 'N' /* 삭제여부 */
			          AND    T.BL_ID = A.BL_ID
			          AND    T.INTG_ITEM_NO = S.INTG_ITEM_NO
			          AND    S.CNTR_YN = 'Y'
			          <![CDATA[
			          AND    S.CNTR_SIZE_CD > '20'    
			           ]]>     
			          AND    S.CNTR_TYPE_CD = 'DR') AS DR40     
			       , (SELECT IFNULL(SUM(S.QTY), 0)
			          FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
			               , TB_SMT_INTG_ITEM S /* 컨테이너  */
			          WHERE  1=1
			          AND    T.DEL_YN = 'N' /* 삭제여부 */
			          AND    S.DEL_YN = 'N' /* 삭제여부 */
			          AND    T.BL_ID = A.BL_ID
			          AND    T.INTG_ITEM_NO = S.INTG_ITEM_NO
			          AND    S.CNTR_YN = 'Y'
			          AND    S.CNTR_SIZE_CD = '40'       
			          AND    S.CNTR_TYPE_CD = 'HC') AS HC40
			       , E.BAF_AMT
			       , E.CAF_AMT 
			       , E.OFT_AMT
			       , A.RPRS_ITEM_NM
			       , (SELECT IF(COUNT(*)=0, 'NEW', 'MOD') 
			          FROM NFINF.TB_FWD_INT215 
			          WHERE HBL_NO = A.BL_NO) AS SEND_GUBUN
			       , (SELECT IF(COUNT(*)=0, 'NEW', 'MOD') 
			          FROM NFINF.TB_FWD_INT404
			          WHERE HBL_NO = A.BL_NO) AS SEND_GUBUN_PMIS                         
			       , FC_FWD_STR_RTN(XX.INTG_ADDR,1,1,'X','H') || ' ' ||
			   FC_FWD_STR_RTN(XX.INTG_ADDR,2,2,'X','H') || ' ' ||
			            FC_FWD_STR_RTN(XX.INTG_ADDR,3,3,'X','H') || ' ' ||
			            FC_FWD_STR_RTN(XX.INTG_ADDR,4,4,'X','H') || ' ' ||
			            FC_FWD_STR_RTN(XX.INTG_ADDR,5,5,'X','H') || ' ' ||
			            FC_FWD_STR_RTN(XX.INTG_ADDR,6,6,'X','H') AS SHPR_ADDR 
			FROM TB_FWD_BL A
			INNER JOIN TB_FWD_BL B ON  B.BL_ID = A.MBL_ID
			        AND B.DEL_YN = 'N'
			INNER JOIN TB_SMT_INTG_TASK_DEPT C ON  C.CST_BL_ID = A.BL_ID
			           AND C.EO_NO = A.EO_NO
			           AND C.TASK_SPR_CD = 'IMP' 
			           AND IFNULL(C.DEL_YN, 'N') = 'N'
			LEFT OUTER JOIN ( SELECT   SUM(IF(CC.FRGH_CD='BAF', CC.LOCL_FRGH_AMT, 0)) AS BAF_AMT            
			                  , SUM(IF(CC.FRGH_CD='CAF', CC.LOCL_FRGH_AMT, 0)) AS CAF_AMT            
			                  , SUM(IF(CC.FRGH_CD=IF(AA.EXCT_SPR_CD='OC', 'OFT', 'AFT'), CC.LOCL_FRGH_AMT, 0)) AS OFT_AMT            
			                  , MAX(AA.BL_ID) AS BL_ID
			           FROM     TB_FWD_BL AA     /* HBL */            
			                  , TB_ISM_SELLBUY CC            
			           WHERE    1=1            
			           AND      AA.BL_ID = CC.BL_ID            
			           AND      AA.DEL_YN  = 'N'            
			           AND      CC.DEL_YN = 'N'            
			           AND      AA.BL_SPR_CD IN ('H','D')            
			           AND      CC.SELLBUY_SPR_CD = 'SO'            
			           AND      CC.DOM_ABRD_BIZPTNR_TYPE_CD = '1' /* 국내거래처 */            
			           AND      CC.BILG_BIZPTNR_CD =  '1004105' /* GS칼텍스 */            
			           AND      CC.OFFSET_SMT_NO1 IS NULL 
			           GROUP BY AA.BL_ID ) E ON E.BL_ID = A.BL_ID
			LEFT OUTER JOIN TB_FWD_INTG_ADDR XX ON  XX.INTG_KEY_ID = A.BL_ID     
			         AND XX.ADDR_SPR_CD = 'BS'
			         AND XX.DEL_YN = 'N'
			WHERE 1=1 
			AND A.DEL_YN = 'N'
			AND A.BL_SPR_CD = 'H'
			AND A.BL_ID = #{blId} 
    </select>
    
    <!-- GS칼텍스인터페이스테이블등록 -->
    <insert id="insertGsctexIfTbl" parameterType="dataItem" >
        /* fwd.edi.fwdCstComIfMgnt.insertGsctexIfTbl */
        INSERT INTO NFINF.TB_FWD_INT215(
                    INTERFACE_ID
                    , SEND_GUBUN
                    , SENDER
                    , RECEIVER
                    , SEND_DT
                    , HBL_NO
                    , PO_NO
                    , FRT_TERM_PP_CC
                    , SHIPPER_ADDR
                    , POR
                    , POR_NM
                    , POD
                    , POD_NM
                    , ONBOARD_DT
                    , ARR_DT
                    , VSL_IATA_NM
                    , VOYAGE_FLT_NO
                    , CARRIER_CD
                    , CARRIER_NM
                    , MF_ITEM_NM
                    , SHPR_GRS_WT
                    , SHPR_GRS_VOL
                    , PKGS
                    , PKGS_NM
                    , PKGS_UNIT
                    , CNTR_20DR_QTY
                    , CNTR_40DR_QTY
                    , CNTR_40HC_QTY
                    , OFT_AMT
                    , BAF_AMT
                    , CAF_AMT
                    , FILE_NM
                    , INS_ID
                    , TIMESTAMP)
             VALUES(
                      #{interfaceId}  
                    , #{sendGubun}
                    , 'PANTOS'
                    , 'GSCALTEX'
                    , #{sendDt}
                    , #{blNo}
                    , #{poNo}
                    , #{frgttermCd}
                    , #{shprAddr}
                    , #{porCd}
                    , #{porNm}
                    , #{podCd}
                    , #{podNm}
                    , #{onbrYmd}
                    , #{arrYmd}
                    , #{fltVslNm}
                    , #{voyage}
                    , #{carrCd} 
                    , #{carrNm}
                    , #{rprsItemNm}
                    , #{sellGwt}
                    , #{sellVolWgt}
                    , #{pkgQty}
                    , #{pkgUnitNm}
                    , #{pkgUnitCd}
                    , #{dr20}
                    , #{dr40}
                    , #{hc40}
                    , #{oftAmt}
                    , #{bafAmt}
                    , #{cafAmt}
                    , CONCAT(#{blNo}, '_', DATE_FORMAT(NOW(), '%m%d%H%i%s'), '.TXT') 
                    , #{rstrId}
                    , NOW()
                    )
    </insert>
    
    <!-- GS칼텍스PMIS인터페이스테이블등록 -->
    <insert id="insertGsctexPMISIfTbl" parameterType="dataItem" >
        /* fwd.edi.fwdCstComIfMgnt.insertGsctexPMISIfTbl */
        INSERT INTO NFINF.TB_FWD_INT404(
                    INTERFACE_ID
                    , SEND_GUBUN
                    , SENDER
                    , RECEIVER
                    , SEND_DT
                    , HBL_NO
                    , PO_NO
                    , POL
                    , POL_NM
                    , POD
                    , POD_NM
                    , ETD
                    , ATD
                    , ETA
                    , ATA
                    , INS_ID
                    , TIMESTAMP)
              VALUES(
                      #{interfaceId}  
                    , #{sendGubunPmis}
                    , 'PANTOS'
                    , 'GSCALTEX'
                    , #{sendDt}
                    , #{blNo}
                    , #{poNo}
                    , #{polCd}
                    , #{polNm}
                    , #{podCd}
                    , #{podNm}                      
                    , #{negoOnbrYmd}
                    , #{onbrYmd}
                    , #{etaYmd}
                    , #{arrYmd}
                    , #{rstrId}
                    , NOW()
                    )
    </insert>
    
    <!-- 크레텍책임BL전송정보조회 -->
    <select id="selectCretRsbtyBlSendInfo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectCretRsbtyBlSendInfo */
        SELECT 
			  'F' AS CHK
			     , A.BL_ID
			     , A.BL_NO
			     , A.MBL_ID
			     , A.MBL_NO     
			     , A.BL_PRT_YMD               
			     , A.EXCT_SPR_CD     
			     , A.SHPP_CD
			     , A.RMK AS SHPP_NM
			     , A.FLT_VSL_NM
			     , A.VOYAGE     
			     , D.CNTR_NO 
			     , D.CNTR_SIZE_CD||D.CNTR_TYPE_CD AS CNTR_SIZE_TYPE
			     , (SELECT SUM(S.QTY)
			         FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
			              , TB_SMT_INTG_ITEM S /* 컨테이너  */
			         WHERE  1=1
			         AND    T.DEL_YN = 'N' /* 삭제여부 */
			         AND    S.DEL_YN = 'N' /* 삭제여부 */
			         AND    T.BL_ID = A.BL_ID
			         AND    T.INTG_ITEM_NO = S.INTG_ITEM_NO
			         AND    S.CNTR_YN = 'Y') AS CNTR_TOT_CNT
			      , A.POL_CD
			      , A.POL_NM
			      , A.POD_CD
			      , A.POD_NM
			      , A.INCOT_CD
			      , A.SELL_GWT
			      , A.SELL_CBM
			      , A.PKG_QTY
			      , A.PKG_UNIT_CD
			      , A.LADG_TYPE_CD
			      , (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                         <property name="clasCd" value="'0064'"/>
                         <property name="dtlCd" value="A.LADG_TYPE_CD"/>
                     </include>) AS LADG_TYPE_NM /* Mybatis Include 처리 :: FC_CM_GET_ETC_CD_NM('0064' , A.LADG_TYPE_CD) LADG_TYPE_NM*/             
			      , A.BL_PRT_YMD
			      , '' AS CLEARANCE_YMD
			      , E.DO_SEND_YMD      
			      , D.FACT_GR_YMD
			      , D.CY_TAKOUT_YMD
			      , A.NEGO_ONBR_YMD
			      , A.ONBR_YMD
			      , A.ETA_YMD 
			      , A.ARR_YMD     
			      , (SELECT IF(COUNT(*)=0,'I','U') 
			         FROM NFINF.TB_FWD_INT237 
			         WHERE 1=1
			         AND BL_ID = A.BL_ID) AS SEND_TYPE
			      , (CASE
			         WHEN A.CNEE_CD='1004806'
			         THEN 'C'
			         WHEN A.CNEE_CD='1111533'
			         THEN 'C'
			         WHEN A.CNEE_CD='1004810'
			         THEN 'W'
			        END) AS COM_TYPE /* ASIS 크레텍책임 121871, 크레텍웰딩 122138 */ /* 거래처 매핑 */
			      , A.SMT_NO
			      , A.EO_NO
			FROM TB_FWD_BL A
			INNER JOIN TB_SMT_INTG_TASK_DEPT B ON  B.EO_NO = A.EO_NO
			           AND B.CST_BL_ID = A.BL_ID
			           AND B.TASK_SPR_CD = 'IMP'
			LEFT OUTER JOIN TB_FWD_BL_PRT_EXPND C ON C.BL_ID = A.BL_ID
			LEFT OUTER JOIN (SELECT T.BL_ID, 
			                        S.CNTR_NO, 
			                        S.CNTR_SIZE_CD, 
			                        S.CNTR_TYPE_CD, 
			                        '' AS FACT_GR_YMD, /*[TODO_PJS] 필드 생성되었으면 주석 푼다. S.FACT_GR_YMD*/
			                        '' AS CY_TAKOUT_YMD  /*[TODO_PJS] 필드 생성되었으면 주석 푼다. S.CY_TAKOUT_YMD*/
			         FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
			              , TB_SMT_INTG_ITEM S /* 컨테이너  */
			         WHERE  1=1
			         AND    T.DEL_YN = 'N' /* 삭제여부 */
			         AND    S.DEL_YN = 'N' /* 삭제여부 */
			         AND    T.BL_ID = #{blId} 
			         AND    T.INTG_ITEM_NO = S.INTG_ITEM_NO
			         AND    S.CNTR_YN = 'Y'
			         LIMIT  1) D ON D.BL_ID = A.BL_ID
			LEFT OUTER JOIN TB_FWD_BL_EXPND E ON E.BL_ID = A.BL_ID
			WHERE 1=1
			AND   A.BL_ID = #{blId}
    </select>
    
    <!-- 크레텍책임인터페이스테이블등록 -->
    <insert id="insertCretRsbtyIfTbl" parameterType="dataItem" >
        /* fwd.edi.fwdCstComIfMgnt.insertCretRsbtyIfTbl */
        INSERT INTO NFINF.TB_FWD_INT237 ( INTERFACE_ID
                          , CUST_CD
                          , REG_DT
                          , BL_ID
                          , HBL_NO
                          , MBL_NO
                          , BL_ISSUE_DT
                          , BIZ_UNIT_CD
                          , VOYAGE_FLT_NO
                          , CNTR_NO
                          , CNTR_TOT_QTY
                          , SHPR_NM
                          , VSL_IATA_NM
                          , POL_NATION_CD
                          , POL_NM
                          , POD_NATION_CD
                          , POD_NM
                          , CNTR_SIZE_TYPE
                          , INCOT_CD
                          , PKGS_UNIT
                          , PKGS
                          , SHIP_MODE
                          , CY_IN_DT
                          , CY_OUT_DT
                          , ETD
                          , ETA
                          , ATD
                          , ATA
                          , SHPR_GRS_WT
                          , CBM
                          , DELV_REQ_DT
                          , SEND_TYPE
                          , FILE_NM
                          , ATTRIBUTE1
                          , INS_ID
                          , TIMESTAMP)
                   VALUES ( #{interfaceId}
                          , '39125'
                          , DATE_FORMAT(NOW(),'%Y%m%d%H%i%s')
                          , #{blId}
                          , #{blNo}
                          , #{mblNo}
                          , #{blPrtYmd}
                          , CASE
                            WHEN #{exctSprCd}='AR'
                            THEN 'AIR'
                            WHEN #{exctSprCd}='OC'
                            THEN 'SEA'
                           END
                          , #{voyage}
                          , #{cntrNo}
                          , #{cntrTotCnt}
                          , #{shppNm}
                          , #{fltVslNm}
                          , SUBSTR(#{polCd}, 1, 2) 
                          , #{polNm}
                          , SUBSTR(#{podCd}, 1, 2) 
                          , #{podNm}
                          , #{cntrSizeType}
                          , #{incotCd}
                          , #{pkgUnitCd}
                          , #{pkgQty}
                          , #{ladgTypeNm}
                          , #{factGrYmd}
                          , #{cyTakoutYmd}
                          , #{negoOnbrYmd}
                          , #{etaYmd}
                          , #{onbrYmd}
                          , #{arrYmd}
                          , #{sellGwt}
                          , #{sellCbm}
                          , #{doSendYmd}
                          , #{sendType}
                          , #{fileNm}
                          , #{comType}
                          , #{rstrId}
                          , NOW() ) 
    </insert>
    
    
    <!-- 크레텍책임BL이미지전송정보조회 -->
    <select id="selectCretRsbtyBlImgSendInfo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectCretRsbtyBlImgSendInfo */
        SELECT   
			  'CRT' IF_WRK_GRP_NM               
			        , A.EXCT_SPR_CD 
			        , A.BL_NO   
			        , A.SMT_NO   
			        , A.EO_NO   
			        , A.BL_ID   
			        , '' AS REF_NO  
			        , 'BL' AS IMG_DOC_SPR_CD    
			        , 'Y' AS DOC_MERG_YN    
			        , 'N' AS BLOB_ATCH_YN   
			        , B.FILE_NM AS RQST_FILE_NM 
			        , '' AS BLOB_CONT   
			        , 'XML' IMG_SEND_TYPE_NM    
			        , B.INS_ID RSTR_ID
			        , B.INS_ID UPDR_ID
			FROM    TB_FWD_BL A 
			       ,(SELECT  BL_ID, FILE_NM, INS_ID    
			         FROM    NFINF.TB_FWD_INT237  
			         WHERE    INTERFACE_ID = #{interfaceId} ) B    
			WHERE    A.BL_ID = B.BL_ID  
			AND      A.DEL_YN = 'N'
    </select>
    
    <!-- 서브원 전송 정보  조회-->
    <select id="selectServeoneSendInfo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectServeoneSendInfo */
        SELECT 
			  'F' AS CHK 
			     , (SELECT IF(COUNT(1)=0, 'N', 'Y') FROM NFINF.TB_FWD_INT715 WHERE ATTR5 = A.BL_ID AND DOC_TYPE_CD = 'CBL') AS CHECK_SEND_YN 
			     , (SELECT IF(COUNT(1)=0, 'N', 'Y') FROM NFINF.TB_FWD_INT715 WHERE ATTR5 = A.BL_ID AND DOC_TYPE_CD = 'BL') AS ORIGIN_SEND_YN 
			     , A.BL_ID
			     , A.EO_NO 
			     , A.SMT_NO  
			     , A.BL_NO 
			     , A.BL_SPR_CD 
			     , B.INTG_TASK_NO
			     , A.MBL_NO 
			     , A.MBL_ID 
			     , (SELECT   INTG_TASK_NO 
			        FROM     TB_SMT_INTG_TASK_DEPT AA
			                 , TB_FWD_BL BB 
			        WHERE    BB.EO_NO = AA.EO_NO
			        AND      BB.BL_ID = A.MBL_ID
			        AND      AA.CST_BL_ID = BB.BL_ID
			        AND      AA.TASK_SPR_CD = 'EXP'          
			        AND      AA.DEL_YN = 'N') AS MBL_INTG_TASK_NO   /* MBL 역할번호 */
			      , (SELECT  S.REF_NO
			         FROM    TB_FWD_INTG_REF_NO S
			                 ,TB_FWD_BL Z
			         WHERE   1=1
			         AND     Z.BL_ID = S.INTG_KEY_ID 
			         AND     S.DEL_YN = 'N'
			         AND     Z.DEL_YN = 'N'
			         AND     S.REF_NO_SPR_CD = 'SR'
			         AND     S.RPRS_YN = 'Y'        
			         LIMIT   1) AS SR_NO
			   , IF((SELECT  COUNT(1) 
			       FROM  TB_FWD_INTG_REF_NO S
			            ,TB_FWD_BL Z
			       WHERE  1=1
			       AND    Z.BL_ID = S.INTG_KEY_ID 
			       AND    S.DEL_YN = 'N'
			       AND    Z.DEL_YN = 'N'
			       AND    S.REF_NO_SPR_CD = 'SR')=0, 'N', 'Y') AS SR_NO_YN   
			      , A.ONBR_YMD
			      , A.SHPP_CD
			      , A.SHPP_NM
			      , A.CNEE_CD
			      , A.CNEE_NM
			      , A.POL_CD
			      , A.POL_NM
			      , A.POD_CD 
			      , A.POD_NM
			      , A.FDEST_CD
			      , A.FDEST_NM
			      , A.EXCT_SPR_CD
			      , SUBSTR( (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
		                         <property name="clasCd" value="'0320'"/>
		                         <property name="dtlCd" value="A.EXCT_SPR_CD"/>
		                     </include>) /* Mybatis Include 처리 :: FC_CM_GET_ETC_CD_NM('0320' , A.EXCT_SPR_CD )*/,1,50) AS EXCT_SPR_NM   /* 운송사명 */
			      , A.PKG_QTY
			      , A.SELL_GWT
			      , A.SELL_CWT
			      , A.LADG_TYPE_CD
			      , SUBSTR( (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                                 <property name="clasCd" value="'0036'"/>
                                 <property name="dtlCd" value="A.LADG_TYPE_CD"/>
                             </include>) /* Mybatis Include 처리 :: FC_CM_GET_ETC_CD_NM('0036' , A.LADG_TYPE_CD )*/,1,50) AS LADG_TYPE_NM
			      , (SELECT SUM(QTY)
			         FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
			               ,TB_SMT_INTG_ITEM S /* 컨테이너  */
			         WHERE  1=1
			         AND    T.DEL_YN = 'N' /* 삭제여부 */
			         AND    S.DEL_YN = 'N' /* 삭제여부 */
			         AND    T.BL_ID = A.BL_ID
			         AND    T.INTG_ITEM_NO = S.INTG_ITEM_NO
			         AND    S.CNTR_YN = 'Y'
			         AND    S.CNTR_SIZE_CD = '20'
			         AND    S.CNTR_TYPE_CD = 'DR') AS CNTR_20DR_QTY 
			      , (SELECT SUM(QTY)
			         FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
			               ,TB_SMT_INTG_ITEM S /* 컨테이너  */
			         WHERE  1=1
			         AND    T.DEL_YN = 'N' /* 삭제여부 */
			         AND    S.DEL_YN = 'N' /* 삭제여부 */
			         AND    T.BL_ID = A.BL_ID
			         AND    T.INTG_ITEM_NO = S.INTG_ITEM_NO
			         AND    S.CNTR_YN = 'Y'
			         AND    S.CNTR_SIZE_CD = '40'
			         AND    S.CNTR_TYPE_CD = 'DR') AS CNTR_40DR_QTY               
			      ,(SELECT SUM(QTY)
			         FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
			               ,TB_SMT_INTG_ITEM S /* 컨테이너  */
			         WHERE  1=1
			         AND    T.DEL_YN = 'N' /* 삭제여부 */
			         AND    S.DEL_YN = 'N' /* 삭제여부 */
			         AND    T.BL_ID = A.BL_ID
			         AND    T.INTG_ITEM_NO = S.INTG_ITEM_NO
			         AND    S.CNTR_YN = 'Y') -
			         (SELECT SUM(QTY)
			         FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
			               ,TB_SMT_INTG_ITEM S /* 컨테이너  */
			         WHERE  1=1
			         AND    T.DEL_YN = 'N' /* 삭제여부 */
			         AND    S.DEL_YN = 'N' /* 삭제여부 */
			         AND    T.BL_ID = A.BL_ID
			         AND    T.INTG_ITEM_NO = S.INTG_ITEM_NO
			         AND    S.CNTR_YN = 'Y'
			         AND    ((S.CNTR_SIZE_CD = '20' AND S.CNTR_TYPE_CD = 'DR') OR (S.CNTR_SIZE_CD = '40' AND S.CNTR_TYPE_CD = 'DR'))) AS CNTR_ETC_QTY  
			       ,'' AS CHECK_EDMS_YN /* [TODO-PJS] VW_ED_STATUS_01 VIEW Table 없음 :: (SELECT CASE 
			                            WHEN COUNT(X.IMG_STATUS) = 0 
			                            THEN 'N'
			                                       ELSE 
			                                         CASE
			                                          WHEN MAX(X.IMG_STATUS)='C'
			                                          THEN 'Y'
			                                          WHEN MAX(X.IMG_STATUS)='U'
			                                          THEN 'Y'
			                                          ELSE 'N'
			                                         END
			                                  END     
			                           FROM   VW_ED_STATUS_01 X
			                           WHERE  X.BL_ID = A.BL_ID
			                           AND    X.BL_NO = A.BL_NO
			                           AND    X.SO_NO = A.SO_NO
			                           AND    X.EO_NO = A.EO_NO
			                           AND    X.DOC_TYPE = '71'
			                           LIMIT  1) AS CHECK_EDMS_YN*/
			        ,'' AS ORIGIN_EDMS_YN /* [TODO-PJS] VW_ED_STATUS_01 VIEW Table 없음 :: (SELECT CASE 
			                       WHEN COUNT(X.IMG_STATUS) = 0 
			                       THEN 'N'
			                                ELSE 
			                                   ELSE
			                                     CASE
			                                        WHEN MAX(X.IMG_STATUS)='C'
			                                        THEN 'Y'
			                                        WHEN MAX(X.IMG_STATUS)='U'
			                                        THEN 'Y'
			                                        ELSE 'N'
			                                       END
			                            END     
			                     FROM   VW_ED_STATUS_01 X
			                     WHERE  X.BL_ID = A.BL_ID
			                     AND    X.BL_NO = A.BL_NO
			                     AND    X.SO_NO = A.SO_NO
			                     AND    X.EO_NO = A.EO_NO
			                     AND    X.DOC_TYPE IN ('04', '28')
			                     LIMIT  1) AS ORIGIN_EDMS_YN*/
			        , '' AS DOC_TYPE_CD 
			        , '' AS DOC_NO 
			        , '' AS FILE_FULL_PATH
			        , '' AS FILE_NAME
			        , '' AS FILE_LENGTH                     
					, '' AS ATTR1
					, '' AS ATTR2
					, '' AS ATTR3
					, '' AS ATTR4
					, '' AS ATTR5    
			        , B.TASK_SPR_CD  
			        , '' AS SEND_TYPE
			        , IF((SELECT COUNT(1)        
			           FROM NFINF.TB_FWD_INT715 A
			           WHERE ATTR5 = A.BL_ID
			           AND DOC_TYPE_CD = 'CBL')=0, 'N', 'Y') AS CHK_YN
			        , A.ONBR_CLOS_YN                         
			FROM TB_FWD_BL A 
			INNER JOIN TB_SMT_INTG_TASK_DEPT B ON  B.EO_NO = A.EO_NO
			           AND B.CST_BL_ID = A.BL_ID
			           AND B.TASK_SPR_CD = 'EXP'
			           AND B.EXCT_BIZPTNR_CD = #{corpCd}
			           AND B.DEL_YN = 'N'
			WHERE 1=1
			AND   A.SHPP_CD IN ( '1004292', '1162521')
			AND   A.BL_SPR_CD IN ('H','D')
			AND   A.DEL_YN = 'N'
			AND   A.ONBR_YMD BETWEEN #{fromDt} AND #{toDt}
			/*{#1}*/
			<if test='blNo != null and blNo != ""'>
               AND A.BL_NO =#{blNo}
            </if>
            <if test='srNo != null and srNo != ""'>
               AND A.SR_NO = #{srNo}
            </if>
            <if test='polCd != null and polCd != ""'>
               AND A.POL_CD = #{polCd}
            </if>
            <if test='podCd != null and podCd != ""'>
               AND A.POD_CD = #{podCd}
            </if>
            <if test='exctSprCd != null and exctSprCd != ""'>
               AND A.EXCT_SPR_CD = #{exctSprCd}
            </if>
            <if test='onbrClosYn != null and onbrClosYn != ""'>
               AND A.ONBR_CLOS_YN = #{onbrClosYn}
            </if>
            <if test='ofcrEmpno != null and ofcrEmpno != ""'>
               AND B.OFCR_EMPNO = #{ofcrEmpno}
            </if>
            /*[TODO] 테스트 완료 후 주석 풀어야 함.*/
<!--             <if test='sendTypeCd != null and sendTypeCd != "" and sendTypeCd != "CHK"'>
               AND EXISTS (SELECT 1 FROM NFINF.TB_FWD_INT715 WHERE ATTR5 = A.BL_ID AND  DOC_TYPE_CD = '71')
            </if>
            <if test='sendTypeCd != null and sendTypeCd != "" and sendTypeCd != "ORGN"'>
               AND EXISTS (SELECT 1 FROM NFINF.TB_FWD_INT715 WHERE BL_NO = A.BL_NO AND DOC_TYPE_CD IN ('04', '28'))
            </if> -->
            
			ORDER BY A.ONBR_YMD
    </select>
    
    <!-- 서브원 전송 요청 정보  조회-->
    <select id="selectServeoneReqSendInfo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectServeoneReqSendInfo */
        SELECT @rownum:=@rownum+1 AS RN
			    , STATUS
			    , INTERFACE_ID
			    , CREATE_DATE
			    , INS_ID 
			FROM (
			  SELECT 'Check' AS STATUS 
			        , A.INTERFACE_ID
			        , A.CREATE_DATE 
			        , A.INS_ID           
			  FROM  NFINF.TB_FWD_INT715 A
			  WHERE  ATTR5 = #{blId}
			  AND  DOC_TYPE_CD = 'CBL'   
			  UNION ALL 
			  SELECT 'Origin' AS STATUS 
			     , A.INTERFACE_ID
			        , A.CREATE_DATE 
			        , A.INS_ID           
			  FROM  NFINF.TB_FWD_INT715 A
			  WHERE  ATTR5 = #{blId}
			  AND  DOC_TYPE_CD = 'BL'
			  ORDER  BY CREATE_DATE) A 
			  INNER JOIN (SELECT @rownum:=0) TMP
    </select>
    
    <!-- 서브원 전송응답 정보  조회-->
    <select id="selectServeoneResSendInfo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectServeoneResSendInfo */
        SELECT @rownum:=@rownum+1 AS RN
		     , INTERFACE_ID
		     , CONF_SPR_CD
		     , CREATE_DATE 
		     , ATTR1
		     , ATTR2
		     , ATTR3
		     , INS_ID
		FROM NFINF.TB_FWD_INT707 
		INNER JOIN (SELECT @rownum:=0) TMP
		WHERE BL_NO = #{blNo}
    </select>
    
    
    <!-- insertServeoneBlInfo에 Insert하기 위한 데이터 조회 -->
    <select id="selectServeoneBlInfoData" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectServeoneBlInfoData */
        SELECT   #{interfaceId} AS INTERFACE_ID/* 인터페이스 ID */
		        ,A.BL_NO AS BL_NO /* BL번호 */
		        ,A.MBL_NO AS MASTER_BL_NO /* 마스터선하증권번호 */
		        ,A.VOYAGE AS VOYAGE_SEQS /* 항차 */
		        ,A.FLT_VSL_NM AS VESSEL_NAME /* 선박명 */
		        ,A.PKG_QTY AS PACKING_QTY /* 포장수량 */
		        ,A.PKG_UNIT_CD AS PACKING_TYPE_CODE /* 포장유형코드 */
		        ,(CASE WHEN #{lfsYn} = 'Y' AND A.EXCT_SPR_CD = 'AR' 
		              THEN A.BUY_GWT 
		              ELSE A.SELL_GWT 
		         END) AS TOTAL_WEIGHT /* 총중량 */
		        ,(CASE WHEN #{lfsYn} = 'Y' AND A.EXCT_SPR_CD = 'AR' 
		              THEN A.BUY_CBM 
		              ELSE A.SELL_CBM
		         END) AS TOTAL_CBM  /* 총CBM */
		        ,(CASE WHEN #{lfsYn} = 'Y' AND A.EXCT_SPR_CD = 'AR' 
		              THEN A.BUY_CWT /* CHARGE_WEIGHT */
		              ELSE A.SELL_CWT /* CHARGE_WEIGHT */
		         END) AS CHARGE_WEIGHT     
		        ,SUBSTR(A.POL_CD, 1, 2) AS LOADING_NATION_CODE/* 선적국가코드 */
		        ,SUBSTR(A.POL_CD, 3, 3) AS LOADING_PORT_CODE/* 선적국가코드 */
		        ,A.POL_NM AS LOADING_PORT_NAME
		        ,SUBSTR(A.POD_CD, 1, 2) AS DISCHARGE_NATION_CODE /* 도착항국가코드 */
		        ,SUBSTR(A.POD_CD, 3, 3) AS DISCHARGE_PORT_CODE /* 도착항코드 */
		        ,A.POD_NM AS DISCHARGE_PORT_NAME/* 도착항명 */
		        ,SUBSTR(A.FDEST_CD, 1, 2) AS FINAL_DEST_NATION_CODE /* 최종목적지국가코드 */
		        ,SUBSTR(A.FDEST_CD, 3, 3) AS FINAL_DESTINATION_CODE /* 최종목적지코드 */
		        ,A.FDEST_NM AS FINAL_DESTINATION_NAME /* 최종목적지명 */
		        ,(SELECT IF(COUNT(1)=0, '9', '4') FROM NFINF.TB_FWD_INT700 WHERE BL_NO = A.BL_NO ) AS BL_STATUS_CODE /* BL전송상태코드 */
		        ,A.BL_PRT_YMD AS BL_ISSUE_DATE /* 선하증권발행일자 */
		        ,CASE WHEN #{lfsYn} = 'Y' THEN A.ONBR_YMD ELSE A.ETD_YMD END AS SHIPPING_DATE /* 예상선적일자 */
		        ,CASE WHEN #{lfsYn} = 'Y' THEN A.ARR_YMD ELSE A.ETA_YMD END AS ARRIVAL_DATE /* 도착일자 */
		        ,SUBSTR(A.FRGTTERM_CD, 1, 1) AS CHARGE_TYPE_CODE /* 선불/후불유형코드 */
		        ,SUBSTR(B.TASK_SPR_CD, 1, 1) AS EXIM_TYPE_CODE /* 수출입구분 */
		        ,(CASE WHEN EXCT_SPR_CD = 'OC' THEN 'S' 
		               WHEN EXCT_SPR_CD = 'AR' THEN 'A'
		               WHEN EXCT_SPR_CD = 'EX' THEN 'E' 
		         END) AS BIZ_BOUND_CODE      /* 사업영역구분코드 */
		        ,(CASE WHEN A.BL_SPR_CD = 'H' THEN 'HBL'
		              WHEN A.BL_SPR_CD = 'D' THEN 'DBL' 
		              END) AS BL_TYPE_CODE  /* BL유형코드 */
		        ,MAX(IF(C.SEQ=1, C.SR_NO, '')) AS SR_NO /* 선적요청번호 */
		        ,(SELECT OUTR_CD 
		          FROM   TB_COM_CD_MPNG
		          WHERE  CD_MPNG_SPR_NM = 'TRANSPORTATION_TYPE_CODE'
		          AND   RLT_BIZPTNR_CD = '1004292'
		          AND   USE_YN = 'Y'
		          AND    INSD_CD = A.TRN_TYPE_CD) AS DELIVERY_METHOD_CODE /* 배송방법코드 */                  
		        ,IF(#{lfsYn}='Y', MAX(IF(C.SEQ=2, C.SR_NO, NULL)), NULL) AS ATTR1 /* 예비항목1 */
		        ,IF(#{lfsYn}='Y', MAX(IF(C.SEQ=3, C.SR_NO, NULL)), NULL) AS ATTR2 /* 예비항목2 */
		        ,IF(#{lfsYn}='Y', MAX(IF(C.SEQ=4, C.SR_NO, NULL)), NULL) AS ATTR3 /* 예비항목3 */
		        ,IF(#{lfsYn}='Y', MAX(IF(C.SEQ=5, C.SR_NO, NULL)), NULL) AS ATTR4 /* 예비항목4 */
		        ,IF(#{lfsYn}='Y', MAX(IF(C.SEQ=6, C.SR_NO, NULL)), NULL) AS ATTR5 /* 예비항목5 */
		        ,IF(#{lfsYn}='Y', MAX(IF(C.SEQ=7, C.SR_NO, NULL)), NULL) AS ATTR6 /* 예비항목6 */
		        ,IF(#{lfsYn}='Y', MAX(IF(C.SEQ=8, C.SR_NO, NULL)), NULL) AS ATTR7 /* 예비항목7 */
		        ,IF(#{lfsYn}='Y', MAX(IF(C.SEQ=9, C.SR_NO, NULL)), NULL) AS ATTR8 /* 예비항목8 */
		        ,IF(#{lfsYn}='Y', MAX(IF(C.SEQ=10, C.SR_NO, NULL)), NULL) AS ATTR9 /* 예비항목9 */
		        ,DATE_FORMAT(NOW(), '%Y%m%d%H%i%s') AS CREATE_DATE /* 생성일시 */
		        ,#{rstrId} AS INS_ID /* 생성자사번 */
		        ,A.LADG_TYPE_CD AS LADG_TYPE_CD /* 적재유형코드 */
		        ,A.CARGO_TYPE_CD AS CARGO_TYPE_CD /* 화물유형코드 */                                      
		FROM TB_FWD_BL A 
		INNER JOIN TB_SMT_INTG_TASK_DEPT B ON  B.EO_NO = A.EO_NO
		           AND B.CST_BL_ID = A.BL_ID
		           AND B.TASK_SPR_CD IN ('EXP', 'IMP', 'TRD')
		           AND B.EXCT_BIZPTNR_CD = #{corpCd}
		           AND B.DEL_YN = 'N'
		INNER JOIN (SELECT BB.REF_NO AS SR_NO, 
				           @rownum:=@rownum+1 AS SEQ 
			        FROM   TB_FWD_INTG_REF_NO BB
			        INNER JOIN (SELECT @rownum:=0) TMP 
				    WHERE  1=1
				    AND    BB.DEL_YN = 'N'
				    AND    BB.INTG_KEY_ID = #{blId}
				    AND    BB.REF_NO_SPR_CD = 'SR'
				    ORDER BY BB.RPRS_YN, BB.REF_NO) C       
		WHERE 1=1
		AND   A.BL_SPR_CD IN ('H','D')
		AND   A.BL_ID = #{blId}
		AND   A.DEL_YN = 'N'
		GROUP BY  A.BL_NO  /* BL번호 */
		    ,A.MBL_NO /* 마스터선하증권번호 */
		    ,A.BL_SPR_CD
		    ,A.VOYAGE /* 항차 */
		    ,A.FLT_VSL_NM /* 선박명 */
		    ,A.PKG_QTY /* 포장수량 */
		    ,A.PKG_UNIT_CD /* 포장유형코드 */
		    ,A.SELL_GWT /* 총중량 */
		    ,A.SELL_CBM /* 총CBM */
		    ,A.SELL_CWT /* CHARGE_WEIGHT */
		    ,A.BUY_GWT /* 총중량 */
		    ,A.BUY_CBM /* 총CBM */
		    ,A.BUY_CWT /* CHARGE_WEIGHT */              
		    ,A.POL_CD
		    ,A.POL_NM
		    ,A.POD_CD
		    ,A.POD_NM /* 도착항명 */
		    ,A.FDEST_CD
		    ,A.FDEST_NM /* 최종목적지명 */
		    ,A.BL_PRT_YMD /* 선하증권발행일자 */
		    ,A.ETD_YMD /* 예상선적일자 */
		    ,A.ETA_YMD /* 도착일자 */
		    ,A.FRGTTERM_CD /* 선불/후불유형코드 */
		    ,B.TASK_SPR_CD
		    ,A.EXCT_SPR_CD   
		    ,A.TRN_TYPE_CD  
		    ,A.LADG_TYPE_CD /* 적재유형코드 */
		    ,A.CARGO_TYPE_CD /* 화물유형코드 */ 
		    ,A.BL_ID   
		    ,A.ONBR_YMD
		    ,A.ARR_YMD
    </select>
    
    <!-- 서브원 BL 정보 등록  -->
    <insert id="insertServeoneBlInfo" parameterType="dataItem" >
        /* fwd.edi.fwdCstComIfMgnt.insertServeoneBlInfo */
        INSERT INTO NFINF.TB_FWD_INT700
        (    
             INTERFACE_ID /* 인터페이스 ID */
            ,BL_NO /* BL번호 */
            ,MASTER_BL_NO /* 마스터선하증권번호 */
            ,VOYAGE_SEQS /* 항차 */
            ,VESSEL_NAME /* 선박명 */
            ,PACKING_QTY /* 포장수량 */
            ,PACKING_TYPE_CODE /* 포장유형코드 */
            ,TOTAL_WEIGHT /* 총중량 */
            ,TOTAL_CBM  /* 총CBM */
            ,CHARGE_WEIGHT  /* CHARGE_WEIGHT */
            ,LOADING_NATION_CODE /* 선적국가코드 */
            ,LOADING_PORT_CODE /* 선적항코드 */
            ,LOADING_PORT_NAME /* 선적항명 */
            ,DISCHARGE_NATION_CODE /* 도착항국가코드 */
            ,DISCHARGE_PORT_CODE /* 도착항코드 */
            ,DISCHARGE_PORT_NAME /* 도착항명 */
            ,FINAL_DEST_NATION_CODE /* 최종목적지국가코드 */
            ,FINAL_DESTINATION_CODE /* 최종목적지코드 */
            ,FINAL_DESTINATION_NAME /* 최종목적지명 */
            ,BL_STATUS_CODE /* BL전송상태코드 */
            ,BL_ISSUE_DATE /* 선하증권발행일자 */
            ,SHIPPING_DATE /* 예상선적일자 */
            ,ARRIVAL_DATE /* 도착일자 */
            ,CHARGE_TYPE_CODE /* 선불/후불유형코드 */
            ,EXIM_TYPE_CODE /* 수출입구분 */
            ,BIZ_BOUND_CODE /* 사업영역구분코드 */
            ,BL_TYPE_CODE /* BL유형코드 */
            ,SR_NO /* 선적요청번호 */
            ,DELIVERY_METHOD_CODE /* 배송방법코드 */
            ,ATTR1 /* 예비항목1 */
            ,ATTR2 /* 예비항목2 */
            ,ATTR3 /* 예비항목3 */
            ,ATTR4 /* 예비항목4 */
            ,ATTR5 /* 예비항목5 */
            ,ATTR6 /* 예비항목6 */
            ,ATTR7 /* 예비항목7 */
            ,ATTR8 /* 예비항목8 */
            ,ATTR9 /* 예비항목9 */
            ,CREATE_DATE /* 생성일시 */
            ,INS_ID /* 생성자사번 */
            ,LADG_TYPE_CD /* 적재유형코드 */
            ,CARGO_TYPE_CD /* 화물유형코드 */
        )
        VALUES (
	        IFNULL(#{interfaceId},'' )
	        , IFNULL(#{blNo},'' )
	        , IFNULL(#{masterBlNo},'' )
	        , IFNULL(#{voyageSeqs},'' )
		    , IFNULL(#{vesselName},'' )
		    , IFNULL(#{packingQty},'' )
		    , IFNULL(#{packingTypeCode},'' )
		    , IFNULL(#{totalWeight},'' )
		    , IFNULL(#{totalCbm},'' )
		    , IFNULL(#{chargeWeight},'' )
		    , IFNULL(#{loadingNationCode},'' )
		    , IFNULL(#{loadingPortCode},'' )
		    , IFNULL(#{loadingPortName},'' )
		    , IFNULL(#{dischargeNationCode},'' )
		    , IFNULL(#{dischargePortCode},'' )
		    , IFNULL(#{dischargePortName},'' )
		    , IFNULL(#{finalDestNationCode},'' )
		    , IFNULL(#{finalDestinationCode},'' )
		    , IFNULL(#{finalDestinationName},'' )
		    , IFNULL(#{blStatusCode},'' )
		    , IFNULL(#{blIssueDate},'' )
		    , IFNULL(#{shippingDate},'' )
		    , IFNULL(#{arrivalDate},'' )
		    , IFNULL(#{chargeTypeCode},'' )
		    , IFNULL(#{eximTypeCode},'' )
		    , IFNULL(#{bizBoundCode},'' )
		    , IFNULL(#{blTypeCode},'' )
		    , IFNULL(#{srNo},'' )
		    , IFNULL(#{deliveryMethodCode},'' )
		    , IFNULL(#{attr1},'' )
		    , IFNULL(#{attr2},'' )
		    , IFNULL(#{attr3},'' )
		    , IFNULL(#{attr4},'' )
		    , IFNULL(#{attr5},'' )
		    , IFNULL(#{attr6},'' )
		    , IFNULL(#{attr7},'' )
		    , IFNULL(#{attr8},'' )
		    , IFNULL(#{attr9},'' )
		    , IFNULL(#{createDate},'' )
		    , IFNULL(#{insId},'' )
		    , IFNULL(#{ladgTypeCd},'' )
		    , IFNULL(#{cargoTypeCd},'' )
		     
		    )
    </insert>
    
    
    <!-- 서브원 컨테이너 정보 등록  -->
    <insert id="insertServeoneCntrInfo" parameterType="dataItem" >
        /* fwd.edi.fwdCstComIfMgnt.insertServeoneCntrInfo */
        INSERT INTO NFINF.TB_FWD_INT702
          (    INTERFACE_ID  /* 인터페이스 ID */
			   , CONTAINER_SEQ_NO  /* 컨테이너일련순서번호 */
			   , CONTAINER_NO  /* 컨테이너번호 */
			   , CONTAINER_SIZE_TYPE  /* 컨테이너크기 및 종류코드 */
			   , CNTR_SIZE  /* 컨테이너SIZE */
			   , CNTR_TYPE  /* 컨테이너TYPE */
			   , CONTAINER_WEIGHT  /* 컨테이너중량 */
			   , CONTAINER_CBM  /* 컨테이너CBM */
			   , SEAL_NO  /* 봉인번호 */
			   , CONTAINER_CARTON_QTY  /* 컨테이너카톤수량 */
			   , LOAD_CONFIRM_FLAG  /* LOAD_CONFIRM_FLAG */
			   , ATTR1  /* 예비항목1 */
			   , ATTR2  /* 예비항목2 */
			   , ATTR3  /* 예비항목3 */
			   , BL_NO   /* BL번호 */ )
			  SELECT  #{interfaceId}
			         ,@rownum:=@rownum+1 
			         , S.CNTR_NO
			         , S.CNTR_SIZE_CD||S.CNTR_TYPE_CD
			         , S.CNTR_SIZE_CD
			         , S.CNTR_TYPE_CD
			         , S.WGT
			         , CASE WHEN S.VOL_UNIT_CD = 'CBM' THEN S.VOL
			           ELSE NULL
			           END 
			         , S.SEAL1
			         , S.CTN_QTY
			         , NULL
			         , NULL
			         , NULL
			         , NULL
			         , A.BL_NO
			  FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
			       , TB_SMT_INTG_ITEM S /* 컨테이너  */
			       , TB_FWD_BL A
			       ,(SELECT @rownum:=0) TMP 
			  WHERE  1=1
			  AND    T.DEL_YN = 'N' /* 삭제여부 */
			  AND    S.DEL_YN = 'N' /* 삭제여부 */
			  AND    A.DEL_YN = 'N' /* 삭제여부 */
			  AND    T.BL_ID = A.BL_ID 
			  AND    T.INTG_ITEM_NO = S.INTG_ITEM_NO
			  AND    S.CNTR_YN = 'Y'
			  AND    A.EXCT_SPR_CD NOT IN ('AR', 'EX')
			     AND    T.BL_ID = #{blId}
    </insert>
    
    <!-- 서브원 참조번호 정보 등록  -->
    <insert id="insertServeoneRefNoInfo" parameterType="dataItem" >
        /* fwd.edi.fwdCstComIfMgnt.insertServeoneRefNoInfo */
        INSERT INTO NFINF.TB_FWD_INT701
	          (   INTERFACE_ID /* 인터페이스 ID */
		          , SR_SEQ /* 일련번호 */
		          , BL_NO /* BL번호 */
		          , SR_NO /* 선적요청번호 */
		          , INVOICE_NO /* 선적요청번호CI_NO */
		          , ATTR1 /* 예비항목1 */
		          , ATTR2 /* 예비항목2 */
		          , ATTR3 /* 예비항목3 */ 
	          )
              SELECT    
                    #{interfaceId}
			        , @rownum:=@rownum+1 
			        , A.BL_NO
			        , S.REF_NO
			        , (SELECT MAX(INVOICE_NO)
			           FROM NFINF.TB_SMT_INT695
			           WHERE SR_NO = S.REF_NO)
			        , NULL
			        , NULL
			        , NULL      
		      FROM  TB_FWD_INTG_REF_NO S
			        ,TB_FWD_BL A
			        ,(SELECT @rownum:=0) TMP 
		      WHERE 1=1
		      AND   A.BL_ID = S.INTG_KEY_ID 
		      AND   S.DEL_YN = 'N'
			  AND   A.DEL_YN = 'N'
			  AND   S.REF_NO_SPR_CD = 'SR'
			  AND   S.INTG_KEY_ID = #{blId}
    </insert>
    
    <!-- 서브원 체크 BL 정보 등록  -->
    <insert id="insertServeoneChkBlInfo" parameterType="dataItem" >
        /* fwd.edi.fwdCstComIfMgnt.insertServeoneChkBlInfo */
        INSERT INTO NFINF.TB_FWD_INT706(    
                    INTERFACE_ID /* 인터페이스 ID */
				    ,BL_NO /* BL번호 */
				    ,BL_NO_SEQ /* 선적요청일련번호 */
				    ,SR_NO /* 선적요청번호 */
				    ,INVOICE_NO /* 송장번호 */
				    ,ATTR1 /* 예비항목1 */
				    ,ATTR2 /* 예비항목2 */
				    ,ATTR3 /* 예비항목3 */
				    ,INS_ID /* 전송자사번 */
				    ,CREATE_DATE /* 생성일시 */)
                    SELECT   
                             #{interfaceId} /* 인터페이스 ID */
			                 ,A.BL_NO /* BL번호 */
			                 ,@rownum:=@rownum+1  /* BL번호SEQ */
			                 ,C.SR_NO /* 선적요청번호 */
				             ,(SELECT MAX(INVOICE_NO) FROM NFINF.TB_SMT_INT695 T
			                   WHERE T.SR_NO = C.SR_NO) /* INVOICE NO */  
			                 ,NULL /* 예비항목1 */
			                 ,NULL /* 예비항목2 */
			                 ,NULL /* 예비항목3 */
			                 ,#{rstrId} /* 생성자사번 */  
			                 ,DATE_FORMAT(NOW(), '%Y%m%d%H%i%s') /* 생성일시 */                                             
				   FROM  TB_FWD_BL A 
                   INNER JOIN TB_SMT_INTG_TASK_DEPT B ON  B.EO_NO = A.EO_NO
			                 AND B.CST_BL_ID = A.BL_ID
			                 AND B.TASK_SPR_CD IN ('EXP', 'IMP')
			                 AND B.EXCT_BIZPTNR_CD = #{corpCd}
			                 AND B.DEL_YN = 'N'
				   LEFT OUTER JOIN (SELECT  S.REF_NO AS SR_NO
				                            , S.INTG_KEY_ID AS BL_ID
						              FROM  TB_FWD_INTG_REF_NO S
					                        ,TB_FWD_BL Z
						              WHERE 1=1
						              AND   Z.BL_ID = S.INTG_KEY_ID 
						              AND   S.DEL_YN = 'N'
						              AND   Z.DEL_YN = 'N'
						              AND   S.REF_NO_SPR_CD = 'SR') C ON C.BL_ID = A.BL_ID
		           INNER JOIN (SELECT @rownum:=0) TMP 
				   WHERE 1=1
				   AND   A.BL_SPR_CD IN ('H','D')
	               AND   A.BL_ID = #{blId}
				   AND   A.DEL_YN = 'N'
    </insert>
    
    <!-- 서브원 이미지 정보 등록  --> 
    <insert id="insertServeoneImgInfo" parameterType="dataItem" >
        /* fwd.edi.fwdCstComIfMgnt."insertServeoneImgInfo" */
        INSERT INTO NFINF.TB_FWD_INT715
	          ( INTERFACE_ID /* 인터페이스 ID */
			    , INTERFACE_SEQ  /* 일련번호 */
	            , DOC_TYPE_CD  /* 일련번호 */
			    , DOC_NO  /* 문서번호 */
			    , FILE_FULLPATH  /* 문서번호 */
			    , FILE_NAME  /* 파일명 */
			    , FILE_LENGTH /* 파일SIZE */
			    , ATTR1 /* 예비항목1 */
			    , ATTR2 /* 예비항목2 */
			    , ATTR3 /* 예비항목3 */
			    , ATTR4 /* 예비항목4 */
			    , ATTR5 /* 예비항목5 */
			    , INS_ID /* 전송자사번 */
			    , CREATE_DATE /* 생성일시 */ )
        VALUES(
                #{interfaceId}
                ,#{interfaceSeq}
	            ,CASE WHEN #{docTypeCd} = '71' THEN 'CBL'
	                  WHEN #{docTypeCd} = '22' THEN 'LICE'
	                  ELSE 'BL'
	             END     
	            ,#{docNo}
	            ,CONCAT(#{fileFullPath},#{fileName})
	            ,#{fileName}
	            ,#{fileLength}                     
			    ,#{attr1}
			    ,#{attr2}
			    ,#{attr3}
			    ,#{attr4}
			    ,#{attr5}
			    ,#{rstrId}      
                ,DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
              )
    </insert>
    
    <!-- 서브원 INTERFACE_ID Sequence 정보  --> 
    <select id="selectServeoneIfSeq" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectServeoneIfSeq */
        SELECT  COUNT(1)+1 AS INTERFACE_SEQ
        FROM    NFINF.TB_FWD_INT715 
        WHERE   INTERFACE_ID = #{interfaceId}
    </select>
    
    <!-- 서브원 이미지 수신 목록 조회 -->
    <select id="selectServeoneImgRecvList" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectServeoneImgRecvList */
        SELECT DOC_NO 
		       , DOC_TYPE_CD 
		       , FILE_NAME 
		       , FILE_FULLPATH 
		       , CREATE_DATE 
		       , ATTR1 
		       , ATTR2
		       , ATTR3
		       , ATTR4
		       , ATTR5
		       , IF_STAT_CD 
		       , MSG_CONT      
        FROM    NFINF.TB_FWD_INT716  
        WHERE   1=1 
        AND     CREATE_DATE BETWEEN CONCAT(#{frDt},'0000') AND CONCAT(#{toDt},'235959')
		/*  {#1}*/
		
		<if test="docNo != null and docNo != ''">
               AND DOC_NO = #{docNo}
        </if>
        
        <if test="docTypeCd != null and docTypeCd != ''">
              AND DOC_TYPE_CD = #{docTypeCd}
        </if>
        ORDER BY INTERFACE_ID
    </select>
    
    <!-- LINE FRIRENDS 전송 정보  조회-->
    <select id="selectLfsSendInfo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLfsSendInfo */
        SELECT 
			  'F' AS CHK 
			     , (SELECT IF(COUNT(1)=0, 'N', 'Y') FROM NFINF.TB_FWD_INT715 WHERE ATTR5 = A.BL_ID AND DOC_TYPE_CD = 'CBL') AS CHECK_SEND_YN 
			     , (SELECT IF(COUNT(1)=0, 'N', 'Y') FROM NFINF.TB_FWD_INT715 WHERE ATTR5 = A.BL_ID AND DOC_TYPE_CD = 'BL') AS ORIGIN_SEND_YN 
			     , A.BL_ID
			     , A.EO_NO 
			     , A.SMT_NO  
			     , A.BL_NO 
			     , A.BL_SPR_CD 
			     , B.INTG_TASK_NO
			     , A.MBL_NO 
			     , A.MBL_ID 
			     , (SELECT INTG_TASK_NO 
			          FROM TB_SMT_INTG_TASK_DEPT AA
			             , TB_FWD_BL BB 
			          WHERE BB.EO_NO = AA.EO_NO
			          AND BB.BL_ID = A.MBL_ID
			          AND AA.CST_BL_ID = BB.BL_ID
			          AND AA.TASK_SPR_CD = 'EXP'          
			          AND AA.DEL_YN = 'N') AS MBL_INTG_TASK_NO   /* MBL 역할번호 */
			      , (SELECT S.REF_NO
			      FROM TB_FWD_INTG_REF_NO S
			          ,TB_FWD_BL Z
			      WHERE  1=1
			      AND    Z.BL_ID = S.INTG_KEY_ID 
			      AND    S.DEL_YN = 'N'
			      AND    Z.DEL_YN = 'N'
			      AND    S.REF_NO_SPR_CD = 'SR'
			      AND    S.RPRS_YN = 'Y'        
			      AND    S.INTG_KEY_ID = A.BL_ID
			      LIMIT 1) AS SR_NO
			   , IF((SELECT COUNT(1) 
			      FROM TB_FWD_INTG_REF_NO S
			          ,TB_FWD_BL Z
			      WHERE  1=1
			      AND    Z.BL_ID = S.INTG_KEY_ID 
			      AND    S.DEL_YN = 'N'
			      AND    Z.DEL_YN = 'N'
			      AND    S.REF_NO_SPR_CD = 'SR'   
			      AND    S.INTG_KEY_ID = A.BL_ID)=0, 'N', 'Y') AS SR_NO_YN   
			      , A.ONBR_YMD
			      , A.SHPP_CD
			      , A.SHPP_NM
			      , A.CNEE_CD
			      , A.CNEE_NM
			      , A.POL_CD
			      , A.POL_NM
			      , A.POD_CD 
			      , A.POD_NM
			      , A.FDEST_CD
			      , A.FDEST_NM
			      , A.EXCT_SPR_CD
			      , SUBSTR( (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                                 <property name="clasCd" value="'0320'"/>
                                 <property name="dtlCd" value="A.EXCT_SPR_CD"/>
                             </include>),1 ,50) AS EXCT_SPR_NM /* Mybatis Include 처리 :: SUBSTR(FC_CM_GET_ETC_CD_NM('0320' , A.EXCT_SPR_CD ),1,50) AS EXCT_SPR_NM   /* 운송사명 */
			      , A.PKG_QTY
			      , CASE WHEN A.EXCT_SPR_CD = 'AR' 
			          THEN A.BUY_GWT 
			          ELSE A.SELL_GWT 
			     END AS SELL_GWT
			      , CASE WHEN A.EXCT_SPR_CD = 'AR' 
			          THEN A.BUY_CWT 
			          ELSE A.SELL_CWT 
			     END AS SELL_CWT 
			      , A.LADG_TYPE_CD
			      , SUBSTR( (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                                 <property name="clasCd" value="'0036'"/>
                                 <property name="dtlCd" value="A.LADG_TYPE_CD"/>
                             </include>),1 ,50) AS LADG_TYPE_NM /* Mybatis Include 처리 :: SUBSTR(FC_CM_GET_ETC_CD_NM('0036' , A.LADG_TYPE_CD ),1,50) LADG_TYPE_NM*/
			      , (SELECT SUM(QTY)
			         FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
			               ,TB_SMT_INTG_ITEM S /* 컨테이너  */
			         WHERE  1=1
			         AND    T.DEL_YN = 'N' /* 삭제여부 */
			         AND    S.DEL_YN = 'N' /* 삭제여부 */
			         AND    T.BL_ID = A.BL_ID
			         AND    T.INTG_ITEM_NO = S.INTG_ITEM_NO
			         AND    S.CNTR_YN = 'Y'
			         AND    S.CNTR_SIZE_CD = '20'
			         AND    S.CNTR_TYPE_CD = 'DR') AS CNTR_20DR_QTY 
			      , (SELECT SUM(QTY)
			         FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
			               ,TB_SMT_INTG_ITEM S /* 컨테이너  */
			         WHERE  1=1
			         AND    T.DEL_YN = 'N' /* 삭제여부 */
			         AND    S.DEL_YN = 'N' /* 삭제여부 */
			         AND    T.BL_ID = A.BL_ID
			         AND    T.INTG_ITEM_NO = S.INTG_ITEM_NO
			         AND    S.CNTR_YN = 'Y'
			         AND    S.CNTR_SIZE_CD = '40'
			         AND    S.CNTR_TYPE_CD = 'DR') AS CNTR_40DR_QTY               
			      ,(SELECT SUM(QTY)
			         FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
			               ,TB_SMT_INTG_ITEM S /* 컨테이너  */
			         WHERE  1=1
			         AND    T.DEL_YN = 'N' /* 삭제여부 */
			         AND    S.DEL_YN = 'N' /* 삭제여부 */
			         AND    T.BL_ID = A.BL_ID
			         AND    T.INTG_ITEM_NO = S.INTG_ITEM_NO
			         AND    S.CNTR_YN = 'Y') -
			         (SELECT SUM(QTY)
			         FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
			               ,TB_SMT_INTG_ITEM S /* 컨테이너  */
			         WHERE  1=1
			         AND    T.DEL_YN = 'N' /* 삭제여부 */
			         AND    S.DEL_YN = 'N' /* 삭제여부 */
			         AND    T.BL_ID = A.BL_ID
			         AND    T.INTG_ITEM_NO = S.INTG_ITEM_NO
			         AND    S.CNTR_YN = 'Y'
			         AND    ((S.CNTR_SIZE_CD = '20' AND S.CNTR_TYPE_CD = 'DR') OR (S.CNTR_SIZE_CD = '40' AND S.CNTR_TYPE_CD = 'DR'))) AS CNTR_ETC_QTY  
			       ,'' AS CHECK_EDMS_YN /* [TODO-PJS] VW_ED_STATUS_01 VIEW Table 없음 :: (SELECT CASE 
			                            WHEN COUNT(X.IMG_STATUS) = 0 
			                            THEN 'N'
			                                  ELSE 
			                                   (CASE
			                                     WHEN MAX(X.IMG_STATUS)='C'
			                                     THEN 'Y'
			                                     WHEN MAX(X.IMG_STATUS)='U'
			                                     THEN 'Y'
			                                     ELSE 'N'
			                                    END)
			                                  END     
			                           FROM   VW_ED_STATUS_01 X
			                           WHERE  X.BL_ID = A.BL_ID
			                           AND    X.BL_NO = A.BL_NO
			                           AND    X.SMT_NO = A.SMT_NO
			                           AND    X.EO_NO = A.EO_NO
			                           AND    X.DOC_TYPE = '71') AS CHECK_EDMS_YN*/
			        ,'' AS ORIGIN_EDMS_YN /* [TODO-PJS] VW_ED_STATUS_01 VIEW Table 없음 :: (SELECT CASE 
			                               WHEN COUNT(X.IMG_STATUS) = 0 
			                               THEN 'N'
			                                       ELSE (CASE
			                                      WHEN MAX(X.IMG_STATUS)='C'
			                                      THEN 'Y'
			                                      WHEN MAX(X.IMG_STATUS)='U'
			                                      THEN 'Y'
			                                      ELSE 'N'
			                                     END)
			                                  END     
			                           FROM   VW_ED_STATUS_01 X
			                           WHERE  X.BL_ID = A.BL_ID
			                           AND    X.BL_NO = A.BL_NO
			                           AND    X.SMT_NO = A.SMT_NO
			                           AND    X.EO_NO = A.EO_NO
			                           AND    X.DOC_TYPE IN ('04', '28', IF(B.TASK_SPR_CD='TRD', '46', ''))) AS ORIGIN_EDMS_YN*/
			        ,'' AS LICE_EDMS_YN /* [TODO-PJS] VW_ED_STATUS_01 VIEW Table 없음 :: (SELECT CASE 
			                             WHEN COUNT(X.IMG_STATUS) = 0 
			                             THEN 'N'
			                                      ELSE (CASE
			                                     WHEN MAX(X.IMG_STATUS)='C'
			                                     THEN 'Y'
			                                     WHEN MAX(X.IMG_STATUS)='U'
			                                     THEN 'Y'
			                                     ELSE 'N'
			                                    END)
			                                  END     
			                           FROM   VW_ED_STATUS_01 X
			                           WHERE  X.BL_ID = A.BL_ID
			                           AND    X.BL_NO = A.BL_NO
			                           AND    X.SMT_NO = A.SMT_NO
			                           AND    X.EO_NO = A.EO_NO
			                           AND    X.DOC_TYPE = '22') AS LICE_EDMS_YN*/              
			        , '' AS DOC_TYPE_CD 
			        , '' AS DOC_NO 
			        , '' AS FILE_FULL_PATH
			        , '' AS FILE_NAME
			        , '' AS FILE_LENGTH    
			        , '' AS DOC_TYPE_CD2 
			        , '' AS DOC_NO2 
			        , '' AS FILE_FULL_PATH2
			        , '' AS FILE_NAME2
			        , '' AS FILE_LENGTH2 
			  , '' AS ATTR1
			  , '' AS ATTR2
			  , '' AS ATTR3
			  , '' AS ATTR4
			  , '' AS ATTR5    
			        , B.TASK_SPR_CD  
			        , '' AS SEND_TYPE
			        , IF((SELECT COUNT(1)        
			           FROM NFINF.TB_FWD_INT715 A
			           WHERE ATTR5 = A.BL_ID
			           AND DOC_TYPE_CD = 'CBL')=0, 'N', 'Y') AS CHK_YN
			        , A.CARGO_TYPE_CD
			        , CASE WHEN B.TASK_SPR_CD = 'TRD' AND '' = 'Y' /* [TODO-PJS] VW_ED_STATUS_01 VIEW Table 없음 :: (SELECT CASE 
			                                    WHEN COUNT(X.IMG_STATUS) = 0 
			                                    THEN 'N'
			                                                                        ELSE (CASE
			                                           WHEN MAX(X.IMG_STATUS)='C'
			                                           THEN 'Y'
			                                           WHEN MAX(X.IMG_STATUS)='U'
			                                           THEN 'Y'
			                                           ELSE 'N'
			                                          END)
			                                                                    END     
			                                                             FROM   VW_ED_STATUS_01 X
			                                                             WHERE  X.BL_ID = A.BL_ID
			                                                             AND    X.BL_NO = A.BL_NO
			                                                             AND    X.SMT_NO = A.SMT_NO
			                                                             AND    X.EO_NO = A.EO_NO
			                                                             AND    X.DOC_TYPE = '46') = 'Y'*/ 
			               THEN 'Y' 
			              ELSE 'N' 
			          END AS SWT_SEND_YN                                      
			FROM TB_FWD_BL A 
			INNER JOIN TB_SMT_INTG_TASK_DEPT B ON  B.EO_NO = A.EO_NO
			           AND B.CST_BL_ID = A.BL_ID
			           AND B.TASK_SPR_CD IN ('EXP', 'IMP', 'TRD')
			           AND B.EXCT_BIZPTNR_CD = #{corpCd}
			           AND B.DEL_YN = 'N'
			WHERE 1=1
			AND   A.BL_SPR_CD IN ('H','D') 
			AND   A.DEL_YN = 'N'
			AND   A.ONBR_YMD BETWEEN #{fromDt} AND #{toDt}
			AND   EXISTS (SELECT 1  FROM   TB_COM_CD_MPNG
			                     WHERE  CD_MPNG_SPR_NM = 'CUSTOMER_CODE'
			                     AND  RLT_BIZPTNR_CD = '31'
			                     AND  INSD_CD = A.SHPP_CD)
			/*{#1}*/
			<if test="blNo != null and blNo != ''">
               AND A.BL_NO =#{blNo}
            </if>
            <if test="srNo != null and srNo != ''">
               AND A.SR_NO = #{srNo}
            </if>
            <if test="polCd != null and polCd != ''">
               AND A.POL_CD = #{polCd}
            </if>
            <if test="podCd != null and podCd != ''">
               AND A.POD_CD = #{podCd}
            </if>
            <if test="exctSprCd != null and exctSprCd != ''">
               AND A.EXCT_SPR_CD = #{exctSprCd}
            </if>
            <if test="ofcrEmpno != null and ofcrEmpno != ''">
               AND B.OFCR_EMPNO = #{ofcrEmpno}
            </if>
            <if test="taskSprCd != null and taskSprCd != ''">
               AND B.TASK_SPR_CD = #{taskSprCd}
            </if>
            <if test="sendTypeCd != null and sendTypeCd != '' and endTypeCd == 'CHK' ">
               AND EXISTS (SELECT 1 FROM NFINF.TB_FWD_INT715 WHERE ATTR5 = A.BL_ID AND  DOC_TYPE_CD = '71')
            </if>
            <if test="sendTypeCd != null and sendTypeCd != '' and endTypeCd == 'ORGN' ">
               AND EXISTS (SELECT 1 FROM NFINF.TB_FWD_INT715 WHERE BL_NO = A.BL_NO AND DOC_TYPE_CD IN ('04', '28'))
            </if>
			
			UNION 
			SELECT 'F' AS CHK 
			     , (SELECT IF(COUNT(1)=0, 'N', 'Y') FROM NFINF.TB_FWD_INT715 WHERE ATTR5 = A.BL_ID AND DOC_TYPE_CD = 'CBL') AS CHECK_SEND_YN 
			     , (SELECT IF(COUNT(1)=0, 'N', 'Y') FROM NFINF.TB_FWD_INT715 WHERE ATTR5 = A.BL_ID AND DOC_TYPE_CD = 'BL') AS ORIGIN_SEND_YN 
			     , A.BL_ID
			     , A.EO_NO 
			     , A.SMT_NO  
			     , A.BL_NO 
			     , A.BL_SPR_CD 
			     , B.INTG_TASK_NO
			     , A.MBL_NO 
			     , A.MBL_ID 
			     , (SELECT INTG_TASK_NO 
			          FROM TB_SMT_INTG_TASK_DEPT AA
			             , TB_FWD_BL BB 
			          WHERE BB.EO_NO = AA.EO_NO
			          AND BB.BL_ID = A.MBL_ID
			          AND AA.CST_BL_ID = BB.BL_ID
			          AND AA.TASK_SPR_CD = 'EXP'          
			          AND AA.DEL_YN = 'N') AS MBL_INTG_TASK_NO   /* MBL 역할번호 */
			      , (SELECT S.REF_NO
			      FROM TB_FWD_INTG_REF_NO S
			          ,TB_FWD_BL Z
			      WHERE  1=1
			      AND    Z.BL_ID = S.INTG_KEY_ID 
			      AND    S.DEL_YN = 'N'
			      AND    Z.DEL_YN = 'N'
			      AND    S.REF_NO_SPR_CD = 'SR'
			      AND    S.RPRS_YN = 'Y'        
			      AND    S.INTG_KEY_ID = A.BL_ID
			      LIMIT 1) AS SR_NO
			   , IF((SELECT COUNT(1) 
			      FROM TB_FWD_INTG_REF_NO S
			          ,TB_FWD_BL Z
			      WHERE  1=1
			      AND    Z.BL_ID = S.INTG_KEY_ID 
			      AND    S.DEL_YN = 'N'
			      AND    Z.DEL_YN = 'N'
			      AND    S.REF_NO_SPR_CD = 'SR'   
			      AND    S.INTG_KEY_ID = A.BL_ID)=0, 'N', 'Y') AS SR_NO_YN   
			      , A.ONBR_YMD
			      , A.SHPP_CD
			      , A.SHPP_NM
			      , A.CNEE_CD
			      , A.CNEE_NM
			      , A.POL_CD
			      , A.POL_NM
			      , A.POD_CD 
			      , A.POD_NM
			      , A.FDEST_CD
			      , A.FDEST_NM
			      , A.EXCT_SPR_CD
			      , SUBSTR( (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                                 <property name="clasCd" value="'0320'"/>
                                 <property name="dtlCd" value="A.EXCT_SPR_CD"/>
                             </include>),1 ,50) AS EXCT_SPR_NM /* Mybatis Include 처리 :: SUBSTR(FC_CM_GET_ETC_CD_NM('0320' , A.EXCT_SPR_CD ),1,50) AS EXCT_SPR_NM   /* 운송사명 */
			      , A.PKG_QTY
			      , CASE WHEN A.EXCT_SPR_CD = 'AR' 
			          THEN A.BUY_GWT 
			          ELSE A.SELL_GWT 
			     END AS SELL_GWT       
			      , A.SELL_CWT
			      , A.LADG_TYPE_CD
			      , SUBSTR( (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetEtcCdNm">
                                 <property name="clasCd" value="'0036'"/>
                                 <property name="dtlCd" value="A.LADG_TYPE_CD"/>
                             </include>),1 ,50) AS LADG_TYPE_NM /* Mybatis Include 처리 :: SUBSTR(FC_CM_GET_ETC_CD_NM('0036' , A.LADG_TYPE_CD ),1,50) LADG_TYPE_NM*/
			      , (SELECT SUM(QTY)
			         FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
			               ,TB_SMT_INTG_ITEM S /* 컨테이너  */
			         WHERE  1=1
			         AND    T.DEL_YN = 'N' /* 삭제여부 */
			         AND    S.DEL_YN = 'N' /* 삭제여부 */
			         AND    T.BL_ID = A.BL_ID
			         AND    T.INTG_ITEM_NO = S.INTG_ITEM_NO
			         AND    S.CNTR_YN = 'Y'
			         AND    S.CNTR_SIZE_CD = '20'
			         AND    S.CNTR_TYPE_CD = 'DR') AS CNTR_20DR_QTY 
			      , (SELECT SUM(QTY)
			         FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
			               ,TB_SMT_INTG_ITEM S /* 컨테이너  */
			         WHERE  1=1
			         AND    T.DEL_YN = 'N' /* 삭제여부 */
			         AND    S.DEL_YN = 'N' /* 삭제여부 */
			         AND    T.BL_ID = A.BL_ID
			         AND    T.INTG_ITEM_NO = S.INTG_ITEM_NO
			         AND    S.CNTR_YN = 'Y'
			         AND    S.CNTR_SIZE_CD = '40'
			         AND    S.CNTR_TYPE_CD = 'DR') AS CNTR_40DR_QTY               
			      ,(SELECT SUM(QTY)
			         FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
			               ,TB_SMT_INTG_ITEM S /* 컨테이너  */
			         WHERE  1=1
			         AND    T.DEL_YN = 'N' /* 삭제여부 */
			         AND    S.DEL_YN = 'N' /* 삭제여부 */
			         AND    T.BL_ID = A.BL_ID
			         AND    T.INTG_ITEM_NO = S.INTG_ITEM_NO
			         AND    S.CNTR_YN = 'Y') -
			         (SELECT SUM(QTY)
			         FROM   TB_FWD_BL_ITEM_MPNG  T /* 품목매핑  */
			               ,TB_SMT_INTG_ITEM S /* 컨테이너  */
			         WHERE  1=1
			         AND    T.DEL_YN = 'N' /* 삭제여부 */
			         AND    S.DEL_YN = 'N' /* 삭제여부 */
			         AND    T.BL_ID = A.BL_ID
			         AND    T.INTG_ITEM_NO = S.INTG_ITEM_NO
			         AND    S.CNTR_YN = 'Y'
			         AND    ((S.CNTR_SIZE_CD = '20' AND S.CNTR_TYPE_CD = 'DR') OR (S.CNTR_SIZE_CD = '40' AND S.CNTR_TYPE_CD = 'DR'))) AS CNTR_ETC_QTY  
			       ,'' AS CHECK_EDMS_YN /* [TODO-PJS] VW_ED_STATUS_01 VIEW Table 없음 :: (SELECT CASE 
			                            WHEN COUNT(X.IMG_STATUS) = 0 
			                            THEN 'N'
			                                  ELSE 
			                                   (CASE
			                                     WHEN MAX(X.IMG_STATUS)='C'
			                                     THEN 'Y'
			                                     WHEN MAX(X.IMG_STATUS)='U'
			                                     THEN 'Y'
			                                     ELSE 'N'
			                                    END)
			                                  END     
			                           FROM   VW_ED_STATUS_01 X
			                           WHERE  X.BL_ID = A.BL_ID
			                           AND    X.BL_NO = A.BL_NO
			                           AND    X.SMT_NO = A.SMT_NO
			                           AND    X.EO_NO = A.EO_NO
			                           AND    X.DOC_TYPE = '71') AS CHECK_EDMS_YN*/
			       ,'' AS ORIGIN_EDMS_YN /* [TODO-PJS] VW_ED_STATUS_01 VIEW Table 없음 :: (SELECT CASE 
			                               WHEN COUNT(X.IMG_STATUS) = 0 
			                               THEN 'N'
			                                       ELSE (CASE
			                                      WHEN MAX(X.IMG_STATUS)='C'
			                                      THEN 'Y'
			                                      WHEN MAX(X.IMG_STATUS)='U'
			                                      THEN 'Y'
			                                      ELSE 'N'
			                                     END)
			                                  END     
			                           FROM   VW_ED_STATUS_01 X
			                           WHERE  X.BL_ID = A.BL_ID
			                           AND    X.BL_NO = A.BL_NO
			                           AND    X.SMT_NO = A.SMT_NO
			                           AND    X.EO_NO = A.EO_NO
			                           AND    X.DOC_TYPE IN ('04', '28', IF(B.TASK_SPR_CD='TRD', '46', ''))) AS ORIGIN_EDMS_YN*/
			       ,'' AS LICE_EDMS_YN /* [TODO-PJS] VW_ED_STATUS_01 VIEW Table 없음 :: (SELECT CASE 
			                             WHEN COUNT(X.IMG_STATUS) = 0 
			                             THEN 'N'
			                                      ELSE (CASE
			                                     WHEN MAX(X.IMG_STATUS)='C'
			                                     THEN 'Y'
			                                     WHEN MAX(X.IMG_STATUS)='U'
			                                     THEN 'Y'
			                                     ELSE 'N'
			                                    END)
			                                  END     
			                           FROM   VW_ED_STATUS_01 X
			                           WHERE  X.BL_ID = A.BL_ID
			                           AND    X.BL_NO = A.BL_NO
			                           AND    X.SMT_NO = A.SMT_NO
			                           AND    X.EO_NO = A.EO_NO
			                           AND    X.DOC_TYPE = '22') AS LICE_EDMS_YN*/ 
			        , '' AS DOC_TYPE_CD 
			        , '' AS DOC_NO 
			        , '' AS FILE_FULL_PATH
			        , '' AS FILE_NAME
			        , '' AS FILE_LENGTH    
			        , '' AS DOC_TYPE_CD2 
			        , '' AS DOC_NO2 
			        , '' AS FILE_FULL_PATH2
			        , '' AS FILE_NAME2
			        , '' AS FILE_LENGTH2 
			  , '' AS ATTR1
			  , '' AS ATTR2
			  , '' AS ATTR3
			  , '' AS ATTR4
			  , '' AS ATTR5    
			        , B.TASK_SPR_CD  
			        , '' AS SEND_TYPE
			        , IF((SELECT COUNT(1)        
			           FROM NFINF.TB_FWD_INT715 A
			           WHERE ATTR5 = A.BL_ID
			           AND DOC_TYPE_CD = 'CBL')=0, 'N', 'Y') AS CHK_YN
			        , A.CARGO_TYPE_CD
			        , CASE WHEN B.TASK_SPR_CD = 'TRD' AND '' = 'Y' /* [TODO-PJS] VW_ED_STATUS_01 VIEW Table 없음 :: (SELECT CASE 
			                                    WHEN COUNT(X.IMG_STATUS) = 0 
			                                    THEN 'N'
			                                                                        ELSE (CASE
			                                           WHEN MAX(X.IMG_STATUS)='C'
			                                           THEN 'Y'
			                                           WHEN MAX(X.IMG_STATUS)='U'
			                                           THEN 'Y'
			                                           ELSE 'N'
			                                          END)
			                                                                    END     
			                                                             FROM   VW_ED_STATUS_01 X
			                                                             WHERE  X.BL_ID = A.BL_ID
			                                                             AND    X.BL_NO = A.BL_NO
			                                                             AND    X.SMT_NO = A.SMT_NO
			                                                             AND    X.EO_NO = A.EO_NO
			                                                             AND    X.DOC_TYPE = '46') = 'Y'*/ 
			               THEN 'Y' 
			              ELSE 'N' 
			          END AS SWT_SEND_YN
			FROM  TB_FWD_BL A 
			INNER JOIN TB_SMT_INTG_TASK_DEPT B ON  B.EO_NO = A.EO_NO
			           AND B.CST_BL_ID = A.BL_ID
			           AND B.TASK_SPR_CD IN ('EXP', 'IMP', 'TRD')
			           AND B.EXCT_BIZPTNR_CD = #{corpCd}
			           AND B.DEL_YN = 'N'  
			WHERE 1=1
			AND   A.BL_SPR_CD IN ('H','D')
			AND   A.DEL_YN = 'N'
			AND   A.ONBR_YMD BETWEEN #{fromDt} AND #{toDt}
			AND   EXISTS (SELECT 1  FROM  TB_COM_CD_MPNG
			                     WHERE  CD_MPNG_SPR_NM = 'CUSTOMER_CODE'
			                     AND  RLT_BIZPTNR_CD = '31'
			                     AND  INSD_CD = A.CNEE_CD
			                 )                         
			/*{#1}*/
			<if test="blNo != null and blNo != ''">
               AND A.BL_NO =#{blNo}
            </if>
            <if test="srNo != null and srNo != ''">
               AND A.SR_NO = #{srNo}
            </if>
            <if test="polCd != null and polCd != ''">
               AND A.POL_CD = #{polCd}
            </if>
            <if test="podCd != null and podCd != ''">
               AND A.POD_CD = #{podCd}
            </if>
            <if test="exctSprCd != null and exctSprCd != ''">
               AND A.EXCT_SPR_CD = #{exctSprCd}
            </if>
            <if test="ofcrEmpno != null and ofcrEmpno != ''">
               AND B.OFCR_EMPNO = #{ofcrEmpno}
            </if>
            <if test="taskSprCd != null and taskSprCd != ''">
               AND B.TASK_SPR_CD = #{taskSprCd}
            </if>
            <if test="sendTypeCd != null and sendTypeCd != '' and endTypeCd == 'CHK' ">
               AND EXISTS (SELECT 1 FROM NFINF.TB_FWD_INT715 WHERE ATTR5 = A.BL_ID AND  DOC_TYPE_CD = '71')
            </if>
            <if test="sendTypeCd != null and sendTypeCd != '' and endTypeCd == 'ORGN' ">
               AND EXISTS (SELECT 1 FROM NFINF.TB_FWD_INT715 WHERE BL_NO = A.BL_NO AND DOC_TYPE_CD IN ('04', '28'))
            </if>
    </select>
    
    <!-- LGLS 전송 요청 정보  조회-->
    <select id="selectLglsReqSendInfo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLglsReqSendInfo */
        SELECT  @rownum:=@rownum+1 AS RN
			    , STATUS
			    , INTERFACE_ID
			    , CREATE_DATE
			    , INS_ID 
        FROM (
			  SELECT 'Check' AS STATUS 
			       , A.INTERFACE_ID
			       , A.CREATE_DATE 
			       , A.INS_ID           
			  FROM NFINF.TB_FWD_INT715 A
			  WHERE ATTR5 = #{blId}
			  AND DOC_TYPE_CD = 'CBL'   
			  UNION ALL 
			  SELECT 'Origin' AS STATUS 
			    , A.INTERFACE_ID
			       , A.CREATE_DATE 
			       , A.INS_ID           
			  FROM NFINF.TB_FWD_INT715 A
			  WHERE ATTR5 = #{blId}
			  AND DOC_TYPE_CD = 'BL'
			  ORDER  BY CREATE_DATE) A
        INNER JOIN (SELECT @rownum:=0) TMP 
    </select>
    
    <!-- LGLS 전송응답 정보  조회-->
    <select id="selectLglsResSendInfo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLglsResSendInfo */
        SELECT @rownum:=@rownum+1 AS RN
		      , INTERFACE_ID
		      , CONF_SPR_CD
		      , CREATE_DATE 
		      , ATTR1
		      , ATTR2
		      , ATTR3
		      , INS_ID
		 FROM NFINF.TB_FWD_INT707 
		 INNER JOIN (SELECT @rownum:=0) TMP 
		 WHERE BL_NO = #{blNo}
    </select>
    
    
    <!-- 서브원 참조번호 정보 등록  -->
    <insert id="insertLfsRefNoInfo" parameterType="dataItem" >
        /* fwd.edi.fwdCstComIfMgnt.insertLfsRefNoInfo */
        INSERT INTO NFINF.TB_FWD_INT701
              ( INTERFACE_ID
              , SR_SEQ 
              , BL_NO 
              , SR_NO
              , INVOICE_NO
              , ATTR1
              , ATTR2
              , ATTR3
              , EXP_LICE_NO)
              (
               SELECT   #{interfaceId}
                        , @rownum:=@rownum+1
                        , BL_NO
                        , SR_NO
                        , INVOICE_NO
                        , ATTR1
                        , ATTR2
                        , ATTR3
                        , EXP_LICE_NO 
              FROM     (SELECT  A.BL_NO AS BL_NO
			                  , S.REF_NO AS SR_NO 
			                  , (SELECT MAX(INVOICE_NO)
			                       FROM NFINF.TB_SMT_INT695
			                       WHERE SR_NO = S.REF_NO) AS INVOICE_NO 
			                  , NULL AS ATTR1
			                  , NULL AS ATTR2
			                  , NULL AS ATTR3    
			                  , NULL AS EXP_LICE_NO 
			            FROM   TB_FWD_INTG_REF_NO S
			                  ,TB_FWD_BL A
			            WHERE  1=1
			            AND    A.BL_ID = S.INTG_KEY_ID 
			            AND    S.DEL_YN = 'N'
			            AND    A.DEL_YN = 'N'
			            AND    S.REF_NO_SPR_CD = 'SR'
			            AND    S.INTG_KEY_ID = #{blId}
			            UNION ALL 
			            SELECT  B.BL_NO AS BL_NO 
			                 , '' AS SR_NO
			                 , '' AS INVOICE_NO
			                 , NULL AS ATTR1 
			                 , NULL AS ATTR2
			                 , NULL AS ATTR3
			                 , A.EXP_LICE_NO  
			               FROM  TB_FWD_BL_EXP_LICE A
			                   , TB_FWD_BL B
			            WHERE A.BL_ID = B.BL_ID
			            AND A.DEL_YN = 'N'
			            AND B.DEL_YN = 'N'
			            AND A.BL_ID = #{blId} ) AA
	            INNER JOIN (SELECT @rownum:=0) TMP
          )
    </insert>
    
    <!-- LG상사 전자영업 info 조회  -->
    <select id="selectLgiElecSalesInfo" parameterType="dataItem" resultType="dataItem">
        /* fwd.edi.fwdCstComIfMgnt.selectLgiElecSalesInfo */
        SELECT                                                                                  
		      'F' AS CHK                                                                                
		      ,'Y' AS STAT                                                                                  
		      ,CONCAT(EMS.IF_END_DATE, EMS.IF_END_TIME) AS SEND_DATE                                                                                   
		      ,FI.SHIPPING_DATE                                                                                 
		      ,FI.INV_NO                                                                                    
		      ,FI.CNTR_NO                                                                                   
		      ,FI.BL_NO                                                                                 
		      ,FI.SWITCH_YN                                                                                 
		      ,FI.SHIPPING_LINE                                                                                 
		      ,FI.SHIPPING_NAME                                                                                 
		      ,FI.STUFFING_QTY                                                                                  
		      ,FI.CNTR_TYPE                                                                                 
		      ,FI.TRANS_MODE                                                                                    
		      ,FI.LOGISITIC_FEE                                                                                 
		      ,FI.CURRENCY_CD                                                                                   
		      ,( SELECT SUM(TXN_FRGH_AMT) AS KRW_FEE                                                                                    
		             FROM TB_ISM_SELLBUY ISB                                                                                    
		            WHERE ISB.BL_ID = FI.BL_ID                                                                                  
		              AND ISB.SELLBUY_SPR_CD ='SO'                                                                                  
		              AND ISB.TXN_CUR_CD = 'KRW'                                                                                    
		              AND ISB.DEL_YN = 'N'                                                                                  
		              AND EXISTS (                                                                                  
		                          SELECT 1                                                                                  
		                            FROM TB_COM_ETC_CD A                                                                                    
		                           WHERE A.USE_YN = 'Y'                                                                                 
		                             AND A.CLAS_CD = '2322'                                                                                 
		                             AND A.RMK_CONT = 'BILL'                                                                                    
		                             AND A.DTL_CD_NM = ISB.BILG_BIZPTNR_CD                                                                                      
		                         )                                                                                  
		          ) AS KRW_FEE                                                                                  
		      ,FI.ETD_DATE                                                                                  
		      ,FI.ETA_DATE                                                                                  
		      ,FI.ATD_DATE                                                                                  
		      ,FI.REV_ETA_DATE                                                                                  
		      ,FI.ATA_DATE                                                                                  
		      ,FI.LOADING_PORT                                                                                  
		      ,FI.LOADING_PORT_NAME                                                                                 
		      ,FI.ARRIVAL_PORT                                                                                  
		      ,FI.ARRIVAL_PORT_NAME                                                                                 
		      ,FI.DUE_DATE                                                                                  
		      ,FI.INCOTEMRS                                                                                 
		      ,FI.BL_FILE_NAME                                                                                  
		      ,FI.ATTR1                                                                                 
		      ,FI.ATTR2                                                                                 
		      ,FI.ATTR3                                                                                 
		      ,FI.ATTR4                                                                                 
		      ,FI.ATTR5                                                                                 
		      ,FI.ATTR6                                                                                 
		      ,FI.ATTR7                                                                                 
		      ,FI.ATTR8                                                                                 
		      ,FI.ATTR9                                                                                 
		      ,FI.ATTR10                                                                                    
		      ,EMS.IF_STATUS_CODE AS SEND_STAT                                                                                  
		      ,EMS.MESSAGE AS MSG                                                                                   
		      ,FI.DEL_YN                                                                                    
		      ,FI.REG_DT                                                                                    
		      ,FI.RSTR_ID                                                                                   
		      ,FI.UPD_DT                                                                                    
		      ,FI.UPDR_ID                                                                                       
		      ,FI.INTERFACE_ID                                                                                  
		      ,FI.INTERFACE_SEQ                                                                                 
		      ,FI.ZXMLDOCNO                                                                                 
		      ,FI.FOWADER_CD                                                                                    
		      ,FI.SHPR_ID                                                                                   
		      ,FI.CNEE_ID                                                                                   
		      ,FI.BL_ID                                                                                 
		      ,FI.SO_NO                                                                                    
		      ,FI.EO_NO                                                                                 
		      ,FI.STATUS_CODE                                                                                   
		      ,FI.ATCH_YN                                                                                   
		      ,IFNULL(FI.ARR_CLOS_YN , 'N') AS ARR_CLOS_YN                                                                                  
		      ,'' AS RQST_FILE_NM  /* JAVA에서 처리 :: FC_FW_GET_NO('LGIBLIMAGE', FI.BL_NO)    AS RQST_FILE_NM       */                                                                                  
		      ,'LGI'                                   AS IF_WRK_GRP_NM                                                 
		      ,'BL'                                    AS IMG_DOC_SPR_CD                                                
		      ,'Y'                                     AS DOC_MERG_YN                                                       
		      ,'N'                                     AS BLOB_ATCH_YN                                                  
		      ,''                                      AS BLOB_CONT                                         
		      ,'XML'                                   AS IMG_SEND_TYPE_NM                                                                  
		      ,'ORG'                                   AS EXP_CLASS_CODE                                                    
		      ,'' AS EDMS_YN /*[TODO-PJS] VW_ED_STATUS_01 VIEW Table 없음 :: IFNULL((SELECT  MAX('Y')                                                                                 
		                                                                              FROM  VW_ED_STATUS_01 X                           
		                                                                             WHERE  X.BL_ID      = FI.BL_ID                         
		                                                                               AND  X.BL_NO      = FI.BL_NO                         
		                                                                               AND  X.SMT_NO      = FI.SMT_NO                           
		                                                                               AND  X.EO_NO      = FI.EO_NO                         
		                                                                               AND   X.DOC_TYPE  IN (SELECT SA.OUTR_CD                              
		                                                                                                     FROM   TB_COM_CD_MPNG SA   
		                                                                                                     WHERE  1=1                                                                 
		                                                                                                     AND    SA.CD_TYPE_CD = 'C'                                                                 
		                                                                                                     AND    SA.CD_MPNG_SPR_NM = 'EDMS_IMG_REQ_IF_DOC_KIND'                                                              
		                                                                                                     AND    SA.INSD_CD = 'b2bFW1131'                                                                    
		                                                                                                     AND    SA.USE_YN = 'Y')                                                                    
		                                                                               AND  X.IMG_STATUS IN ('C' , 'U')                             
		                                                                       ),'N')  AS EDMS_YN*/     /*2020.10.26 김정숙 [CSR ID:4321480] [개발] LG상사 미전송 조회 기능 보완 | [요청번호]C20201023_21480 */                                 
		     ,(SELECT SA.ONBR_CLOS_YN  FROM TB_FWD_BL SA WHERE SA.BL_ID  = FI.BL_ID LIMIT 1) AS ONBR_CLOS_YN                                                                                    
		     ,'Y' AS CHK_FLAG                                                                                                                   
		  FROM NFINF.TB_FWD_INT655 FI                                                                                   
		      ,NFINF.TB_EDI_MASTER_S EMS                                                                                    
		 WHERE FI.INTERFACE_ID = EMS.INTERFACE_ID                                                                                   
         /*  {#1}*/
        <if test='stat != null and stat != "" and stat == "N"'>
            AND    1 = 2 /* 조회 되지 않도록  */
        </if>
		<if test='exctSprCd != null and exctSprCd != ""'>
            AND (CASE
                    WHEN FI.TRANS_MODE = 'AIR'
                    THEN 'AR'
                    WHEN FI.TRANS_MODE = 'VSL'
                    THEN 'OC'
                    ELSE FI.TRANS_MODE
                END) =  #{exctSprCd}   /* 업무구분코드(VSL=Vessel, AIR=Air, TUS=TRUCK,Rail etc.) */
        </if>      
		<if test='dateType != null and dateType != "" and dateType == "OB"'>
            /* from~to 날짜  OB^OBD DT,AR^ARR DT,SD^Send DT */
            AND FI.ETD_DATE BETWEEN #{fromDt} AND #{toDt} /* 출항일자 */
        </if>
		<if test='dateType != null and dateType != "" and dateType == "AR"'>
            AND FI.ETA_DATE BETWEEN #{fromDt} AND #{toDt} /* 입항일자 */
        </if>
		<if test='dateType != null and dateType != "" and dateType == "SD"'>
            AND EMS.IF_END_DATE BETWEEN #{fromDt} AND #{toDt} /* 전송일자 */
        </if>
        <if test='polCd != null and polCd != "" and polType == "CT"'>
            AND FI.LOADING_PORT = #{polCd}
        </if>
        <if test='polCd != null and polCd != "" and polType == "NA"'>
	        AND EXISTS (SELECT 1
	                    FROM    TB_COM_LOC X
	                    WHERE   1=1
	                    AND     X.USE_YN = 'Y'
	                    AND     X.LOC_CD = FI.LOADING_PORT
	                    AND     X.NATN_CD = #{polCd})
        </if>
        <if test='podCd != null and podCd != "" and podType == "CT"'>
            AND FI.ARRIVAL_PORT = #{podCd}
        </if>
        <if test='podCd != null and podCd != "" and podType == "NA"'>
	        AND EXISTS (SELECT  1
	                    FROM    TB_COM_LOC X
	                    WHERE   1=1
	                    AND     X.USE_YN = 'Y'
	                    AND     X.LOC_CD = FI.ARRIVAL_PORT
	                    AND     X.NATN_CD = #{podCd})
        </if>
        <if test='shppCd != null and shppCd != ""'>
            AND FI.SHPR_ID = #{shppCd} /* shpr조건 */
        </if>
        <if test='cneeCd != null and cneeCd != ""'>
            AND FI.CNEE_ID =  #{cneeCd}/* cnee조건 */
        </if>
        <if test='carrCd != null and carrCd != ""'>
            AND FI.SHIPPING_LINE =  #{carrCd}/* 운송사 조건 */
        </if>
        <if test='switchYn != null and switchYn != ""'>
            AND FI.SWITCH_YN =  #{switchYn}
        </if>
        <if test='incotCd != null and incotCd != ""'>
            AND FI.INCOTEMRS =  #{incotCd}
        </if>
        <if test='blno != null and blno != "" and noType == "SO"'>
            AND REGEXP_LIKE ( FI.SO_NO, REPLACE(#{blno} , ',' ,'|') )
        </if>
        <if test='blno != null and blno != "" and noType == "BL"'>
            AND REGEXP_LIKE ( FI.BL_NO, REPLACE(#{blno} , ',' ,'|') )
        </if>
        <if test='blno != null and blno != "" and noType == "CN"'>
            AND REGEXP_LIKE ( FI.CNTR_NO, REPLACE(#{blno} , ',' ,'|') )
        </if>
        <if test='blno != null and blno != "" and noType == "IN"'>
            AND REGEXP_LIKE ( FI.INV_NO, REPLACE(#{blno} , ',' ,'|') )
        </if>
		UNION ALL                                                                                   
		SELECT BL.*                                                                                 
		  FROM (                                                                                    
		        SELECT 'F' AS CHK                                                                           
		              ,'N' AS STAT                                                                          
		              ,'' AS SEND_DATE                                                                          
		              ,A.ONBR_YMD AS SHIPPING_DATE                                                                          
		              ,C.REF_NO AS INV_NO                                                                           
		              ,(CASE                                                                            
		                    WHEN A.EXCT_SPR_CD='OC'                                                                 
		                    THEN IFNULL(E.CNTR_NO, A.BL_NO)                                                                 
		                    WHEN A.EXCT_SPR_CD='AR'                                                                 
		                    THEN IFNULL(A.MBL_NO, A.BL_NO)                                                                  
		                END) AS CNTR_NO                                                                         
		              ,A.BL_NO                                                                          
		              ,A.BL_SWITCH_YN AS SWITCH_YN                                                                          
		              ,IFNULL( (SELECT  TASK.CARR_CD                                                                        
		                        FROM    TB_SMT_INTG_TASK_DEPT TASK                                                                      
		                        WHERE   TASK.CST_BL_ID = A.BL_ID                                                                    
		                        AND     TASK.EO_NO = A.EO_NO                                                                            
		                        AND     TASK.DEL_YN = 'N'                                                                       
		                        AND     A.DEL_YN = 'N'                                                                              
		                        AND     TASK.TASK_SPR_CD ='EXP')                                                                        
		                     ,                                                                          
		                      (SELECT   TASK.CARR_CD                                                                        
		                       FROM     TB_SMT_INTG_TASK_DEPT TASK                                                                      
		                       WHERE    TASK.CST_BL_ID = A.BL_ID                                                                        
		                       AND      TASK.EO_NO = A.EO_NO                                                                        
		                       AND      TASK.DEL_YN = 'N'                                                                       
		                       AND      A.DEL_YN = 'N'                                                                          
		                       AND      TASK.TASK_SPR_CD ='IMP')                                                                    
		                   )                                                                            
		                 AS SHIPPING_LINE                                                                           
		              ,IFNULL( A.CARR_NM                                                                            
		                     ,IFNULL(                                                                           
		                           (SELECT (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetBizptnrNm">
						                         <property name="bizptnrCd" value="TASK.CARR_CD"/>
						                     </include>) AS NM /* Mybatis Include 처리 :: FC_CM_GET_BIZPTNR_NM( TASK.CARR_CD ) AS NM */                                                                           
		                              FROM TB_SMT_INTG_TASK_DEPT TASK                                                                           
		                             WHERE TASK.CST_BL_ID = A.BL_ID                                                                         
		                               AND TASK.EO_NO = A.EO_NO                                                                                 
		                               AND TASK.DEL_YN = 'N'                                                                            
		                               AND A.DEL_YN = 'N'                                                                               
		                               AND TASK.TASK_SPR_CD ='EXP')                                                                         
		                           ,                                                                            
		                            (SELECT (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetBizptnrNm">
                                                 <property name="bizptnrCd" value="TASK.CARR_CD"/>
                                             </include>) AS NM /* Mybatis Include 처리 :: FC_CM_GET_BIZPTNR_NM( TASK.CARR_CD ) AS NM */                                                                          
		                              FROM TB_SMT_INTG_TASK_DEPT TASK                                                                            
		                             WHERE TASK.CST_BL_ID = A.BL_ID                                                                         
		                               AND TASK.EO_NO = A.EO_NO                                                                                 
		                               AND TASK.DEL_YN = 'N'                                                                                
		                               AND A.DEL_YN = 'N'                                                                               
		                               AND TASK.TASK_SPR_CD ='IMP')                                                                         
		                          )                                                                                 
		                     )                                                                          
		                 AS SHIPPING_NAME                                                                           
		                ,(SELECT SUM(ITEM_QTY) AS SUM_ITEM_QTY                                                                      
		                    FROM TB_FWD_INTG_ITEM II                                                                        
		                   WHERE 1=1                                                                        
		                     AND II.INTG_KEY_ID = A.BL_ID                                                                       
		                     AND II.DEL_YN = 'N'                                                                        
		                 ) AS STUFFING_QTY                                                                      
		              ,(CASE                                                                            
		                    WHEN A.EXCT_SPR_CD='OC'                                                                 
		                    THEN E.CNTR_SIZE_CD||'FT'                                                                   
		                    WHEN A.EXCT_SPR_CD='AR'                                                                 
		                    THEN 'AIR'                                                                  
		                END ) AS CNTR_TYPE                                                                          
		              ,(CASE                                                                                
		                    WHEN A.EXCT_SPR_CD='OC'                                                                 
		                    THEN 'VSL'                                                                  
		                    WHEN A.EXCT_SPR_CD='AR'                                                                 
		                    THEN 'AIR'                                                                  
		                    ELSE A.EXCT_SPR_CD                                                                  
		                END ) AS TRANS_MODE                                                                         
		              ,(SELECT SUM(DOL_FRGH_AMT) AS LOGISITIC_FEE                                                                           
		                FROM TB_ISM_SELLBUY ISB                                                                     
		                WHERE ISB.BL_ID = A.BL_ID                                                                       
		                AND ISB.SELLBUY_SPR_CD ='SO'                                                                        
		                AND ISB.DEL_YN = 'N'                                                                        
		                AND EXISTS (                                                                        
		                              SELECT 1                                                                              
		                                FROM TB_COM_ETC_CD A                                                                                
		                               WHERE A.USE_YN = 'Y'                                                                             
		                                 AND A.CLAS_CD = '2322'                                                                             
		                                 AND A.RMK_CONT = 'BILL'                                                                                
		                                 AND A.DTL_CD_NM = ISB.BILG_BIZPTNR_CD                                                                                  
		                            )                                                                           
		                ) AS LOGISITIC_FEE                                                                      
		              ,'USD' AS CURRENCY_CD                                                                         
		              ,( SELECT SUM(TXN_FRGH_AMT) AS LOGISITIC_FEE                                                                          
		                 FROM   TB_ISM_SELLBUY ISB                                                                          
		                 WHERE  ISB.BL_ID = A.BL_ID                                                                         
		                 AND    ISB.SELLBUY_SPR_CD ='SO'                                                                            
		                 AND    ISB.TXN_CUR_CD = 'KRW'                                                                          
		                 AND    ISB.DEL_YN = 'N'                                                                            
		                 AND EXISTS (                                                                               
		                              SELECT 1                                                                              
		                                FROM TB_COM_ETC_CD A                                                                                
		                               WHERE A.USE_YN = 'Y'                                                                             
		                                 AND A.CLAS_CD = '2322'                                                                             
		                                 AND A.RMK_CONT = 'BILL'                                                                                
		                                 AND A.DTL_CD_NM = ISB.BILG_BIZPTNR_CD                                                                                  
		                             )                                                                              
		                  ) AS KRW_FEE                                                                          
		                ,A.ETD_YMD AS ETD_DATE                                                                      
		                ,A.ETA_YMD AS ETA_DATE                                                                      
		                ,A.ONBR_YMD AS ATD_DATE                                                                     
		                ,'' AS REV_ETA_DATE  /* [TODO-PJS] TB_VM_ORD_TRCKG Table 생성 필요  :: ( SELECT VST.POD_ETA_YMD                                                                       
		                     FROM TB_VM_ORD_TRCKG VST                                                                       
		                    WHERE VST.SMT_NO = A.SMT_NO                                                                     
		                      AND VST.BL_ID = A.BL_ID                                                                       
		                      AND VST.EXCT_SPR_CD = A.EXCT_SPR_CD                                                                       
		                      AND ( (A.EXCT_SPR_CD = 'AR' AND 1=1) OR ( A.EXCT_SPR_CD = 'OC' AND VST.CNTR_NO = E.CNTR_NO ) )                                                                        
		                      AND VST.DEL_YN = 'N'                                                                      
		                 ) AS REV_ETA_DATE */                                                                             
		                ,A.ARR_YMD AS ATA_DATE                                                                      
		                ,A.POL_CD AS LOADING_PORT                                                                       
		                ,A.POL_NM AS LOADING_PORT_NAME                                                                      
		                ,A.POD_CD AS ARRIVAL_PORT                                                                       
		                ,A.POD_NM AS ARRIVAL_PORT_NAME                                                                      
		                ,DATE_FORMAT(LAST_DAY(DATE_ADD(A.ONBR_YMD, INTERVAL 1 MONTH)) , 'YYYYMMDD' ) AS DUE_DATE                                                                        
		                ,A.INCOT_CD AS INCOTEMRS                                                                        
		              ,'' AS BL_FILE_NAME                                                                           
		              ,'' AS ATTR1                                                                          
		              ,'' AS ATTR2                                                                          
		              ,'' AS ATTR3                                                                          
		              ,'' AS ATTR4                                                                          
		              ,'' AS ATTR5                                                                          
		              ,'' AS ATTR6                                                                          
		              ,'' AS ATTR7                                                                          
		              ,'' AS ATTR8                                                                          
		              ,'' AS ATTR9                                                                          
		              ,'' AS ATTR10                                                                         
		              ,'' AS SEND_STAT                                                                          
		              ,'' AS MSG                                                                            
		              ,A.DEL_YN AS DEL_YN                                                                           
		              ,A.REG_DT AS REG_DT                                                                           
		              ,A.RSTR_ID AS RSTR_ID                                                                         
		              ,A.UPD_DT AS UPD_DT                                                                           
		              ,A.UPDR_ID AS UPDR_ID                                                                             
		              ,'' AS INTERFACE_ID                                                                           
		              ,'' AS INTERFACE_SEQ                                                                          
		              ,'' AS ZXMLDOCNO                                                                          
		              ,'PANTOS' AS FOWADER_CD                                                                           
		              ,A.SHPP_CD AS SHPR_ID                                                                     
		              ,A.CNEE_CD AS CNEE_ID                                                                     
		              ,A.BL_ID                                                                      
		              ,A.SMT_NO                                                                     
		              ,A.EO_NO                                                                      
		              ,'' AS STATUS_CODE                                                                            
		              ,'Y' AS ATCH_YN                                                                           
		              ,A.ARR_CLOS_YN AS ARR_CLOS_YN                                                                             
		              ,'' AS RQST_FILE_NM /* JAVA에서 처리 :: FC_FW_GET_NO('LGIBLIMAGE', A.BL_NO)    AS RQST_FILE_NM*/                                                                                   
		              ,'LGI'                                  AS IF_WRK_GRP_NM                                      
		              ,'BL'                                   AS IMG_DOC_SPR_CD                                     
		              ,'Y'                                    AS DOC_MERG_YN                                                
		              ,'N'                                    AS BLOB_ATCH_YN                                           
		              ,''                                     AS BLOB_CONT                                  
		              ,'XML'                                  AS IMG_SEND_TYPE_NM                                                           
		              ,'ORG'                                  AS EXP_CLASS_CODE                                         
		              ,'' AS EDMS_YN /* [TODO-PJS] VW_ED_STATUS_01 VIEW Table 없음 :: IFNULL((SELECT MAX('Y')                                                                                 
		                                                                                  FROM  VW_ED_STATUS_01 X                       
		                                                                                 WHERE  X.BL_ID      = A.BL_ID                      
		                                                                                   AND  X.BL_NO      = A.BL_NO                      
		                                                                                   AND  X.SMT_NO      = A.SMT_NO                        
		                                                                                   AND  X.EO_NO      = A.EO_NO                      
		                                                                                         AND   X.DOC_TYPE  IN (SELECT   SA.OUTR_CD                      
		                                                                                                               FROM     TB_CM_CD_MPNG SA   
		                                                                                                               WHERE    1=1                         
		                                                                                                               AND      SA.CD_TYPE_CD = 'C'                     
		                                                                                                               AND      SA.CD_MPNG_SPR_NM = 'EDMS_IMG_REQ_IF_DOC_KIND'                  
		                                                                                                               AND      SA.INSD_CD = 'b2bFW1131'                    
		                                                                                                               AND      SA.USE_YN = 'Y')                    
		                                                                                   AND  X.IMG_STATUS IN ('C' , 'U')                         
		                                                                                   ),'N')  AS   EDMS_YN*/  /*2020.10.26 김정숙 [CSR ID:4321480] [개발] LG상사 미전송 조회 기능 보완 | [요청번호]C20201023_21480 */                      
		              ,A.ONBR_CLOS_YN                                                                                   
		              ,'Y' AS CHK_FLAG                                                                                                                      
		          FROM TB_FWD_BL A                                                                          
		          LEFT OUTER JOIN TB_FWD_INTG_REF_NO C ON  C.INTG_KEY_ID = A.BL_ID                                                                          
		                                              AND C.DEL_YN = 'N'                                        
		                                              AND C.REF_NO_SPR_CD = 'IN'                                        
		          LEFT OUTER JOIN TB_FWD_BL_ITEM_MPNG D ON  D.BL_ID = A.BL_ID                                                                               
		                                               AND D.DEL_YN = 'N'                                           
		                                               AND D.MPNG_KIND_CD = 'OMI'                                           
		          LEFT OUTER JOIN TB_SMT_INTG_ITEM E ON  E.INTG_ITEM_NO = D.INTG_ITEM_NO                                                                            
		                                            AND E.DEL_YN = 'N'                                          
		                                            AND E.CNTR_YN = 'Y'                                         
		          INNER JOIN TB_SMT_ORD F ON  F.SMT_NO = A.SMT_NO                                                                           
		                                AND F.DEL_YN = 'N'                                                  
		         WHERE  1 = 1                                                                           
		           AND A.ONBR_CLOS_YN = 'Y'                                                                         
		           AND A.DEL_YN = 'N'                                                                           
		           AND A.BL_SPR_CD IN( 'H' , 'D' )                                                                          
		           AND A.EXCT_SPR_CD = 'OC'                                                                             
		           AND (                                                                            
		                   ( A.EXCT_SPR_CD = 'AR'                                                                           
		                     AND (                                                                          
		                           EXISTS (                                                                         
		                                    SELECT 1                                                                            
		                                      FROM TB_COM_ETC_CD ETC                                                                            
		                                     WHERE ETC.USE_YN = 'Y'                                                                         
		                                       AND ETC.CLAS_CD = '2322'                                                                         
		                                       AND ETC.RMK_CONT = 'SHIP'                                                                            
		                                       AND ETC.DTL_CD_NM = A.SHPP_CD                                                                                
		                                   )                                                                            
		                        OR EXISTS (                                                                         
		                                    SELECT 1                                                                            
		                                      FROM TB_COM_ETC_CD ETC                                                                            
		                                     WHERE ETC.USE_YN = 'Y'                                                                         
		                                       AND ETC.CLAS_CD = '2322'                                                                         
		                                       AND ETC.RMK_CONT = 'CNEE'                                                                            
		                                       AND ETC.DTL_CD_NM = A.CNEE_CD                                                                                
		                                   )                                                                                                    
		                         )                                                                                  
		                     AND EXISTS (                                                                           
		                                   SELECT 1                                                                         
		                                     FROM TB_SMT_ORD_SELL_BILG SB                                                                           
		                                         ,TB_COM_ETC_CD EC                                                                          
		                                    WHERE SB.BILG_BIZPTNR_CD = EC.DTL_CD_NM                                                                         
		                                      AND EC.USE_YN = 'Y'                                                                           
		                                      AND EC.CLAS_CD = '2322'                                                                           
		                                      AND EC.RMK_CONT = 'BILL'                                                                          
		                                      AND SB.SMT_NO = A.SMT_NO                                                                          
		                                 )                                                                                                  
		                    )                                                                           
		                OR ( A.EXCT_SPR_CD = 'OC'                                                                           
		                     AND EXISTS (                                                                           
		                                    SELECT 1                                                                            
		                                      FROM TB_COM_ETC_CD ETC                                                                            
		                                     WHERE ETC.USE_YN = 'Y'                                                                         
		                                       AND ETC.CLAS_CD = '2322'                                                                         
		                                       AND ETC.RMK_CONT = 'SALE'                                                                            
		                                       AND ETC.DTL_CD_NM = F.SALES_OFCR_EMPNO                                                                               
		                                 )                                                                          
		                    )                                                                           
		               )                                                                            
		            /* [TODO-PJS] VW_ED_STATUS_01 VIEW Table 없음 :: AND EXISTS (  SELECT 1                                                                           
		                                                                        FROM  VW_ED_STATUS_01 X                             
		                                                                       WHERE  X.BL_ID      = A.BL_ID                                
		                                                                         AND  X.BL_NO      = A.BL_NO                                
		                                                                         AND  X.SMT_NO      = A.SMT_NO                              
		                                                                         AND  X.EO_NO      = A.EO_NO                                
		                                                                         --AND  X.DOC_TYPE   IN ('04', '27')                                        
		                                                                         AND   X.DOC_TYPE  IN (SELECT SA.OUTR_CD                                        
		                                                                                                FROM  TB_CM_CD_MPNG SA                  
		                                                                                               WHERE 1=1                                            
		                                                                                                  AND  SA.CD_TYPE_CD = 'C'                                          
		                                                                                                  AND  SA.CD_MPNG_SPR_NM = 'EDMS_IMG_REQ_IF_DOC_KIND'                                       
		                                                                                                  AND    SA.INSD_CD = 'b2bFW1131'                                       
		                                                                                                  AND    SA.USE_YN = 'Y')                                       
		                                                                         AND  X.IMG_STATUS IN ('C' , 'U')                               
		                        )     */                                                                                                        
		           /*{#2}*/    
		           <if test='stat != null and stat != "" and stat == "Y"'>
	                   AND 1 = 2 /* 조회 되지 않도록  */
                   </if>
		           <if test='exctSprCd != null and exctSprCd != ""'>
                       AND A.EXCT_SPR_CD = #{exctSprCd} /* 업무구분코드( OC=Vessel, AR=Air, TUS=TRUCK,Rail etc.) */
                   </if>
		           <if test='dateType != null and dateType != "" and dateType == "OB"'>
                       /* from~to 날짜  OB^OBD DT,AR^ARR DT,SD^Send DT */
                       AND A.ONBR_YMD BETWEEN #{fromDt} AND #{toDt} /* 출항일자 */
                   </if>
		           <if test='dateType != null and dateType != "" and dateType == "AR"'>
                       AND A.ETA_YMD  BETWEEN #{fromDt} AND #{toDt} /* 입항일자 */
                   </if>
		           <if test='dateType != null and dateType != "" and dateType == "SD"'>
                       AND 1 = 2 /* 조회 되지 않도록  */
                   </if>
		           <if test='porCd != null and porCd != "" and porType == "CT"'>
                       AND A.POR_CD = #{porCd}
                   </if>
                   <if test='porCd != null and porCd != "" and porType == "NA"'>
                       AND EXISTS (SELECT 1
			                       FROM    TB_COM_LOC X
			                       WHERE   1=1
			                       AND     X.USE_YN = 'Y'
			                       AND     X.LOC_CD = A.POR_CD
			                       AND     X.NATN_CD = #{porCd})
                   </if>
                   <if test='polCd != null and polCd != "" and polType == "CT"'>
                       AND A.POL_CD = #{polCd}
                   </if>
                   <if test='polCd != null and polCd != "" and polType == "NA"'>
                       AND EXISTS (SELECT 1
                                   FROM    TB_COM_LOC X
                                   WHERE   1=1
                                   AND     X.USE_YN = 'Y'
                                   AND     X.LOC_CD = A.POL_CD
                                   AND     X.NATN_CD = #{polCd})
                   </if>
		           <if test='podCd != null and podCd != "" and podType == "CT"'>
                       AND A.POD_CD = #{podCd}
                   </if>
                   <if test='podCd != null and podCd != "" and podType == "NA"'>
                       AND EXISTS (SELECT 1
                                   FROM    TB_COM_LOC X
                                   WHERE   1=1
                                   AND     X.USE_YN = 'Y'
                                   AND     X.LOC_CD = A.A.POD_CD
                                   AND     X.NATN_CD = #{podCd})
                   </if>
		           <if test='pdelCd != null and pdelCd != "" and pdelType == "CT"'>
                       AND A.PDEL_CD = #{pdelCd}
                   </if>
                   <if test='pdelCd != null and pdelCd != "" and pdelType == "NA"'>
                       AND EXISTS (SELECT 1
                                   FROM    TB_COM_LOC X
                                   WHERE   1=1
                                   AND     X.USE_YN = 'Y'
                                   AND     X.LOC_CD = A.A.PDEL_CD
                                   AND     X.NATN_CD = #{pdelCd})
                   </if>
                   <if test='shppCd != null and shppCd != ""'>
                        AND A.SHPP_CD = #{shppCd} /* shpr조건 */
                   </if>
                   <if test='cneeCd != null and cneeCd != ""'>
                        AND A.CNEE_CD = #{cneeCd} /* cnee조건 */
                   </if>
                   <if test='ntfyCd != null and ntfyCd != ""'>
                        AND A.NTPR_CD = #{ntfyCd} /* ntfy 조건 */
                   </if>
                   <if test='switchYn != null and switchYn != ""'>
                        AND A.BL_SWITCH_YN = #{switchYn}
                   </if>
                   <if test='incotCd != null and incotCd != ""'>
                        AND A.INCOT_CD = #{incotCd}
                   </if>
                   <if test='blno != null and blno != "" and noType == "SO"'>
			            AND REGEXP_LIKE ( A.SMT_NO, REPLACE(#{blno} , ',' ,'|') )
			        </if>
			        <if test='blno != null and blno != "" and noType == "BL"'>
			            AND REGEXP_LIKE ( A.BL_NO, REPLACE(#{blno} , ',' ,'|') )
			        </if>
			        <if test='blno != null and blno != "" and noType == "IN"'>
			            AND REGEXP_LIKE ( C.REF_NO, REPLACE(#{blno} , ',' ,'|') )
			        </if>
            ) BL                                                                         
		    WHERE 1=1                                                                               
		      AND NOT EXISTS (                                                                                  
		                          SELECT 1                                                                          
		                            FROM NFINF.TB_FWD_INT655 TFI                                                                            
		                           WHERE TFI.BL_ID = BL.BL_ID                                                                           
		                               AND TFI.INV_NO = BL.INV_NO                                                                           
		                               AND TFI.CNTR_NO = BL.CNTR_NO                                                                         
		                               AND TFI.DEL_YN = 'N'                                                                                 
		                      )                                                                         
		        /*{#3}*/
              <if test='carrCd != null and carrCd != "" '>
                  AND BL.SHIPPING_LINE =  #{carrCd}/* 운송사 조건 */
              </if>
              <if test='blno != null and blno != "" and noType == "CN" '>
                  AND REGEXP_LIKE ( BL.CNTR_NO, REPLACE(#{blno} , ',' ,'|') )
              </if>                                                                           
		UNION ALL                                                                                   
		SELECT BL.*                                                                                 
		  FROM (                                                                                    
		        SELECT                                                                              
		              'F' AS CHK                                                                        
		              ,'N' AS STAT                                                                          
		              ,'' AS SEND_DATE                                                                          
		              ,A.ONBR_YMD AS SHIPPING_DATE                                                                          
		              ,C.REF_NO AS INV_NO                                                                           
		              ,(CASE                                                                            
		                    WHEN A.EXCT_SPR_CD='OC'                                                                 
		                    THEN IFNULL(E.CNTR_NO, A.BL_NO)                                                                 
		                    WHEN A.EXCT_SPR_CD='AR'                                                                 
		                    THEN IFNULL(A.MBL_NO, A.BL_NO)                                                                  
		                END) AS CNTR_NO                                                                         
		              ,A.BL_NO                                                                          
		              ,A.BL_SWITCH_YN AS SWITCH_YN                                                                          
		              ,IFNULL( (SELECT TASK.CARR_CD                                                                         
		                       FROM TB_SMT_INTG_TASK_DEPT TASK                                                                          
		                      WHERE TASK.CST_BL_ID = A.BL_ID                                                                            
		                        AND TASK.EO_NO = A.EO_NO                                                                                
		                        AND TASK.DEL_YN = 'N'                                                                           
		                        AND A.DEL_YN = 'N'                                                                                  
		                        AND TASK.TASK_SPR_CD ='EXP')                                                                            
		                     ,                                                                          
		                    (SELECT TASK.CARR_CD                                                                            
		                       FROM TB_SMT_INTG_TASK_DEPT TASK                                                                          
		                      WHERE TASK.CST_BL_ID = A.BL_ID                                                                            
		                        AND TASK.EO_NO = A.EO_NO                                                                                
		                        AND TASK.DEL_YN = 'N'                                                                               
		                        AND A.DEL_YN = 'N'                                                                                  
		                        AND TASK.TASK_SPR_CD ='IMP')                                                                            
		                   )                                                                            
		                 AS SHIPPING_LINE                                                                           
		              ,IFNULL( A.CARR_NM                                                                            
		                     ,IFNULL(                                                                           
		                           (SELECT (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetBizptnrNm">
                                                 <property name="bizptnrCd" value="TASK.CARR_CD"/>
                                             </include>) AS NM /* Mybatis Include 처리 :: FC_CM_GET_BIZPTNR_NM( TASK.CARR_CD ) AS NM */                                                                           
		                              FROM TB_SMT_INTG_TASK_DEPT TASK                                                                           
		                             WHERE TASK.CST_BL_ID = A.BL_ID                                                                         
		                               AND TASK.EO_NO = A.EO_NO                                                                                 
		                               AND TASK.DEL_YN = 'N'                                                                            
		                               AND A.DEL_YN = 'N'                                                                               
		                               AND TASK.TASK_SPR_CD ='EXP')                                                                         
		                           ,                                                                            
		                            (SELECT (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetBizptnrNm">
                                                 <property name="bizptnrCd" value="TASK.CARR_CD"/>
                                             </include>) AS NM /* Mybatis Include 처리 :: FC_CM_GET_BIZPTNR_NM( TASK.CARR_CD ) AS NM */                                                                          
		                              FROM TB_SMT_INTG_TASK_DEPT TASK                                                                           
		                             WHERE TASK.CST_BL_ID = A.BL_ID                                                                         
		                               AND TASK.EO_NO = A.EO_NO                                                                                 
		                               AND TASK.DEL_YN = 'N'                                                                                
		                               AND A.DEL_YN = 'N'                                                                               
		                               AND TASK.TASK_SPR_CD ='IMP')                                                                         
		                          )                                                                                 
		                     )                                                                          
		                 AS SHIPPING_NAME                                                                           
		                ,(SELECT SUM(ITEM_QTY) AS SUM_ITEM_QTY                                                                      
		                    FROM TB_FWD_INTG_ITEM II                                                                        
		                   WHERE 1=1                                                                        
		                     AND II.INTG_KEY_ID = A.BL_ID                                                                       
		                     AND II.DEL_YN = 'N'                                                                        
		                 ) AS STUFFING_QTY                                                                      
		              ,(CASE                                                                            
		                    WHEN A.EXCT_SPR_CD='OC'                                                                 
		                    THEN E.CNTR_SIZE_CD||'FT'                                                                   
		                    WHEN A.EXCT_SPR_CD='AR'                                                                 
		                    THEN 'AIR'                                                                  
		                END ) AS CNTR_TYPE                                                                          
		              ,(CASE                                                                            
		                    WHEN A.EXCT_SPR_CD='OC'                                                                 
		                    THEN 'VSL'                                                                  
		                    WHEN A.EXCT_SPR_CD='AR'                                                                 
		                    THEN 'AIR'                                                                  
		                    ELSE A.EXCT_SPR_CD                                                                  
		                END ) AS TRANS_MODE                                                                         
		                ,( SELECT SUM(DOL_FRGH_AMT) AS LOGISITIC_FEE                                                                        
		                     FROM TB_ISM_SELLBUY ISB                                                                        
		                    WHERE ISB.BL_ID = A.BL_ID                                                                       
		                      AND ISB.SELLBUY_SPR_CD ='SO'                                                                      
		                      AND ISB.DEL_YN = 'N'                                                                      
		                      AND EXISTS (                                                                      
		                                      SELECT /*+ NO_UNNEST*/ 1                                                                      
		                                        FROM TB_COM_ETC_CD A                                                                        
		                                       WHERE A.USE_YN = 'Y'                                                                     
		                                         AND A.CLAS_CD = '2322'                                                                     
		                                         AND A.RMK_CONT = 'BILL'                                                                        
		                                         AND A.DTL_CD_NM = ISB.BILG_BIZPTNR_CD                                                                          
		                                 )                                                                      
		                 ) AS LOGISITIC_FEE                                                                     
		              ,'USD' AS CURRENCY_CD                                                                         
		              ,( SELECT SUM(TXN_FRGH_AMT) AS LOGISITIC_FEE                                                                          
		                     FROM TB_ISM_SELLBUY ISB                                                                            
		                    WHERE ISB.BL_ID = A.BL_ID                                                                           
		                      AND ISB.SELLBUY_SPR_CD ='SO'                                                                          
		                      AND ISB.TXN_CUR_CD = 'KRW'                                                                            
		                      AND ISB.DEL_YN = 'N'                                                                          
		                      AND EXISTS (                                                                          
		                                  SELECT /*+ NO_UNNEST*/ 1                                                                          
		                                    FROM TB_COM_ETC_CD A                                                                            
		                                   WHERE A.USE_YN = 'Y'                                                                         
		                                     AND A.CLAS_CD = '2322'                                                                         
		                                     AND A.RMK_CONT = 'BILL'                                                                            
		                                     AND A.DTL_CD_NM = ISB.BILG_BIZPTNR_CD                                                                              
		                                 )                                                                          
		                  ) AS KRW_FEE                                                                          
		                ,A.ETD_YMD AS ETD_DATE                                                                      
		                ,A.ETA_YMD AS ETA_DATE                                                                      
		                ,A.ONBR_YMD AS ATD_DATE                                                                     
		                ,'' AS REV_ETA_DATE /* [TODO_PJS] TB_VM_ORD_TRCKG Table 생성 필요  :: ( SELECT VST.POD_ETA_YMD                                                                       
		                     FROM TB_VM_ORD_TRCKG VST                                                                       
		                    WHERE VST.SMT_NO = A.SMT_NO                                                                     
		                      AND VST.BL_ID = A.BL_ID                                                                       
		                      AND VST.EXCT_SPR_CD = A.EXCT_SPR_CD                                                                       
		                      AND ( (A.EXCT_SPR_CD = 'AR' AND 1=1) OR ( A.EXCT_SPR_CD = 'OC' AND VST.CNTR_NO = E.CNTR_NO ) )                                                                        
		                      AND VST.DEL_YN = 'N'                                                                      
		               ) AS REV_ETA_DATE */                                                                               
		                ,A.ARR_YMD AS ATA_DATE                                                                      
		                ,A.POL_CD AS LOADING_PORT                                                                       
		                ,A.POL_NM AS LOADING_PORT_NAME                                                                      
		                ,A.POD_CD AS ARRIVAL_PORT                                                                       
		                ,A.POD_NM AS ARRIVAL_PORT_NAME                                                                      
		                ,DATE_FORMAT(LAST_DAY(DATE_ADD(A.ONBR_YMD, INTERVAL 1 MONTH)) , 'YYYYMMDD' ) AS DUE_DATE                                                                        
		                ,A.INCOT_CD AS INCOTEMRS                                                                        
		              ,'' AS BL_FILE_NAME                                                                           
		              ,'' AS ATTR1                                                                          
		              ,'' AS ATTR2                                                                          
		              ,'' AS ATTR3                                                                          
		              ,'' AS ATTR4                                                                          
		              ,'' AS ATTR5                                                                          
		              ,'' AS ATTR6                                                                          
		              ,'' AS ATTR7                                                                          
		              ,'' AS ATTR8                                                                          
		              ,'' AS ATTR9                                                                          
		              ,'' AS ATTR10                                                                         
		              ,'' AS SEND_STAT                                                                          
		              ,'' AS MSG                                                                            
		              ,A.DEL_YN AS DEL_YN                                                                           
		              ,A.REG_DT AS REG_DT                                                                           
		              ,A.RSTR_ID AS RSTR_ID                                                                         
		              ,A.UPD_DT AS UPD_DT                                                                           
		              ,A.UPDR_ID AS UPDR_ID                                                                             
		              ,'' AS INTERFACE_ID                                                                           
		              ,'' AS INTERFACE_SEQ                                                                          
		              ,'' AS ZXMLDOCNO                                                                          
		              ,'PANTOS' AS FOWADER_CD                                                                           
		              ,A.SHPP_CD AS SHPR_ID                                                                     
		              ,A.CNEE_CD AS CNEE_ID                                                                     
		              ,A.BL_ID                                                                      
		              ,A.SMT_NO                                                                     
		              ,A.EO_NO                                                                      
		              ,'' AS STATUS_CODE                                                                            
		              ,'Y' AS ATCH_YN                                                                           
		              ,A.ARR_CLOS_YN AS ARR_CLOS_YN                                                                             
		              ,'' AS RQST_FILE_NM /* JAVA에서 처리 :: FC_FW_GET_NO('LGIBLIMAGE', A.BL_NO)    AS RQST_FILE_NM*/                                                                           
		              ,'LGI'                                  AS IF_WRK_GRP_NM                                      
		              ,'BL'                                   AS IMG_DOC_SPR_CD                                     
		              ,'Y'                                    AS DOC_MERG_YN                                                
		              ,'N'                                    AS BLOB_ATCH_YN                                           
		              ,''                                     AS BLOB_CONT                                  
		              ,'XML'                                  AS IMG_SEND_TYPE_NM                                                           
		              ,'ORG'                                  AS EXP_CLASS_CODE                                         
		              ,'' AS EDMS_YN /* [TODO-PJS] VW_ED_STATUS_01 VIEW Table 없음 :: IFNULL((SELECT MAX('Y')                                                                                 
		                                                                          FROM  VW_ED_STATUS_01 X                               
		                                                                         WHERE  X.BL_ID      = A.BL_ID                              
		                                                                           AND  X.BL_NO      = A.BL_NO                              
		                                                                           AND  X.SMT_NO      = A.SMT_NO                                
		                                                                           AND  X.EO_NO      = A.EO_NO                              
		                                                                           AND  X.DOC_TYPE  IN (SELECT  SA.OUTR_CD                              
		                                                                                                FROM    TB_CM_CD_MPNG SA    
		                                                                                                WHERE   1=1                                 
		                                                                                                AND     SA.CD_TYPE_CD = 'C'                             
		                                                                                                AND     SA.CD_MPNG_SPR_NM = 'EDMS_IMG_REQ_IF_DOC_KIND'                          
		                                                                                                AND     SA.INSD_CD = 'b2bFW1131'                            
		                                                                                                AND     SA.USE_YN = 'Y')                            
		                                                                           AND  X.IMG_STATUS IN ('C' , 'U')                                 
		                                                                           ),'N')  AS   EDMS_YN*/  /*2020.10.26 김정숙 [CSR ID:4321480] [개발] LG상사 미전송 조회 기능 보완 | [요청번호]C20201023_21480 */                              
		              ,A.ONBR_CLOS_YN                                                                                   
		              ,'Y' AS CHK_FLAG                                                                                                                      
		          FROM TB_FWD_BL A                                                                          
		          LEFT OUTER JOIN TB_FWD_INTG_REF_NO C ON  C.INTG_KEY_ID = A.BL_ID                                                                          
		                                              AND C.DEL_YN = 'N'                                        
		                                              AND C.REF_NO_SPR_CD = 'IN'                                        
		          LEFT OUTER JOIN TB_FWD_BL_ITEM_MPNG D ON  D.BL_ID = A.BL_ID                                                                               
		                                               AND D.DEL_YN = 'N'                                           
		                                               AND D.MPNG_KIND_CD = 'OMI'                                           
		          LEFT OUTER JOIN TB_SMT_INTG_ITEM E ON  E.INTG_ITEM_NO = D.INTG_ITEM_NO                                                                            
		                                            AND E.DEL_YN = 'N'                                          
		                                            AND E.CNTR_YN = 'Y'                                         
		          INNER JOIN TB_SMT_ORD F ON  F.SMT_NO = A.SMT_NO                                                                           
		                                AND F.DEL_YN = 'N'                                                  
		         WHERE  1 = 1                                                                           
		           AND A.ONBR_CLOS_YN = 'Y'                                                                         
		           AND A.DEL_YN = 'N'                                                                           
		           AND A.BL_SPR_CD IN( 'H' , 'D' )                                                                          
		           AND A.EXCT_SPR_CD = 'AR'                                                                         
		           AND (                                                                            
		                   ( A.EXCT_SPR_CD = 'AR'                                                                           
		                     AND (                                                                          
		                           EXISTS (                                                                         
		                                    SELECT 1                                                                            
		                                      FROM TB_COM_ETC_CD ETC                                                                            
		                                     WHERE ETC.USE_YN = 'Y'                                                                         
		                                       AND ETC.CLAS_CD = '2322'                                                                         
		                                       AND ETC.RMK_CONT = 'SHIP'                                                                            
		                                       AND ETC.DTL_CD_NM = A.SHPP_CD                                                                                
		                                   )                                                                            
		                        OR EXISTS (                                                                         
		                                    SELECT 1                                                                            
		                                      FROM TB_COM_ETC_CD ETC                                                                            
		                                     WHERE ETC.USE_YN = 'Y'                                                                         
		                                       AND ETC.CLAS_CD = '2322'                                                                         
		                                       AND ETC.RMK_CONT = 'CNEE'                                                                            
		                                       AND ETC.DTL_CD_NM = A.CNEE_CD                                                                                
		                                   )                                                                                                    
		                         )                                                                                  
		                     AND EXISTS (                                                                           
		                                   SELECT 1                                                                         
		                                     FROM TB_SMT_ORD_SELL_BILG SB                                                                           
		                                         ,TB_COM_ETC_CD EC                                                                          
		                                    WHERE SB.BILG_BIZPTNR_CD = EC.DTL_CD_NM                                                                         
		                                      AND EC.USE_YN = 'Y'                                                                           
		                                      AND EC.CLAS_CD = '2322'                                                                           
		                                      AND EC.RMK_CONT = 'BILL'                                                                          
		                                      AND SB.SMT_NO = A.SMT_NO                                                                          
		                                 )                                                                                                  
		                    )                                                                           
		                OR ( A.EXCT_SPR_CD = 'OC'                                                                           
		                     AND EXISTS (                                                                           
		                                    SELECT /*+ NO_UNNEST*/ 1                                                                            
		                                      FROM TB_COM_ETC_CD ETC                                                                            
		                                     WHERE ETC.USE_YN = 'Y'                                                                         
		                                       AND ETC.CLAS_CD = '2322'                                                                         
		                                       AND ETC.RMK_CONT = 'SALE'                                                                            
		                                       AND ETC.DTL_CD_NM = F.SALES_OFCR_EMPNO                                                                               
		                                 )                                                                          
		                    )                                                                           
		               )                                                                            
		           /* [TODO-PJS] VW_ED_STATUS_01 VIEW Table 없음 :: AND EXISTS (  SELECT 1                                                                            
		                                                                        FROM  VW_ED_STATUS_01 X                             
		                                                                       WHERE  X.BL_ID      = A.BL_ID                                
		                                                                         AND  X.BL_NO      = A.BL_NO                                
		                                                                         AND  X.SMT_NO      = A.SMT_NO                              
		                                                                         AND  X.EO_NO      = A.EO_NO                                
		                                                                         --AND  X.DOC_TYPE   IN ('04', '27')                                        
		                                                                         AND   X.DOC_TYPE  IN (SELECT SA.OUTR_CD                                        
		                                                                                                FROM  TB_COM_CD_MPNG SA                 
		                                                                                               WHERE 1=1                                            
		                                                                                                  AND  SA.CD_TYPE_CD = 'C'                                          
		                                                                                                  AND  SA.CD_MPNG_SPR_NM = 'EDMS_IMG_REQ_IF_DOC_KIND'                                       
		                                                                                                  AND    SA.INSD_CD = 'b2bFW1131'                                       
		                                                                                                  AND    SA.USE_YN = 'Y')                                       
		                                                                         AND  X.IMG_STATUS IN ('C' , 'U')                               
		                        )     */                                                                            
		           /*{#2}*/
		           <if test='stat != null and stat != "" and stat == "Y"'>
                       AND 1 = 2 /* 조회 되지 않도록  */
                   </if>
                   <if test='exctSprCd != null and exctSprCd != ""'>
                       AND A.EXCT_SPR_CD = #{exctSprCd} /* 업무구분코드( OC=Vessel, AR=Air, TUS=TRUCK,Rail etc.) */
                   </if>
                   <if test='dateType != null and dateType != "" and dateType == "OB"'>
                       /* from~to 날짜  OB^OBD DT,AR^ARR DT,SD^Send DT */
                       AND A.ONBR_YMD BETWEEN #{fromDt} AND #{toDt} /* 출항일자 */
                   </if>
                   <if test='dateType != null and dateType != "" and dateType == "AR"'>
                       AND A.ETA_YMD  BETWEEN #{fromDt} AND #{toDt} /* 입항일자 */
                   </if>
                   <if test='dateType != null and dateType != "" and dateType == "SD"'>
                       AND 1 = 2 /* 조회 되지 않도록  */
                   </if>
                   <if test='porCd != null and porCd != "" and porType == "CT"'>
                       AND A.POR_CD = #{porCd}
                   </if>
                   <if test='porCd != null and porCd != "" and porType == "NA"'>
                       AND EXISTS (SELECT 1
                                   FROM    TB_COM_LOC X
                                   WHERE   1=1
                                   AND     X.USE_YN = 'Y'
                                   AND     X.LOC_CD = A.POR_CD
                                   AND     X.NATN_CD = #{porCd})
                   </if>
                   <if test='polCd != null and polCd != "" and polType == "CT"'>
                       AND A.POL_CD = #{polCd}
                   </if>
                   <if test='polCd != null and polCd != "" and polType == "NA"'>
                       AND EXISTS (SELECT 1
                                   FROM    TB_COM_LOC X
                                   WHERE   1=1
                                   AND     X.USE_YN = 'Y'
                                   AND     X.LOC_CD = A.POL_CD
                                   AND     X.NATN_CD = #{polCd})
                   </if>
                   <if test='podCd != null and podCd != "" and podType == "CT"'>
                       AND A.POD_CD = #{podCd}
                   </if>
                   <if test='podCd != null and podCd != "" and podType == "NA"'>
                       AND EXISTS (SELECT 1
                                   FROM    TB_COM_LOC X
                                   WHERE   1=1
                                   AND     X.USE_YN = 'Y'
                                   AND     X.LOC_CD = A.A.POD_CD
                                   AND     X.NATN_CD = #{podCd})
                   </if>
                   <if test='pdelCd != null and pdelCd != "" and pdelType == "CT"'>
                       AND A.PDEL_CD = #{pdelCd}
                   </if>
                   <if test='pdelCd != null and pdelCd != "" and pdelType == "NA"'>
                       AND EXISTS (SELECT 1
                                   FROM    TB_COM_LOC X
                                   WHERE   1=1
                                   AND     X.USE_YN = 'Y'
                                   AND     X.LOC_CD = A.A.PDEL_CD
                                   AND     X.NATN_CD = #{pdelCd})
                   </if>
                   <if test='shppCd != null and shppCd != ""'>
                        AND A.SHPP_CD = #{shppCd} /* shpr조건 */
                   </if>
                   <if test='cneeCd != null and cneeCd != ""'>
                        AND A.CNEE_CD = #{cneeCd} /* cnee조건 */
                   </if>
                   <if test='ntfyCd != null and ntfyCd != ""'>
                        AND A.NTPR_CD = #{ntfyCd} /* ntfy 조건 */
                   </if>
                   <if test='switchYn != null and switchYn != ""'>
                        AND A.BL_SWITCH_YN = #{switchYn}
                   </if>
                   <if test='incotCd != null and incotCd != ""'>
                        AND A.INCOT_CD = #{incotCd}
                   </if>
                   <if test='blno != null and blno != "" and noType == "SO"'>
                        AND REGEXP_LIKE ( A.SMT_NO, REPLACE(#{blno} , ',' ,'|') )
                    </if>
                    <if test='blno != null and blno != "" and noType == "BL"'>
                        AND REGEXP_LIKE ( A.BL_NO, REPLACE(#{blno} , ',' ,'|') )
                    </if>
                    <if test='blno != null and blno != "" and noType == "IN"'>
                        AND REGEXP_LIKE ( C.REF_NO, REPLACE(#{blno} , ',' ,'|') )
                    </if>
             ) BL                                                                         
		    WHERE 1=1                                                                               
		      AND NOT EXISTS (                                                                                  
		                          SELECT 1                                                                          
		                            FROM NFINF.TB_FWD_INT655 TFI                                                                         
		                           WHERE TFI.BL_ID = BL.BL_ID                                                                           
		                               AND TFI.INV_NO = BL.INV_NO                                                                           
		                               AND TFI.CNTR_NO = BL.CNTR_NO                                                                         
		                               AND TFI.DEL_YN = 'N'                                                                                 
		                      )                                                                         
	          /*{#3}*/
	          <if test='carrCd != null and carrCd != "" '>
                  AND BL.SHIPPING_LINE =  #{carrCd}/* 운송사 조건 */
              </if>
              <if test='blno != null and blno != "" and noType == "CN" '>
                  AND REGEXP_LIKE ( BL.CNTR_NO, REPLACE(#{blno} , ',' ,'|') )
              </if>
		UNION ALL                                                                                   
		SELECT FL.*                                                                                 
		FROM (                                                                                  
		  SELECT 'F' AS CHK                                                                                 
		        ,'N' AS STAT                                                                                    
		        ,'' AS SEND_DATE                                                                                    
		        ,A.ONBR_YMD AS SHIPPING_DATE                                                                                    
		        ,(SELECT    MAX(C.REF_NO)                                                                                       
		          FROM      TB_FWD_INTG_REF_NO C                                                                         
		          WHERE     C.INTG_KEY_ID=A.BL_ID                                                                               
		          AND       C.DEL_YN = 'N'                                                                          
		          AND       C.REF_NO_SPR_CD = 'IN' ) AS INV_NO                                                                          
		        ,'' AS CNTR_NO                                                                                                  
		        ,A.BL_NO                                                                                    
		        ,A.BL_SWITCH_YN AS SWITCH_YN                                                                                    
		        ,IFNULL( (SELECT TASK.CARR_CD                                                                                   
		                 FROM TB_SMT_INTG_TASK_DEPT TASK                                                                                    
		                WHERE TASK.CST_BL_ID = A.BL_ID                                                                                  
		                  AND TASK.EO_NO = A.EO_NO                                                                                          
		                  AND TASK.DEL_YN = 'N'                                                                                 
		                  AND A.DEL_YN = 'N'                                                                                        
		                  AND TASK.TASK_SPR_CD ='EXP')                                                                                  
		               ,                                                                                    
		              (SELECT TASK.CARR_CD                                                                                  
		                 FROM TB_SMT_INTG_TASK_DEPT TASK                                                                                    
		                WHERE TASK.CST_BL_ID = A.BL_ID                                                                                  
		                  AND TASK.EO_NO = A.EO_NO                                                                                          
		                  AND TASK.DEL_YN = 'N'                                                                                         
		                  AND A.DEL_YN = 'N'                                                                                        
		                  AND TASK.TASK_SPR_CD ='IMP')                                                                                  
		             )                                                                                  
		           AS SHIPPING_LINE                                                                                 
		        ,IFNULL( A.CARR_NM                                                                                  
		               ,IFNULL(                                                                                     
		                     (SELECT (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetBizptnrNm">
                                          <property name="bizptnrCd" value="TASK.CARR_CD"/>
                                      </include>) AS NM /* Mybatis Include 처리 :: FC_CM_GET_BIZPTNR_NM( TASK.CARR_CD ) AS NM */                                                                                 
		                        FROM TB_SMT_INTG_TASK_DEPT TASK                                                                                 
		                       WHERE TASK.CST_BL_ID = A.BL_ID                                                                                   
		                         AND TASK.EO_NO = A.EO_NO                                                                                           
		                         AND TASK.DEL_YN = 'N'                                                                                  
		                         AND A.DEL_YN = 'N'                                                                                         
		                         AND TASK.TASK_SPR_CD ='EXP')                                                                                   
		                     ,                                                                                  
		                      (SELECT (<include refid="fwd.common.fwdFuncInclude.fwdFcCmGetBizptnrNm">
                                           <property name="bizptnrCd" value="TASK.CARR_CD"/>
                                       </include>) AS NM /* Mybatis Include 처리 :: FC_CM_GET_BIZPTNR_NM( TASK.CARR_CD ) AS NM */                                                                                    
		                        FROM TB_SMT_INTG_TASK_DEPT TASK                                                                                 
		                       WHERE TASK.CST_BL_ID = A.BL_ID                                                                                   
		                         AND TASK.EO_NO = A.EO_NO                                                                                           
		                         AND TASK.DEL_YN = 'N'                                                                                          
		                         AND A.DEL_YN = 'N'                                                                                         
		                         AND TASK.TASK_SPR_CD ='IMP')                                                                                   
		                    )                                                                                       
		               )                                                                                    
		           AS SHIPPING_NAME                                                                                 
		        ,(SELECT SUM(ITEM_QTY) AS SUM_ITEM_QTY                                                                                  
		            FROM TB_FWD_INTG_ITEM II                                                                                 
		           WHERE 1=1                                                                                    
		             AND II.INTG_KEY_ID = A.BL_ID                                                                                   
		             AND II.DEL_YN = 'N'                                                                                    
		         ) AS STUFFING_QTY                                                                                  
		        ,''  AS CNTR_TYPE                                                                                               
		        ,(CASE                                                                                  
		                WHEN A.EXCT_SPR_CD='OC'                                                                     
		                THEN 'VSL'                                                                      
		                WHEN A.EXCT_SPR_CD='AR'                                                                     
		                THEN 'AIR'                                                                      
		                ELSE A.EXCT_SPR_CD                                                                      
		            END ) AS TRANS_MODE                                                                             
		        ,( SELECT SUM(DOL_FRGH_AMT) AS LOGISITIC_FEE                                                                                    
		             FROM TB_ISM_SELLBUY ISB                                                                                    
		            WHERE ISB.BL_ID = A.BL_ID                                                                                   
		              AND ISB.SELLBUY_SPR_CD ='SO'                                                                                  
		              AND ISB.DEL_YN = 'N'                                                                                  
		              AND EXISTS (                                                                                  
		                              SELECT /*+ NO_UNNEST*/ 1                                                                                  
		                                FROM TB_COM_ETC_CD A                                                                                    
		                               WHERE A.USE_YN = 'Y'                                                                                 
		                                 AND A.CLAS_CD = '2322'                                                                                 
		                                 AND A.RMK_CONT = 'BILL'                                                                                    
		                                 AND A.DTL_CD_NM = ISB.BILG_BIZPTNR_CD                                                                                      
		                         )                                                                                  
		         ) AS LOGISITIC_FEE                                                                                 
		        ,'USD' AS CURRENCY_CD                                                                                   
		        ,( SELECT SUM(TXN_FRGH_AMT) AS LOGISITIC_FEE                                                                                    
		               FROM TB_ISM_SELLBUY ISB                                                                                  
		              WHERE ISB.BL_ID = A.BL_ID                                                                                 
		                AND ISB.SELLBUY_SPR_CD ='SO'                                                                                    
		                AND ISB.TXN_CUR_CD = 'KRW'                                                                                  
		                AND ISB.DEL_YN = 'N'                                                                                    
		                AND EXISTS (                                                                                    
		                            SELECT /*+ NO_UNNEST*/ 1                                                                                    
		                              FROM TB_COM_ETC_CD A                                                                                  
		                             WHERE A.USE_YN = 'Y'                                                                                   
		                               AND A.CLAS_CD = '2322'                                                                                   
		                               AND A.RMK_CONT = 'BILL'                                                                                  
		                               AND A.DTL_CD_NM = ISB.BILG_BIZPTNR_CD                                                                                        
		                           )                                                                                    
		            ) AS KRW_FEE                                                                                    
		        ,A.ETD_YMD AS ETD_DATE                                                                                  
		        ,A.ETA_YMD AS ETA_DATE                                                                                  
		        ,A.ONBR_YMD AS ATD_DATE                                                                                 
		        ,'' AS REV_ETA_DATE                                                                                         
		        ,A.ARR_YMD AS ATA_DATE                                                                                  
		        ,A.POL_CD AS LOADING_PORT                                                                                   
		        ,A.POL_NM AS LOADING_PORT_NAME                                                                                  
		        ,A.POD_CD AS ARRIVAL_PORT                                                                                   
		        ,A.POD_NM AS ARRIVAL_PORT_NAME                                                                                  
		        ,DATE_FORMAT(LAST_DAY(DATE_ADD(A.ONBR_YMD, INTERVAL 1 MONTH)) , 'YYYYMMDD' ) AS DUE_DATE                                                                                    
		        ,A.INCOT_CD AS INCOTEMRS                                                                                    
		        ,'' AS BL_FILE_NAME                                                                                 
		        ,'' AS ATTR1                                                                                    
		        ,'' AS ATTR2                                                                                    
		        ,'' AS ATTR3                                                                                    
		        ,'' AS ATTR4                                                                                    
		        ,'' AS ATTR5                                                                                    
		        ,'' AS ATTR6                                                                                    
		        ,'' AS ATTR7                                                                                    
		        ,'' AS ATTR8                                                                                    
		        ,'' AS ATTR9                                                                                    
		        ,'' AS ATTR10                                                                                   
		        ,'' AS SEND_STAT                                                                                    
		        ,'' AS MSG                                                                                  
		        ,A.DEL_YN AS DEL_YN                                                                                 
		        ,A.REG_DT AS REG_DT                                                                                 
		        ,A.RSTR_ID AS RSTR_ID                                                                                   
		        ,A.UPD_DT AS UPD_DT                                                                                 
		        ,A.UPDR_ID AS UPDR_ID                                                                                               
		        ,'' AS INTERFACE_ID                                                                                 
		        ,'' AS INTERFACE_SEQ                                                                                    
		        ,'' AS ZXMLDOCNO                                                                                    
		        ,'PANTOS' AS FOWADER_CD                                                                                 
		      ,A.SHPP_CD AS SHPR_ID                                                                                 
		      ,A.CNEE_CD AS CNEE_ID                                                                                 
		      ,A.BL_ID                                                                                  
		      ,A.SMT_NO                                                                                 
		      ,A.EO_NO                                                                                  
		      ,'' AS STATUS_CODE                                                                                    
		      ,'Y' AS ATCH_YN                                                                                   
		      ,A.ARR_CLOS_YN AS ARR_CLOS_YN                                                                                     
		      ,'' AS RQST_FILE_NM /* JAVA에서 처리 :: FC_FW_GET_NO('LGIBLIMAGE', A.BL_NO)    AS RQST_FILE_NM*/                                                                                           
		      ,'LGI'                  AS IF_WRK_GRP_NM                                                                                  
		      ,'BL'                      AS IMG_DOC_SPR_CD                                                                                  
		      ,'Y'                        AS DOC_MERG_YN                                                                                        
		      ,'N'                        AS BLOB_ATCH_YN                                                                                   
		      ,''                    AS BLOB_CONT                                                                                   
		      ,'XML'                               AS IMG_SEND_TYPE_NM                                                                                      
		      ,'ORG'                   AS EXP_CLASS_CODE                                                                                    
		      ,'' AS EDMS_YN /* [TODO-PJS] VW_ED_STATUS_01 VIEW Table 없음 :: IFNULL((SELECT MAX('Y')                                                                                 
		                                                                                  FROM  VW_ED_STATUS_01 X                       
		                                                                                 WHERE  X.BL_ID      = A.BL_ID                      
		                                                                                   AND  X.BL_NO      = A.BL_NO                      
		                                                                                   AND  X.SMT_NO      = A.SMT_NO                        
		                                                                                   AND  X.EO_NO      = A.EO_NO                      
		                                                                                         AND   X.DOC_TYPE  IN (SELECT   SA.OUTR_CD                      
		                                                                                                               FROM     TB_CM_CD_MPNG SA   
		                                                                                                               WHERE    1=1                         
		                                                                                                               AND      SA.CD_TYPE_CD = 'C'                     
		                                                                                                               AND      SA.CD_MPNG_SPR_NM = 'EDMS_IMG_REQ_IF_DOC_KIND'                  
		                                                                                                               AND      SA.INSD_CD = 'b2bFW1131'                    
		                                                                                                               AND      SA.USE_YN = 'Y')                    
		                                                                                   AND  X.IMG_STATUS IN ('C' , 'U')                         
		                                                                                   ),'N')  AS   EDMS_YN*/ /*2020.10.26 김정숙 [CSR ID:4321480] [개발] LG상사 미전송 조회 기능 보완 | [요청번호]C20201023_21480 */                       
		      , A.ONBR_CLOS_YN                                                                                  
		      ,'N' AS CHK_FLAG                                                                                                      
		   FROM TB_FWD_BL A                                                                                         
		        ,TB_SMT_ORD F                                                                                   
		   WHERE  1 = 1                                                                                 
		       AND A.DEL_YN = 'N'                                                                                   
		       AND A.BL_SPR_CD IN( 'H' , 'D' )                                                                                  
		       AND A.SMT_NO = F.SMT_NO                                                                                  
		       AND (                                                                                    
		               ( A.EXCT_SPR_CD = 'AR'                                                                                   
		                 AND (                                                                                  
		                       EXISTS (                                                                                 
		                                SELECT 1                                                                                    
		                                  FROM TB_COM_ETC_CD ETC                                                                                    
		                                 WHERE ETC.USE_YN = 'Y'                                                                                 
		                                   AND ETC.CLAS_CD = '2322'                                                                                 
		                                   AND ETC.RMK_CONT = 'SHIP'                                                                                    
		                                   AND ETC.DTL_CD_NM = A.SHPP_CD                                                                                    
		                               )                                                                                    
		                    OR EXISTS (                                                                                 
		                                SELECT 1                                                                                    
		                                  FROM TB_COM_ETC_CD ETC                                                                                    
		                                 WHERE ETC.USE_YN = 'Y'                                                                                 
		                                   AND ETC.CLAS_CD = '2322'                                                                                 
		                                   AND ETC.RMK_CONT = 'CNEE'                                                                                    
		                                   AND ETC.DTL_CD_NM = A.CNEE_CD                                                                                    
		                               )                                                                                    
		                     )                                                                                  
		                 AND EXISTS (                                                                                   
		                               SELECT 1                                                                                 
		                                 FROM TB_SMT_ORD_SELL_BILG SB                                                                                   
		                                     ,TB_COM_ETC_CD EC                                                                                  
		                                WHERE SB.BILG_BIZPTNR_CD = EC.DTL_CD_NM                                                                                 
		                                  AND EC.USE_YN = 'Y'                                                                                   
		                                  AND EC.CLAS_CD = '2322'                                                                                   
		                                  AND EC.RMK_CONT = 'BILL'                                                                                  
		                                  AND SB.SMT_NO = A.SMT_NO                                                                                  
		                             )                                                                                  
		                )                                                                                   
		            OR ( A.EXCT_SPR_CD = 'OC'                                                                                   
		                 AND EXISTS (                                                                                   
		                                SELECT /*+ NO_UNNEST*/ 1                                                                                    
		                                  FROM TB_COM_ETC_CD ETC                                                                                    
		                                 WHERE ETC.USE_YN = 'Y'                                                                                 
		                                   AND ETC.CLAS_CD = '2322'                                                                                 
		                                   AND ETC.RMK_CONT = 'SALE'                                                                                    
		                                   AND ETC.DTL_CD_NM = F.SALES_OFCR_EMPNO                                                                                   
		                             )                                                                                  
		                )                                                                                   
		           )                                                                                    
		           /*{#2}*/
		           <if test='stat != null and stat != "" and stat == "Y"'>
                       AND 1 = 2 /* 조회 되지 않도록  */
                   </if>
                   <if test='exctSprCd != null and exctSprCd != ""'>
                       AND A.EXCT_SPR_CD = #{exctSprCd} /* 업무구분코드( OC=Vessel, AR=Air, TUS=TRUCK,Rail etc.) */
                   </if>
                   <if test='dateType != null and dateType != "" and dateType == "OB"'>
                       /* from~to 날짜  OB^OBD DT,AR^ARR DT,SD^Send DT */
                       AND A.ONBR_YMD BETWEEN #{fromDt} AND #{toDt} /* 출항일자 */
                   </if>
                   <if test='dateType != null and dateType != "" and dateType == "AR"'>
                       AND A.ETA_YMD  BETWEEN #{fromDt} AND #{toDt} /* 입항일자 */
                   </if>
                   <if test='dateType != null and dateType != "" and dateType == "SD"'>
                       AND 1 = 2 /* 조회 되지 않도록  */
                   </if>
                   <if test='porCd != null and porCd != "" and porType == "CT"'>
                       AND A.POR_CD = #{porCd}
                   </if>
                   <if test='porCd != null and porCd != "" and porType == "NA"'>
                       AND EXISTS (SELECT 1
                                   FROM    TB_COM_LOC X
                                   WHERE   1=1
                                   AND     X.USE_YN = 'Y'
                                   AND     X.LOC_CD = A.POR_CD
                                   AND     X.NATN_CD = #{porCd})
                   </if>
                   <if test='polCd != null and polCd != "" and polType == "CT"'>
                       AND A.POL_CD = #{polCd}
                   </if>
                   <if test='polCd != null and polCd != "" and polType == "NA"'>
                       AND EXISTS (SELECT 1
                                   FROM    TB_COM_LOC X
                                   WHERE   1=1
                                   AND     X.USE_YN = 'Y'
                                   AND     X.LOC_CD = A.POL_CD
                                   AND     X.NATN_CD = #{polCd})
                   </if>
                   <if test='podCd != null and podCd != "" and podType == "CT"'>
                       AND A.POD_CD = #{podCd}
                   </if>
                   <if test='podCd != null and podCd != "" and podType == "NA"'>
                       AND EXISTS (SELECT 1
                                   FROM    TB_COM_LOC X
                                   WHERE   1=1
                                   AND     X.USE_YN = 'Y'
                                   AND     X.LOC_CD = A.A.POD_CD
                                   AND     X.NATN_CD = #{podCd})
                   </if>
                   <if test='pdelCd != null and pdelCd != "" and pdelType == "CT"'>
                       AND A.PDEL_CD = #{pdelCd}
                   </if>
                   <if test='pdelCd != null and pdelCd != "" and pdelType == "NA"'>
                       AND EXISTS (SELECT 1
                                   FROM    TB_COM_LOC X
                                   WHERE   1=1
                                   AND     X.USE_YN = 'Y'
                                   AND     X.LOC_CD = A.A.PDEL_CD
                                   AND     X.NATN_CD = #{pdelCd})
                   </if>
                   <if test='shppCd != null and shppCd != ""'>
                        AND A.SHPP_CD = #{shppCd} /* shpr조건 */
                   </if>
                   <if test='cneeCd != null and cneeCd != ""'>
                        AND A.CNEE_CD = #{cneeCd} /* cnee조건 */
                   </if>
                   <if test='ntfyCd != null and ntfyCd != ""'>
                        AND A.NTPR_CD = #{ntfyCd} /* ntfy 조건 */
                   </if>
                   <if test='switchYn != null and switchYn != ""'>
                        AND A.BL_SWITCH_YN = #{switchYn}
                   </if>
                   <if test='incotCd != null and incotCd != ""'>
                        AND A.INCOT_CD = #{incotCd}
                   </if>
                   <if test='blno != null and blno != "" and noType == "SO"'>
                        AND REGEXP_LIKE ( A.SMT_NO, REPLACE(#{blno} , ',' ,'|') )
                    </if>
                    <if test='blno != null and blno != "" and noType == "BL"'>
                        AND REGEXP_LIKE ( A.BL_NO, REPLACE(#{blno} , ',' ,'|') )
                    </if>
		          ) FL                                                                              
		WHERE 1=1                                                                                   
		   AND (FL.EDMS_YN ='N'   OR  FL.ONBR_CLOS_YN = 'N'   OR FL.INV_NO IS NULL)                                                                                 
		   AND SUBSTR(BL_NO,1,4) NOT IN (SELECT T.INSD_CD                                                                                   
		                                        FROM TB_COM_CD_MPNG T                                                                                   
		                                       WHERE T.CD_MPNG_SPR_NM='LGI_EXCEPTION'                                                                                   
		                                          AND T.FMLA_CD='BL_NO'                                                                                 
		                                          AND T.USE_YN = 'Y')                                                                                   
		   AND SUBSTR(BL_NO,1,5) NOT IN (SELECT T.INSD_CD                                                                                   
		                                            FROM TB_COM_CD_MPNG T                                                                                   
		                                          WHERE T.CD_MPNG_SPR_NM='LGI_EXCEPTION'                                                                                    
		                                             AND T.FMLA_CD='BL_NO'                                                                                  
		                                             AND T.USE_YN = 'Y')                                                                                    
		   /*{#3}*/                                                                            
           <if test='carrCd != null and carrCd != "" '>
                AND FL.SHIPPING_LINE =  #{carrCd}/* 운송사 조건 */
           </if>
           <if test='blno != null and blno != "" and noType == "CN" '>
                AND REGEXP_LIKE ( FL.CNTR_NO, REPLACE(#{blno} , ',' ,'|') )
           </if>
           
           <if test='blno != null and blno != "" and noType == "IN"'>
               AND REGEXP_LIKE ( FL.INV_NO, REPLACE(#{blno} , ',' ,'|') )
           </if>
    </select>
    
    
    <!-- LG상사 전자영업 EDI 전송 DATA 등록  -->
    <insert id="insertLgiElecSalesEdiSend" parameterType="dataItem" >
        /* fwd.edi.fwdCstComIfMgnt.insertLgiElecSalesEdiSend */
        INSERT INTO NFINF.TB_FWD_INT655(
				     INTERFACE_ID
				    ,INTERFACE_SEQ
				    ,ZXMLDOCNO
				    ,FOWADER_CD
				    ,SHIPPING_DATE
				    ,INV_NO
				    ,CNTR_NO
				    ,BL_NO
				    ,SWITCH_YN
				    ,SHIPPING_LINE
				    ,SHIPPING_NAME
				    ,STUFFING_QTY
				    ,CNTR_TYPE
				    ,TRANS_MODE
				    ,LOGISITIC_FEE
				    ,CURRENCY_CD
				    ,ETD_DATE
				    ,ETA_DATE
				    ,ATD_DATE
				    ,REV_ETA_DATE
				    ,ATA_DATE
				    ,LOADING_PORT
				    ,LOADING_PORT_NAME
				    ,ARRIVAL_PORT
				    ,ARRIVAL_PORT_NAME
				    ,DUE_DATE
				    ,INCOTEMRS
				    ,BL_FILE_NAME
				    ,SHPR_ID
				    ,CNEE_ID
				    ,BL_ID
				    ,SO_NO
				    ,EO_NO
				    ,STATUS_CODE
				    ,ATCH_YN
				    ,ARR_CLOS_YN        
				    ,ATTR1
				    ,ATTR2
				    ,ATTR3
				    ,ATTR4
				    ,ATTR5
				    ,ATTR6
				    ,ATTR7
				    ,ATTR8
				    ,ATTR9
				    ,ATTR10
				    ,DEL_YN
				    ,REG_DT
				    ,RSTR_ID
	      )
	      VALUES
	      (
				    #{interfaceId}
				   ,1
				   ,DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
				   ,#{fowaderCd}
				   ,#{shippingDate}
				   ,#{invNo}
				   ,#{cntrNo}
				   ,#{blNo}
				   ,#{switchYn}
				   ,#{shippingLine}
				   ,#{shippingName}
				   ,#{stuffingQty}
				   ,#{cntrType}
				   ,(CASE
				     WHEN #{transMode}='OC'
				     THEN 'VSL'
				     WHEN #{transMode}='AR'
				     THEN 'AIR'
				     ELSE #{transMode}
				     END)
				   ,#{logisiticFee}
				   ,#{currencyCd}
				   ,#{etdDate}
				   ,#{etaDate}
				   ,#{atdDate}
				   ,#{revEtaDate}
				   ,#{ataDate}
				   ,#{loadingPort}
				   ,#{loadingPortName}
				   ,#{arrivalPort}
				   ,#{arrivalPortName}
				   ,#{dueDate}
				   ,#{incotemrs}
				   ,#{blFileName}
				   ,#{shprId}
				   ,#{cneeId}
				   ,#{blId}
				   ,#{soNo}
				   ,#{eoNo}
				   ,#{statusCode}
				   ,#{atchYn}
				   ,#{arrClosYn}
				   ,#{attr1}
				   ,#{attr2}
				   ,#{attr3}
				   ,#{attr4}
				   ,#{attr5}
				   ,#{attr6}
				   ,#{attr7}
				   ,#{attr8}
				   ,#{attr9}
				   ,#{attr10}       
				   ,'N'
				   ,NOW()
				   ,#{rstrId}
		      )
    </insert>
    
    
    
</mapper>